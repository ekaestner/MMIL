function [stim_labels,conds_contrast,stim_labels_model] = abcd_set_contrasts_nback(varargin)
%function [stim_labels,conds_contrast] = abcd_set_contrasts_nback(error_flag,extra_flag,stim_times_model)
%
% Purpose: create struct array specifying contrasts to perform for nBack task
%
% Optional input:
%   error_flag: [0|1] encode error trials as separate events
%    {default = 0}
%   extra_flag: [0|1] create timing files for extra, orthogonal event encoding
%    (i.e. 'target','lure','nonlure')
%    {default = 0}
% ' stim_times_flag': [0|1|2] use stimulus time files
%     0 = 1D, 1 = txt and 2 = block.txt 
%     {default = 1}
%
% Output:
%   stim_labels: list of the names of all conditions 
%   conds_contrast: struct array containing these fields:
%     groupA: cell array containing first set of condition names
%     groupB: cell array containing second set of condition names
%     name: contrast name
%  
%
% Created:  12/14/16 by Don Hagler
% Prev Mod: 09/12/17 by Don Hagler
% Last Mod: 10/26/17 by Dani Cornejo
%

conds_contrast = [];
stim_labels = [];
stim_labels_model = []; 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

parms = mmil_args2parms(varargin, { ...
  'error_flag',0,0:1,...
  'extra_flag',0,0:1,...
  });  
extra_flag = parms.extra_flag;
error_flag = parms.error_flag; 

condtypes = {'2_back','0_back'};
stimtypes = {'posface','neutface','negface','place'};
extra_stimtypes = {'target','lure','nonlure'};

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

if extra_flag
  stimtypes = cat(2,stimtypes,extra_stimtypes);
end;

condnames = {}; k = 1;
for i=1:length(condtypes)
  for j=1:length(stimtypes)
    tmpname = sprintf('%s_%s',condtypes{i},stimtypes{j});
    condnames{k} = tmpname;
    k = k + 1;
    if error_flag
      condnames{k} = [tmpname '_err'];
      k = k + 1;
    end;
  end;
end;

condnames = cat(2,condnames,'cue');

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

names_contrast = {...
  '0_back'...
  '2_back'...
  'place'...
  'emotion'...
  ...
  '2_back_vs_0_back'...
  'face_vs_place'...
  'emotion_vs_neutface'...
  'negface_vs_neutface'...
  'posface_vs_neutface'...
};

if extra_flag
  names_contrast = cat(2,names_contrast,{...
    'target'...
    'lure'...
    'nonlure'...
    ...
    'target_vs_lure'...
    'target_vs_nonlure'...
    'lure_vs_nonlure'...
  });
end;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

groupA = {...
  {'0_back_place','0_back_negface','0_back_neutface','0_back_posface'};...
  {'2_back_place','2_back_negface','2_back_neutface','2_back_posface'};...
  {'0_back_place','2_back_place'};...
  {'0_back_negface','2_back_negface','0_back_posface','2_back_posface'};...
  ...
  {'2_back_place','2_back_negface','2_back_neutface','2_back_posface'};...
  {'0_back_negface','2_back_negface','0_back_neutface','2_back_neutface','0_back_posface','2_back_posface'};...
  {'0_back_negface','2_back_negface','0_back_posface','2_back_posface'};...
  {'0_back_negface','2_back_negface'};...
  {'0_back_posface','2_back_posface'};...
};

if extra_flag
  groupA = cat(1,groupA,{...
    {'0_back_target','2_back_target'};...
    {'0_back_lure','2_back_lure'};...
    {'0_back_nonlure','2_back_nonlure'};...
    ...
    {'0_back_target','2_back_target'};...
    {'0_back_target','2_back_target'};...
    {'0_back_lure','2_back_lure'};...
  });
end;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

groupB = {...
  [];...
  [];...
  [];...
  [];...
  ...
  {'0_back_place','0_back_negface','0_back_neutface','0_back_posface'};...
  {'0_back_place','2_back_place'};...
  {'0_back_neutface','2_back_neutface'};...
  {'0_back_neutface','2_back_neutface'};...
  {'0_back_neutface','2_back_neutface'};...
}; 

if extra_flag
  groupB = cat(1,groupB,{...
    [];...
    [];...
    [];...
    ...
    {'0_back_lure','2_back_lure'};...
    {'0_back_nonlure','2_back_nonlure'};...
    {'0_back_nonlure','2_back_nonlure'};...  
  });
end;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

nconds = length(condnames);

stim_labels = {};
nevents = 0;
for i=1:nconds
  cond = condnames{i};
  nevents = nevents + 1;
  stim_labels{nevents} = sprintf('%s',cond);
end;


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

ncontrast = length(names_contrast);
for i=1:ncontrast
  conds_contrast(i).groupA = groupA{i};
  conds_contrast(i).groupB = groupB{i};
  conds_contrast(i).name = names_contrast{i}; 
end;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

