#############################################################################

## MMPS_101: minor revision to add CYCBI longitudinal processing ##
## Don Hagler 02/19/10

cd ~holland/bin
cp totalReg reg roiDv brainMaskFromSeg /home/mmildev/MMPS/MMPS_101/bin
cp -rp /home/holland/ADNI/params /home/mmildev/MMPS/MMPS_101/parms/CYCBI
cp -r /home/mmildev/matlab/EPDTI_PrePost/params /home/mmildev/MMPS/MMPS_101/parms/LONGDTI

% Dominic changed totalReg to allow input bin and parmdir

% renamed some old functions (may never use these again)
mv MMIL_Warp_Surface_Longitudinal.m MMIL_Warp_Surf_Long.m
mv MMIL_CleanUp_Longitudinal_Warped_Surface.m MMIL_CleanUp_Long_Warped_Surf.m

% changed MMIL_Long_Setup_Exam.m to NOT create masks from aseg
% created MMIL_Long_Register_Exams.m and MMIL_Long_Register_Exam.m
% changed EPDTI_MMIL_PrePost_Setup_Exams.m

% changes to REC_MMIL_Get_StudyInfo_NEW, REC_MMIL_Get_StudyInfo
% changes to REC_MMIL_RootDirs_NEW, REC_MMIL_RootDirs 
% change to REC_MMIL_Import_Viewer_QC
% changes to MMIL_Check_StudyInfo, MMIL_Check_RootDirs, MMIL_Get_Container

% REC_MMIL_Long_Setup_Exams
% REC_MMIL_Long_Register_Exams

% changes to DTI_MMIL_AsegMask_Fibers, DTI_MMIL_Convert_Fibers_to_Segmentation
%  DTI_MMIL_Analyze_Exam, DTI_MMIL_Analyze_Exams, DTI_MMIL_Analyze_Fibers_Exam,
%  EPDTI_MMIL_Analyze_DT_Exams, EPDTI_MMIL_Summarize_All_DT
%    to add exclCG_flag option to change how white matter masking is done

% MMIL_Analyze_Long_Exams
% MMIL_Analyze_Long_Exam
% REC_MMIL_Long_Analyze_Exams

cp -rp ~dhagler/svn/matlab/master /home/mmildev/MMPS/MMPS_101/matlab/timesurfer

% renamed MMIL_Analyze_MRIStats_Exam(s) to MMIL_Analyze_MRI_Exam(s)
% renamed MMIL_Summarize_MRIStats to MMIL_Summarize_MRI_Analysis
% renamed MMIL_Compile_MRIStats to MMIL_Compile_MRI_Analysis

% changed default output dir to 'analysis' from 'mmil'

% MMIL_Summarize_Long_Analysis
% MMIL_Compile_Long_Analysis

% changed MMIL_Summarize_MRI_Analysis
% changed MMIL_Compile_MRI_Analysis

% REC_MMIL_Summarize_Long_Analysis
% REC_MMIL_Compile_Long_Analysis

#############################################################################
#############################################################################

## MMPS_102: minor revision to remove references to /home/mmildev
## Don Hagler 03/05/10

mkdir /home/mmildev/MMPS/atlases
cp -rp /space/md5/2/data/MMILDB/mmildev/atlases /home/mmildev/MMPS/atlases/atlases.2009
cd /home/mmildev/MMPS/MMPS_102
ln -s ../atlases/atlases.2009 atlases

cd /home/mmildev/MMPS
cp -rp atlases /usr/pubsw/packages/MMPS

mv /home/mmildev/MMPS/MMPS_102/matlab/MMIL_Stream/identity.xfm /home/mmildev/MMPS/MMPS_102/parms
cd /home/mmildev/MMPS/MMPS_102/parms
mkdir MRIREG
mv input*.txt MRIREG

% removed references to mmildev:
%  DTI_Tools/DTI_load_qmat.m (switch to dev version)
%  AATL_Stream/AATL_MMIL_Freesurfer_Remake_Surfaces.m
%  new AATL_MMIL_RootDirs
%  AATL_Stream/AATL_MMIL_SetRootDirs.m
%  ADNI_Stream/ADNI_MMIL_Register_PET_to_MRI.m
%  ADNI_Stream/ADNI_MMIL_Register_and_Resample_MRI_Volumes_NEW.m
%  AUTSM_Stream/AUTSM_MMIL_Freesurfer_Recon_Exam.m
%  BOLD_Tools/BOLD_AtlasReg_to_T1.m
%  DTI_Tools/DTI_AtlasReg_to_T1.m
%  DTI_Tools/DTI_track_fibers.m
%  EPDTI_PrePost/EPDTI_MMIL_PrePost_Register_Exam.m 
%  MEGFWD_Stream/MEGFWD_MMIL_SetRootDirs.m
%  MMIL_Longitudinal/MMIL_Long_Register_DTI_Exam.m
%  MMIL_Longitudinal/MMIL_Long_Register_Exams.m
%  MMIL_Stream/MMIL_Freesurfer_Recon_v4_Exam.m
%  MMIL_Stream/MMIL_Register_and_Resample_MRI_Volumes.m
%  MMIL_Stream/MMIL_Register_and_Resample_MRI_Volumes_NEW.m
%  MMIL_Stream/MMIL_Resamp_FSRecon_to_Avg_Exam.m
%  MMIL_Tools/MMIL_Calculate_T1Ratio.m
%  MMIL_Tools/MMIL_NLReg2Atlas_dev.m
%  MMIL_Tools/MMIL_Transform_to_Head_Atlas.m
%  PETutils/test_ADNI_PET_Anal.m
%  PITU/PITU_Modify_Brainmask.m
%  PreprocessHeadModel/dctMorph_Reg2Atlas_mmil.m
%  PreprocessHeadModel/dctMorph_SkullStrip_amd.m
%  PreprocessHeadModel/rebuild_head_atlas.m
%  REC_Stream/REC_MMIL_Freesurfer_Recon_Exam.m
%  REC_Stream/REC_MMIL_Freesurfer_Remake_Surfaces.m
%  REC_Stream/REC_MMIL_Register_PET_to_MRI.m
%  REC_Stream/REC_MMIL_Register_and_Resample_MRI_Volumes.m
%  atlases/init_jpdf_FLASHHI_FLASHLO.m
%  atlases/init_jpdf_FLASHHI_MPR.m
%  atlases/init_jpdf_FSNU_BOLD.m
%  atlases/init_jpdf_FSNU_DTI.m
%  atlases/init_jpdf_MEDICHI_MEDICLO.m
%  atlases/init_jpdf_MPR_FLASHHI.m
%  atlases/init_jpdf_MPR_FLASHLO.m
%  atlases/init_jpdf_MPR_GECAL.m
%  atlases/init_jpdf_MPR_MEDICHI.m
%  atlases/reinit_jpdf_FSNU_DTI.m
%  mmil_tools/mmil_average_volumes.m
%  mmil_tools/mmil_bbregister.m
%  mmil_tools/mmil_dct_brainmask.m
%  mmil_tools/mmil_dct_reg_atlas.m
%  mmil_tools/mmil_mriApply3DDispField.m
%  mmil_tools/mmil_mriRegister.m
%  mmil_tools/mmil_rbreg_vol2vol_jpdf.m
%  utils/Register_Func_to_Struct.m
%  utils/reorient_AAatlas.m


cp -rp /home/mmildev/MMPS/MMPS_DEV/parms/DTI /home/mmildev/MMPS/MMPS_102/parms

#############################################################################
#############################################################################

## MMPS_200: major revision to add robust tensor estimation with censoring
## Don Hagler 03/09/10

## started with MMPS_102 and added back changes from MMPS_DEV, which branched at MMPS_100

cd /home/mmildev/MMPS/MMPS_200_DEV/matlab
rm -r DukeMouseAnalysis
mv DTI_Stream DTI_Stream_OLD
mv DTI_Tools DTI_Tools_OLD
mkdir DTI_Stream
mkdir DTI_Tools
mkdir DTI_Utils

% new DTI_Fit_Tensor, DTI_Calc_DTmeas, DTI_Convert_DTmeas DTI_Calc_DT
% renamed DTI_MMIL_Load_VolDSI to DTI_MMIL_Load_Data
% renamed DTI_MMIL_Set_DT_FStem to DTI_MMIL_Set_DT_fstem, use mmil_args2parms
% renamed DTI_MMIL_Set_FOD_FStem to DTI_MMIL_Set_FOD_fstem
% new DTI_EddyCurrCorr
% new DTI_MotionCorr
% new DTI_GradUnwarp
% new DTI_Correct_Data
% new DTI_MMIL_Get_ScanInfo
% new DTI_Register_Scans for between scan registration
% changed DTI_MMIL_Register_to_T1; register single scan, added bbregflag
% changed DTI_Correct_Data to use fname_censor

cd /home/mmildev/MMPS/MMPS_200_DEV/matlab/ADNI_Tools
rm do_tmp.m ge_gradients.csv.old register_Mayo_ADNI_sessions.m.old tmpreg.m

cd /home/mmildev/MMPS/MMPS_200_DEV/matlab/DTI_Stream_OLD
rm DTI_MMIL_Apply_GradUnwarp.m DTI_MMIL_Calc_DT.m DTI_MMIL_Calc_DT_and_Resample.m DTI_MMIL_Convert_DToutput.m

rm DTI_MMIL_Eddy_Current_Correction.m DTI_MMIL_Eddy_Current_Correction_NEW.m DTI_MMIL_Load_VolDSI.m
rm DTI_MMIL_Motion_Correction.m DTI_MMIL_Motion_Correction_NEW.m DTI_MMIL_Register_to_FS.m DTI_MMIL_Register_to_T1.m
rm DTI_MMIL_Resample_DToutput.m DTI_MMIL_Resample_Data.m DTI_MMIL_Set_DT_FStem.m DTI_MMIL_Set_FOD_FStem.m
rm DTI_MMIL_SynthVol_Tensor.m DTI_MMIL_Unwarp_B0_Distortion.m

% changed DTI_MMIL_Export_Data, DTI_MMIL_AtlasTrack_Fibers_Exam.m

% moved several functions from DTI_Tools_OLD to DTI_Utils
cd /home/mmildev/MMPS/MMPS_200_DEV/matlab/DTI_Tools_OLD
rm Siemens* GE* tensor.dat bvecs*.txt
rm DSI_Fit_DT.m DTI_correct_eddy_current_distortion.m DTI_fast_eddy.m FastEddy.m DTI_Estimate_T2.m
mv DTI_Estimate_T2.m DTI_Fiber_Path_to_Mask.m DTI_Read_DTIStudio_Fiber.m DTI_Read_ROImap.m ../DTI_Utils
mv DTI_Rotate_Tensors.m DTI_Rotate_Vectors.m DTI_calc_b0_scale.m DTI_calc_fiber_overlap.m ../DTI_Utils
mv DTI_calc_fiber_volume_ratio.m DTI_export_DTIstudio.m DTI_flip_vecs.m DTI_read_GE_tensor_dat.m ../DTI_Utils
mv DTI_read_dirs.m DTI_smfiber_tensor.m DTI_smoothfiber.m DTI_track_prob_fibers.m ../DTI_Utils
mv save_dat.m tensor2components.m components2tensor.m dat2mgh.m load_dat.m mgh2dat.m plot*.m ../DTI_Utils
mv fast_interp1.m ../DTI_Utils
mv DTI_AtlasReg_to_T1.m DTI_track_fibers.m ../DTI_Utils
mv DTI_load_qmat.m ../DTI_Utils

% changed DTI_read_GE_tensor_dat and DTI_read_dirs

% new mmil_smooth3d
% changed mmil_dilate_mask to use mmil_smooth3d

cd /home/mmildev/MMPS/MMPS_200_DEV/matlab/MMIL_Stream
rm MMIL_Process_DTI_NEW.m MMIL_Process_DTI_OLD.m
mv MMIL_Process_DTI_TEST.m MMIL_Process_DTI.m
% changes to MMIL_Process_DTI

% updated MMIL_Process_Exam

% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED so pepolar = 1 for DTIrev
%                                                 and pepolar = 3 for rorevro

% moved diffusion direction files to /home/mmildev/MMPS/MMPS_200_DEV/parms/DTI

% updated DTI_Analysis functions, removed references to DToutput

% renamed DTI_MMIL_Resample_Data to DTI_Resample_Data

% switched to new Process_Exams for REC
cd /home/mmildev/MMPS/MMPS_200_DEV/matlab/REC_Stream
rm REC_MMIL_Process_Exam.m REC_MMIL_Process_Exam_oldECC.m REC_MMIL_Process_Exams.m
mv REC_MMIL_Process_Exams_NEW.m REC_MMIL_Process_Exams.m

% removed DEV_DTI_Stream and MEGFWD_Stream
cd /home/mmildev/MMPS/MMPS_200_DEV/matlab
rm -r DEV_DTI_Stream
mv MEGFWD_Stream/MEGFWD_MMIL_Make_BEM_Surfs.m MMIL_Stream/MMIL_Make_BEM_Surfs.m
rm -r MEGFWD_Stream
% updated EPDTI_Stream/EPDTI_MMIL_Process_Exam.m, EPMGH_Stream/EPMGH_MMIL_Process_Exam.m, and MMIL_Stream/MMIL_Process_Exam.m

% changed reference to DTI_MMIL_SetFStem to DTI_MMIL_Set_DT_fstem:
%  atlases/reinit_jpdf_FSNU_DTI.m

% removed smooth_fwhm option:
%  atlases/reinit_jpdf_FSNU_DTI.m
%  DEV_Stream/DEV_MMIL_Analyze_DT_Exams.m
%  DTI_Analysis/DTI_MMIL_Analyze_Aseg_Exam.m
%  DTI_Analysis/DTI_MMIL_Analyze_CortSurf_Exam.m
%  DTI_Analysis/DTI_MMIL_Analyze_Exam.m
%  DTI_Analysis/DTI_MMIL_Analyze_Exams.m
%  DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
%  DTI_Analysis/DTI_MMIL_Compile_ROIs.m
%  DTI_Analysis/DTI_MMIL_Summarize_Aseg.m
%  DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
%  DTI_Stream_OLD/DTI_MMIL_AtlasNorm_Fibers_Exam.m
%  DTI_Stream_OLD/DTI_MMIL_AtlasTrack_Fibers_Exam.m
%  DTI_Stream_OLD/DTI_MMIL_Calc_FOD.m
%  DTI_Stream_OLD/DTI_MMIL_Calc_FOD_and_Resample.m
%  DTI_Stream_OLD/DTI_MMIL_CleanUpResFS.m
%  DTI_Stream_OLD/DTI_MMIL_Convert_FODoutput.m
%  DTI_Stream_OLD/DTI_MMIL_Export_Data.m
%  DTI_Stream_OLD/DTI_MMIL_Fit_DiffParms.m
%  DTI_Stream_OLD/DTI_MMIL_Fit_Fibers.m
%  DTI_Stream_OLD/DTI_MMIL_Fit_IsoDiff.m
%  DTI_Stream_OLD/DTI_MMIL_Resample_FODoutput.m
%  EPDTI_Analysis/EPDTI_MMIL_Analyze_DT_Exams.m
%  EPDTI_Analysis/EPDTI_MMIL_Analyze_FOD_Exams.m
%  EPDTI_Analysis/EPDTI_MMIL_SurfGroupAvg_DT.m
%  EPDTI_Atlas/EPDTI_MMIL_Average_Atlas_DTmeas.m
%  EPDTI_Atlas/EPDTI_MMIL_Average_Atlas_DTmeas_Fiber.m
%  EPDTI_Atlas/EPDTI_MMIL_Average_Atlas_DTmeas_Fibers.m
%  EPDTI_Atlas/EPDTI_MMIL_WarpToAtlas_Exam.m
%  EPDTI_Stream/EPDTI_MMIL_CalcDT_Exams.m
%  EPDTI_Stream/EPDTI_MMIL_CalcFOD_Exams.m
%  EPDTI_Stream/EPDTI_MMIL_FitMultiFibers_Exam.m
%  EPDTI_Stream/EPDTI_MMIL_Fit_Fibers.m
%  EPDTI_Stream/EPDTI_MMIL_Fit_IsoDiff.m
%  EPDTI_Stream/EPDTI_MMIL_Import_DTIStudio_FiberMasks.m
%  EPDTI_Stream/EPDTI_MMIL_ResFS_CalcDT_Exams.m
%  EPDTI_Stream/EPDTI_MMIL_Track_Fibers_Exam.m
%  MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
%  MMIL_Longitudinal/MMIL_Long_Setup_Exams.m
%  MMIL_Stream/MMIL_Process_Exam.m
%  REC_Analysis_OLD/REC_MMIL_Analyze_DT_Exams.m
%  VETSA_Stream/VETSA_MMIL_Analyze_DT_Exams.m
%  VETSA_Stream/VETSA_MMIL_Process_Exam.m
%  VETSA_Stream/VETSA_MMIL_WarpToAtlas_Exam.m

% changed all references to DTI_MMIL_Set_DT_FStem to DTI_MMIL_Set_DT_fstem
%  DTI_Analysis/DTI_MMIL_Analyze_Aseg_Exam.m

% change all references to DTI_MMIL_Set_DT_FStem to DTI_MMIL_Set_DT_fstem
%  DTI_Analysis/DTI_MMIL_Analyze_CortSurf_Exam.m
%  DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
%  DTI_Analysis/DTI_MMIL_Compile_ROIs.m
%  DTI_Analysis/DTI_MMIL_Summarize_Aseg.m
%  DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
%  DTI_Stream/DTI_MMIL_Set_DT_fstem.m
%  DTI_Stream_OLD/DTI_MMIL_AtlasNorm_Fibers_Exam.m
%  DTI_Stream_OLD/DTI_MMIL_AtlasTrack_Fibers_Exam.m
%  DTI_Stream_OLD/DTI_MMIL_Fit_DiffParms.m
%  DTI_Stream_OLD/DTI_MMIL_Fit_Fibers.m
%  DTI_Stream_OLD/DTI_MMIL_Fit_IsoDiff.m
%  EPDTI_Analysis/EPDTI_MMIL_SurfGroupAvg_DT.m
%  EPDTI_Atlas/EPDTI_MMIL_Average_Atlas_DTmeas.m
%  EPDTI_Atlas/EPDTI_MMIL_Average_Atlas_DTmeas.m
%  EPDTI_Atlas/EPDTI_MMIL_Average_Atlas_DTmeas_Fiber.m
%  EPDTI_Atlas/EPDTI_MMIL_WarpToAtlas_Exam.m
%  EPDTI_Stream/EPDTI_MMIL_FitMultiFibers_Exam.m
%  EPDTI_Stream/EPDTI_MMIL_Fit_Fibers.m
%  EPDTI_Stream/EPDTI_MMIL_Fit_IsoDiff.m
%  EPDTI_Stream/EPDTI_MMIL_Import_DTIStudio_FiberMasks.m
%  EPDTI_Stream/EPDTI_MMIL_Track_Fibers_Exam.m
%  MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
%  VETSA_Stream/VETSA_MMIL_WarpToAtlas_Exam.m

% changed all references to DTI_MMIL_Set_FOD_FStem
%  DTI_Analysis/DTI_MMIL_Analyze_Aseg_Exam.m
%  DTI_Analysis/DTI_MMIL_Analyze_CortSurf_Exam.m
%  DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
%  DTI_Analysis/DTI_MMIL_Compile_ROIs.m
%  DTI_Analysis/DTI_MMIL_Summarize_Aseg.m
%  DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
%  DTI_Stream_OLD/DTI_MMIL_Calc_FOD.m
%  DTI_Stream_OLD/DTI_MMIL_Convert_FODoutput.m
%  DTI_Stream_OLD/DTI_MMIL_Resample_FODoutput.m

rm /home/mmildev/MMPS/MMPS_200_DEV/matlab/EPDTI_Stream/EPDTI_MMIL_ResFS_CalcDT_Exams.m

% changed MMIL_Load_ContainerInfo

cd /home/mmildev/MMPS/MMPS_200_DEV/matlab/DTI_Tools_OLD
mv convert_bvecs2dirs.m make_icoqmat.m map_q* uicmd_icoplot_* ../DTI_Utils/

% write adjusted qmat to _qmat.mat file in DTI_Resample_Data
% write adjusted qmat to _qmat.mat file in DTI_Correct_Data

% added Calc_DT to MMIL_Process_DTI
% added Export_Data to MMIL_Process_DTI

% changed DTI_MMIL_Load_Data to read _qmat.mat files

% changed censoring (in DTI_Correct_Data) so censor files are 
%   list of frame numbers, not 0s and 1s


% changed DTI_MMIL_Load_Data to call DTI_standardize_qmat
% new DTI_standardize_qmat to replace DTI_flip_vecs, does not assume axial

% changed DTI_MMIL_GetValidScans

% changed DTI_MMIL_AtlasTrack_Fibers_Exam to use DTI_standardize_qmat
% changed DTI_MMIL_Export_Data to use DTI_standardize_qmat
cd /home/mmildev/MMPS/MMPS_200_DEV/matlab
rm DTI_Utils/DTI_flip_vecs.m

% for DTI, removed all regFS, resFS, FSflag, regtype:
%  DTI_Analysis/DTI_MMIL_Analyze_CortSurf_Exam.m
%  DTI_Analysis/DTI_MMIL_Analyze_Aseg_Exam.m
%  DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
%  DTI_Stream/DTI_MMIL_AsegMask_Fibers.m
%  DTI_Stream/DTI_MMIL_AtlasTrack_Fibers_Exam.m
%  DTI_Stream/DTI_MMIL_Register_to_T1.m
%  DTI_Stream/DTI_MMIL_Set_FiberInfix.m
%  DTI_Stream/DTI_MMIL_Convert_Fibers_to_Segmentation.m
%  DTI_Stream_OLD/DTI_MMIL_AtlasNorm_Fibers_Exam.m
%  DTI_Stream_OLD/DTI_MMIL_Resample_FODoutput.m
%  DTI_Stream_OLD/DTI_MMIL_Resample_Fibers.m
%  DTI_Stream_OLD/DTI_MMIL_Manual_Register_Override.m
%  DTI_Stream_OLD/DTI_MMIL_Calc_FOD_and_Resample.m
%  EPDTI_Atlas/EPDTI_MMIL_AtlasNorm_Fibers_Exam.m
%  EPDTI_Atlas/EPDTI_MMIL_AtlasTrack_Fibers_Exam.m
%  EPDTI_Atlas/EPDTI_MMIL_WarpToAtlas_Exam.m
%  EPDTI_Stream/EPDTI_MMIL_ResampFibersToT1_Exam.m
%  EPDTI_PrePost/EPDTI_MMIL_PrePost_Setup_Exams.m
%  MMIL_Stream/MMIL_Process_Exam.m
%  ADNI_Stream/ADNI_MMIL_AtlasTrack_Fibers_Exams.m
%  atlases/reinit_jpdf_FSNU_DTI.m

cd /home/mmildev/MMPS/MMPS_200_DEV/matlab
rm DTI_Stream_OLD/DTI_MMIL_CleanUpResFS.m

% updated EPDTI_MMIL_Process_Exam to use MMIL_Process_DTI


#############################################################################
#############################################################################

## MMPS_201: minor revision
## Don Hagler 03/11/10

# changes copied from MMPS_103 (minor bug fix for MMPS_102)
cd /home/mmildev/MMPS/MMPS_103_DEV/matlab
cp -p atlases/init_jpdf_* /home/mmildev/MMPS/MMPS_201_DEV/matlab/atlases
cp -p utils/Register_Func_to_Struct.m /home/mmildev/MMPS/MMPS_201_DEV/matlab/utils
cp -p  utils/reorient_AAatlas.m /home/mmildev/MMPS/MMPS_201_DEV/matlab/utils
% added "/" before "atlases":
%  atlases/init_jpdf_FLASHHI_FLASHLO.m
%  atlases/init_jpdf_FLASHHI_MPR.m
%  atlases/init_jpdf_FSNU_BOLD.m
%  atlases/init_jpdf_FSNU_DTI.m
%  atlases/init_jpdf_MEDICHI_MEDICLO.m
%  atlases/init_jpdf_MPR_FLASHHI.m
%  atlases/init_jpdf_MPR_FLASHLO.m
%  atlases/init_jpdf_MPR_GECAL.m
%  atlases/init_jpdf_MPR_MEDICHI.m
%  atlases/reinit_jpdf_FSNU_DTI.m
%  utils/Register_Func_to_Struct.m
%  utils/reorient_AAatlas.m

% new DTI_MMIL_Load_RegInfo

% changed DTI_MMIL_Analyze_CortSurf_Exam to use save regT1.dat files for painting
%  without requiring T1 resolution DT measures

% load RegInfo using DTI_MMIL_Load_RegInfo
%  DTI_Stream_OLD/DTI_MMIL_Manual_Register_Override.m
%  DTI_Stream_OLD/DTI_MMIL_Resample_Fibers.m
%  DTI_Analysis/DTI_MMIL_Analyze_Aseg_Exam.m
%  DTI_Analysis/DTI_MMIL_Analyze_CortSurf_Exam.m
%  DTI_Stream/DTI_MMIL_AtlasTrack_Fibers_Exam.m
%  DTI_Stream/DTI_MMIL_Calc_DT.m
%  DTI_Stream_OLD/DTI_MMIL_AtlasNorm_Fibers_Exam.m
%  DTI_Stream_OLD/DTI_MMIL_Resample_FODoutput.m

% changed EPDTI_MMIL_PrePost_Register_Exams.m to use MMIL_Long_Register_Exams.m

% changed DTI_MMIL_Manual_Register_Override; removed mcflag, use DTI_MMIL_Get_ScanInfo

% changed EPDTI_MMIL_RootDirs.m; RootDirs.proc = /space/md8/10/data/epiproj/EPDTI/Containers

cd /home/mmildev/MMPS/MMPS_201_DEV/matlab/MMIL_Stream
mv MMIL_Register_and_Resample_MRI_Volumes_NEW.m MMIL_Register_and_Resample_MRI_Volumes.m
mv MMIL_Apply_MRI_Corrections_NEW.m MMIL_Apply_MRI_Corrections.m
mv MMIL_Process_Structurals_NEW.m MMIL_Process_Structurals.m
% updated MMIL_Process_Exam, MMIL_Process_Structurals

cd /home/mmildev/MMPS/MMPS_201_DEV/matlab/REC_Stream
mv REC_MMIL_Get_StudyInfo_NEW.m REC_MMIL_Get_StudyInfo.m
mv REC_MMIL_ReadProjInfo_NEW.m REC_MMIL_ReadProjInfo.m
mv REC_MMIL_RootDirs_NEW.m REC_MMIL_RootDirs.m
% updated REC_MMIL_Get_StudyInfo, REC_MMIL_Process_Exams, REC_MMIL_ReadProjInfo
%   and REC_MMIL_RootDirs
% created new /home/mmilrec2/ProjInfo/REC_MMIL_ProjInfo.csv with one REC_TEST only

% changed default DTI rot and trans to [0 0 0]

% pass aseg_codes_Cg and aseg_codes_wm from DTI_MMIL_Analyze_Fibers_Exam.m to
%  DTI_MMIL_Convert_Fibers_to_Segmentation

% added exlclCG option (default = 1) to REC_MMIL_Analyze_DT_Exams
% added exlclCG option (default = 1) to REC_MMIL_Summarize_All_DT

cd /home/mmildev/MMPS/MMPS_201_DEV/matlab/DTI_Stream_OLD
rm DTI_MMIL_Fit_DiffParms.m DTI_MMIL_Fit_Fibers.m DTI_MMIL_Fit_IsoDiff.m

% renamed DSI_Fit_FOD to DTI_Fit_FOD
cd /home/mmildev/MMPS/MMPS_201_DEV/matlab/DTI_Tools_OLD
mv DSI_Fit_FOD.m DTI_Fit_FOD.m
mv DTI_Fit_FOD.m ../DTI_Tools
rm -r /home/mmildev/MMPS/MMPS_201_DEV/matlab/DTI_Tools_OLD

cd /home/mmildev/MMPS/MMPS_201_DEV/matlab
rm DTI_Stream_OLD/DTI_MMIL_Choose_Ref_Scans.m
rm DTI_Stream_OLD/DTI_MMIL_Resample_Isotropic.m
mv DTI_Stream_OLD/DTI_MMIL_Resample_Fibers.m DTI_Stream
rm DTI_Stream_OLD/DTI_MMIL_WarpToAtlas_T1.m
mv DTI_Stream_OLD/DTI_MMIL_Manual_Register_Override.m DTI_Stream

% updated VETSA_Stream/VETSA_MMIL_WarpToAtlas_Exam.m to use MMIL_WarpToAtlas

% change calls to MMIL_Load_Container_Info to MMIL_Load_ContainerInfo
%  MMIL_Stream/MMIL_Apply_MRI_Corrections.m
%  MMIL_Stream/MMIL_Process_Raw_MRI.m
rm /home/mmildev/MMPS/MMPS_201_DEV/matlab/MMIL_Tools/MMIL_Load_Container_Info.m

% changed DTI_MMIL_Analyze_Aseg_Exam to look for DT_meas.mat file instead
% changed DTI_MMIL_Analyze_Fibers_Exam to look for DT_meas.mat file instead
% changed DTI_MMIL_Analyze_CortSurf_Exam to look for DT_meas.mat file instead

% make min_nb0 only affect snums_DT, not snums_valid in DTI_Get_ScanInfo
%  DTI_Get_ScanInfo
%  DTI_MMIL_AtlasNorm_Fibers_Exam
%  DTI_MMIL_AtlasTrack_Fibers_Exam
%  DTI_MMIL_Resample_Fibers
%  DTI_MMIL_Load_RegInfo
%  DTI_MMIL_Manual_Register_Override

% changed EPDTI analysis functions infix to 'corr_resDTI'
%  EPDTI_MMIL_Analyze_DT_Exams 
%  EPDTI_MMIL_Analyze_FOD_Exams
%  EPDTI_MMIL_Calc_FiberStats
%  EPDTI_MMIL_Calc_msFOD_FiberStats
%  EPDTI_MMIL_Summarize_All_DT
%  EPDTI_MMIL_SurfGroupAvg_DT (also changed *DT_tensor.mat to *DT_meas.mat)

% no more B0unwarp parmset -- use defaults, update binary
%  OLD_Stream/BOLD_MMIL_Unwarp_B0_Distortion.m
%  DTI_Tools/DTI_Correct_Data.m
%  EPI_Tools/EPI_estimate_B0_distortion.m
%  MMIL_Stream/MMIL_Process_DTI.m
%  DTI_Stream/DTI_MMIL_Get_ScanInfo
cp -p ~holland/bin/unwarpB0 /home/mmildev/MMPS/MMPS_201_DEV/bin


cd /home/mmildev/MMPS/MMPS_201_DEV/matlab/EPDTI_Analysis
mv EPDTI_MMIL_Summarize_MRIStats.m EPDTI_MMIL_Summarize_MRI_Analysis.m
mv EPDTI_MMIL_Analyze_MRIStats_Exams.m EPDTI_MMIL_Analyze_MRI_Exams.m
% changed EPDTI_MMIL_Summarize_MRI_Analysis (to call MMIL_Summarize_MRI_Analysis)
% changed EPDTI_MMIL_Analyze_MRI_Exams (to call MMIL_Analyze_MRI_Exams)

% always use min_nb0 for calls to DTI_MMIL_Set_DT_fstem
%  DTI_Analysis/DTI_MMIL_Analyze_Aseg_Exam.m
%  DTI_Analysis/DTI_MMIL_Analyze_CortSurf_Exam.m
%  DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
%  DTI_Analysis/DTI_MMIL_Compile_ROIs.m
%  DTI_Analysis/DTI_MMIL_Summarize_Aseg.m
%  DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
%  DTI_Stream/DTI_MMIL_AtlasTrack_Fibers_Exam.m
%  DTI_Stream/DTI_MMIL_Calc_DT.m
%  DTI_Stream/DTI_MMIL_Set_DT_fstem.m
%  DTI_Stream_OLD/DTI_MMIL_AtlasNorm_Fibers_Exam.m
%  EPDTI_Analysis/EPDTI_MMIL_SurfGroupAvg_DT.m
%  EPDTI_Atlas/EPDTI_MMIL_Average_Atlas_DTmeas.m
%  EPDTI_Atlas/EPDTI_MMIL_Average_Atlas_DTmeas.m
%  EPDTI_Atlas/EPDTI_MMIL_Average_Atlas_DTmeas_Fiber.m
%  EPDTI_Atlas/EPDTI_MMIL_WarpToAtlas_Exam.m
%  EPDTI_Stream/EPDTI_MMIL_Import_DTIStudio_FiberMasks.m
%  EPDTI_Stream/EPDTI_MMIL_Track_Fibers_Exam.m
%  MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
%  atlases/reinit_jpdf_FSNU_DTI.m

cd /home/mmildev/MMPS/MMPS_201_DEV/matlab
mkdir EPDTI_Stream_OLD
mv EPDTI_Stream/EPDTI_MMIL_Fit_Fibers.m EPDTI_Stream_OLD
mv EPDTI_Stream/EPDTI_MMIL_FitMultiFibers.m EPDTI_Stream_OLD
mv EPDTI_Stream/EPDTI_MMIL_Fit_IsoDiff.m EPDTI_Stream_OLD

% all EPDTI infix = 'corr_resDTI'
%  EPDTI_Atlas/EPDTI_MMIL_AtlasNorm_Fibers_Exam.m
%  EPDTI_Atlas/EPDTI_MMIL_AtlasTrack_Fibers_Exam.m
%  EPDTI_Atlas/EPDTI_MMIL_Average_Atlas_DTmeas_Fibers.m
%  EPDTI_PrePost/EPDTI_MMIL_PrePost_Setup_Exams.m
%  EPDTI_Stream/EPDTI_MMIL_CalcDT_Exams.m
%  EPDTI_Stream/EPDTI_MMIL_CalcFOD_Exams.m
%  EPDTI_Stream/EPDTI_MMIL_ResampFibersToT1_Exam.m
%  EPDTI_Stream/EPDTI_MMIL_Track_Fibers_Exam.m
%  EPDTI_Stream_OLD/EPDTI_MMIL_FitMultiFibers_Exam.m

% leave as is (because there are other errors from being outdated):
%  EPDTI_Stream_OLD/EPDTI_MMIL_FitMultiFibers_Exam.m:fname_DTout = [DT_fstem '_tensor.mat'];
%  EPDTI_Stream_OLD/EPDTI_MMIL_Fit_Fibers.m:matfile = [fstem '_tensor.mat'];
%  EPDTI_Stream_OLD/EPDTI_MMIL_Fit_IsoDiff.m:matfile = [fstem '_tensor.mat'];
%
% change to _meas.mat:
%  VETSA_Stream/VETSA_MMIL_WarpToAtlas_Exam.m:fname_DTout = [DT_fstem '_tensor.mat'];
% 

mv DTI_Stream_OLD/DTI_MMIL_Set_StudyInfo_SNums.m DTI_Stream/DTI_MMIL_Set_StudyInfo_SNums.m

% changed DTI_Resample_Data so volsz_T1 is accurate

% replace maskwm_flag and exclCg_flag with xcg_flag
%  DTI_Analysis/DTI_MMIL_Analyze_Exam.m
%  DTI_Analysis/DTI_MMIL_Analyze_Exams.m
%  DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
%  DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
%  DTI_Stream/DTI_MMIL_Convert_Fibers_to_Segmentation.m
%  DTI_Stream/DTI_MMIL_Set_FiberInfix.m
%  EPDTI_Analysis/EPDTI_MMIL_Analyze_DT_Exams.m
%  EPDTI_Analysis/EPDTI_MMIL_Summarize_All_DT.m
%  REC_Analysis/REC_MMIL_Analyze_DT_Exams.m
%  REC_Analysis/REC_MMIL_Summarize_All_DT.m

% change default exclude_flag=1 in
%  DTI_Stream/DTI_MMIL_AsegMask_Fibers.m

% changed DTI_Stream/DTI_MMIL_Set_FiberInfix.m to fix fiber_infix if parms.resT1flag

cd /home/mmildev/MMPS/MMPS_201_DEV/matlab/EPDTI_PrePost
rm -r params

cd /home/mmildev/MMPS/MMPS_201_DEV/matlab
mv ADNI_Tools/ ../old/matlab/ADNI_Tools.100318
mv ADNI_Stream/ ../old/matlab/ADNI_Stream.100318
mv ADNI_Analysis ../old/matlab/ADNI_Analysis.100318
mv VETSA_Stream ../old/matlab/VETSA_Stream.100318
mv AUTSM_Stream/ ../old/matlab/AUTSM_Stream.100318

% changed maskwm to xcg:
%  DEV_Stream/DEV_MMIL_Analyze_DT_Exams.m
%  DTI_Analysis/DTI_MMIL_Compile_ROIs.m
%  DTI_Stream/DTI_MMIL_AsegMask_Fibers.m
%  EPDTI_Analysis/EPDTI_MMIL_Calc_FiberStats.m
%  EPDTI_Analysis/EPDTI_MMIL_Calc_FiberStats_All.m
%  EPDTI_Stream/EPDTI_MMIL_ResampFibersToT1_Exam.m
%  MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
%  MMIL_Longitudinal/MMIL_Long_Setup_Exams.m

% changed DTI_MMIL_Analyze_Fibers so
%   fiber_dir = fiber_fromatlas_resT1, not fiber_fromatlas_res

% removed references to resflag:
%  DTI_Analysis/DTI_MMIL_Compile_ROIs.m
%  DTI_Analysis/DTI_MMIL_Summarize_Aseg.m
%  DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
%  DTI_Stream_OLD/DTI_MMIL_Calc_FOD.m
%  DTI_Stream_OLD/DTI_MMIL_Calc_FOD_and_Resample.m
%  EPDTI_Analysis/EPDTI_MMIL_Analyze_FOD_Exams.m
%  EPDTI_Analysis/EPDTI_MMIL_Calc_AsegStats.m
%  EPDTI_Analysis/EPDTI_MMIL_Calc_AsegStats_All.m
%  EPDTI_Analysis/EPDTI_MMIL_Calc_FiberStats.m
%  EPDTI_Analysis/EPDTI_MMIL_Calc_FiberStats_All.m
%  EPDTI_Analysis/EPDTI_MMIL_Calc_msFOD_FiberStats.m
%  EPDTI_Analysis/EPDTI_MMIL_Summarize_All_FOD.m

% changed DTI_resflag to DTI_DT_regT1flag:
%  DEV_BOLD_Stream/DEV_BOLD_MMIL_Process_Exams.m
%  REC_Stream/REC_MMIL_Process_Exams.m

% changed resflag to DT_regT1flag:
%  EPDTI_Stream/EPDTI_MMIL_CalcDT_Exams.m

% remove creation/copying of aseg_wmmask
%  DTI_Analysis/DTI_MMIL_Analyze_Aseg_Exam.m
%  MMIL_Longitudinal/MMIL_Long_Setup_Exam.m

% change resT1_flag to resT1flag:
%  DTI_Analysis/DTI_MMIL_Analyze_Exam.m
%  DTI_Analysis/DTI_MMIL_Analyze_Exams.m
%  DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m

cd /home/mmildev/MMPS/MMPS_201_DEV/matlab
mv TOP_Stream ../old/matlab/TOP_Stream.100319
mv BIRN_utils ../old/matlab/BIRN_utils.100319

% removed/changed references to ADNI
/home/mmildev/MMPS/MMPS_201_DEV/matlab
cp -p ../old/matlab/ADNI_Tools.100318/EstimateB1RxRatio_ADNI.m utils
%  PreprocessHeadModel/coregister_headmodel_scans.m
%  ctx_utils/ctx_get_gradwarpinfo.m
cd /home/mmildev/MMPS/MMPS_201_DEV/parms
cp -p /home/dale/matlab/ADNItools/ge_gradients.csv .

% changed EPDTI_MMIL_Process_Exams and EPDTI_MMIL_Process_Exam
%   so they give FSContainerPath to MMIL_Process_DTI

% changed MMIL_Long_Setup_Exam to look for resT1_xcg fibers, not xcg_resT1
%  making EPDTI_MMIL_PrePost_ResampFibersToT1_Exams unnecessary
cd /home/mmildev/MMPS/MMPS_201_DEV/matlab
rm EPDTI_PrePost/EPDTI_MMIL_PrePost_ResampFibersToT1_Exams.m

% Dominic updated totalReg and reg to better handle resume after crash
%  03/13/10
cd ~holland/bin
cp -p totalReg reg /home/mmildev/MMPS/MMPS_201_DEV/bin

% changed MMIL_Check_StudyInfo to make sure SubjID and VisitID are strings

% changed mmil_masksurf to use vertices not coords

% changed MMIL_Analyze_Long_Exams to include SubjID in jobID

% changed MMIL_Concat_SurfStats to output MRIdate

% changed totalReg: $$ to $ for touch files

% changed default smoothing for REC_MMIL_Analyze_Long_Exams

% changed DTI_MMIL_Summarize_Fibers to output fiber names and meas
% new DTI_MMIL_Read_Fiber_Legend, new DTI_Fiber_Legend.csv in parms

% changed EPDTI_MMIL_CalcDT_Exams to pass correct
%   parameters to DTI_MMIL_Calc_DT

% changed MMIL_Process_DTI to give warning and continue
%   if errors for a given scan

% changed EPDTI_MMIL_Process_Exams and EPDTI_MMIL_Process_Exam to
%   supply snums to MMIL_Process_DTI

% changed MMIL_Process_Exam: check for FSContainerPath only once

% new DTI_MMIL_Summarize_CortSurf.m
% changed EPDTI_MMIL_Summarize_All_DT to call DTI_MMIL_Summarize_CortSurf

cd /home/mmildev/MMPS/MMPS_201_DEV/matlab
mv DTI_Stream_OLD/DTI_MMIL_Convert.m DTI_Stream
% minor changes to DTI_MMIL_Convert

/home/mmildev/MMPS/MMPS_201_DEV/matlab/REC_Stream
rm REC_MMIL_Process_Structurals.m
rm REC_MMIL_Register_and_Resample_MRI_Volumes.m
rm REC_MMIL_Apply_MRI_Corrections.m
rm REC_MMIL_Import_StudyInfo.m

% changed MMIL_Process_Exams so DTI_nii_out_orient default is []

% changed to include job number and SubjID or SourceDir in jobID:
MMIL_Process_Exams
MMIL_Long_Setup_Exams
MMIL_Long_Register_Exams
MMIL_Analyze_MRI_Exams
MMIL_Analyze_Long_Exams
MMIL_Analyze_BOLD_Exams
DTI_MMIL_Analyze_Exams
REC_MMIL_Freesurfer_Recon_Exams
MMIL_Freesurfer_Recon_Exams
MMIL_PreProcess_Exams.m
MMIL_Resamp_FSRecon_to_Avg_Exams.m

cd /home/mmildev/MMPS/MMPS_201_DEV/matlab/REC_Analysis
rm REC_MMIL_Analyze_MRIStats_Longitudinal_Exams.m
rm REC_MMIL_Summarize_Longitudinal_CortThick.m
rm REC_MMIL_Summarize_Longitudinal_Volume.m

% fixed error in DTI_Correct_Data with between scan motion correction
%   needed to supply vox2ras matrix for correct resampling

% changed default err_thresh in DTI_Fit_Tensor to 0.25 (censor more!)

% added DTI_Atlas to atlases in MMPS
cd /home/mmildev/MMPS/atlases
cp -rp atlases.2009 atlases.2010
cd atlases.2010
cp -rp cp -rpd /space/md5/2/data/MMILDB/EPDTI/DTI_Atlas .
cd /home/mmildev/MMPS/MMPS_201_DEV
rm atlases
ln -s ../atlases/atlases.2010 atlases

% added fibers 1011 and 1021 to
%  /home/mmildev/MMPS/MMPS_201_DEV/parms/DTI_Fiber_Legend.csv

% add fibers 1011 and 1021 to DTI_Atlas from /home/cjpung/test_fornix
%  fiber_101_no_hipp and fiber_102_no_hipp
cd /home/mmildev/MMPS/atlases/atlases.2010/DTI_Atlas/AllSubjects
% copy/rename all of the fornix files (overkill -- do not need all of them)
mkdir tmp
cp fiber_101_* tmp
cp fiber_102_* tmp
cd tmp
myrename 101 1011
myrename 102 1021
% copy new masks from cjpung
set src = /home/cjpung/test_fornix/fiber_101_no_hipp
cp $src/fiber_101_mean_countatlas_mask_NOHIPP.Labels.mgz \
   fiber_1011_mean_countatlas_mask.mgz
set src = /home/cjpung/test_fornix/fiber_102_no_hipp
cp $src/fiber_102_mean_countatlas_mask_NOHIPP.Labels.mgz \
   fiber_1021_mean_countatlas_mask.mgz
% apply masks to mean_countatlas for fibers 1011 and 1021
mri_mask -T 0.5 fiber_1011_mean_countatlas.mgz \
                fiber_1011_mean_countatlas_mask.mgz \
                fiber_1011_temp.mgz
mv fiber_1011_temp.mgz fiber_1011_mean_countatlas.mgz
mri_mask -T 0.5 fiber_1021_mean_countatlas.mgz \
                fiber_1021_mean_countatlas_mask.mgz \
                fiber_1021_temp.mgz
mv fiber_1021_temp.mgz fiber_1021_mean_countatlas.mgz
cd ..
mv tmp/* .
rm -r tmp

% changed EPDTI_MMIL_Calc_FiberStats_All and
%         EPDTI_MMIL_Calc_msFOD_FiberStats to use
%         DTI_MMIL_Read_Fiber_Legend
cd /home/mmildev/MMPS/MMPS_201_DEV/matlab/EPDTI_Stream
rm EPDTI_MMIL_Read_Fiber_Legend.m
% removed old_fibers_flag from EPDTI_MMIL_Calc_FiberStats
% changed /home/mmildev/MMPS/MMPS_201_DEV/parms/DTI_Fiber_Legend.csv
%  to add back ReorderNumber

% changed EPDTI_MMIL_AtlasTrack_Fibers_Exam:
%  do not supply fiber_atlasdir (use default)

% changed DTI_MMIL_AtlasTrack_Fibers_Exam:
%  set default fiber_atlasdir to
%   [getenv('MMPS_DIR') '/atlases/DTI_Atlas/AllSubjects'] 

% added 1011 and 1021 to fibers for:
%   EPDTI_MMIL_AtlasTrack_Fibers_Exam
%   DTI_MMIL_AtlasTrack_Fibers_Exam
%   DTI_MMIL_Analyze_Fibers_Exam
%   DTI_MMIL_Summarize_Fibers (just a comment)
%   EPDTI_MMIL_Analyze_DT_Exams

% changed DTI_Correct_Data to by default quit if B0uw would be skipped
%   e.g. no rev scans  (require_B0uw_flag, default = 1)

% fixed DTI_Motion_Corr for case (EPDTI_dk01_070126) where scan has
%   different volsz than ref

% changed DTI_MMIL_Get_ScanInfo to break ties when choosing B0uw pairs
%   by choosing closest b-value or later scan if all have same b value

% add require_B0uw_flag to MMIL_Process_DTI, MMIL_Process_Exam,
%       and MMIL_Process_Exams

% removed Diag column from EPDTI_StudyInfo.csv
% removed use of  Diag/diag in EPDTI/DTI analysis (use group instead)
%  EPDTI_Analysis/EPDTI_MMIL_Calc_AsegStats.m
%  EPDTI_Analysis/EPDTI_MMIL_Calc_FiberStats.m
%  EPDTI_Analysis/EPDTI_MMIL_Calc_msFOD_FiberStats.m
%  EPDTI_Analysis/EPDTI_MMIL_SurfGroupAvg_DT.m
%  EPDTI_Atlas/EPDTI_MMIL_Average_Atlas_DTmeas.m
%  EPDTI_PrePost/EPDTI_MMIL_PrePost_Summarize_Fibers.m
%  EPDTI_Analysis/EPDTI_MMIL_Calc_AsegStats.m
%  DTI_Analysis/DTI_MMIL_Compile_ROIs.m
%  DTI_Analysis/DTI_MMIL_Summarize_Aseg.m
%  DTI_Analysis/DTI_MMIL_Summarize_CortSurf.m
%  DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
%  DTI_Stream/DTI_MMIL_Check_StudyInfo.m

% changed default resampling to cubic (interpm = 2) for these functions:
%  ctx_utils/ctx_Resample_Volume.m
%  ctx_utils/ctx_resample_to_LIA.m
%  mmil_tools/mmil_warp_to_atlas.m
%  utils/vol_resample_pad.m

% changed MMIL_Register_and_Resample_MRI_Volumes_OLD to use interpm = 1
%  when calling ctx_utils/ctx_resample_to_LIA.m to be consistent
%  with previous behavior (temporarily keep EPDTI processing consistent)

% fixed fs_aparc_roi so results have correct hemi for roi code and name

cp -p /home/mmildev/MMPS/MMPS_103/parms/CYCBI/inputParamsScale.txt /home/mmildev/MMPS/MMPS_201_DEV/parms/CYCBI
cp -p /home/mmildev/MMPS/MMPS_103/bin/totalReg  /home/mmildev/MMPS/MMPS_201_DEV/bin

% changed DTI_MMIL_Register_to_T1 to not use --surf option for tkregister2
%   (requires subj and subjdir)

% changed DTI_Correct_Data so that fs_load_mgh is not called unnecessarily
%   (when fname_out exists)

% changed DTI_Censor_Vol to take volmask -- only replace values inside mask
% changed DTI_MotionCorr and DTI_EddyCurrCorr to pass volmask to DTI_Censor_Vol

% save images of DTfit.censor_err and DTfit.censor_mat from DTI_Correct_Data

% changed DTI_Register_Scans to add non-default option for affine reg

% added censor_min_ndirs and censor_thresh as options to MMIL_Process_DTI
%  DTI_Correct_Data, DTI_MotionCorr, DTI_EdddyCurrCorr, DTI_Fit_Tensor

% changed fs_subj2ico.csh to find identify.xfm in $MMPS_PARMS

% new ts_dip_info to return [lh_dip_info,rh_dip_info] (uses Projects)
% changed fs_subj2ico.csh to not make dip files by default
% changed mmil_prep_MRI.csh to not make dip/dec files by default

% changed DTI_MMIL_Resample_Fibers so fibers include new fornix fibers

% changed DTI_MMIL_Analyze_Fibers_Exam so called functions receive
%  all relevant parameters (e.g. DTI_MMIL_Resample_Fibers,
%  DTI_MMIL_Convert_Fibers_to_Segmentation, DTI_MMIL_AsegMask_Fibers))

% renamed fs_aseg_wmmask to fs_aseg_mask, added optional exclude_flag

% changed DTI_MMIL_Analyze_Exam to pass xcg_flag and aseg_codes to 
%   DTI_MMIL_Analyze_Aseg_Exam and DTI_MMIL_Analyze_Fibers_Exam
% changed DTI_MMIL_Analyze_Aseg_Exam to create aseg_xcgmask.mgz

% changed DTI_Resample_Data so name of lowres T1 is T1_resDTI or T1_resDTI_regT1

% changed MMIL_Long_Setup_Exam to copy aseg_xcgmask.mgz

% changed MMIL_Long_Setup_Exam to choose correct T1 lowres depending on infix

% changed EPDTI_MMIL_PrePost_Analyze_Exam to use xcgmask instead of wmmask

% changed Read_ADNI_PET_dir to use try/catch so missing fields in dicom
%  headers do not cause errors

% changed ReadPETdcmfiles so check if ActualFrameDuration field exists

% changed REC_MMIL_Import_PET_Exam to replace spaces and parenthesis
%   in input directory name

% changed REC_MMIL_Import_PET_Exam to check for PatientID field

% changed EPDTI_MMIL_PrePost_Summarize_Fibers to include
%  FA, LDC, TDC, ADC, b0N, and T1 as measures

% changed REC_MMIL_Resamp_FSRecon_to_Avg_Exams to use REC_MMIL_RootDirs

% testing:
%  ran EPDTI_MMIL_Process_Exams
%  ran EPDTI_MMIL_AtlasTrack_Fibers_Exams
%  ran EPDTI_MMIL_Analyze_DT_Exams
%  ran EPDTI_MMIL_Summarize_All_DT
%  ran EPDTI_MMIL_PrePost_Setup_Exams
%  ran EPDTI_MMIL_PrePost_Register_Exams
%  ran EPDTI_MMIL_PrePost_Analyze_Exams
%  ran EPDTI_MMIL_PrePost_Summarize_Fibers


#############################################################################
#############################################################################

## MMPS_202: minor revision
## Don Hagler 04/10/10

% changed MMIL_Process_Exam to use T1ContainerPath
%  for registering DTI and BOLD data to another visit's T1

% renamed BOLD_MMIL_Register_to_T1_NEW to BOLD_MMIL_Register_to_T1
%  added T1ContainerPath option
% updated DEV_BOLD_Stream/DEV_BOLD_MMIL_Register_Exam.m
% updated BOLD_Analysis/BOLD_MMIL_Analyze_Exam.m
% updated REC_Stream/REC_MMIL_Register_BOLD.m

% changed MMIL_Process_DTI to accept T1ContainerPath option

% changed EPDTI_StudyInfo to include VisitID and STRUCT_VisitID instead
%  of proc and surf

% changed MMIL_Check_StudyInfo to check for STRUCT_VisitID

% changed MMIL_Process_Exams to use MMIL_Check_StudyInfo instead of
%    MMIL_Check_StudyInfo_SourceDir

% changed MMIL_Process_Exams to look for VisitID and STRUCT_VisitID in StudyInfo

% removed MMIL_Check_StudyInfo_SourceDir

% changed MMIL_Freesurfer_Recon_Exam to use parms
% changed MMIL_Freesurfer_Recon_Exam to use recon-all for version >= 400

% changed mmil_average_volumes to add parmsdir
%   made paramfile = inputParamsRigid.txt

% changed DTI_MMIL_Register_to_T1 to accept T1ContainerPath option

% changed EPDTI_MMIL_Read_StudyInfo to correctly calculate age
%   and to use MMIL_Check_StudyInfo
%   renamed StudyDate field in csv to Study_Date so it will be ignored
%   MMIL_Check_StudyInfo extracts from SessID

% changed EPDTI_MMIL_PrePost_Analyze_Exam to use visit A fibers instead of
%  baseline fibers

% changed BOLD_MMIL_Register_to_T1 and DTI_MMIL_Register_to_T1
%  to use _mask.mgh file of _brainmask.mgz, standardize BOLD

% changed MMIL_Freesurfer_Remake_Surfaces to use recon-all for version >= 400
         set string for step directive ('-autorecon2', '-autorecon2-wm')

% removed bin/make_average*_amd
% renamed bin/make_average*_djh to make_average*_v3
% moved bin/make_average* to csh dir
% moved bin/fs_recon* to csh dir

% changed MMIL_Resamp_FSRecon_to_Avg_Exam to call make_average_subject_v3

% changed fs_subj2ico.csh to call  make_average_subject_v3

% changed DTI_MMIL_Convert_Fibers_to_Segmentation to use 
%   fibers 1011 and 1021 instead of 101 and 102 (edited fornix)

% changed ts_dSPM to not calculate fit and err by default (added option)
%   (to save time and disk space)

% changed ts_process_fif_data, ts_average_fif_data, and ts_postprocess_avg
%  to have optional datatype (can be single to save disk space)

#############################################################################
#############################################################################

## MMPS_203: minor revision
## Don Hagler 04/19/10

% changed ts_process_fif_data, ts_average_fif_data, and ts_postprocess_avg
%  so default datatype is single (to save disk space)

% new ts_roi_analysis function (wrapper for ts_stc2roi)

% changed ts_pointreg to have autofit option (but it doesn't work well)

% fixed EPDTI_MMIL_FreeSurfer_Recon_Exams to use ProjID instead of projID

% changed ts_dSPM to calculate dipinfo using ts_dipinfo
% changed ts_dSPM to have nodec_flag to use all dipoles (e.g. for ico4)

cd /space/md7/1/pubsw/packages/MMPS/MMPS_203_DEV/matlab/MMIL_Stream
rm MMIL_Freesurfer_Recon_v4_Exam.m

% changed MMIL_Freesurfer_Recon_Exams to correctly pass FS_version from env

% changed EPDTI_MMIL_FreeSurfer_Recon_Exams to explicitly set FS_version = 305

% changed mmil_bbregister to correcly source from $PUBSH/bin instead of $PUBSH
% changed mmil_bbregister to use FS_version instead of fsver

% renamed MMIL_Resamp_FSRecon_to_Avg_Exams to MMIL_IcoResamp_FSRecon_Exams
% renamed MMIL_Resamp_FSRecon_to_Avg_Exam to MMIL_IcoResamp_FSRecon_Exam

% changed MMIL_IcoResamp_FSRecon_Exam to use mmil_args2parms
%   and accept FS_version and ico as options

% renamed EPDTI_Stream/EPDTI_MMIL_Resamp_FSRecon_to_Avg_Exams.m to
%   EPDTI_Stream/EPDTI_MMIL_IcoResamp_FSRecon_Exams.m

% renamed REC_Stream/REC_MMIL_Resamp_FSRecon_to_Avg_Exams.m to
%   REC_Stream/REC_MMIL_IcoResamp_FSRecon_Exams.m

% updated EPDTI_Stream/EPDTI_MMIL_IcoResamp_FSRecon_Exams.m
% updated REC_Stream/REC_MMIL_IcoResamp_FSRecon_Exams.m

% changed REC_MMIL_FreeSurfer_Recon_Exams to allow only one ProjID
% changed REC_MMIL_FreeSurfer_Recon_Exams to use MMIL_FreeSurfer_Recon_Exams

% removed REC_Stream REC_MMIL_Freesurfer_Recon_Exam.m
%   and REC_MMIL_Freesurfer_Remake_Surfaces.m

% changed MMIL_Long_Setup_Exams so default infix is 'corr_resDTI'

% changed mmilrec2 ProjInfo to have FREESURFERRECON_ico_RootDir

% changed use of avgarea to icoarea in these functions:
%  MMIL_Analysis/MMIL_Analyze_MRI_Exams
%  fstools/fs_paint
%  MMIL_Analysis/MMIL_Get_SurfStats.m
%  MMIL_Analysis/MMIL_Concat_SurfStats.m
%  EPDTI_Analysis/EPDTI_MMIL_Analyze_MRI_Exams.m
%  EPDTI_Analysis/EPDTI_MMIL_Concat_SurfStats.m
%  EPDTI_Analysis/EPDTI_MMIL_SurfGroupGLM.m
%  REC_Analysis/REC_MMIL_Analyze_MRI_Exams.m
%  REC_Analysis/REC_MMIL_Concat_SurfStats.m

% changed use of _avg to _ico in these functions:
%  MMIL_Stream/MMIL_IcoResamp_FSRecon_Exam.m
%  MMIL_Stream/MMIL_IcoResamp_FSRecon_Exams.m
%  MMIL_Analysis/MMIL_Analyze_MRI_Exam.m

% changed fsavg to fsico in these functions, (and cycbi to long if needed):
%    (mostly only in help)
%  MMIL_Toos/MMIL_Check_RootDirs.m
%  MMIL_Stream/MMIL_IcoResamp_FSRecon_Exam.m
%  MMIL_Stream/MMIL_IcoResamp_FSRecon_Exams.m
%  BOLD_Analysis/BOLD_MMIL_Get_SurfStats.m
%  DTI_Stream/DTI_MMIL_Check_StudyInfo.m
%  EPDTI_Stream/EPDTI_MMIL_RootDirs.m
%  EPDTI_Stream/EPDTI_MMIL_SetRootDirs.m
%  MMIL_Analysis/MMIL_Analyze_BOLD_Exams.m
%  MMIL_Analysis/MMIL_Analyze_Long_Exams.m
%  MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
%  MMIL_Analysis/MMIL_Analyze_MRI_Exams.m
%  MMIL_Analysis/MMIL_Compile_Long_Analysis.m
%  MMIL_Analysis/MMIL_Compile_MRI_Analysis.m
%  MMIL_Analysis/MMIL_Concat_SurfStats.m
%  MMIL_Analysis/MMIL_Get_SurfStats.m
%  MMIL_Analysis/MMIL_Summarize_Long_Analysis.m
%  MMIL_Analysis/MMIL_Summarize_MRI_Analysis.m
%  MMIL_Analysis/MMIL_SurfGroupAvg_BOLD.m
%  MMIL_Analysis/MMIL_SurfGroupGLM_BOLD.m
%  MMIL_Longitudinal/MMIL_Long_Register_Exams.m
%  MMIL_Longitudinal/MMIL_Long_Setup_Exams.m
%  MMIL_Stream/MMIL_Freesurfer_Recon_Exams.m
%  MMIL_Stream/MMIL_Process_Exam.m
%  MMIL_Stream/MMIL_Process_Exams.m
%  MMIL_Tools/MMIL_Check_StudyInfo.m
%  MMIL_Tools/MMIL_Set_Common_RootDirs.m
%  REC_Stream/REC_MMIL_RootDirs.m

% created make_average_subject_v4, make_average_surface_v4, and
%   make_average_volume_v4 (copied from FS_450)

% changed make_average_subject_v4
%   replaced make_average_subject with make_average_subject_v4
%   replaced make_average_surface with make_average_surface_v4
%   replaced make_average_volume with make_average_volume_v4

% changed make_average_subject_v3
%   replaced make_average_subject with make_average_subject_v3
%   replaced make_average_surface with make_average_surface_v3
%   replaced make_average_volume with make_average_volume_v3
%   replaced make_average_subject_djh with make_average_subject_v3
%   replaced make_average_surface_djh with make_average_surface_v3
%   replaced make_average_volume_djh with make_average_volume_v3

% changed make_average_surface_v4
%   replaced make_average_subject with make_average_subject_v4
%   replaced make_average_surface with make_average_surface_v4
%   replaced make_average_volume with make_average_volume_v4
%   comment out id command (crashes under Rocks)
%   added code to make links from original subjects into sdout
%     (if SUBJECTS_DIR != sdout)

% changed make_average_surface_v3
%   replaced make_average_subject with make_average_subject_v3
%   replaced make_average_surface with make_average_surface_v3
%   replaced make_average_volume with make_average_volume_v3
%   added code to make links from original subjects into sdout
%     (if SUBJECTS_DIR != sdout)

% changed make_average_volume_v4
%   replaced make_average_subject with make_average_subject_v4
%   replaced make_average_surface with make_average_surface_v4
%   replaced make_average_volume with make_average_volume_v4
%   allow ico parameter (but do nothing)

% changed make_average_volume_v3
%   replaced make_average_subject with make_average_subject_v3
%   replaced make_average_surface with make_average_surface_v3
%   replaced make_average_volume with make_average_volume_v3
%   allow ico parameter (but do nothing)

#############################################################################
#############################################################################

## MMPS_204: minor revision
## Don Hagler 04/21/10

% changed EPDTI_MMIL_PrePost_Analyze_Exam:
%  higher initial threshold for lesion mask and two rounds
%    of smoothing with low threshold
%  when combining lesion masks for v3 vs. v2, resample both v1-v2 and v1-v3
%    lesion masks to v2 space before combining

% created mmil_mriApplyTransforms wrapper for mriApplyTransforms

% copied jpdfReg (perl script) from /home/kuperman/matlab/jpdf to 
%     /usr/pubsw/packages/MMPS/MMPS_204_DEV/bin
%   changed hard-coded paths for reg and brainMaskFromSeg

cd /space/md10/2/holland/T1T2/atlas
cp *.mgz /usr/pubsw/packages/MMPS/atlases/atlases.2010/T1T2

/home/kuperman/bin
cp ip.txt /usr/pubsw/packages/MMPS/MMPS_204_DEV/parms/REG/inputParamsT1T2jpdf.txt

% created MMIL_Register_T2_to_T1 from DTI_MMIL_Register_to_T1.m
%   removed DTI specific stuff
%   changed from DTI to T2
%   added oldregflag (default=0) to allow choice of
%     mmil_rbreg_vol2vol_jpdf or D.Holland's jpdf reg
%   added code from /home/kuperman/matlab/jpdf/DTI_MMIL_Register_to_T1.m
%     and /home/kuperman/matlab/jpdf/DTI_RR_to_DTI.m
%   reorient T1 and mask to LIA if not already
%   load reg mats from reg output and combine
%   call mmil_jpdfreg_T1T2, which calls mmil_reg

% created mmil_jpdfreg_T1T2
% created fs_read_header
% created mmil_reorient_to_LIA
% created mmil_resample_to_LIA
% created mmil_reg

% changed BOLD_MMIL_Register_to_T1 to use MMIL_Register_T2_to_T1
%   updated BOLD_MMIL_Analyze_Exam

% renamed DTI_GradUnwarp to EPI_GradUnwarp
%  made M required input
%  updated DTI_Correct_Data

% changed DTI_MotionCorr so M is required input
%  updated DTI_Correct_Data

% renamed EPI_correct_B0_distortion to EPI_UnwarpB0.m
% renamed EPI_estimate_B0_distortion.m to EPI_EstimateB0.m
% renamed EPI_reorient_vol.m to EPI_ReorientVol.m
% updated DTI_Correct_Data

#############################################################################
#############################################################################

## MMPS_205: minor revision
## Don Hagler 04/26/10

% created BOLD_MotionCorr
% created BOLD_TShift

% fixed bug in ts_roi_analysis to handle single string "conditions"

% changed DTI_Correct_Data to correct pass mask_smooth1, etc.to DTI_MotionCorr

% created BOLD_Correct_Data modeled on DTI_Correct_Data

% changed EPI_GradUnwarp to accept fname_in and fname_out
%   updated DTI_Correct_Data

% renamed BOLD_MMIL_Convert.m to BOLD_MMIL_Export_Data
%  updated based on DTI_MMIL_Export_Data

% updated MMIL_Process_BOLD
% copied DTI_Tools/DTI_Register_Scans.m as EPI_Tools/EPI_Register_Scans.m

% removed these functions:
BOLD_MMIL_Apply_GradUnwarp.m
BOLD_MMIL_Motion_Correction.m
BOLD_MMIL_TShift.m
BOLD_MMIL_Unwarp_B0_Distortion.m

% updated MMIL_Process_Exam

% copied DTI_MMIL_Get_ScanInfo to create BOLD_MMIL_Get_ScanInfo
% changed BOLD_MMIL_Get_ScanInfo

% updated MMIL_Process_Exams to have these BOLD parameters
%   to match MMIL_Process_Exam

% removed REC_MMIL_Register_BOLD

% removed BOLD_Stream/BOLD_MMIL_Set_Infix
% removed MMIL_Tools/MMIL_Detect_BOLD

% changed to take infix instead of mc_flag, gradunwarp_flag, etc.:
%  MMIL_Analysis/MMIL_SurfGroupGLM_BOLD
%  MMIL_SurfGroupAvg_BOLD
%  MMIL_Analyze_BOLD_Exams
%  BOLD_Analysis/BOLD_MMIL_Analyze_Exam.m
%  BOLD_Analysis/BOLD_MMIL_Combine_Fourier_Sessions.m
%  BOLD_Analysis/BOLD_MMIL_Get_SurfStats.m

% replaced BOLD_MMIL_Set_Infix with BOLD_MMIL_Get_ScanInfo
%  BOLD_Analysis/BOLD_MMIL_Analyze_Exam.m
%  BOLD_Analysis/BOLD_MMIL_Combine_Fourier_Sessions.m
%  BOLD_Analysis/BOLD_MMIL_Get_SurfStats.m

% removed use of MMIL_Detect_BOLD
%  MMIL_Stream/MMIL_Process_Exam.m

% removed BOLD_MMIL_Choose_Ref_Scans

% replaced MMIL_Detect_BOLD with BOLD_MMIL_Get_ScanInfo:
%  BOLD_Analysis/BOLD_MMIL_Fourier_Analysis.m
%  BOLD_Analysis/BOLD_MMIL_GLM_Analysis.m
%  BOLD_Stream/BOLD_MMIL_Register_to_T1.m
%  BOLD_Stream/BOLD_MMIL_Export_Data.m

% replaced use of BOLD_MMIL_Choose_Ref_Scans with BOLD_MMIL_Get_ScanInfo:
%  BOLD_Analysis/BOLD_MMIL_Fourier_Analysis.m
%  BOLD_Analysis/BOLD_MMIL_GLM_Analysis.m
%  BOLD_Stream/BOLD_MMIL_Register_to_T1.m

% added mc_flag and mc_inter_flag as options to BOLD_MMIL_GLM_Analysis
% added mc_inter_flag as option to BOLD_MMIL_Fourier_Analysis
% added mc_flag and mc_inter_flag as options to BOLD_MMIL_Analyze_Exam
% added mc_flag and mc_inter_flag as options to MMIL_Analyze_BOLD_Exams

#############################################################################
#############################################################################

## MMPS_206: minor revision
## Don Hagler 05/03/10

% changed BOLD_MMIL_Get_ScanInfo to not use SE-PEP scans as
%   motion correction references
%   added SessInfo.regT1_ref
% updated MMIL_Process_BOLD to use ScanInfo(s).B0reg_ref_for
% update BOLD_MMIL_Register_to_T1 to use SessInfo.regT1_ref

% changed fs_read_orient to detect oblique slices (oblique_flag)

% changed EPI_Resample_Data to accept EPI_type to include in fname_T1_lowres
% changed MMIL_Process_BOLD to pass 'BOLD' as EPI_type to EPI_Resample_Data

% changed MMIL_Register_T2_to_T1 to accept T2_type to include in fname_T1_res
% changed BOLD_MMIL_Register_to_T1 to pass 'T2_BOLD' as T2_type to MMIL_Register_T2_to_T1

% changed mmil_construct_M to accept orient option
%   hard-coded rotations and x-flip for each of 48 possible orient strings

% changed EPI_Resample_Data.m to have option to de-oblique (default=1)

# Important Change! fix for creating MPR_res with multiple scans
% changed mmil_average_volumes to reorient to LIA before calling mriRegister
 
% created mmil_write_regscripts
% changed MMIL_Register_T2_to_T1 to call mmil_write_regscripts
% change EPI_Resample_Data to call mmil_write_regscripts

% changed EPI_Resample_Data to have save_reg_flag option
% changed MMIL_Process_BOLD so save_reg_flag=1 only for ref scan

% changed EPDTI_MMIL_PrePost_Setup_Exams to have masksf_flag=1
% changed MMIL_Long_Setup_Exams to add masksf_flag option
% changed MMIL_Long_Setup_Exam to add masksf_flag option
% changed EPDTI_MMIL_PrePost_Analyze_Exam to add masksf_flag option
% changed EPDTI_MMIL_PrePost_Analyze_Exam to add masksf_flag option
% changed EPDTI_MMIL_PrePost_Summarize_Fibers to add masksf_flag

% moved DTI_MMIL_Convert_Fibers_to_Segmentation.m and DTI_MMIL_AsegMask_Fibers.m
%   from DTI_Stream to DTI_Analysis

% changed DTI_MMIL_Analyze_Aseg_Exam and DTI_MMIL_Analyze_Fibers_Exam
%    to add 0 to list of aseg codes to exclude

% renamed utils/get_voxres_from_M to fstools/fs_voxsize_from_M

% changed MMIL_Process_BOLD to pass EchoSpacing and AcquisitionColumns to
%   BOLD_Correct_Data

% changed MMIL_Process_BOLD, MMIL_Process_Exam, and MMIL_Process_Exams to
%   have deoblique_flag

% changed BOLD_Correct_Data to (if dx from SE-PEP), rescale dx field
%   and if voxel size different, resample and rescale dx field

* added BOLDScanNums field to StudyInfo, to exclude bad scans
% changed BOLD_MMIL_Get_ScanInfo to accept snums
% updated these:
%  BOLD_Analysis/BOLD_MMIL_Analyze_Exam.m
%  BOLD_Analysis/BOLD_MMIL_Combine_Fourier_Sessions.m
%  BOLD_Analysis/BOLD_MMIL_Fourier_Analysis.m
%  BOLD_Analysis/BOLD_MMIL_GLM_Analysis.m
%  BOLD_Analysis/BOLD_MMIL_Get_SurfStats.m
%  BOLD_Stream/BOLD_MMIL_Export_Data.m
%  BOLD_Stream/BOLD_MMIL_Register_to_T1.m
%  MMIL_Stream/MMIL_Process_BOLD.m
%  MMIL_Analysis/MMIL_Analyze_BOLD_Exams.m
% changed BOLD_MMIL_Export_Data, added snums_valid and snums_export parameters
% changed BOLD_Analysis/BOLD_MMIL_GLM_Analysis, added snums_valid parameter
% changed BOLD_Analysis/BOLD_MMIL_Fourier_Analysis, added snums_valid parameter
% changed BOLD_Analysis/BOLD_MMIL_Combine_Fourier_Sessions, added snums_valid parameter
% changed BOLD_Analysis/BOLD_MMIL_Analyze_Exam, added snums_valid parameter
%   added to calls to BOLD_MMIL_GLM_Analysis, BOLD_MMIL_Fourier_Analysis
% changed MMIL_Stream/MMIL_Process_BOLD call to BOLD_MMIL_Export_Data
%   to add snums_valid and snums_export
%   added snums to call to BOLD_MMIL_Register_to_T1
% changed BOLD_MMIL_Analyze_Exam
%   added snums to call to BOLD_MMIL_Register_to_T1
% changed MMIL_Process_Exam, added BOLD_snums
% changed MMIL_Check_StudyInfo to create fields BOLDScanNums and DTIScanNums
%  and to split strings into vectors for several fields 
% changed EPDTI_MMIL_Read_StudyInfo, removed convert string to vector
% changed BOLD_MMIL_Read_StudyInfo, removed convert string to vector

% added xcshjobs and bcshjobs for launching jobs locally on a workstation
%  either in xterm (xcshjobs) or in background (bcshjobs)

% changed MMIL_Analyze_BOLD_Exams to change BOLDScanNums to snums_valid

% changed BOLD_MMIL_Fourier_Analysis, BOLD_MMIL_GLM_Analysis,
%   BOLD_MMIL_Get_SurfStats, and BOLD_MMIL_Combine_Fourier_Sessions
%   to replace parms.revflag with SessInfo.revflag

% changed MMIL_Check_StudyInfo to correctly find fsurf container when
%   STRUCT_VisitID ~= VisitID

#############################################################################
#############################################################################

## MMPS_207: minor revision
## Don Hagler 05/07/10

* this was for the purpose of saving memory
% changed fs_fourier_avg to only calculate cxFstats for stimfreq
% changed BOLD_MMIL_Fourier_Analysis and fs_fourier_avg to pass stimfreq
%   to fs_fourier_avg

% changed fs_load_mgh to keep floats as singles to save memory

% changed EPDTI_MMIL_Analyze_MRI_Exams; aseg_stats_flag to aseg_flag, etc.

% changed MMIL_IcoResamp_FSRecon_Exam to check RootDirs.fsico correctly
% changed MMIL_IcoResamp_FSRecon_Exams to not create multiple jobs for same fpath
% changed MMIL_Analyze_MRI_Exams to not create multiple jobs for same fpath

% changed MMIL_Freesurfer_Recon_Exam to call MMIL_Copy_BEM_Surfs
% created MMIL_Copy_BEM_Surfs
% changed MMIL_Freesurfer_Recon_Exams, adding bemflag and bemtype

% changed fs_paint to use projdist_avg and projfract_avg

% changed BOLD_MMIL_Analyze_Exam, MMIL_Analyze_BOLD_Exams
%   BOLD_MMIL_GLM_Analysis, and BOLD_MMIL_Fourier_Analysis
%   to use projfrac_avg or projdist_avg

% renamed ctx_get_gradwarpinfo_amd to ctx_get_gradwarpinfo
%  removed extra versions
%    ctx_get_gradwarpinfo.m.jcr
%    ctx_get_gradwarpinfo.m.orig

% changed MMIL_Process_BOLD to check for ambiguousgwtype
%   and if so, set gradunwarp_flag = 0

% changed EPI_UnwarpB0 and EPI_EstimateBO to 
%   call EPI_ReorientVol instead of EPI_reorient_vol

% changed mmil_write_csv to have firstcol_label
% changed MMIL_Compile_MRI_Analysis to return results.VisitIDs and results.STRUCT_VisitIDs
% changed MMIL_Summarize_MRI_Analysis to use STRUCT_VisitID instead of subjID

% changed MMIL_Process_BOLD
%   to pass PhaseDir, AcquisitionRows, etc. to BOLD_Correct_Data
% changed BOLD_Correct_Data
%   to set swapxy_flag=1 if PhaseDir = 'ROW'
%   to pass swapxy_flag to EPI_EstimateB0 and EPI_UnwarpB0
% changed EPI_EstimateB0 and EPI_UnwarpB0
%    to accept and use swapxy_flag instead of reorienting to LPS

% changed MMIL_Process_DTI
%   to pass PhaseDir, AcquisitionRows, etc. to DTI_Correct_Data
% changed DTI_Correct_Data
%   to set swapxy_flag=1 if PhaseDir = 'ROW'
%   to pass swapxy_flag to EPI_EstimateB0 and EPI_UnwarpB0

% changed EPI_EstimateB0 and EPI_UnwarpB0 to throw errors instead of using
%  fprintf('%s: ERROR:...  and errcode

% changed MMIL_Process_Exam and MMIL_Process_Exams to add options:
%  DTI_censor_flag, DTI_censor_thresh, DTI_censor_min_ndirs

% changed EPDTI_MMIL_Process_Exams to use MMIL_Process_Exams

% changed MMIL_Compile_MRI_Analysis to correctly set VisitNumbers if not a
%  field in StudyInfo

% changed REC_MMIL_Long_Register_Exams
%   REC_MMIL_Analyze_Long_Exams, and REC_MMIL_Summarize_Long_Analysis
%   to get baseflag from ProjInfo

% changed REC_MMIL_Long_Setup_Exams to always try to copy aseg.mgz, even for
%   follow-ups

% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to save PhaseDir for DTI scans

% JCR added VisitIDs to MMIL_Summarize_Long_Analysis

% changed MMIL_Compile_Long_Analysis and MMIL_Summarize_Long_Analysis to correctly
%   handle baseflag = 0

% changed MMIL_Analyze_Long_Exam; regdirs{i} to regdirs{r}

#############################################################################
#############################################################################

## MMPS_208: minor revision
## Don Hagler 05/28/10

% changed MMIL_Process_Exams and MMIL_Process_Exam to have
%   DTI_B0unwarp_flag instead of DTI_require_B0uw_flag

% changed MMIL_Process_DTI to take B0unwarp_flag and set require_B0uw_flag

% changed DTI_MMIL_Register_to_T1 to use MMIL_Register_T2_to_T1

% changed BOLD_MMIL_Register_to_T1 (cosmetic)

% update these DTI functions that use RegInfo struct, changing DTI to T2:
%  DTI_Analysis/DTI_MMIL_Analyze_Aseg_Exam.m
%  DTI_Analysis/DTI_MMIL_Analyze_CortSurf_Exam.m
%  DTI_Stream/DTI_MMIL_AtlasTrack_Fibers_Exam.m
%  DTI_Stream/DTI_MMIL_Load_RegInfo.m
%  DTI_Stream/DTI_MMIL_Manual_Register_Override.m
%  DTI_Stream/DTI_MMIL_Resample_Fibers.m
%  DTI_Stream_OLD/DTI_MMIL_AtlasNorm_Fibers_Exam.m
%  DTI_Stream_OLD/DTI_MMIL_Resample_FODoutput.m
%  DTI_Tools/DTI_Convert_DTmeas.m
%  DTI_Tools/DTI_Resample_Data.m

% changed MMIL_Process_BOLD to check for gwtype first, then ambiquousgwtype

% changed MMIL_Register_T2_to_T1 to make ref vol with
%   volsz_T2(1:3) instead of volsz_T2

% changed MMIL_Process_DTI to check for gwtype first, then ambiquousgwtype,
%   added gradunwarp_flag

% changed DTI_Correct_Data to add gradunwarp_flag

% changed MMIL_Register_and_Resample_MRI_Volumes to handle case where suffix
%   is empty (no B1 and no uw)

% changed MMIL_Freesurfer_Recon_Exam to -make autorecon2 only, not all

% changed MMIL_Get_SurfStats to handle dv
% changed MMIL_Concat_SurfStats to use 'analysis' as statsdir
% changed MMIL_Get_SurfStats to use 'analysis' as statsdir

% changed BOLD_MMIL_Get_ScanInfo to properly count nreps for BOLD_ipp scans

% added tcl scripts from ~mmilrec/bin 06/17/10
% added sh script from ~mmilrec/bin 06/17/10

% renamed printeps to mmil_printeps

% changed ts_roi_analysis to average across hemis

% changed DTI_MMIL_Calc_DT to smooth mask

% changed ctx_get_gradwarpinfo so triotim has right gwtype (4)

% changed REC_MMIL_Get_StudyInfo to set VisitNumber to 1 if not supplied

% changed DTI_MMIL_Calc_DT to save sumsq err of tensor fit

% changed DTI_MMIL_Calc_DT to calculate err one slice at a time to save memory

% added mri_proc to documentation/examples

% changed fs_surf_roi_avg to set nverts before being used when loading labels
% changed fs_surf_roi_avg to use parms.aparc instead of aparcname

% changed MMIL_Make_BEM_Surfs to look for aparc+aseg.mgz instead of 
%   aseg+aparc.mgz

% changed BOLD_MMIL_Get_ScanInfo to work if no rev scans (median returning NaN)

% changed ts_avg_fif_data so max_num_trials works even if save_epochs_flag=0

#############################################################################
#############################################################################

## MMPS_209: minor revision
## Don Hagler 07/26/10

% changes from Jason Sherfey to timesurfer:
U    ts_iEEG/priv/ts_iEEG_eeg2epoch.m
A    timesurfer/timesurfer.m
U    timesurfer/master/funspecs.csv
A    timesurfer/master/timesurfer_global.m
U    timesurfer/master/defaults.csv
A    timesurfer/master/load_subject_parameters_xls.m
U    timesurfer/master/find_masterfile.m
A    timesurfer/master/guidefaults.csv
U    timesurfer/master/funtypes.csv
A    timesurfer/master/timesurfer_defaults.m
A    timesurfer/master/load_parms.m
A    timesurfer/master/load_subject_parameters.m
A    timesurfer/master/read_funspecs.m
U    timesurfer/master/filenames.csv
U    timesurfer/csv/parsecell.m
U    timesurfer/plots/ts_ezmultiplot.m
A    timesurfer/plots/syncview.m
A    timesurfer/plots/write_layout_ieeg.m
A    timesurfer/plots/ts_ezplot.m
A    timesurfer/plots/visualizer.m
A    timesurfer/plots/ts_syncplot.m
U    timesurfer/functions/ts_checkdata_header.m
U    timesurfer/functions/ts_object_info.m
U    timesurfer/functions/ts_write_mscript.m
A    timesurfer/functions/ts_timefreq_average.m
A    timesurfer/functions/ts_MEG_sensor_neighbours.m
U    timesurfer/functions/ts_matrix2epoch.m
U    timesurfer/functions/ts_timefreq_baseline.m
U    timesurfer/functions/ts_matrix2avg.m
U    timesurfer/functions/ts_visual_reject.m
A    timesurfer/functions/ts_freqband_average.m
A    timesurfer/functions/ts_loadedf.m
U    timesurfer/functions/ts_freqanalysis_fieldtrip.m
A    timesurfer/functions/ts_matrix2data.m
U    timesurfer/functions/ts_statistics.m
U    timesurfer/functions/ts_data2fieldtrip.m
U    timesurfer/functions/ts_preproc.m
U    timesurfer/functions/ts_statistics_wrapper.m
U    timesurfer/functions/ts_fieldtrip2data.m
U    timesurfer/functions/ts_PLV.m
U    timesurfer/functions/ts_timefreq_rejection.m
U    timesurfer/functions/ts_data_selection.m
U    timesurfer/functions/ts_process_ieeg_data.m
A    timesurfer/functions/ts_vertex_neighbours.m
U    timesurfer/functions/ts_loadfif.m
A    timesurfer/functions/ts_timefreq_makebaseline.m
U    timesurfer/functions/ts_reject.m
U    timesurfer/functions/ts_session.m
U    timesurfer/functions/ts_zscore.m
A    ts_fieldtrip/createsubcfg.m
A    documentation/TimeSurfer_Documentation.zip
A    documentation/tutorials/ts_gui
A    documentation/tutorials/ts_gui/Tutorial3_TemplatePLV.docx
A    documentation/tutorials/ts_gui/Tutorial5_CompleteTask.docx
A    documentation/tutorials/ts_gui/Tutorial2_InteractivePLV.docx
A    documentation/tutorials/ts_gui/Tutorial5_Template_ERP_TFR_TFwave.mat
A    documentation/tutorials/ts_gui/Tutorial2_InteractivePLV.txt
A    documentation/tutorials/ts_gui/Tutorial3_TemplatePLV.mat
A    documentation/tutorials/ts_gui/Tutorial5_CompleteTask_FEM-Example.mat
A    documentation/tutorials/ts_gui/Tutorial1_InteractiveERP.docx
A    documentation/tutorials/ts_gui/Tutorial2_InteractivePLV.mat
A    documentation/tutorials/ts_gui/Tutorial1_InteractiveERP.mat
A    documentation/tutorials/ts_gui/Tutorial5_FEM_conditionkey.csv
A    documentation/tutorials/ts_gui/Tutorial4_VisualRejection.docx
A    documentation/TimeSurfer_User_Manual.docx

#############################################################################
#############################################################################

## MMPS_210: minor revision
## Don Hagler 07/26/10

% changed make_average_subject_v4 (csh) to remove link when finished

% changed ts_plot_avg to optionally plot all channels for a given type

% removed obsolete REC analysis functions:
%   REC_MMIL_Summarize_Cort_dv.m
%   REC_MMIL_Summarize_All_MRI.m
%   REC_MMIL_Summarize_CortThick.m
%   REC_MMIL_Summarize_All.m

% changed fs_load_mgh; added keepsingle option to save memory
%  default is 0 to avoid potential backward compatibility issues
%  with functions expecting doubles

% changed fs_fourier to use keepsingle=1 when calling fs_load_mgh
% changed BOLD_MMIL_GLM_Analysis to use keepsingle=1 when calling fs_load_mgh
% changed mmil_resample_by_regdat to use keepsingle=1 when calling fs_load_mgh

% changed REC_MMIL_Summarize_All_DT so homedir is current user

% changed DTI_MMIL_Set_DT_fstem to have error if cannot create DTcalc dir

% changed DTI_MMIL_AtlasTrack_Fibers_Exam to set parms.snums with output
%   from DTI_MMIL_Set_DT_fstem

% changed DTI_Convert_DTmeas to use correct M matrix (parms.Reginfo.M_T2) when
%   resampling V0 to T1 resolution

% changed MMIL_Freesurfer_Recon_Exam so -noribbon etc. comes after -all

% changed MMIL_Process_Exam and MMIL_Process_Exams so that BOLD_mc_flag
%   default value is true and accepted values are [false true]
%   instead of 3 and [0 1 2 3 4]

% changed mmil_write_script and mmil_write_tags so floats are written with
%   8 decimal places

% changed BOLD_MMIL_Get_ScanInfo to make SessInfo.reg_ref_rev = [] if
%   snums_rev=0 and SessInfo.reg_ref_for = [] if snums_for=0

% changed MMIL_Check_StudyInfo to split DTI/BOLD _resolution and _nvoxels
%   into numeric vector

% changed MMIL_Process_DTI to make outfix a commented parameter
% changed MMIL_Process_Exam to accept and DTI_outfix and pass outfix to 
%   MMIL_Process_DTI
% changed MMIL_Process_Exams to accept and pass DTI_outfix
% changed REC_MMIL_Process_Exams to pass DTI_outfix as tag

% changed DTI_Resample_Data to check if qmat is empty before adjusting it
% changed MMIL_Process_DTI to reload original qmat if qmat file from
%   motion correction not found (i.e. if motion correction not done)

% changed REC_MMIL_Get_StudyInfo to initialize StudyInfo.RawQC with []

% changed ts_postprocess_avg to convert to double before resampling
%   then convert back to single if datatype = single

% changed EPI_Resample_Data to have native_flag to keep original nvoxels and resolution
% change MMIL_Process_BOLD to pass native_flag to EPI_Resample_Data
% change MMIL_Process_Exam and MMIL_Process_Exams to use BOLD_native_flag

% created new MMIL_Read_ProjInfo to read project info csv files,
%   ignore comments and convert certain fields from strings to numeric vectors

% changed REC_MMIL_ReadProjInfo to use MMIL_Read_ProjInfo
% renamed REC_MMIL_ReadProjInfo to REC_MMIL_Read_ProjInfo:
%   REC_MMIL_Get_Container
%   REC_MMIL_Import_PET_Exams
%   REC_MMIL_Register_PET_to_MRI_Exams
%   REC_MMIL_RootDirs
%   REC_MMIL_Status_Report_MRI
%   REC_MMIL_Status_Report_PET
%   REC_MMIL_Analyze_DT_Exams
%   REC_MMIL_Analyze_MRI_Exams
%   REC_MMIL_Analyze_PET_Exams
%   REC_MMIL_Concat_SurfStats
%   REC_MMIL_Concat_SurfStats
%   REC_MMIL_Merge_CSV_Files
%   REC_MMIL_Summarize_CortThick_forPET
%   REC_MMIL_Summarize_MRI_Analysis
%   REC_MMIL_Summarize_PET_aparc
%   REC_MMIL_Summarize_PET_aseg
%   REC_MMIL_Summarize_SubCort_dv
%   REC_MMIL_Summarize_Volume
%   REC_MMIL_Summarize_Volume_forPET
%   REC_MMIL_SurfGroupAvg_ApplyMasks
%   REC_MMIL_SurfGroupAvg_CortThick
%   REC_MMIL_SurfGroupAvg_CortThick_forPET
%   REC_MMIL_SurfGroupAvg_PET

% use REC_MMIL_Read_ProjInfo(ProjID) if only one Proj needed:
%   REC_MMIL_Get_Container
%   REC_MMIL_RootDirs

% changed REC functions to allow only one ProjID at a time, use
%     REC_MMIL_RootDirs, and use RootDirs.home instead of hard-coded homedir
%   REC_Analysis/REC_MMIL_Analyze_PET_Exams
%   REC_Analysis/REC_MMIL_Concat_SurfStats
% changed by Cooper Roddey:
%   REC_Stream/REC_MMIL_Import_PET_Exams.m
%   REC_Stream/REC_MMIL_Status_Report_MRI.m
%   REC_Stream/REC_MMIL_Status_Report_PET.m
%   REC_Stream/REC_MMIL_Register_PET_to_MRI_Exams.m
%   REC_Stream/REC_MMIL_RootDirs.m
%   REC_Stream/REC_MMIL_Status_Report.m
%   REC_Analysis/REC_MMIL_Summarize_Volume_forPET.m
%   REC_Analysis/REC_MMIL_SurfGroupAvg_CortThick_forPET.m
%   REC_Analysis/REC_MMIL_Summarize_PET_aseg.m
%   REC_Analysis/REC_MMIL_Concat_SurfStats.m
%   REC_Analysis/REC_MMIL_Summarize_MRI_Analysis.m
%   REC_Analysis/REC_MMIL_Summarize_PET_aparc.m
%   REC_Analysis/REC_MMIL_Merge_CSV_Files.m
%   REC_Analysis/REC_MMIL_SurfGroupAvg_ApplyMasks.m
%   REC_Analysis/REC_MMIL_SurfGroupAvg_PET.m
%   REC_Analysis/REC_MMIL_Summarize_Volume.m
%   REC_Analysis/REC_MMIL_SurfGroupAvg_CortThick.m
%   REC_Analysis/REC_MMIL_Summarize_CortThick_forPET.m
%   REC_Analysis/REC_MMIL_Summarize_SubCort_dv.m

% changed EPI_Resample_Data to not give warnings with native_flag

% changed DTI_Correct_Data to catch any errors when trying to create and save
%   censor_mat and censor_err images

% changed MMIL_Process_Exams to check if T1ContainerPath is empty
%   (in case STRUCT_VisitID is different but does not exist yet)
%   if so, set BOLD_regT1flag = 0 and DTI_regT1flag = 0

% changed MMIL_Process_BOLD to uncommet try/catch around BOLD_Correct_Data

% new BOLD_MMIL_Load_RegInfo
% new BOLD_MMIL_Manual_Register_Override

% changed DTI_MMIL_Manual_Register_Override to make fnamestem a parms field
%   and removed call to DTI_MMIL_Get_ScanInfo (called by DTI_MMIL_Load_RegInfo)
% changed DTI_MMIL_Load_RegInfo to quit if ScanInfo is empty

% changed BOLD_MMIL_Register_to_T1 to remove unused fname_reg parameter

% changed MMIL_Register_T2_to_T1 to load RegInfo if already exists
%   return values are not empty

% changed BOLD_MMIL_Combine_Fourier_Sessions:
%   fixed error with too many "end"s
%   initialized empty snums_valid as empty cell array
%   only write one csh script that accepts hemi as command line parameter

% changed fs_fourier_avg to calculate cxfstat for individual stimfreq
%   only if nframes>1

% changed BOLD_MMIL_Combine_Fourier_Sessions and BOLD_MMIL_Fourier_Analysis
%   to write view csh files with second parameter save_flag

#############################################################################
#############################################################################

## MMPS_211: minor revision
## Don Hagler 08/16/10

% changed EPI_EstimateB0 to use varargin and accept kernelWidthMax and lambda2
%   changed variable names (e.g. fin to fname_in)
% changed EPI_UnwarpB0 to use varargin
%   changed variable names (e.g. fin to fname_in)

% change DTI_Correct_Data and BOLD_Correct_Data to use 'key',value pairs
%   when calling EPI_EstimateB0 and EPI_UnwarpB0

% created new function EPI_OptimizeB0 to
%   find optimal kernelWidthMax and lambda2

% changed DTI_Correct_Data and BOLD_Correct_Data to optionally
%   optimize kernelWidthMax and lambda2

% changed MMIL_Process_BOLD and MMIL_Process_DTI to have optimize_B0uw_flag
%   and other B0uw optimization parameters (e.g. kernelWidthMax_vec)

% changed MMIL_Process_Exam and MMIL_Process_Exams to have
%   optimize_B0uw_flag and other parameters

% changed BOLD_MMIL_Fourier_Analysis and BOLD_MMIL_GLM_Analysis to set
%   default tkmsooth=2 and added fslope to call to fs_surfmgh.csh

% update unwarpB0
cp -p /home/holland/bin/unwarpB0 /home/mmildev/svn/mmil/MMPS/bin

% made all functions have default optimize_B0uw_flag = 0

% changed MMIL_Read_ProjInfo to split 'kernelWidthMax_vec' and 'lambda2_vec'
%   into vectors

% changed REC_MMIL_Process_Exams to allow B0uw optimization parameters
%   from command line and from ProjInfo

% changed mmil_dilate_mask to add erode_flag

% changed EPI_Register_Scans to make tighter initial mask, then two rounds
%   of erosion and dilation -- to exclude lower intensity areas outside brain
%   Save mask with optional input name
% changed MMIL_Process_DTI and MMIL_Process_BOLD to pass fname_mask
%   based on reference fname to EPI_Register_Scans

% changed mmil_reg to take affine_flag

% changed EPI_Register_Scans to use mmil_reg

% changed MMIL_Process_DTI to use EPI_Register_Scans instead of DTI_Register_Scans
% removed DTI_Register_Scans

% created new EPI_BrainMask, called by EPI_Register_Scans

% changed MMIL_Process_BOLD and MMIL_Process_DTI to do between scan
%   registration on corrected images (in case different shim)

% adjust parameters in EPI_BrainMask to reliably create brain mask from EPI

% created new fs_detrend_vol to regress motion from timeseries volume
% changed fs_normdetrend to call fs_detrend_vol
% changed fs_fourier to call fs_detrend_vol
% changed fs_fourier to accept fname_motion

% changed BOLD_MMIL_Analyze_Exam so default tksmooth = 2

% changed BOLD_MMIL_Fourier_Analysis to pass fname_motion to fs_fourier
%   and added mc_flag

% changed BOLD_MMIL_Analyze_Exam to pass mc_flag to BOLD_MMIL_Fourier_Analysis

% changed BOLD_MMIL_Fourier_Analysis and BOLD_MMIL_GLM_Analysis to set
%   motion_fnames to [fstem_'corr_motion.1D'] if infix starts with 'corr'

% changed BOLD_MMIL_GLM_Analysis to set fthresh=0.1 and colscale=1

% changed fs_surfmgh.csh to make default colscale = 1

% changed REC_MMIL_Get_StudyInfo to check for empty ProjInfo.STRUCT_rawQCflag
% changed REC_MMIL_Import_ViewerQC to use %s instead of "mfilename"

% changed MMIL_Process_BOLD to do registration between scans in its own for loop
%   separate from BOLD_Correct_Data (since ref scan might not be Correct yet)

% changed MMIL_Process_DTI to do registration between scans in its own for loop
%   separate from DTI_Correct_Data

% changed BOLD_MMIL_Combine_Fourier_Sessions so default tksmooth = 2

% changed MMIL_IcoResamp_FSRecon_Exam to not reset ContainerDir_ico with
%   out ico number if ico<7

% changed MMIL_Compile_Long_Analysis to properly exclude subjects without
%   complete baseline visit

% changed by JCR to require single ProjID:
%   MMPS/matlab/REC_Analysis/REC_MMIL_Analyze_Long_Exams.m
%   MMPS/matlab/REC_Analysis/REC_MMIL_Analyze_DT_Exams.m
%   MMPS/matlab/REC_Analysis/REC_MMIL_Analyze_MRI_Exams.m

% changed by JCR:
%   MMPS/matlab/jcrpub/PING/PING_dcmodify_byScanInfo.m

% changed MMIL_Check_StudyInfo so error message uses available variables
%   (not ProjInfo or fname)

% changed DTI_MMIL_Summarize_Fibers to output VisitID

#############################################################################
#############################################################################

## MMPS_212: minor revision
## Don Hagler 09/03/10

% changed REC_MMIL_Process_Exams to get StudyInfo

% created startup_MMPS.m to add paths and look for MMPS_nonsvn

% changed REC_MMIL_Process_Exams to add tags (e.g. DTI_censor_flag and B0unwarp)

% changed fs_3dDeconv to handle multiple input files
% changed BOLD_MMIL_GLM_Analysis to analyze multiple runs concatenated
% changed BOLD_MMIL_Analyze_Exam to pass GLM_concat_flag to BOLD_MMIL_GLM_Analysis
% changed MMIL_Analyze_BOLD_Exams to add GLM_concat_flag and GLM_contrasts_flag

% changed MMIL_Process_Exam and MMIL_Process_Exams to add DTI_gradunwarp_flag
%   and DTI_cleanupflag
% changed MMIL_Process_DTI to add cleanupflag

% changed MMIL_Process_Exam and MMIL_Process_Exams to add
%   DTI_ecc_flag and DTI_mc_flag
% changed MMIL_Process_DTI to add ecc_flag and mc_flag

% changed REC_MMIL_Process_Exam to pass all tags for MMIL_Process_Exams

% changed MMIL_Viewer to look for MMIL_QC_Proj_list.csv in user's ProjInfo
%   directory, not mmilrec's

# Important Change! (for any user using REC functions)
% changed REC_MMIL_Get_StudyInfo so expected location of VisitInfo,
%   QC info, etc. to subdirectories are in ProjInfo, not MetaData

% changed REC_MMIL_Analyze_DT_Exams to pass override some parameters
%  (e.g. xcg_flag, min_bval) with values from ProjInfo (if isfield, ~isempty)

% changed REC_MMIL_Process_Exams to remove DTI B0uw optimization parameters
%  from command line (force use of ProjInfo)

% changed BOLD_MMIL_GLM_Analysis and BOLD_MMIL_Fourier_Analysis
%   so view is optional third argument for view*.csh scripts

% changed MMIL_Read_ProjInfo so split values are kept as doubles
%   but converted to int32 if mmil_isint returns true

% changed EPDTI_MMIL_Import_DTIStudio_FiberMasks
%   to fix syntax error (missing ... at end of line)
%   replaced usage of EPDTI_MMIL_SetRootDirs with EPDTI_MMIL_RootDirs
%   changed StudyInfo.MRIPROCESSED to StudyInfo.proc

% changed MMIL_Process_DTI to look for replacement fname_T1 if necessary
%   e.g. root directory changed

% changed MMIL_Process_DTI to pass M_T1 and volsz_T1 to DTI_Resample_Data

% change DTI_Resample_Data to create T1 vol of zeros instead of loading
%   fname_T1

% renamed DTI_MMIL_Analyze_Exams to MMIL_Analyze_DTI_Exams
%   (moved from DTI_Analysis to MMIL_Analysis)
% updated:
%   DEV_Stream/DEV_MMIL_Analyze_DT_Exams
%   EPDTI_Analysis/EPDTI_MMIL_Analyze_DT_Exams
%   EPDTI_Analysis/EPDTI_MMIL_Analyze_FOD_Exams
%   REC_Analysis/REC_MMIL_Analyze_DT_Exams
%   MMIL_Analysis/MMIL_Analyze_DTI_Exams

% renamed DTI_MMIL_Analyze_Exam to MMIL_Analyze_DTI_Exam
%   (moved from DTI_Analysis to MMIL_Analysis)
% renamed BOLD_MMIL_Analyze_Exam to MMIL_Analyze_BOLD_Exam
%   (moved from BOLD_Analysis to MMIL_Analysis)
% updated:
%   MMIL_Analysis/MMIL_Analyze_BOLD_Exams
%   MMIL_Analysis/MMIL_Analyze_BOLD_Exam
%   MMIL_Analysis/MMIL_Analyze_DTI_Exams
%   MMIL_Analysis/MMIL_Analyze_DTI_Exam

% changed DTI_MMIL_Calc_DT to clear variables when no longer needed
%   to save memory

% changed MMIL_Process_Exam to correctly pass DTI_min_nb0, DTI_min_bval,
%   DTI_min_nb0, and DTI_min_ndirs to DTI_MMIL_AtlasTrack_Fibers_Exam
%   MMIL_Process_DTI

# Important change! (for any project using IcoResamp)
% changed MMIL_IcoResamp_FSRecon_Exam
%   correctly pass ico to make_average_subject (was always doing ico7 before)
%   create ContainerInfo.mat
%   new container name has type FREESURFERICO or FREESURFERICO4
%     with no ico tag at end
% changed MMIL_Check_StudyInfo to add fsico container type
% changed MMIL_Get_Container to add fsico container type
% changed MMIL_Analyze_MRI_Exams so help says that StudyInfo can have
%   fsico field
% changed MMIL_Analyze_MRI_Exam to use fsico container name from StudyInfo
% changed MMIL_Get_SurfStats so help says that StudyInfo can have fsioc

% changed REC_MMIL_Analyze_DT_Exams
%   to not set batchname (gets set by MIL_Analyze_DTI_Exams)
%   to set infix depending on DTI_resample_flag and DTI_regT1_flag from ProjInfo

% changed MMIL_Process_Exam and MMIL_Process_Exams so default
%   DTI_censor_min_ndirs is 12

% changed mmil_average_volumes to use mmil_reg instead of mriRegister

% changed ts_roi_analysis to correctly set plot file names

% changed REC_MMIL_Summarize_All_DT to override some parameters with ProjInfo
%   (min_bval, xcg_flag, etc)
% changed REC_MMIL_Analyze_DT_Exams header


% changed BOLD_MMIL_Combine_Fourier_Sessions to remove extra save_flag = 0

% removed DEV_Stream

% added source code for find_bem_surfs, tractoview, fact_suabe

% changed REC_MMIL_RootDirs to look for long_dti directory from ProjInfo
% changed REC_MMIL_RootDirs to set default directories to []
%  (so not necessary to specify if not used)
% changed MMIL_Long_Setup_Exams to set RootDirs.long = RootDirs.long_dti
%   if isfield and ~isempty
% changed MMIL_Long_Register_Exams to set RootDirs.long = RootDirs.long_dti
%   if isfield and ~isempty

% changed read_dicom_4dvol to allocate vol as single (to save memory)

% by JCR:
% changed fs_read_aseg_stats to correctly read Brain rois from
%   header of stats file (e.g. BrainMaskVolume, BrainSegmentationVolume, etc)
% changed DTI_MMIL_Summarize_CortSurf to output VisitID
% changed DTI_MMIL_Summarize_Aseg to output VisitID

% changed DTI_MMIL_Summarize_Fibers, DTI_MMIL_Summarize_CortSurf, and
%   DTI_MMIL_Summarize_Aseg to use "SubjID" instead of "SubjectID"

% removed REC_MMIL_Summarize_SubCort_dv and REC_MMIL_Summarize_Volume

% created mmil_reg_average_volmes
%   (copy of mmil_average_volumes that uses mmil_reg instead of mriRegister)
% copied mmil_average_volumes from MMPS_211 (seg faults with reg)
%   back to using mriRegister

# NOTE: for mriRegister to work, need i386 versions of 
#  libgsl.so.0 and libstdc++.so.5
#    yum install gsl.i386
#    yum install compat-libstdc++-33.i386

% changed BOLD_MMIL_Get_ScanInfo to prevent error when
%   SessInfo.B0reg_refs_for is empty (snums specified with only PEPSE scans)

% changed help so example infix = 'corr_resDTI':
% DTI_MMIL_Analyze_CortSurf_Exam,
% DTI_MMIL_Analyze_Aseg_Exam to
% MMIL_Analyze_DTI_Exams

% changed REC_MMIL_Analyze_DT_Exams so that default values for DTI_resample_flag
%   and DTI_regT1flag are both 1 (when pulling from ProjInfo) for setting
%   infix correctly

#############################################################################
#############################################################################

## MMPS_213: minor revision
## Don Hagler 09/28/10

% changed REC_MMIL_Summarize_All_DT so that default values for DTI_resample_flag
%   and DTI_regT1flag are both 1 (when pulling from ProjInfo) for setting
%   infix correctly

% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to correctly set pepolar for
%  Siemens non-rorevro scans

% changed MMIL_Process_Exams default kernelWidthMax_vec lambda2_vec

% changed fs_paint to add "parms." to mask_roinums to fix undefined variable
%   when using mask_midbrain_flag=1

% changed DTI_Fit_Tensor to normalize error for each slice
%   by max of mean signal of all slices

% rev152

% changed DTI_Fit_Tensor to normalize err by median
%  NOTE: this makes error for 6-dir scans incredibly inflated
%   but censor_min_ndirs prevents censoring on them anyway

% changed to make default censor_thresh = 3.2:
%  DTI_Fit_Tensor
%  DTI_MotionCorr
%  DTI_EddyCurrCorr
%  DTI_Correct_Data

% for switching back to normalizing by
%   max of mean signal or mean signal for each slice
%  DTI_Fit_Tensor_TEST

% changed DTI_MMIL_Check_StudyInfo to remove unused parameters
%   min_bval, min_ndirs, min_nb0, snum_index

% changed calls to DTI_MMIL_Check_StudyInfo to remove snum_index and min_bval:
%  MMIL_Analysis/MMIL_Analyze_DTI_Exams
%  DTI_Analysis/DTI_MMIL_Compile_ROIs
%  DTI_Analysis/DTI_MMIL_Summarize_Aseg
%  DTI_Analysis/DTI_MMIL_Summarize_CortSurf
%  DTI_Analysis/DTI_MMIL_Summarize_Fibers
%  EPDTI_Analysis/EPDTI_MMIL_SurfGroupAvg_DT
%  EPDTI_Atlas/EPDTI_MMIL_Average_Atlas_DTmeas_Fiber
%  EPDTI_PrePost/EPDTI_MMIL_PrePost_Register_Exams
%  EPDTI_PrePost/EPDTI_MMIL_PrePost_Summarize_Fibers
%  EPDTI_Stream/EPDTI_MMIL_CalcDT_Exams

% changed by JCR to fix use of '\n' in [string]
%  MMPS/matlab/MMIL_Stream/MMIL_Freesurfer_Remake_Surfaces.m

% rev155

% changed REC_MMIL_Get_StudyInfo to return if StudyInfo is empty after
%   MMIL_Check_StudyInfo (no raw containers)

% rev156

% changed MMIL_Freesurfer_Recon_Exams to use VisitID in job name not SubjID

% changed MMIL_Freesurfer_Recon_Exams to correctly pass T1type to
%   MMIL_Freesurfer_Recon_Exam

% rev 159

% changed MMIL_Freesurfer_Recon_Exam for when full_recon_flag=0
%  -autorecon1-volonly was not recognized by recon-all
%  instead: cmd = sprintf('%s -autorecon1 -autorecon2-volonly -make autorecon2-volonly\n',cmd);

% rev 160

#############################################################################
#############################################################################

## MMPS_214: minor revision
## Don Hagler 10/12/10

% changed MMIL_Process_DTI: added semicolon after "ContainerPath" in this line:
%  if isempty(parms.T1ContainerPath), parms.T1ContainerPath = ContainerPath; end;
%  to not display parms to screen

% changed MMIL_Process_Exam to not do regexprep on T1ContainerDir
%   if T1ContainerPath is empty

% changed DTI_Correct_Data to do eddy current correction even if mc_flag=0
%   changed this line:
%     if isempty(qmat) || ~parms.mc_flag || ~parms.ecc_flag
%   to this:
%     if isempty(qmat) || (~parms.mc_flag && ~parms.ecc_flag)

% created ksh, perl, tcl dirs
% copied scripts from bin dir to appropriate directories
% changed SetUpMMPS.csh to add ksh, perl, sh, tcl dirs to path

% rev 162

% changed MMIL_Process_BOLD to look for fname_T1 in T1ContainerPath if
%   one RegInfo.fname_T1 not found (e.g. proc root dir moved)

% changed MMIL_Process_DTI to use EPI_Resample_Data instead of DTI_Resample_Data
% removed DTI_Resample_Data
% changed DTI_MMIL_Get_ScanInfo to add regT1_ref to SessInfo
% changed DTI_MMIL_Register_to_T1 to use SessInfo.regT1_ref

% changed ts_stc2mgh (cosmetic change to handle missing t0 or t1 input)

% rev 163

% changed fs_resample_mgh so tfirst and tlast are 1-based
% changed ts_surf2movie to make default timestamp_fontname helvetica
%   arial not found
% changed ts_surf2movie so tfirst and tlast are 1-based

% changed DTI_MMIL_Analyze_Aseg_Exam, DTI_MMIL_Analyze_CortSurf_Exam,
%   and DTI_MMIL_Analyze_Fibers_Exam to check if SessInfo is empty
%   before trying to access SessInfo.snums_DT

% changed ts_roi_analysis to also save parms along with time and wforms

% changed ts_roi_analysis to allow cell array for plot_type to save
%   tif and eps at same time

% changed fs_write_label to remove extra options for vertex coordinates

% created fs_shrink_label to smooth and threshold a label to make it smaller

% changed MMIL_Compile_Long_Analysis to change StudyInfo to tmpStudyInfo at
%   lines 296 and 371, and removed "continue" at line 171

% changed fs_ico2ico to use mri_surf2surf (instead of wrongly assuming that
%   first 2562 vertices of ico7 correspond to ico4

% rev 169

#############################################################################
#############################################################################

## MMPS_215: minor revision
## Don Hagler 11/02/10

% changed MMIL_Process_Exam and MMIL_Process_Exams to make default
%  DTI_DT_regT1flag = 0

% removed fstools/fs_groupavg_glm_OLD.m
% removed fstools/fs_groupavg_old.m

% rev 170

% added fs_read_curv, fs_write_curv, fs_write_ascii_curv, fs_read_ascii_curv
%   direct copies of non-fs tagged functions in $FREESURFER_HOME/matlab with
%   FSVER = 450

% rev 171

% changed MMIL_Process_Exam to pass DTIflag to DTI_MMIL_AtlasTrack_Fibers_Exam
% changed DTI_MMIL_AtlasTrack_Fibers_Exam to take DTIflag and quit if
%   DTIflag=1 and isempty(snums)

% changed tensor2components and components2tensor to match order
%   used for tensor calculations (xx,yy,zz,xy,xz,yz) for 6-element vector
%   and to transpose T for 9 component to make numbering easier

% changed DTI_MMIL_AtlasTrack_Fibers_Exam to not do DTI_standardize_qmat

% created DTI_Utils/DTI_M_to_R to convert 4x4 M to 3x3 R
% changed DTI_Rotate_Tensors and DTI_Rotate_Vectors to use DTI_M_to_R
% changed DTI_Rotate_Tensors and DTI_Rotate_Vectors to account for
%   RAS to LPH flips when doing rotations

% rev 175

% changed EPDTI_MMIL_WarpToAtlas_Exam (mostly added todo notes)
%   to use inv(M_Atlas_to_DTI) for vector and tensor rotation,
%   not M_Atlas_to_DTI

% changed DTI_Convert_DTmeas to use correct M_out when saving resampled
%   V0 volume; also changed so M_T2_to_T1 is passed to DTI_Rotate_Vectors

% set executable property for all files in MMPS/bin
%   cd MMPS/bin
%   svn ps svn:executable yes *

% rev 176

% from Anders Dale:
%   changed ctx_get_gradwarpinfo to assign gwtype=9 for mr450 and mr750
% updated Projects toolbox:
cd /space/md5/2/data/dhagler/svn/mmil/external/matlab/Projects/VolumeToolbox
svn rm 6_DistortionCorrection; svn commit
cp -rp /home/dale/matlab_junk/MorphometryToolbox/6_DistortionCorrection .
# Important Change! to vol_unwarp_grad.m to accept gwtype=9
% updated /usr/pubsw/packages/MMPS/external/Projects
%  also for mmilcluster4

% rev 179

% changed MMIL_Concat_Surfstats to output VisitID in csv file

% created REC_MMIL_Classify_Exams to allow forced classification only

% changed MMIL_Freesurfer_Recon_Exam to make and copy BEM surfs at end
% changed MMIL_Copy_BEM_Surfs to copy all types of BEM surfaces and then make
%   links to the bem dir in the freesurfer subject dir

% changed REC_MMIL_Summarize_All_DT to make sure measlist and FODmeaslist
%   are cell arrays and so scalefacts is vector of 1's if does not match
%   length of scalefacts

% rev 181

% changed BOLD_Correct_Data and DTI_Correct_Data so list of allowed
%   gruw_type includes 9 (mr450, mr750)

% rev 182

% change so list of allowed gwtype includes 9:
EPI_Tools/EPI_GradUnwarp.m
MMIL_Tools/MMIL_get_gradwarp_signature.m
mmil_tools/mmil_unwarp_grad.m

% rev 183

% changed BOLD_Correct_Data to fix typo in help

% changed by Cooper:
%   MMPS/matlab/REC_Stream/REC_MMIL_Import_ViewerQC.m
%   MMPS/matlab/MMIL_Stream/MMIL_Register_and_Resample_MRI_Volumes.m
%   MMPS/matlab/MMIL_Tools/MMIL_Viewer.m

% created fs_recon.m to generate csh commands to run recon-all step-by-step
% removed fs_rmtouchfiles
% removed fs_mktouchfiles
% renamed fs_checktouchfiles to fs_check_status
%   removed nonlinregflag, changed names of touchfiles
%   added optional version input
% changed fs_group_roi_summary to use fs_check_status instead of fs_checktouchfiles
% changed MMIL_Get_FSReconStatus, removed nonlinregflag, use fs_check_status,
%   added optional version input
% removed MMIL_Freesurfer_Remake_Surfaces
% changed MMIL_Freesurfer_Recon_Exam to use fs_recon, added touchonly_flag,
%   removed cort_ribbon_flag, pass FS_version to MMIL_Get_FSReconStatus
% changed MMIL_Freesurfer_Recon_Exams, added touchonly_flag,
%   removed cort_ribbon_flag
% changed REC_MMIL_Freesurfer_Recon_Exams, removed cort_ribbon_flag
% changed EPDTI_MMIL_Freesurfer_Recon_Exams, removed cort_ribbon_flag
% changed MMIL_Warp_Surf_Long, commented out fs_mktouchfiles
% removed AATL_MMIL_Freesurfer_Remake_Surfaces
% removed MMIL_CleanUp_Long_Warped_Surf
% changed fs_check_status, added function to clean up sloppy code

% rev 187

% changed DTI_Correct_Data to load fname_censor for motion correction
%   in case ecc_flag = 0 and mc_flag = 1, or if mc is interrupted
% created DTI_censor_frames to load fname_censor and return vol, qmat, bvals
%   with bad frames removed
% changed DTI_MMIL_Load_Data to censor vol and qmat if not already done
%   during ecc or mc

% changed DTI_Correct_Data for bug fix
% changed MMIL_Process_DTI for bug fix

% rev 193

% changed by Cooper:
%  MMPS/matlab/REC_Stream/REC_MMIL_Import_ViewerQC.m
%  MMPS/matlab/MMIL_Stream/MMIL_Register_and_Resample_MRI_Volumes.m
%  MMPS/matlab/jcrpub/PING/PING_dcmodify_byScanInfo.m

% changed by Mona:
%  webapps/drupal/sites/all/modules/mmil/mmil.module
%  webapps/drupal/sites/all/modules/mmil/mmil_upload.module

#############################################################################
#############################################################################

## MMPS_220: major revision
## Don Hagler 12/08/10

% changed by Mona:
%  webapps/drupal/sites/all/modules/mmil/mmil_subject.module
%  webapps/drupal/sites/all/modules/mmil/mmil.module
%  webapps/drupal/sites/all/modules/mmil/mmil_upload.module

% rev 197

% NOTE: the following changes are to require gradwarp to be done
%   successfully (except for Philips) and to determine gradwarp type
%   from image if ambiguous from dicom header (GE only)
% changed to remove STRUCT_suffixlist and add STRUCT_gradunwarp_flag:
%   MMIL_Process_Exam, MMIL_Process_Exams, and REC_MMIL_Process_Exams
% changed MMIL_Apply_MRI_Corrections to accept gradunwarp_flag and return
%   errcode=1 if gradwarpinfo is missing (e.g. ambiguousgwtype)
% changed MMIL_Process_Structurals to add graduwarp_flag, hide suffixlist,
%   and pass gradunwarp_flag to MMIL_Apply_MRI_Corrections
% renamed MMIL_get_gradwarp_signature to MMIL_Get_Gradwarp_Signature
% changed MMIL_Process_Structurals to call MMIL_Get_Gradwarp_Signature before
%   MMIL_Apply_MRI_Corrections
% changed MMIL_Apply_MRI_Corrections to use mmil_args2parms
% moved from MMIL_Stream to MMIL_Tools:
%   MMIL_Apply_MRI_Corrections
%   MMIL_Register_and_Resample_MRI_Volumes
%   MMIL_Register_T2_to_T1
%   MMIL_Make_BEM_Surfs
%   MMIL_Copy_BEM_Surfs
%   MMIL_Import_Raw_MRI
%   MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED
%   MMIL_Convert_MRIRAWNONDICOM_to_MRIPROCESSED
%   MMIL_Classify_MRIRAWDICOM
%   MMIL_Unpack_DICOM_Dir_to_Container
%   MMIL_Unpack_NONDICOM_Dir_to_Container
% removed MMIL_Register_and_Resample_MRI_Volumes_OLD
% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to include ReceiveCoilName
%   in scaninfo
% changed MMIL_Apply_MRI_Corrections to calculate B1 field if any scan needs it
%   but then only apply it to those that do (previously would not do B1 correction
%   for any scan if any scan was from head coil
% changed MMIL_Get_Gradwarp_Signature to accept ContainerPath
% changed MMIL_Get_Gradwarp_Signature work for multiple scantypes
% changed MMIL_Get_Gradwarp_Signature to use mmil_args2parms

% rev 198

% changed to use 'orig' not 'tmp':
MMIL_Stream/MMIL_Process_Exams
MMIL_Stream/MMIL_Process_Exam
MMIL_Tools/MMIL_Check_RootDirs
EPDTI_Stream/EPDTI_MMIL_RootDirs
EPDTI_Stream/EPDTI_MMIL_SetRootDirs
MMIL_Tools/MMIL_Status_Report
REC_Stream/REC_MMIL_Status_Report
MMIL_Tools/MMIL_RootDirs_from_ProjInfo
REC_Stream/REC_MMIL_Import_PET_Exams
%% NOTE: ProjInfo csv files can now use 'orig', 'raw', 'proc', etc.
%%   but they can continue to use 'TMP_MRI_RootDir', 'MRIRAWDICOM_RootDir', etc.

% changed 'tmp' to 'orig' in help only:
MMIL_Stream/MMIL_IcoResamp_FSRecon_Exams
MMIL_Stream/MMIL_Freesurfer_Recon_Exams
MMIL_Analysis/MMIL_SurfGroupAvg_BOLD
MMIL_Analysis/MMIL_SurfGroupGLM_BOLD
MMIL_Analysis/MMIL_Summarize_MRI_Analysis
MMIL_Analysis/MMIL_Summarize_Long_Analysis
MMIL_Tools/MMIL_Get_Container
MMIL_Analysis/MMIL_Get_SurfStats
MMIL_Analysis/MMIL_Concat_SurfStats
BOLD_Analysis/BOLD_MMIL_Get_SurfStats
DTI_Stream/DTI_MMIL_Check_StudyInfo
MMIL_Analysis/MMIL_Analyze_BOLD_Exams
MMIL_Analysis/MMIL_Compile_Long_Analysis
MMIL_Analysis/MMIL_Compile_MRI_Analysis

% changed MMIL_Check_StudyInfo to build StudyInfo from orig rootdir

% changed MMIL_Process_Exams by adding 'newflag' option to only create
%   jobs for new data (i.e. only if proc or raw container are missing)
% changed REC_MMIL_Process_Exams to add 'newflag'

% rev 199

% From Josh:
% changed DTI_MMIL_Load_Data to look for DifDirs in ScanInfo
% changed DTI_MMIL_Get_ScanInfo to look for DifDirs in ScanInfo
% changed MMIL_Classify_MRIRAWDICOM to work for PING, etc.
% added Philips_DiffDirs_32.txt to MMPS/parms/DTI
% changed DTI_load_qmat to work for Siemens and Philips
% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to handle PING

% rev 200

% removed REC_MMIL_Get_Container
% changed MMIL_Get_Container to accept VisitID instead of SubjID 
%   no more StudyDate, FieldStrength, or loose_date_flag
% changed calls to MMIL_Get_Container
%   REC_Stream/REC_MMIL_Get_StudyInfo
%   MMIL_Stream/MMIL_Process_Exam
%   MMIL_Stream/MMIL_Process_Exams
%   MMIL_Tools/MMIL_Check_StudyInfo
% changed to use VisitID instead of SubjID:
%   MMIL_Stream/MMIL_PreProcess_Exams
%   MMIL_Stream/MMIL_PreProcess_Exam
%   MMIL_Stream/MMIL_Import_Raw_MRI
% changed to use ContainerInfo.VisitID instead of ContainerInfo.subjid
%   MMIL_Stream/MMIL_Freesurfer_Recon_Exam
%   MMIL_Stream/MMIL_IcoResamp_FSRecon_Exam
%   MMIL_Tools/MMIL_Unpack_NONDICOM_Dir_to_Container
%   REC_Stream/REC_MMIL_Import_PET_Exam
%   MMIL_Tools/MMIL_Convert_MRIRAWNONDICOM_to_MRIPROCESSED
%   MMIL_Tools/MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED
%   ARO_Stream/ARO_MMIL_Convert_Scan_Name
% changed MMIL_Classify_MRIRAWDICOM to not use subjid
% changed to handle orig containers that already have StudyDate etc in name:
%   MMIL_Check_StudyInfo, MMIL_Process_Exams, MMIL_Process_Exam, MMIL_Import_Raw_MRI

% rev 203

% changed to handle orig containers that already have StudyDate etc in name:
%   MMIL_Check_StudyInfo, MMIL_Process_Exams, MMIL_Process_Exam, MMIL_Import_Raw_MRI
%   so that any '.' are replaced with '_'
%   This avoids problems with including '.' in job name and
%   prevents the pattern matches from choosing SubjID as VisitID for orig
%   containers (e.g. for ADNI) that have StudyDate in VisitID

% rev 204

% From Anders and Cooper:
%   changed MMIL_Classify_MRIRAWDICOM to handle HAA_HUNT data with missing
%     dicom info

% rev 205

% changed by Mona:
%   webapps/drupal/sites/all/modules/mmil/mmil_upload.module

% rev 206

% changed ctx_fs_load_mgh to use mmil_check_nargs and to get first frame only
% changed ctx_fs_save_mgh to use mmil_check_nargs

% changed MMIL_Get_Gradwarp_Signature to use different range of voxels that
%   work better for correlation calculations

% created ctx_get_gwtype and ctx_get_gwsig

% removed ctx_load_mgh
% renamed ctx_fs_load_mgh to ctx_load_mgh
% removed ctx_write_mgh
% renamed ctx_fs_save_mgh to ctx_save_mgh

% changed to use ctx_save_mgh instead of ctx_write_mgh (no datatypestr):
%  MMIL_Tools/MMIL_Transform_to_Head_Atlas.m
%  PITU/PITU_Convert_Exam.m
%  PITU/PITU_Modify_Brainmask.m
%  PITU/PITU_tmp.m
%  PreprocessHeadModel/coregister_headmodel_scans.m
%  REC_Stream/REC_MMIL_Register_PET_to_MRI.m 

% find/replace all uses of ctx_fs_load_mgh to ctx_load_mgh
% find/replace all uses of ctx_fs_save_mgh to ctx_save_mgh
cd /space/md5/2/data/dhagler/svn/mmil/MMPS/matlab
perl -pi -e 's/ctx_fs_load_mgh/ctx_load_mgh/g' */*.m
perl -pi -e 's/ctx_fs_save_mgh/ctx_save_mgh/g' */*.m

% changed MMIL_Get_Gradwarp_Signature to use ctx_get_gwtype and ctx_get_gwsig

% rev 207

% changed MMIL_Process_Exams to not check for raw container (only proc)
%   for newflag=1

% changed MMIL_Get_Container to narrow dirlist down to those that have
%   VisitID followed immediately by "_", 8 digit date, ".", and anything
%   This avoids warning when two Containers have similar VisitID's
%   e.g. TEST_S001_101212 and TEST_S001_101212a

% changed MMIL_Apply_MRI_Corrections to check for empty gradwarpinfo.gwtype
%   (for cases that are still ambiguous after running MMIL_Get_Gradwarp_Signature)

% changed MMIL_Get_Gradwarp_Signature to check volume is actually a volume

% changed MMIL_Classify_MRIRAWDICOM to make sure GE_SequenceLabel and GE_SequenceName
%   are both row vectors (with rowvec)

% removed load_mgh_amd and write_mgh_amd

% changed by Cooper:
%   changed fs_load_mgh to convert M to be 1-based
%   changed fs_save_mgh to convert M to be 0-based
%   MMPS/matlab/MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m
%   MMPS/matlab/MMIL_Tools/MMIL_Viewer.m
%   MMPS/matlab/utils/matlab2c.m
%   MMPS/matlab/REC_Stream/REC_MMIL_Import_ViewerQC.m
%   MMPS/matlab/fstools/fs_load_mgh.m
%   MMPS/matlab/fstools/fs_save_mgh.m
%   MMPS/matlab/jcrpub/MTA_Study
%   MMPS/matlab/jcrpub/MTA_Study/mta_unzip_anon.csh

% rev 211

% changed by Josh:
%   MMPS/matlab/MMIL_Stream/MMIL_Process_DTI.m
%   MMPS/matlab/MMIL_Tools/MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED.m
%   MMPS/matlab/utils/read_dicom_4dvol.m

% rev 212

% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to fix indenting

% rev 215

% copied ~kuperman/matlab/resize/resize to 
%   /space/md5/2/data/dhagler/svn/mmil/MMPS/bin/resize_volume
%   (apparently is a variant of mriRegister)
% copied ~kuperman/matlab/resize/inputParamsScale.txt to
%   /space/md5/2/data/dhagler/svn/mmil/MMPS/parms/MRIREG/inputParamsScale.txt
% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to use resize_volume
%   and paramfile = [getenv('MMPS_PARMS') '/MRIREG/inputParamsScale.txt'];
% copied ~holland/bin/shiftX to /space/md5/2/data/dhagler/svn/mmil/MMPS/bin/shiftX
% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to use MMPS shiftX

% rev 217

% changed BOLD_TShift to fix typo
% changed BOLD_MotionCorr and BOLD_TShift to set tpath=pwd if empty

% rev 218

% changed by Cooper:
%   MMPS/matlab/MMIL_Tools/MMIL_Get_Gradwarp_Signature.m
%   MMPS/matlab/MMIL_Tools/MMIL_Apply_MRI_Corrections.m
%   MMPS/matlab/jcrpub/MTA_Study
%   MMPS/matlab/jcrpub/Anonymize_Tools
%   MMPS/matlab/jcrpub/Anonymize_Tools/proj_startup_template.m
%   MMPS/matlab/jcrpub/Anonymize_Tools/Unzip_Anonymize_Subj_Exams.m
%   MMPS/matlab/jcrpub/Anonymize_Tools/unzip_anonymize_subj_exams.csh

% changed MMIL_Register_and_Resample_MRI_Volumes so suffixlist is set depending
%   on scaninfo.gradwarpinfo.unwarpflag
% changed MMIL_Process_Structurals to remove suffixlist option

% rev 221

% changed MMIL_Register_and_Resample_MRI_Volumes to accept
%   gradunwarp_flag=1
% changed MMIL_Process_Structurals to pass gradunwarp_flag to MMIL_Register...

% changed by Vijay:
%    MMPS/matlab/EPDTI_Stream/EPDTI_MMIL_Import_DTIStudio_FiberMasks.m
%    MMPS/matlab/DTI_Stream/DTI_MMIL_Load_Data.m
%    MMPS/matlab/EPI_Tools/EPI_Resample_Data.m
%    MMPS/matlab/DTI_Tools/DTI_MotionCorr.m
% added by Vijay:
%    MMPS/matlab/DTI_Utils/DTI_Rotate_qmat.m

% changed by Cooper:
%    MMPS/matlab/jcrpub/Anonymize_Tools/Unzip_Anonymize_Subj_Exams.m
%    MMPS/matlab/jcrpub/Anonymize_Tools/unzip_anonymize_subj_exams.csh
% added by Cooper:
%    MMPS/matlab/jcrpub/Anonymize_Tools/Subject_unzip.m
%    MMPS/matlab/jcrpub/Anonymize_Tools/unzip_anonymize_ALL.csh

% rev 225

% changed ts_dSPM to add hidden 'save_results_flag'

% changed MMIL_Analyze_BOLD_Exams to have qcflag with default = 0

% rev 226

% changed by Vijay:
%    MMPS/matlab/DTI_Stream/DTI_MMIL_AtlasTrack_Fibers_Exam.m
%    MMPS/matlab/DTI_Utils/DTI_standardize_qmat.m

% added by Vijay:
%    MMPS/matlab/DTI_Utils/DTI_standardize_vec2atlas.m

% rev 228

% changed MMIL_Analyze_BOLD_Exams to not warn if fsurf is empty

% changed MMIL_Check_StudyInfo to set VisitID to STRUCT_VisitID for
%   ContainerType fsurf

% rev 229

% changed DTI_MMIL_Export_Data to not call DTI_standardize_qmat
% removed DTI_standardize_qmat

% rev 230

% moved MMIL_Import_Raw_MRI from MMIL_Tools to MMIL_Stream

% added ProjID and MMPSVER to ContainerInfo:
% changed MMIL_Load_ContainerInfo (minor)
% added MMIL_Save_ContainerInfo
% added MMIL_Stamp_Container (to add ProjID and MMPSVER to ContainerInfo)
% changed MMIL_Process_Exam to call MMIL_Stamp_Container
%   after MMIL_Import_Raw_MRI and after MMIL_Process_Raw_MRI
% changed MMIL_Stamp_Container to save list of MMPS_nonsvn dirlist
% changed MMIL_Freesurfer_Recon_Exams to pass ProjID to MMIL_Freesurfer_Recon_Exam
% changed MMIL_Freesurfer_Recon_Exam to call MMIL_Save_ContainerInfo
% changed MMIL_Freesurfer_Recon_Exam to call MMIL_Stamp_Container
% changed MMIL_IcoResamp_FSRecon_Exams to pass ProjID to MMIL_IcoResamp_FSRecon_Exam
% changed MMIL_IcoResamp_FSRecon_Exam to call MMIL_Save_ContainerInfo
% changed MMIL_IcoResamp_FSRecon_Exam to call MMIL_Stamp_Container

% changed fs_check_status to initialize allexist and volexist earlier

% rev 232

#############################################################################
#############################################################################

## MMPS_221: medium revision
## Don Hagler 01/13/10

% changed by Mona:
%   webapps/drupal/sites/all/modules/mmil/mmil_upload.module

% added Philips_DiffDirs_32.txt to parms/DTI (from Josh Kuperman)

% rev 235

% changed fs_recon.m by removing unused 'touch_prefix' parameter

% changed to remove looping over ProjInfo (allow only one ProjID):
%   REC_MMIL_Summarize_MRI_Analysis
%   REC_MMIL_Summarize_CortThick_forPET
%   REC_MMIL_Summarize_PET_aparc
%   REC_MMIL_Summarize_PET_aseg
%   REC_MMIL_Summarize_Volume_forPET

% changed REC_MMIL_Analyze_DT_Exams to override default with ProjInfo
%   and override ProjInfo with command-line input

% rev 239

% renamed REC_MMIL_Analyze_DT_Exams to REC_MMIL_Analyze_DTI_Exams

% created REC_MMIL_Analyze_BOLD_Exams

% rev 240

% changed mmil_dilate_mask to have thresh3 = 0.01

% changed BOLD_Correct_Data to remove extra %s in fprintf WARNINGs

% created fs_vol_match to check if dimensions and orientations match
%   for two files
% changed EPI_EstimateB0 and EPI_OptimizeB0 to use fs_vol_match

% change MMIL_Process_BOLD to uncomment try/catch statements

% from JCR:
%  removed MMPS/matlab/jcrpub/Anonymize_Tools

% rev 242

% changed DTI_MMIL_Get_ScanInfo to not use future scans as B0uw reference
%   (copied code from BOLD_MMIL_Get_ScanInfo)

% changed mmil_dilate_mask to add ";" to suppress display of volmask

% renamed/changed BOLD_MMIL_Read_StudyInfo to BOLD_MMIL_Check_StudyInfo
% changed MMIL_Analyze_BOLD_Exams to call BOLD_MMIL_Check_StudyInfo

% moved DTI_MMIL_CSD_Tract_Exam from DTI_Stream_OLD to DTI_Stream
% changed DTI_MMIL_CSD_Tract_Exam
%   default seed_point_sampling = [2 2 2]
%

% changed DTI_MMIL_Load_Data to fix bug with isfield(ScanInfo(s).DifDirs)
%   used getfielddefault instead

% rev 244

% changed REC_MMIL_IcoResamp_FSRecon_Exams to accept ico option

% changed MMIL_IcoResamp_FSRecon_Exams to remove redundant parm batchname

% changed MMIL_Copy_BEM_Surfs to make default BEMtype = 'aseg'
%   added warnings if in_bem_dir not found

% changed MMIL_IcoResamp_FSRecon_Exams to use VisitID in job name

% changed mmil_isint to return 0 if any values are not finite
% created mmil_structarr_str2num to convert strings to numeric vectors
%   for struct arrays; uses str2num instead of eval
% changed MMIL_Check_StudyInfo and MMIL_Read_ProjInfo to
%   use mmil_structarr_str2num

% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED and
%   MMIL_Classify_MRIRAWDICOM to use MMIL_Load_ContainerInfo and
%   MMIL_Save_ContainerInfo

% rev 245

% created MMPS/matlab/MEG_Stream
%    MMPS/matlab/MEG_Stream/MEG_MMIL_Check_RootDirs.m
%    MMPS/matlab/MEG_Stream/MEG_MMIL_Check_StudyInfo.m
%    MMPS/matlab/MEG_Stream/MEG_MMIL_Get_Container.m
%    MMPS/matlab/MEG_Stream/MEG_MMIL_Get_StudyInfo.m
%    MMPS/matlab/MEG_Stream/MEG_MMIL_ProjInfo_Args.m
%    MMPS/matlab/MEG_Stream/MEG_MMIL_Read_ProjInfo.m
%    MMPS/matlab/MEG_Stream/MEG_MMIL_RootDirs.m
%    MMPS/matlab/MEG_Stream/MEG_MMIL_RootDirs_from_ProjInfo.m
%    MMPS/matlab/REC_Stream/REC_MMIL_Process_MEG_Exams.m
%    MMPS/matlab/MMIL_Stream/MMIL_Process_MEG.m
%    MMPS/matlab/MMIL_Stream/MMIL_Process_MEG_Exam.m
%    MMPS/matlab/MMIL_Stream/MMIL_Import_MEG.m
%    MMPS/matlab/MMIL_Stream/MMIL_Process_MEG_Exams.m

% added MMPS/matlab/mmil_util/mmil_merge_args.m (from JCR)

% rev 246

% added fs_labels2masks (from ~dhagler/megret/conv_labels2masks.m)

% changed mmil_args2parms and mmil_merge_args to return if ~mmil_check_nargs

% added rcse toolbox (retinotopy constrained source estimation)
%   from ~dhagler/matlab/megret
%   renamed files with "rc_" prefix
%   updated function calls (to use rc_) and sorted functions
%     used internally to "functions" and others to "extra"
%   updated plotting functions

% rev 247

% created MMIL_Analyze_MEG_Exams, MMIL_Analyze_MEG_Exam
% renamed MEG_MMIL_ProjInfo_Args to MEG_MMIL_Args, added allowed contexts
% created REC_MMIL_Analyze_MEG_Exams
% created MEG_MMIL_dSPM and MEG_MMIL_RCSE
% created empty MEG_MMIL_dSPM_RCSE

% rev 252

% changed MMIL_Analyze_MEG_Exam(s) to use dSPM and RCSE field name prefixes
% changed MMIL_Process_MEG_Exam(s) to use PROC field name prefixes
% changed MEG_MMIL_Args to look for and strip arg group prefixes
% updated REC_MMIL_Process_MEG_Exams
% updated REC_MMIL_Analyze_MEG_Exams

% created MEG_MMIL_Browse_Raw
% created MEG_MMIL_Ready_RetFit
% created MEG_MMIL_Reg2MRI
% changed MMIL_Process_MEG_Exam(s), MMIL_Process_MEG to pass FSContainerPath
%   and save as field in ContainerInfo.mat, for use by MEG_MMIL_Reg2MRI

% changed ts_pointreg

% changed mmil_masksurf to use 5000 vertices
% changed REC_MMIL_Create_BEM_Exams, MMIL_Create_BEM_Exam(s) so default
%   BEMtype = 'T1' (not 'aseg'), ico = 4

% removed REC_Analysis/REC_group_roi_summary

% changed MEG_MMIL_RCSE and MEG_MMIL_dSPM to have default badchanfile
%    = 'badchans.txt', if not found, set to empty before passing along
% changed MMIL_Analyze_MEG_Exam(s) to have default badchanfile

% created MMIL_RetFit_MEG_Exams and MMIL_RetFit_MEG_Exam
% created REC_MMIL_RetFit_MEG_Exams

% changed MMIL_Analyze_MEG_Exams and MMIL_Process_MEG_Exams to override
%   parameter values with non-empty values from StudyInfo

% changed MEG_MMIL_Check_StudyInfo to get proc (MRI) container
% changed MEG_MMIL_Args to add MEG_MMIL_Ready_RetFit and MMIL_RetFit_MEG_Exams

% changed ts_process_fif_data to not overwrite parms.mat unless forceflag

% created MEG_MMIL_dSPM_ROI, wrapper for ts_roi_analysis
% changed MMIL_Analyze_MEG_Exam(s) to use MEG_MMIL_dSPM_ROI
% changed MEG_MMIL_Args to add MEG_MMIL_dSPM_ROI
% changed ts_roi_analysis to take relative roidir

% created mmil_write_value to simplify mmil_write_tags and mmil_write_script
%   and to allow writing cell arrays of vectors

% changed rc_ready_retfit to use roi_name instead of maskstem
% changed rc_retfit to use roi_name instead of roi_stem

% changed MEG_MMIL_RCSE to fix ERROR message

% changed rc_RCSE to use mmil_isrelative

% changed MMIL_Analyze_MEG_Exams to check for cond_info file (for RCSE) in
%   ContainerPath and /home/user/ProjInfo/ProjID

% changed REC_MMIL_Analyze_MEG_Exams so default RCSE_plotflag = 1
% changed rc_RCSE_func to add "rc_" to calc_ret_sourcecov

% changed MEG_MMIL_dSPM, *MMIL_Analyze_MEG_Exam* so default overwrite_results_flag = 0

% changed rc_RCSE to make plot montages with imread,cat,imwrite

% changed DTI_Correct_Data to close censor_mat image figure before
%   creating censor_err image figure

% changed by Mona:
%   webapps/drupal/sites/all/modules/mmil/mmil.module
%   webapps/drupal/sites/all/modules/mmil/mmil_site.module
%   webapps/drupal/sites/all/modules/mmil/mmil_upload.module
%   webapps/drupal/sites/all/modules/mmil/mmil_upload.info

% rev 254

% changed MEG_MMIL_Get_Container to correctly handle Containers with and without
%   session IDs (i.e. date and time stamp from MRI dicoms)

% changed MMIL_Process_Exam to set DTI_resample_flag=0 (and BOLD_resample_flag=0)
%   if STRUCT_VisitID container is missing and DTI_regT1flag=2 (or BOLD_regT1flag=2)

% changed REC_MMIL_Process_Exams, added DTI_snums_flag to tags

% added by Mona:
%  webapps/drupal/sites/all/modules/mmil/mmil_api.php

% rev 256

% changed ts_dSPM to use ts_dSPM_sourcecov, have forceflag
%   removed overwrite_forward_flag and overwrite_inverse_flag
% created ts_dSPM_sourcecov
% created ts_mgh2sourcecov
% changed ts_thresh_weights; modernized, allow empty v
% changed MEG_MMIL_dSPM, rc_dSPM_RCSE, REC_MMIL_Analyze_MEG_Exams,
%  MMIL_Analyze_MEG_Exam(s)
%   to remove overwrite_forward_flag and overwrite_inverse_flag

% rev 257

% changed MMIL_Process_MEG_Exams to fix tmp_parms/parms confusion

% changed MMIL_Process_MEG_Exams to allow non-unique MEG_VisitID in StudyInfo
%   but generate job for first entry only

% changed MMIL_Classify_MRIRAWDICOM to fix indentation,
%   check isfield(tmpinfo,'Private_0051_100b')

% changed fs_surfmgh.csh to load label file
% changed rc_ready_retfit to include label file in view scripts
% changed MEG_MMIL_Ready_RetFit and rc_ready_retfit so default smooth=10
%   (for displaying data in tksurfer)
% changed rc_retfit, REC_MMIL_RetFit_MEG_Exams, MMIL_RetFit_MEG_Exam(s),
  and MEG_MMIL_Ready_RetFit to have default niter = 1000
% changed rc_retfit to check exist || forceflag before writing results
% changed rc_retfit to use mmil_parms2args instead of explicitly creating
%   cell array of options
% changed rc_retfit_func to create subfunction resamp_results_surf
% changed rc_ready_retfit to pass outdir to rc_retfit
% changed rc_retfit and rc_retfit_func to accept and use outdir
% changed rc_retfit to add roi_indir parameter
% changed rc_retfit, rc_ready_retfit, and MMIL_RetFit_MEG_Exam
%   to consistently use hemi.name.label convention for input and output labels
% changed rc_retfit to put mat, mgh, label files in separate subdirs

% changed ts_pointreg to have button to overwrite intransfile
%   added buttons for small and large step sizes
%   moved and resized buttons, made fontsize larger

% changed rc_RCSE to accept retfit_dir and set retfit_stem to
%   [retfit_dir '/matfiles/' retfit_stem]
% changed MMIL_Analyze_MEG_Exam(s), REC_MMIL_Analyze_MEG_Exam, and MEG_MMIL_RCSE
%   to allow RCSE_retfit_dir

% changed MMIL_Read_StudyInfo to ignore lines that start with %, changed
%   MMIL_Read_ProjInfo to not (since it calls MMIL_Read_StudyInfo)

% rev 259

% created BOLD_MMIL_Combine_Fourier_Subject, BOLD_MMIL_Combine_Fourier_Subjects,
%   and REC_MMIL_Combine_Fourier_Subject
% changed fs_fourier_avg to accept phase_offset as vector

% changed rc_ready_retfit to create log file to note where data came from

% changed BOLD_MMIL_Check_StudyInfo to use mmil_splitstr to separate 1D files

% changed BOLD_MMIL_Combine_Fourier_Sessions to accept OutContainerPath
% changed BOLD_MMIL_Combiner_Fourier_Subject to set OutContainerPath
%   as first Container with polar data (or eccen if no polar data)

% created mmil_run_batch_jobs.m to run jobs serially with one instance of matlab

% changed rc_retfit_func to try passing 'Algorithm','active-set' to optimset
%   and if error, try again with 'LargScale','off'
%   R2007a does not recognize 'Algorithm'
%   R2009b has default Algorithm that conflicts with 'LargeScale','off'

% changed rc_RCSE_func to call new functions (in separate files)
%  rc_rotate_trans.m rc_check_bounds.m rc_check_wrap.m
%  rc_RCSE_retmap_from_retfit.m rc_RCSE_set_cond_info_offsets.m
%  rc_RCSE_save_results.m rc_RCSE_extract_source_wforms.m rc_RCSE_fit_waveforms.m
%  rc_RCSE_full_nbrhood_search.m rc_RCSE_rand_nbrhood_search.m rc_RCSE_rand_rf_search.m
%  rc_RCSE_rand_rcsale_search.m rc_RCSE_rand_rot_search.m rc_RCSE_rand_offset_search.m
%  rc_RCSE_init_mstart.m rc_RCSE_mstart_rand_offset_search.m rc_RCSE_hybrid_offset_search.m
%  rc_RCSE_reweight_lsq.m rc_RCSE_func.m rc_calc_ref_absdiff.m rc_RCSE_full_offset_search.m
%  rc_calc_ref_corr.m rc_RCSE_calc_fit_err.m rc_RCSE_prep_forward.m
%  rc_RCSE_calc_vf2ctx.m rc_RCSE_check_parms.m rc_RCSE_check_conds.m

% created MEG_MMIL_RCSE_GroupAvg (from ~dhagler/matlab/batch_megret/calc_megret_groupavg.m)
% changed rc_RCSE to add infix_flag, default = 0, so output prefix is same as
%   input parameter "prefix"
% created rc_RCSE_set_infix to create string to indicate values of some parameters
% added RCSE_infix and RCSE_infix_flag to MEG_MMIL_RCSE, rc_RCSE,
%   REC_MMIL_Analyze_MEG_Exams, etc.
% added MEG_MMIL_RCSE_GroupAvg to MEG_MMIL_Args
% changed MEG_MMIL_RCSE_GroupAvg to use all contrast levels

% added by JCR:
%   MMPS/matlab/MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m

% changed by JCR:
%   MMPS/matlab/MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
%   MMPS/matlab/MMIL_Analysis/MMIL_Concat_SurfStats.m
%   MMPS/matlab/MMIL_Analysis/MMIL_Get_SurfStats.m
%   MMPS/matlab/MMIL_Analysis/MMIL_Compile_MRI_Analysis.m

% rev 261

% changed MMIL_Compile_MRI_Analysis to include CortContrastRatio as separate
%   field in results

% changed rc_dSPM_RCSE to use .(fields{f}) instead of setfield/getfield

% changed mmil_run_batch_jobs to use loop and fgetl instead of mmil_readtext

% changed rc_RCSE_calc_fit_err to reshape Y and Yfit
%   correctly taking into account number of conditions

% changed rc_calc_simple_inverse, rc_calc_ret_inverse_operator,
%   and rc_calc_ret_inverse_operator_noprior to not printf message

% changed rc_retfit_func, rc_retfit, and rc_mask_pol to remove
%   ecc_phase_offset parameter
% changed rc_retfit_func, rc_mask_pol, and fs_fourier_avg
%   so rmin is used to calculate phase when logtrans_flag = 0
% changed fs_fourier_avg to accept r_max_vec, r_max, r_min_vec, r_min_factor,
%   and logtrans_flags
% changed BOLD_MMIL_Combine_Fourier_Sessions to accept r_max_vec, r_max,
%   r_min_vec, r_min_factor, and logtrans_flags, combine across sessions
%   and pass to fs_fourier_avg
% changed BOLD_MMIL_Combine_Fourier_Subject to get r_max, r_min, logtrans_flag
%   from StudyInfo and pass to BOLD_MMIL_Combine_Fourier_Sessions

% changed MMIL_RetFit_MEG_Exam(s) and REC_MMIL_RetFit_MEG_Exams
%   to accept RF_r_min_factor, with default = 0.02
% changed rc_ready_retfit to use r_min_factor

% rev 266

% changed BOLD_MMIL_Combine_Fourier_Sessions to set r_max, r_min, logtrans_flag
%   to empty if datatype is not 'eccen'

% renamed mmil_run_batch_jobs to mmil_run_batch

% changed rc_RCSE and rc_RCSE_func to add forceflag [0|1|2]
%   removed overwrite_forward_flag from rc_RCSE_func
%   removed save_forward_prep_flag
% changed rc_RCSE_check_parms and rc_RCSE_prep_forward to use forceflag
% changed MEG_MMIL_RCSE, RCE_MMIL_Analyze_MEG_Exams, MMIL_Analyze_MEG_Exam(s)
%   to use RCSE_forceflag, removed RCSE_save_forward_prep

% changed rc_RCSE_check_parms to remove backward compatibility for
%   noise_start and noise_end

% changed rc_retfit_func to keep fit_data.ecc_r and fit_data.ecc_i sparse

% created rc_extract_prior to get prior waveform from results mat file
%   and resample to reference time and nwforms, handle Group RCSE results
% changed rc_RCSE_hybrid_offset_search, rc_RCSE_fit_waveforms, and
%   rc_RCSE_check_parms

% changed REC_MMIL_Analyze_MEG_Exams to add RCSE_group_prior_flag,
%   RCSE_group_prior_prefix, and RCSE_group_prior_niters
% changed MMIL_Analyze_MEG_Exams to accept those parameters, but not pass them to
%   MMIL_Analyze_MEG_Exam

% changed scripts in MMPS/csh to use -nodesktop instead of -nojvm

% changed rc_RCSE to display total elapsed time

% changed rc_RCSE_retmap_from_retfit and rc_RCSE_calc_vf2ctx to display message
%   and elapsed time, changed other rc_RCSE functions to not display message and
%   elapsed time

% changed ts_dSPM to accept forceflag=2 to overwrite forward
% changed MEG_MMIL_dSPM, MEG_MMIL_Analyze_MEG_Exam(s),...
%   and REC_MMIL_Analyze_MEG_Exams

% changed MEG_MMIL_Read_ProjInfo and MEG_MMIL_Check_StudyInfo to convert
%   RCSE r and th offset ranges from strings to numeric vectors

% changed fs_fourier_avg to fix bug when cxfstatsflag 0

% removed REC_MMIL_Combine_Fourier_Subjects
% renamed BOLD_MMIL_Combine_Fourier_Subjects to MMIL_Combine_Retinotopy_Exams
% changed MMIL_Combine_Retinotopy_Exams to accept ProjID, and optionally
%   RootDirs and StudyInfo
% created MMIL_Check_ProjID to get StudyInfo and RootDirs using ProjID,
%   unless RootDirs and StudyInfo are supplied
% renamed BOLD_MMIL_Combine_Fourier_Subject to MMIL_Combine_Retinotopy_Exam
% created MMIL_Retinotopy_GroupAvg, uses MMIL_Combine_Retinotopy_Exam

% changed BOLD_MMIL_Combine_Fourier_Sessions to add sphere and smooth
%   to input file name, use fsaverage as subj

% created BOLD_MMIL_Set_Fourier_Stem
% changed MEG_MMIL_Ready_RetFit to use BOLD_MMIL_Set_Fourier_Stem

% changed mmil_source_diff and ts_surf2movie to use mmil_unix instead of
%   smartunix
% removed utils/smartunix
% changed mmil_unix to not use varargout

% changed fs_read_trisurf and fs_mgh2w to use exist instead of file_exists,
%   and to not use error(... instead of error(sprintf(...
% removed utils/file_exists

% changed mmil_splitstr to allow some separators with escape sequences to work
%   e.g. '\n'
% removed utils/splitstr

% changed MMIL_Classify_MRIRAWDICOM to fix bug
%   changed ContainerOutPath to ContainerPath in call to MMIL_Save_ContainerInfo

% rev 267

% changed fs_surf2ico
% created fs_label_groupavg
% created fs_label2mgh

% changed ts_vestal to convert Y and C to double before passing to
%   L1_norm_linprog_lamda

% changed fs_3dDeconv to strip extra TRs from stim 1D files for multiple files

% changed MMIL_Analyze_BOLD_Exams to not make jobs if FP_snums, FE_snums,
%   and GLM_snums are all empty

% changed MMIL_Retinotopy_GroupAvg to accept outdir (now documented)
%   instead of OutContainerPath

% created MEG_MMIL_Average_ROIs

% created MEG_MMIL_Check_ProjID
%   copy of MMIL_Check_ProjID, but uses MEG_MMIL_Get_StudyInfo
%   instead of REC_MMIL_Get_StudyInfo

% created MMIL_Get_ProjInfo, returns ProjInfo and RootDirs
% changed MMIL_Read_ProjInfo to include MEG fields as default numvec_tags
%   allow numvec_tags as input to be added to default_tags

% created MMIL_Get_StudyInfo
% created MMIL_Get_QCInfo from REC_MMIL_Get_StudyInfo
% changed MMIL_RootDirs_from_ProjInfo to add MEG dirs
% removed MEG_MMIL_RootDirs_from_ProjInfo
% changed MMIL_Check_RootDirs to add MEG dirs
% removed MEG_MMIL_Check_RootDirs and MEG_MMIL_RootDirs
% moved MEG_MMIL_Get_Container to MMIL_Get_Container
% changed MMIL_Check_ProjID to use MMIL_Get_StudyInfo (not REC_MMIL_Get_StudyInfo)
%   added changes from MEG_MMIL_Check_ProjID
% removed MEG_MMIL_Check_ProjID
% changed MMIL_Check_StudyInfo to incorporate changes from
%   MEG_MMIL_Check_StudyInfo and REC_MMIL_Check_StudyInfo
% changed MMIL_Check_StudyInfo and MMIL_Check_ProjID to use slighly different
%   parameter names (e.g. 'raw_meg_flag' instead of 'raw_megflag')
%   added QC parameters for manual QC
% removed MEG_MMIL_Read_ProjInfo
% removed MEG_MMIL_Get_StudyInfo
% removed MEG_MMIL_Check_StudyInfo
% moved MEG_MMIL_Args to MMIL_Args
% changed MMIL_Args to add cases for MMIL_Check_StudyInfo, MMIL_Get_StudyInfo,
%    MMIL_Check_ProjID, and MMIL_Get_QCInfo
% changed MMIL_Get_StudyInfo, MMIL_Check_ProjID to use MMIL_Args
% changed MMIL_Process_MEG_Exam to use MMIL_Args for MMIL_Check_ProjID
% changed MMIL_Combine_Retinotopy_Exams to use MMIL_Args for MMIL_Check_ProjID
% changed MMIL_RetFit_MEG_Exams, MMIL_Analyze_MEG_Exams, and
%   MMIL_Process_MEG_Exams to accept ProjID
% changed MMIL_Process_MEG_Exams to combine ProjInfo and varargin
% removed REC_MMIL_RetFit_MEG_Exams, REC_MMIL_Analyze_MEG_Exams, and
%   REC_MMIL_Process_MEG_Exams
% changed MMIL_RetFit_MEG_Exam to use MMIL_Args instead of MEG_MMIL_Args
% changed MMIL_Get_StudyInfo, MMIL_Check_StudyInfo MMIL_Check_ProjID,
%   and MMMIL_Args to use required_containers instead of individual
%   proc_flag, fsurf_flag, etc.

% changed to use required_containers instead of procflag, fsflag, etc.:
%   DTI_Stream/DTI_MMIL_Check_StudyInfo
%   EPDTI_Analysis/EPDTI_MMIL_SurfGroupAvg_DT
%   MMIL_Analysis/MMIL_Combine_Retinotopy_Exams
%   BOLD_Analysis/BOLD_MMIL_Get_SurfStats
%   MMIL_Analysis/MMIL_Analyze_BOLD_Exams
%   MMIL_Analysis/MMIL_Analyze_Long_Exams
%   MMIL_Analysis/MMIL_Analyze_MRI_Exams
%   MMIL_Analysis/MMIL_Compile_Long_Analysis
%   MMIL_Analysis/MMIL_Compile_MRI_Analysis
%   MMIL_Analysis/MMIL_Concat_SurfStats
%   MMIL_Analysis/MMIL_Get_SurfStats
%   MMIL_Analysis/MMIL_SurfGroupAvg_BOLD
%   MMIL_Analysis/MMIL_SurfGroupGLM_BOLD
%   MMIL_Longitudinal/MMIL_Long_Register_Exams
%   MMIL_Longitudinal/MMIL_Long_Setup_Exams

% changed to have default qcflag = 1:
%   EPDTI_MMIL_SurfGroupAvg_DT
%   MMIL_Combine_Retinotopy_Exams
%   MMIL_Analyze_BOLD_Exams
%   MMIL_Analyze_Long_Exams
%   MMIL_SurfGroupGLM_BOLD
%   MMIL_SurfGroupAvg_BOLD

% changed MMIL_Process_MEG_Exam, MMIL_Process_Exam(s) to use
%   required_rootdirs instead of required_fields

% changed MEG_MMIL_RCSE_GroupAvg and MEG_MMIL_Group_RCSE to accept ProjID
%   as required input, RootDirs and StudyInfo as optional
% removed REC_MMIL_RCSE_GroupAvg and REC_MMIL_Group_RCSE

% renamed MEG_MMIL_Average_ROIs to BOLD_MMIL_Average_ROIs
% renamed MEG_MMIL_Ready_RetFit to BOLD_MMIL_Ready_RetFit
% renamed MMIL_RetFit_MEG_Exam(s) to MMIL_RetFit_BOLD_Exam(s)
% changed to be independent of MEG:
%   BOLD_MMIL_Ready_RetFit, BOLD_MMIL_Average_ROIs, MMIL_RetFit_BOLD_Exam(s)
% updated MMIL_Args

% changed MMIL_RetFit_BOLD_Exam(s) and BOLD_MMIL_Ready_RetFit to accept
%   multisess_flag
% changed MMIL_RetFit_BOLD_Exams to accept RF_multisess_r_max
%   to override RF_r_max if multisess_flag = 1

% renamed REC_MMIL_Import_PET_Exam to MMIL_Import_PET_Exam
% changed REC_MMIL_Import_PET_Exams to call MMIL_Import_PET_Exam
% renamed REC_MMIL_Register_PET_to_MRI_Exams to REC_MMIL_Process_PET_Exams
%   changed not loop over ProjInfo, fixed indentation
%   use REC_MMIL_Get_StudyInfo, removed commented code
% renamed REC_MMIL_Register_PET_to_MRI to MMIL_Process_PET_Exam
%   removed commented code, fixed indentation

% removed PETPIB/petpib as special container type; changed:
%   MMIL_RootDirs_from_ProjInfo
%   MMIL_Get_Container
%   MMIL_Check_StudyInfo
%   MMIL_Check_RootDirs

% changed MMIL_Check_ProjID and MMIL_Get_StudyInfo so that
%   QC_raw, QC_recon, etc. are false by default

% moved from MMIL_Tools to MMIL_Utils:
% MMIL_Args.m                    MMIL_Check_StudyInfo.m    MMIL_Get_ProjInfo.m        MMIL_Read_ProjInfo.m           MMIL_Set_Common_RootDirs.m
% MMIL_Check_Container_Exists.m  MMIL_Check_Usage.m        MMIL_Get_QCInfo.m          MMIL_Read_StudyInfo.m          MMIL_Stamp_Container.m
% MMIL_Check_ProjID.m            MMIL_Get_Container.m      MMIL_Get_StudyInfo.m       MMIL_RootDirs_from_ProjInfo.m  tmp_PET_StudyInfo.m
% MMIL_Check_RootDirs.m          MMIL_Get_FSReconStatus.m  MMIL_Load_ContainerInfo.m  MMIL_Save_ContainerInfo.m

% created BOLD_MMIL_Check_RetFit_Data to make sure retinotopy analysis
%   files exist before running RetFit (in BOLD_MMIL_Ready_RetFit) or
%   creating a job (in MMIL_RetFit_BOLD_Exams)

% changed MMIL_Analyze_MEG_Exams to set RCSE_retfit_dir to be relative to
%   fMRI ContainerPath

% changed RCSE to save cond_info offsets to ContainerPath,
%   even if input cond_info comes from ProjInfo

% changed BOLD_MMIL_GLM_Analysis to remove unused 'smooth' parameter
% changed BOLD_MMIL_Set_Fourier_Stem to get SessInfo if length(snums)==1
% created BOLD_MMIL_Set_GLM_Stem
% created BOLD_MMIL_GLM_ROI_Analysis

% changed fs_recon to add parcstats2

% changed by Vijay:
%   MMPS/matlab/MMIL_Tools/MMIL_RootDirs_from_ProjInfo.m
%   MMPS/matlab/DTI_Tools/DTI_EddyCurrCorr.m
%   MMPS/matlab/DTI_Tools/DTI_MotionCorr.m
%   MMPS/matlab/DTI_Tools/DTI_Fit_Tensor.m

% added by Vijay:
%   MMPS/matlab/DTI_Atlas
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exam.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Average_Atlas_Fibers.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exams.m
%   MMPS/matlab/DTI_Atlas/REC_MMIL_WarpToAtlas.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_WarpToAtlas_Exam.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_WarpToAtlas_Exams.m
%   MMPS/matlab/DTI_Atlas/REC_MMIL_ImportFibers.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Average_Atlas_Fiber.m

% changed by Mona:
%   webapps/drupal/sites/all/modules/mmil/mmil_user.module
%   webapps/drupal/sites/all/modules/mmil/mmil_subject.module
%   webapps/drupal/sites/all/modules/mmil/mmil.module
%   webapps/drupal/sites/all/modules/mmil/mmil_upload.module

% rev 276

% changed MMIL_RootDirs_from_ProjInfo to add "fibers"
%   (reconciling changes made by Vijay)

% rev 277

% change MMIL_Analyze_BOLD_Exams to accept ProjID, changed some defaults
% removed REC_MMIL_Analyze_BOLD_Exams

% changed MMIL_Args to call function for each context (using eval)
% created mmil_args_... function for each context in mmil_args
%  (e.g. mmil_Args_MMIL_Analyze_BOLD_Exams.m)

% changed REC_MMIL_Read_ProjInfo to look first for MMIL_ProjInfo.csv, then if not found,
%   look for REC_MMIL_ProjInfo.csv (temporary fix until transition away from REC
%   is complete)

% changed MMIL_Analyze_DTI_Exams and MMIL_Analyze_MRI_Exams to use VisitID
%   instead of SubjID in job names

% changed MMIL_Analyze_BOLD_Exam to call BOLD_MMIL_GLM_ROI_Analysis

% removed MMIL_Check_Container_Exists (not used, no current purpose)

% changed MMIL_Check_StudyInfo, MMIL_Get_StudyInfo, and MMIL_Check_ProjID
%    to allow 'modality' option to limit output to 'MRI', 'MEG', or 'PET'
% changed to use 'modality' option:
%    MMIL_Analysis/MMIL_Analyze_BOLD_Exams
%    BOLD_Analysis/BOLD_MMIL_Get_SurfStats
%    MMIL_Analysis/MMIL_Analyze_Long_Exams
%    MMIL_Analysis/MMIL_Analyze_MRI_Exams
%    MMIL_Analysis/MMIL_Combine_Retinotopy_Exams
%    MMIL_Analysis/MMIL_Compile_Long_Analysis
%    MMIL_Analysis/MMIL_Compile_MRI_Analysis
%    MMIL_Analysis/MMIL_Concat_SurfStats
%    MMIL_Analysis/MMIL_Get_SurfStats
%    MMIL_Analysis/MMIL_SurfGroupAvg_BOLD
%    MMIL_Analysis/MMIL_SurfGroupGLM_BOLD
%    MMIL_Longitudinal/MMIL_Long_Register_Exams
%    MMIL_Longitudinal/MMIL_Long_Setup_Exams

% changed REC_MMIL_Get_StudyInfo to use MMIL_Import_MRI_QC, etc. instead of
%   REC_MMIL_Import_MRI_QC
% removed REC_MMIL_Import_MRI_QC, REC_MMIL_Import_Meta, REC_MMIL_Import_PET_QC,
%   and REC_MMIL_Import_ViewerQC

% changed mmil_structarr_str2num; fixed bug where same variable was used
%   to index tags and infostruct; changed looping order; reduced tags
%   to intersection with fieldnames

% changed MMIL_Check_StudyInfo to use sub functions to make code more
%   readable; removed warnings for missing VisitIDs; added warnings
%   for missing containers (if required); excluded studies with missing
%   required containers, regardless of qcflag

% rev 278

% renamed mmil_util directory to mmil_utils

% rev 279

% renamed mmil_isempty2 to mmil_isempty
% removed utils/isempty2
% changed ts_checkdata to use mmil_isempty instead of isempty2
% removed utils/brainmask_fromFS_for_longitudinal_reg
% changed fs_resample_mgh to use mmil_isint instead of isint
% removed utils/isint
% changed ts_surf2movie to use mmil_padstr instead of padstr
% renamed utils/padstr to mmil_utils/mmil_padstr
% removed utils/strlen
% renamed utils/cell2num to mmil_utils/mmil_cell2num
% changed to use mmil_cell2num: ts_iEEG_eeg2epoch, ts_recode_events, and
%   ts_loadcnt
% removed utils/readtext
% changed EPDT_MMIL_SurfGroupGLM to remove call to readtext

% changed MMIL_Get_QCinfo to look first for files without "REC_" prefix,
%   then if not found, 

% changed to remove StudyDate_MRI:
%   REC_MMIL_Export_MRI_QC, REC_MMIL_Get_StudyInfo, MMIL_Check_StudyInfo,
%   MMIL_Import_MRI_QC, MMIL_Import_Meta, MMIL_Import_ViewerQC

% changed PETRAWDIR to PETRAW and PETPROCESSEDDIR to PETPROC
%   MMIL_Stream/MMIL_Import_PET_Exam
%   MMIL_Stream/MMIL_Process_Exam
%   MMIL_Utils/MMIL_Get_Container
%   MMIL_Utils/MMIL_RootDirs_from_ProjInfo
%   PETutils/ADNI_MMIL_Build_PET_hist
%   REC_Stream/REC_MMIL_Get_StudyInfo
%   REC_Stream/REC_MMIL_Process_PET_Exams
%   REC_Stream/REC_MMIL_Status_Report_PET
%   REC_Analysis/REC_MMIL_Analyze_PET_Exams
%   REC_Analysis/REC_MMIL_Summarize_CortThick_forPET
%   REC_Analysis/REC_MMIL_Summarize_PET_aparc
%   REC_Analysis/REC_MMIL_Summarize_PET_aseg
%   REC_Analysis/REC_MMIL_Summarize_Volume_forPET
%   REC_Analysis/REC_MMIL_SurfGroupAvg_CortThick_forPET
%   REC_Analysis/REC_MMIL_SurfGroupAvg_PET

% removed PETutils/test_ADNI_PET_Anal
% changed REC_MMIL_Status_Report_PET to not loop over ProjInfo
% changed REC_MMIL_SurfGroupAvg_PET to not loop over ProjInfo

% renamed MMIL_Retinotopy_GroupAvg to BOLD_MMIL_Average_Retinotopy
% changed fs_label_groupavg to save mgh files in subdir "individuals"

% added by Vijay:
%    matlab/REC_Analysis/REC_MMIL_Summarize_DTI_Analysis.m
%    matlab/mmil_utils/mmil_mgh2sparse.m
%    matlab/mmil_utils/mmil_sparse2mgh.m
%    matlab/MMIL_Analysis/MMIL_MRI_Complete_csv.m

% changed by Vijay:
%    matlab/DTI_Stream/DTI_MMIL_Set_DT_fstem.m
%    matlab/DTI_Stream/DTI_MMIL_Set_FOD_fstem.m
%    matlab/DTI_Stream/DTI_MMIL_GetValidScans.m
%    matlab/DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
%    matlab/DTI_Analysis/DTI_MMIL_Summarize_Aseg.m
%    matlab/DTI_Analysis/DTI_MMIL_Summarize_CortSurf.m
%    matlab/DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exam.m
%    matlab/DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exams.m
%    matlab/DTI_Atlas/DTI_MMIL_WarpToAtlas_Exam.m
%    matlab/DTI_Atlas/DTI_MMIL_WarpToAtlas_Exams.m

% rev 283

% changed MEG_MMIL_RCSE_GroupAvg to avoid occasional NaNs in deflection values

% changed MMIL_Analyze_MEG_Exams to use batch_append_flag and batch_msg_flag

% changed fs_recon.m to not use -no-isrunning flag if version is < 400
% change fs_recon.m to check if recon-all.log exists before checking for errors

% changed by Vijay:
%   MMPS/matlab/DTI_Stream/DTI_MMIL_AtlasTrack_Fibers_Exam.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exam.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exams.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_WarpToAtlas_Exam.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_WarpToAtlas_Exams.m

% removed by Vijay:
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Average_Atlas_Fibers.m
%   MMPS/matlab/DTI_Atlas/REC_MMIL_WarpToAtlas.m
%   MMPS/matlab/DTI_Atlas/REC_MMIL_ImportFibers.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Average_Atlas_Fiber.m

% rev 286

% removed REC_MMIL_Summarize_All_DT

% changed to accept prior_avg_flag:
%   rc_RCSE_func, rc_RCSE, MEG_MMIL_RCSE, MMIL_Analyze_MEG_Exam(s)
% changed rc_RCSE to not count contrast=0 in number of contrasts
% changed MEG_MMIL_Group_RCSE to save unique_contrasts in results
% changed rc_construct_ret_mapping to add use_areas to retmap
% changed rc_extract_prior to use avg_flag to average prior across
%   areas, contrasts, both, or neither

% changed MEG_MMIL_RCSE_GroupAvg so default peak_mindiff = 0.5

% changed MEG_MMIL_RCSE, MMIL_Analyze_MEG_Exam(s), rc_RCSE, rc_RCSE_func, and 
%   rc_RCSE_fit_waveforms to use prior_weight parameter with default = 0.5

% changed rc_plot_RCSE_GroupAvg_contrast to not display (- nA M) -- only (nA M)

% changed rc_RCSE_func so that IRLS is done after nonlinear optimization

% rev 287

% changed rc_RCSE_check_parms so reweight_flag does not disable searches

% created mmil_mkdir to create directory or die
% changed BOLD_MMIL_Average_ROIs, BOLD_MMIL_Combine_Fourier_Session,
%   BOLD_MMIL_Fourier_Analysis, BOLD_MMIL_Fourier_Analysis, BOLD_MMIL_GLM_Analysis,
%   MEG_MMIL_Group_RCSE, and MEG_MMIL_RCSE_GroupAvg to use mmil_mkdir

% changed BOLD_MMIL_Average_Retinotopy, BOLD_MMIL_Average_ROIs to use
%   GroupAvg_Polar, GroupAvg_Ecc, GroupAvg_ROI (StudyInfo fields)
% created BOLD_MMIL_GLM_ROI_GroupAvg, using GroupAvg_GLM_ROI StudyInfo field

% changed rc_ready_retfit to create scripts for view fit results with tksurfer

% changed rc_retfit and rc_retfit_func to add map_rev_polar_flag
%   and map_area_name

% changed by Vijay:
%   MMPS/matlab/mmil_utils/mmil_unix.m
%   MMPS/matlab/MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
%   MMPS/matlab/DTI_Stream/DTI_MMIL_AtlasTrack_Fibers_Exam.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Fibers.m
%   MMPS/matlab/DTI_Utils/DTI_Rotate_Tensors.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_WarpToAtlas_Exam.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_WarpToAtlas_Exams.m

% added by Vijay:
%   MMPS/matlab/DTI_Atlas/DTIAtlas_MMIL_Calc_FiberStats.m
%   MMPS/matlab/DTI_Atlas/DTIAtlas_MMIL_Calc_FiberStats.m

% changed by Mona:
%   webapps/drupal/sites/all/modules/mmil/mmil_subject.module
%   webapps/drupal/sites/all/modules/mmil/mmil_upload.module

% rev 293

% changed to accept grid_offset_smooth:
%   rc_RCSE and rc_RCSE_func,MMIL_Analyze_MEG_Exam(s) MEG_MMIL_RCSE
% changed rc_RCSE_prep_forward to use grid_offset_smooth to expand
%   number of vertices included in forward solution
%   default grid_offset_smooth = 5

% changed to accept inverse_type:
%   rc_RCSE and rc_RCSE_func,MMIL_Analyze_MEG_Exam(s) MEG_MMIL_RCSE
%   default inverse_type = 1 (identity noise covar, no source covar)
%    *uses less memory
% changed rc_RCSE_full_nbrhood_search to not set simple_inverse_flag
% changed MEG_MMIL_Group_RCSE to use switch/case instead of if/elseif/else
% changed rc_RCSE_check_parms to change inverse_type to 2 if indy_locs_flag=1
% changed rc_RCSE_fit_waveforms to use switch/case for parms.inverse_type
% changed rc_RCSE_calc_vf2ctx to not make temporary variable tmp_rowsums

% changed rc_ready_retfit, BOLD_MMIL_Ready_RetFit, and
%       MMIL_RetFit_BOLD_Exam(s) to use map_rev_polar_flag, map_area_name,
%       map_model_type

% added by Vijay:
%   MMPS/matlab/mmil_utils/mmil_save_sparse.m
%   MMPS/matlab/mmil_utils/mmil_load_sparse.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Average_AtlasFiber_Exam.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Average_AtlasFiber_Exams.m

% changed by Vijay:
%   MMPS/matlab/DTI_Stream/DTI_MMIL_AtlasTrack_Fibers_Exam.m
%   MMPS/matlab/DTI_Stream/DTI_MMIL_Set_FiberInfix.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Fibers.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exams.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_WarpToAtlas_Exam.m
%   MMPS/matlab/DTI_Atlas/DTIAtlas_MMIL_Calc_FiberStats.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_WarpToAtlas_Exams.m
%   MMPS/matlab/MMIL_Utils/MMIL_Check_RootDirs.m

% rev 296

% removed mmil_mgh2sparse, mmil_sparse2mgh
% changed mmil_load_sparse to have "volsz" instead of "sz"
% minor changes to mmil_save_sparse

% rev 297

% moved DTI_MMIL_AtlasTrack_Fibers_Exam from DTI_Stream to DTI_Atlas
% minor changes to DTI_MMIL_Average_AtlasFiber_Exam, use mmil_mkdir
% renamed DTI_MMIL_Average_AtlasFiber_Exam(s) to DTI_MMIL_Average_Atlas_Fiber(s)

% rev 298

% changed fs_3dDeconv to output iresp files for each condition

% changed DTI_track_fibers to use mmil_args2parms, made rois optional,
%   if empty, set to fname_FA (whole volume or fname_prob * fname_FA)
% removed EPDTI_Atlas

% rev 299

% changed atlases link to point to atlases.2011.04.08

% rev 300

% changed MMIL_Stamp_Container to add mfilename to WARNING statements

% changed REC_MMIL_Analyze_DTI_Exams to fix bug with extra min_val

% changed MMIL_Process_DTI to uncomment try/catch statements

% changed DTI_MMIL_Resample_Fibers to use mmil_load_sparse and mmil_save_sparse

%% changes made to spped up processing when already complete:
% created mmil_load_mgh_info to load M and volsz from mgh/mgz file
%   then save in [fstem '_info.mat'] file for future access
% changed to use mmil_load_mgh_info:
%   MMIL_Process_BOLD, MMIL_Process_DTI, and MMIL_Register_T2_to_T1
%   EPI_Resample_Data, DTI_MMIL_AtlasTrack_Fibers_Exam
% changed DTI_MMIL_Register_to_T1 and BOLD_MMIL_Register_to_T1 to have
%   slightly different message before calling MMIL_Register_T2_to_T1
% changed DTI_MMIL_AtlasTrack_Fibers_Exam to load FA and V0 only
%   if output files do not exist

% rev 302

% changed rc_ready_retfit so view scripts have different fthresh and fmid
%   for fitted data
% changed MMIL_RetFit_BOLD_Exam(s) so default smooth = 10

% rev 303

% changed rc_ready_retfit to make map_area_name written as %s, not %0d
%   changed other %0d to %d, changed %0.2f to %0.4f

% changed rc_plot_sources to include V4 in area_names and area_colors

% changed rc_RCSE_retmap_from_retfit to pass area_names to
%   rc_define_retmap_from_retfit

% rev 304

% changed rc_retfit_func to correct area_labels for rh
%   (v1- and v1+ were reversed)

% changed MMIL_Register_T2_to_T1 to initialize vol_T2 as empty

% changed by Vijay:
%   MMPS/matlab/REC_Analysis/REC_MMIL_Summarize_DTI_Analysis.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Summarize_Aseg.m

% changed by Cooper:
%   MMPS/matlab/MMIL_Analysis/MMIL_Analyze_MRI_Exams.m
%   MMPS/matlab/MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m
%   MMPS/matlab/MMIL_Analysis/MMIL_MRI_Complete_csv.m

% added by Cooper
%   MMPS/matlab/jcrpub/fileio
%   MMPS/matlab/jcrpub/fileio/readtext_jcr.m

% rev 305

% changed by Vijay:
%   MMPS/matlab/fstools/fs_multi_roi.m
%   MMPS/matlab/REC_Analysis/REC_MMIL_Summarize_DTI_Analysis.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Convert_Fibers_to_Segmentation.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Aseg_Exam.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Fibers.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Summarize_CortSurf.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_AsegMask_Fibers.m
%   MMPS/matlab/MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
%   MMPS/matlab/MMIL_Analysis/MMIL_Analyze_DTI_Exams.m

% rev 306

% changed parms/DTI_Fiber_Legend.csv to include new fibers, used short
%   abbreviations for all fibers

% removed EPDTI_Stream, EPDTI_PrePost, EPDTI_Analysis, EPMGH_Stream

% changed to standardize fiber numbers to [101:110,115:123,133:138,141:150]:
%   DTI_Atlas/DTI_MMIL_WarpToAtlas_Exams
%   DTI_Atlas/DTI_MMIL_AtlasTrack_Fibers_Exam
%   DTI_Analysis/DTI_MMIL_Summarize_Fibers
%   DTI_Analysis/DTI_MMIL_AsegMask_Fibers
%   DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam
%   DTI_Analysis/DTI_MMIL_Analyze_Fibers
%   DTI_Atlas/DTIAtlas_MMIL_Calc_FiberStats
%   DTI_Atlas/DTI_MMIL_Average_Atlas_Fibers
%   DTI_Atlas/DTI_MMIL_WarpToAtlas_Exam
%   DTI_Stream/DTI_MMIL_Resample_Fibers
%   DTI_Stream_OLD/DTI_MMIL_AtlasNorm_Fibers_Exam
%   MMIL_Analysis/MMIL_Analyze_DTI_Exams
%   MMIL_Analysis/MMIL_Analyze_DTI_Exam
%   MMIL_Longitudinal/MMIL_Long_Setup_Exam
%   MMIL_Longitudinal/MMIL_Long_Setup_Exams
%   REC_Stream/REC_MMIL_Status_Report_MRI
%   REC_Analysis/REC_MMIL_Analyze_DTI_Exams

% changed DTI_Analysis/DTI_MMIL_Convert_Fibers_to_Segmentation to use fiber
%   numbers [101:110,115:120,123,135:138,143:150]
%   excluded Fmaj (121), Fmin (122), SLF (133,134), SCS (141,142)

% changed DTI_MMIL_Average_Atlas_Fiber(s) to remove cleanup_flag
%   and cleanup code

% rev 307

#############################################################################
#############################################################################

## MMPS_222: medium revision
## Don Hagler 04/13/11

% changed MMIL_Stamp_Container to add \n to end of WARNINGs

% changed MMIL_Analyze_MEG_Exams to use try/catch around mmil_readtext
%   in case scriptlist.txt is empty

% changed MMIL_Summarize_DTI_Analysis, REC_MMIL_Summarize_DTI_Analysis,
%   and DTI_MMIL_Summarize_Fibers to add 'vol' to default measlist
%   and made corresponding scalefact = 2^3 = 8
% changed DTI_MMIL_Summarize_Aseg and DTI_MMIL_Summarize_CortSurf so
%   help shows mesalist as NOT including 'vol'

% changed by Vijay:
%   DTI_Analysis/DTI_MMIL_AsegMask_Fibers

% rev 309

% changed MMIL_Analyze_DTI_Exam to set tmp_parms.atlas_flag, etc.

% created:
%   mmil_utils/mmil_isdicomfile.m  % not used
%   mmil_tools/mmil_copy_dicoms.m
%   mmil_tools/mmil_unpack_dicoms.m
%   mmil_tools/mmil_sort_dicoms.m
% changed mmil_unix to split multi-line cmd and buffer calls to unix

% changed by Vijay:
%   mmil_utils/mmil_load_sparse.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
%   DTI_Stream/DTI_MMIL_Set_FiberInfix.m
%   DTI_Stream/DTI_MMIL_Resample_Fibers.m
%   DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
%   DTI_Analysis/DTI_MMIL_AsegMask_Fibers.m
%   DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exam.m

% rev 313

% added comments to MMIL_Classify_MRIRAWDICOM

% rev 314

% changed rc_RCSE_check_parms to give message "checking parameters..."
% changed rc_RCSE_func to check parms before checking whether results.mat exists

% changed MEG_MMIL_Group_RCSE to set parms.nareas when loading data.mat

% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to remove hard-coded
%   call to ~holland/bin/shiftX (use shiftX instead)
% copied ~holland/bin/shiftX to /usr/pubsw/packages/MMPS/MMPS_DJH/bin

% rev 315

% changed fs_3dDeconv and BOLD_MMIL_GLM_Analysis to add iresp_flag

% removed fs_recon* from csh
% removed gmat* and gcsh* from csh
% changed xmatjob and bmatjob to use -nojvm instead of -nodesktop

% created mmil_getfield to replace getfielddefault
% changed rc_define_retmap_from_retfit to use mmil_getfield
% created rc_load_retfit_results
% changed rc_RCSE to use rc_load_retfit_results
% changed rc_construct_ret_mapping to fix bug
%   retmap.cond_order instead of cond_order

% changed fs_check_stats to add parcstats2 to lists of steps to check

% created rc_calc_vf2ctx and changed rc_RCSE_calc_vf2ctx to call it
% changed rc_calc_vf2ctx and rc_define_retmap_from_retfit to threshold weights
%   with absolute value to allow negative weights

% created rc_create_retfit_labels
% changed BOLD_MMIL_GLM_ROI_Analysis to use rc_create_retfit_labels,
%   calculate response function using inverse with temporal and spatial priors
% changed rc_define_retmap_from_retfit to check isfield contrast
% changed MMIL_Analyze_BOLD_Exam to use retfit, iresp, etc. options
%   for GLM_ROI analysis

% changed parms/MMIL_FSColorLUT.txt to add new fibers, change so no duplicate
%   names (Fornix, Forceps-Major)

% changed use mmil_isint instead of isint:
%   timesurfer/functions/ts_avg_fif_data.m
%   ts_iEEG/priv/ts_iEEG_avg2fieldtrip.m
%   timesurfer/plots/visualizer.m
%   timesurfer/functions/ts_postprocess_avg.m
%   timesurfer/functions/ts_data2fieldtrip.m
%   rcse/functions/rc_construct_ret_mapping.m

% changed ts_pointreg to set parms.intransfile to parms.outtransfile if empty
%   do not set parms.intransfile to empty if not found

% changed rc_RCSE_calc_vf2ctx to correctly call rc_calc_vf2ctx instead of itself
%   and added ; to end of line

% changed by Mona:
%   webapps/drupal/sites/all/modules/mmil/mmil.module
%   webapps/drupal/sites/all/modules/mmil/mmil_upload.module

% added by Mona:
%   webapps/drupal/sites/all/modules/mmil/mmil_qc.module
%   webapps/drupal/sites/all/modules/mmil/mmil_qc.info

% changed by Cooper:
%   MMPS/matlab/MMIL_Tools/MMIL_Classify_MRIRAWDICOM.m
%   MMPS/matlab/MMIL_Tools/MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED.m
%   MMPS/matlab/jcrpub/PING/PING_anonymize.m
%   MMPS/matlab/jcrpub/PING/PING_dcmodify_byScanInfo.m
%   MMPS/matlab/jcrpub/PING/ping_unzip_anon_all.csh
%   MMPS/matlab/jcrpub/PING/PING_dir_dcmodify.m
%   MMPS/matlab/jcrpub/PING/PING_unzip_anonymize.m
%   MMPS/matlab/jcrpub/PING/ping_unzip_anon.csh

% added by Cooper:
%   MMPS/matlab/jcrpub/PING/PING_Save_Anon_Status.m
%   MMPS/matlab/jcrpub/PING/PING_unzip_exam.m
%   MMPS/matlab/jcrpub/PING/PING_Proc_ScanInfoFile.m

% removed by Cooper:
%   MMPS/matlab/jcrpub/PING/PING_Subject_unzip.m

% rev 321

% changed rc_extract_prior to fix bugs related to matching contrast levels

% created MEG_MMIL_GroupRCSE_Contrast
% changed rc_plot_RCSE_GroupAvg_contrast to skip group avg plots if
%   < 2 subjects

% changed MMI_RetFit_BOLD_Exams to use mmil_getfield instead of getfielddefault

% changed MMIL_Analyze_BOLD_Exam(s) to fix problems with GLM_ROI options

% changed BOLD_MMIL_GLM_ROI_GroupAvg to remove exneg_flag, pthresh, full_flag,
%   avg_hemi_flag, avg_uplow_flag

% changed rc_RCSE_fit_waveforms to save results.S with contrast as
%   third dimension
% removed rc_plot_areas and rc_plot_areas_over_results
% changed rc_plot_loose_areas and rc_plot_sources to expect results.S to have
%   third dim as contrast
% updated as necessary:
%  rc_RCSE_full_offset_search
%  rc_RCSE_extract_source_wforms
%  rc_RCSE_save_results
%  rc_extract_prior
%  rc_synth_sensors_from_RCSE
%  rc_calc_ref_corr
%  rc_calc_ref_absdiff
%  rc_plot_RCSE_GroupAvg_contrast
%  MEG_MMIL_RCSE_GroupAvg

% changed rc_plot_RCSE_GroupAvg_contrast and
%   BOLD_MMIL_GLM_ROI_GroupAvg to use logx_flag
% added check_input function to rc_plot_RCSE_GroupAvg_contrast

% changed fs_paint to use tempname for temporary register.dat file

% changed by Mona:
%   webapps/drupal/sites/all/modules/mmil/mmil_qc.module

% changed by Vijay or Cooper:
%   MMPS/matlab/MMIL_Analysis/MMIL_Concat_SurfStats.m
%   MMPS/matlab/MMIL_Analysis/MMIL_Summarize_MRI_Analysis.m
%   MMPS/matlab/MMIL_Analysis/MMIL_MRI_Complete_csv.m
%   MMPS/matlab/MMIL_Analysis/MMIL_Compile_MRI_Analysis.m
%   MMPS/matlab/REC_Stream/REC_MMIL_Process_Exams.m
%   MMPS/matlab/MMIL_Stream/MMIL_Process_Exams.m
%   MMPS/matlab/MMIL_Stream/MMIL_Process_DTI.m
%   MMPS/matlab/MMIL_Stream/MMIL_Process_Exam.m
%   MMPS/matlab/MMIL_Tools/MMIL_Classify_MRIRAWDICOM.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Compile_ROIs.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exam.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Calc_FiberStats.m
%   MMPS/matlab/MMIL_Utils/MMIL_Read_StudyInfo.m
%   MMPS/matlab/MMIL_Utils/MMIL_Check_StudyInfo.m
%   MMPS/matlab/MMIL_Utils/MMIL_Read_ProjInfo.m
%   MMPS/matlab/MMIL_Utils/MMIL_Check_ProjID.m
%   MMPS/matlab/MMIL_Utils/MMIL_Get_ProjInfo.m

% rev 325

% changed rc_RCSE to accept sfvec, colvec,
%   change contvec to use contrast values, not indices
% also MEG_MMIL_RCSE, MMIL_Analyze_MEG_Exam(s)
% changed rc_RCSE_check_conds to check (not assume) 
%   contrast is field of cond_info

% changed MMIL_Analyze_MEG_Exams to fix sprintf for WARNING (omitted SubjID)

% changed MEG_MMIL_GroupRCSE_Contrast to accept contrast_label and pass
%   to rc_plot_RCSE_GroupAvg_contrast
% changed rc_plot_RCSE_GroupAvg_contrast to allow normflag = 2
%   (norm to max value)

% changed MMIL_Analyze_MEG_Exams so RCSE_reweight_flag is NOT set to zero
%   if RCSE_group_prior_flag = 1

% changed rc_RCSE_calc_fit_err to remove retmap as input (not being used)
% changed rc_RCSE_fit_waveforms to not pass retmap to rc_RCSE_calc_fit_err

% changed atlases links for MMPS and MMPS_dep to be relative (../atlases)
%   added atlases link parallel to MMPS and MMPS_dep

% rev 326

% changed rc_model_wform to add optional 'wfit_func' with new type 'gamma'
% changed rc_fit_wforms and rc_fit_wform_components to use wfit_func

% changed BOLD_MMIL_Combine_Fourier_Sessions to change RETContainerPath to
%   ContainerPath; fixed bug accessing empty parameter as cell array

% renamed rc_RCSE_mstart_rand_offset_search to rc_RCSE_mstart_offset_search
%   changed rc_RCSE_func, rc_RCSE_hybrid_offset_search
% created rc_RCSE_fmincon_offset_search

% changed MMIL_Process_Exams to accept ProjID
% changed REC_MMIL_Process_Exams to be a thin shell
% created mmil_args_MMIL_Process_Exams
% changed MMIL_Process_Exam(s) to use DTI_CSD_tracto_flag and other parameters
%   for CSD tractography

% removed by Cooper:
%   MMPS/matlab/MMIL_Analysis/MMIL_MRI_Complete_csv.m

% added by Cooper:
%   MMPS/matlab/MMIL_Analysis/MMIL_Summarize_MRI_DTI_csv.m

% changed by Cooper:
%   MMPS/matlab/MMIL_Analysis/MMIL_Concat_SurfStats.m
%   MMPS/matlab/REC_Analysis/REC_MMIL_Concat_SurfStats.m

% changed by Vijay:
%   MMPS/matlab/MMIL_Utils/MMIL_Check_StudyInfo.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Average_Atlas_Fibers.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_WarpToAtlas_Exam.m
%   MMPS/matlab/DTI_Atlas/DTI_MMIL_Average_Atlas_Fiber.m

% rev 329

% changed rc_construct_ret_forward by moving some code before loop (for speed)

% changed MMIL_Read_ProjInfo to include 'DTI_CSD_seed_point_sampling' in
%   default tags to be converted to numeric from string

% changed rc_define_retmap_from_retfit to use nbrhds
% changed rc_RCSE_retmap_from_retfit to pass nbrhds
% created rc_RCSE_calc_nbrhds
% changed rc_RCSE_check_parms to call rc_RCSE_calc_nbrhds

% changed MMIL_Classify_MRIRAWDICOM to get nb0 and nbval for Siemens rorevro
%   (uncommented original code commented out by Josh)

% changed by Josh:
%   MMPS/matlab/MMIL_Tools/MMIL_Classify_MRIRAWDICOM.m
%   MMPS/matlab/MMIL_Tools/MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED.m
%   MMPS/matlab/BOLD_Stream/BOLD_MMIL_Register_to_T1.m
%   MMPS/matlab/BOLD_Stream/BOLD_MMIL_Get_ScanInfo.m
%   MMPS/matlab/EPI_Tools/EPI_UnwarpB0.m
%   MMPS/matlab/BOLD_Tools/BOLD_Correct_Data.m
%   MMPS/matlab/BOLD_Tools/BOLD_MotionCorr.m
%   MMPS/matlab/MMIL_Stream/MMIL_Process_BOLD.m

% changed by Vijay:
%   MMPS/matlab/REC_Stream/REC_MMIL_Freesurfer_Recon_Exams.m
%   MMPS/matlab/REC_Stream/REC_MMIL_Long_Register_Exams.m
%   MMPS/matlab/REC_Stream/REC_MMIL_Long_Setup_Exams.m
%   MMPS/matlab/fstools/fs_multi_roi.m
%   MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
%   MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exams.m
%   MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Register_DTI_Exam.m
%   MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Mask_T1.m
%   MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Register_Exams.m
%   MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m

% added by Vijay:
%   MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_DTI_Exams.m
%   MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_DTI_Exam.m
%   MMPS/matlab/MMIL_Analysis/MMIL_Summarize_Long_DTI_Analysis.m

% rev 333

% changed rc_RCSE_check_parms to set parms.nbrhds = []

% changed MEG_MMIL_RCSE_GroupAvg to use new defaults for waveform fitting
%   with 7 components, added 'use_components' paramater to choose which to use

% created mmil_classify_dicoms, mmil_classify_GE, mmil_classify_Siemens,
%   and mmil_classify_Philips

% rev 334

% changed MMIL_Unpack_DICOM_Dir_to_Container to use mmil_unpack_dicoms
% changed to use linkflag:
%   MMIL_PreProcess_Exam, MMIL_PreProcess_Exams, MMIL_Import_Raw_MRI,
% changed to use DCM_linkflag:
%   MMIL_Process_Exam, MMIL_Proces_Exams
% changed mmil_args_MMIL_Process_Exams to add 'DCM' arg group
% changed mmil_copy_dicoms to save SeriesDirPath
% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to use SeriesInfo as struct array
% changed MMIL_Unpack_NONDICOM_Dir_to_Container, made SeriesInfo struct array,
%   not cell array

% rev 335

% changed mmil_unix, mmil_unpack_dicoms, mmil_sort_dicoms, mmil_copy_dicoms,
%   and MMIL_Unpack_DICOM_Dir_to_Container so default batch_limit = 250
% changed mmil_sort_dicoms to fix regpat for EchoTime

% rev 336

% changed mmil_args_MEG_MMIL_RCSE_GroupAvg and mmil_args_MEG_MMIL_Group_RCSE
%   to include all relevant extra_tags

% changed mmil_args_MMIL_Process_Exams to include DTIflag and BOLDflag

% changed by Vijay:
%   MMPS/matlab/DTI_Stream/DTI_MMIL_Load_Data.m
%   MMPS/matlab/MMIL_Stream/MMIL_Process_DTI.m
%   MMPS/matlab/mmil_tools/mmil_classify_Siemens.m

% rev 339

% changed "BOLD_APE" to "BOLD_ape" in:
%   mmil_classify_GE
%   BOLD_MMIL_Get_ScanInfo
%   MMIL_Process_BOLD
%   MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED

% added BOLD_MergeAPE and BOLD_SplitAPE from Josh Kuperman's svn copy

% various changes related to ape
% (preserving functionality from Josh):
%   BOLD_MotionCorr
%   BOLD_Correct_Data
%   EPI_UnwarpB0
%   MMIL_Process_BOLD
%   MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED
%   BOLD_MergeAPE
%   BOLD_SplitAPE

% rev 340

% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to split BOLD_ape scans
%   info for and rev files
% removed BOLD_SplitAPE
% changed MMIL_Process_BOLD to not treat BOLD_ape scans differently,
%   not use apeflag
% reverted BOLD_Correct_Data, BOLD_MotionCorr, EPI_UnwarpB0
%   back to MMPS_221 version
% changed MMIL_Process_BOLD to merge for and rev for BOLD_ape scans at end
% changed BOLD_MergeAPE, way to combine files, also merge motion files
% change BOLD_MMIL_Export_Data to look for correct file name
%   for BOLD_ape scans
% changed BOLD_MMIL_Fourier_Analysis and BOLD_MMIL_GLM_Analysis to set fstem
%   for BOLD_ape scans

% rev 341

% changed BOLD_MergeAPE to have normflag, with default=1, so images
%   are the sqrt sum of squares of rev and for

% changed rc_RCSE and MEG_MMIL_RCSE to use thetavec
% changed MMIL_Analyze_MEG_Exam(s) to use RCSE_thetavec

% changed BOLD_MMIL_Set_Fourier_Stem and BOLD_MMIL_Set_GLM_Stem to
%   set name correcly for BOLD_ape

% changed BOLD_MergeAPE to output ape file so, if normflag=1 (default)
%   nf_ape = min(nf_rev,nf_for)

% rev 343

% changed rc_RCSE to set output cond_info file to start with parms.prefix

% changed MMIL_Analyze_Long_Exams, MMIL_Long_Register_Exams, and
%   MMIL_Long_Setup_Exams; removed 'long' from required_containers

% rev 344

#############################################################################
#############################################################################

## MMPS_223: medium revision
## Don Hagler 07/01/11

% changed rc_plot_RCSE_GroupAvg_contrast and MEG_MMIL_GroupRCSE_Contrast
%   to use powflag, to calculate AUC as integrated magnitude or power

% changed by Cooper:
%   MMPS/matlab/MMIL_Analysis/MMIL_Analyze_MRI_Exams.m
%   MMPS/matlab/MMIL_Analysis/MMIL_Concat_SurfStats.m
%   MMPS/matlab/MMIL_Analysis/MMIL_Summarize_MRI_DTI_csv.m
%   MMPS/matlab/MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m

% changed by Vijay:
%   MMPS/matlab/REC_Stream/REC_MMIL_Long_Register_Exams.m
%   MMPS/matlab/MMIL_Stream/MMIL_Process_Exams.m
%   MMPS/matlab/mmil_tools/mmil_classify_Siemens.m
%   MMPS/matlab/mmil_tools/mmil_classify_dicoms.m

% rev 348

% changed fs_read_annotation to use "error" instead of fprintf with ERROR

% changed rc_dSPM_RCSE to fix call to rc_synth_sensors_from_RCSE (added "rc_")
% created mmil_args_rc_RCSE
% changed MMIL_Args to allow context = 'rc_RCSE'
% created rc_synth_RCSE_noise

% changed rc_RCSE so that thetavec, eccvec, etc., do not include condiitons
%   with contrast = 0 in list of unique values

% in MEG_MMIL_GroupRCSE_Contrast and rc_plot_RCSE_GroupAvg_contrast,
%   changed default powerflag = 2

% changed rc_plot_RCSE_GroupAvg_contrast to get auc before continue if peaks
%   are missing
% changed MEG_MMIL_GroupRCSE_Contrast to make 
%   xlim = contrast_levels(end) + [-0.05,0.05] when hiC_flag = 1
% changed rc_plot_RCSE_GroupAvg_contrast to get subtract baseline auc
% changed MEG_MMIL_GroupRCSE_Contrast to accept auc_range, auc_baseline_range,
%   auc_baseline_flag, and peak_pol
% changed MEG_MMIL_GroupRCSE_Contrast to use peak_range = [50,200]
% changed MEG_MMIL_GroupRCSE_Contrast to use mmil_parms2args before calling
%   rc_plot_RCSE_GroupAvg_contrast
% changed MEG_MMIL_RCSE_GroupAvg to remove 'xlim' as input
% changed mmil_args_MEG_MMIL_RCSE_GroupAvg to remove 'xlim'

% changed ts_dSPM to accept noisenorm_identity_flag, passed to
%   ts_calc_inverse_operator_amd
% changed ts_calc_inverse_operator_amd to accept nn_ident_flag,
%   use identity matrix for C used to calculate noise normalization factors
% changed to accept dSPM_noisenorm_identity_flag:
%   MMIL_Analyze_MEG_Exam(s), MEG_MMIL_dSPM


% added/changed by Vijay, Cooper, or Mona:
A    MMPS/matlab/mmil_args/mmil_args_MMIL_Long_Setup_Exams.m
A    MMPS/matlab/mmil_args/mmil_args_MMIL_Long_Register_Exams.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Compile_Long_Analysis.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_DTI_Exams.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_Exams.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_DTI_Exam.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
U    MMPS/matlab/REC_Stream/REC_MMIL_Get_StudyInfo.m
D    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Register_DTI_Exam.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exams.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Register_Exams.m
U    MMPS/matlab/REC_Analysis/REC_MMIL_Analyze_DTI_Exams.m
U    MMPS/matlab/mmil_utils/mmil_barh.m
U    MMPS/matlab/MMIL_Tools/MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Convert_Fibers_to_Segmentation.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_AsegMask_Fibers.m
U    MMPS/matlab/jcrpub/PING/PING_dcmodify_byScanInfo.m
U    MMPS/matlab/jcrpub/PING/ping_unzip_anon_all.csh
U    MMPS/matlab/jcrpub/PING/PING_unzip_anonymize.m
U    MMPS/matlab/jcrpub/PING/PING_unzip_exam.m
U    MMPS/matlab/jcrpub/PING/ping_unzip_anon.csh
A    MMPS/matlab/jcrpub/PING/PING_Import_and_Anon_Exams.m
U    MMPS/matlab/mmil_tools/mmil_sort_dicoms.m
U    MMPS/matlab/mmil_tools/mmil_classify_GE.m
U    MMPS/matlab/mmil_tools/mmil_classify_Siemens.m
U    MMPS/matlab/mmil_tools/mmil_classify_Philips.m
U    MMPS/matlab/mmil_tools/mmil_copy_dicoms.m
U    MMPS/matlab/mmil_tools/mmil_classify_dicoms.m
U    MMPS/matlab/mmil_tools/mmil_reg.m
U    MMPS/matlab/mmil_tools/mmil_jpdfreg_T1T2.m
U    MMPS/matlab/MMIL_Utils/MMIL_Get_QCInfo.m
U    MMPS/matlab/MMIL_Utils/MMIL_Args.m
U    MMPS/matlab/MMIL_Utils/MMIL_Import_MRI_QC.m
A    MMPS/parms/QUARC
A    MMPS/parms/QUARC/inputParamsNonLinRegFine.txt
A    MMPS/parms/QUARC/inputParamsNormIntensities02ORIG.txt
A    MMPS/parms/QUARC/inputParamsNonLinRegStandard_FA.txt
A    MMPS/parms/QUARC/inputParamsNonLinRegROI.txt
A    MMPS/parms/QUARC/inputParamsNonLinRegROI01.txt
A    MMPS/parms/QUARC/inputParamsNonLinRegEstimate.txt
A    MMPS/parms/QUARC/inputParamsNonLinRegROI02.txt
A    MMPS/parms/QUARC/inputParamsScale.txt
A    MMPS/parms/QUARC/inputParamsAffine.txt
A    MMPS/parms/QUARC/inputParamsNormIntensities01.txt
A    MMPS/parms/QUARC/inputParamsNonLinRegStandard.txt
A    MMPS/parms/QUARC/inputParamsNormIntensities02.txt
A    MMPS/perl/quarcNoBias
A    MMPS/perl/quarc
A    MMPS/bin/applyLocalScaling
A    MMPS/bin/invertDisplacementField
A    MMPS/bin/applyTransforms
A    MMPS/bin/cortRoiDv
U    MMPS/bin/reg
U    MMPS/bin/roiDv
A    MMPS/bin/dvRev
A    MMPS/bin/restrictImage2Mask
A    MMPS/bin/invertAffMatrix
A    MMPS/bin/averageImage
A    MMPS/bin/segMasks
U    webapps/drupal/sites/all/modules/mmil/mmil_upload.module
U    webapps/drupal/sites/all/modules/mmil/mmil_qc.module

% rev 357

% reconciled changes to MMIL_Args

% rev 358

% moved rc_peakdet from rcse/extra to rcse_functions
% created rc_analyze_wforms
% changed MEG_MMIL_RCSE_GroupAvg to call rc_analyze_wforms,
%   do extra plotting done previously by rc_plot_RCSE_GroupAvg_contrast
% changed MEG_MMIL_GroupRCSE_Contrast to not use rc_plot_RCSE_GroupAvg_contrast
% removed rc_plot_RCSE_GroupAvg_contrast
% changed mmil_args_MEG_MMIL_Group_RCSE
% changed MEG_MMIL_Group_RCSE to call rc_analyze_wforms
% changed MEG_MMIL_RCSE_GroupAvg to not normlize latency

% changed MMIL_Check_StudyInfo to initialize fsico4, etc. fields
%   and to check containers for correct ContainerType (i.e. fsico4)
% changed ts_dSPM to check if foward_matfile is relative
% changed ts_calc_inverse_operator_amd to set diagonal values of C_nn
%   to mean(diag(C))

% changed mmil_unix to check if cmd_list is empty, in case user is running
%   R2007a, for which regexp returns empty if there is no '\n'

% changed MMIL_Process_MEG to initialize ContainerOutPath as []
% changed SetUpMMPS.csh to add dcmtk to path

% changed by Vijay or Cooper:
A    MMPS/matlab/mmil_args/mmil_args_DTI_MMIL_Average_Atlas_Fibers.m
A    MMPS/matlab/mmil_args/mmil_args_DTI_MMIL_Import_DTIStudio_Fibers_Exams.m
A    MMPS/matlab/mmil_args/mmil_args_DTI_MMIL_WarpToAtlas_Exams.m
U    MMPS/matlab/MMIL_Utils/MMIL_Args.m
U    MMPS/matlab/MMIL_Utils/MMIL_RootDirs_from_ProjInfo.m
U    MMPS/matlab/MMIL_Utils/MMIL_Check_RootDirs.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exams.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Register_Exams.m
U    MMPS/matlab/jcrpub/PING/PING_unzip_exam.m
U    MMPS/matlab/DTI_Atlas/DTI_MMIL_Average_Atlas_Fibers.m
U    MMPS/matlab/DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exams.m
U    MMPS/matlab/DTI_Atlas/DTI_MMIL_WarpToAtlas_Exams.m
U    MMPS/matlab/mmil_tools/mmil_sort_dicoms.m
U    MMPS/matlab/mmil_tools/mmil_classify_GE.m
U    MMPS/matlab/mmil_tools/mmil_copy_dicoms.m

% rev 363

% changed SetUpMMPS.csh to add dcmtk to path
% resolved conflict with MMIL_Args

% rev 364

% changed MMIL_Process_MEG_Exam to look for badchanfile in orig MEG dir
% changed MMIL_Process_MEG to look for badchanfile in proc MEG dir or copy
%   from orig location to proc MEG dir

% changed MMIL_IcoResamp_FSRecon_Exams to accept ProjID
% changed MMIL_Args to allow context = 'MMIL_IcoResamp_FSRecon_Exams'
% created mmil_args_MMIL_IcoResamp_FSRecon_Exams
% changed REC_MMIL_IcoResamp_FSRecon_Exams to be thin shell wrapper

% changed by Vijay or Cooper:
U    MMPS/matlab/MMIL_Utils/MMIL_Import_MRI_QC.m
U    MMPS/matlab/mmil_tools/mmil_classify_GE.m
U    MMPS/matlab/mmil_tools/mmil_classify_Siemens.m
U    MMPS/matlab/mmil_tools/mmil_classify_Philips.m
U    MMPS/matlab/mmil_tools/mmil_classify_dicoms.m

% rev 367

% changed SetUpFreeSurfer.csh to fix tkwma alias for v.4.x.x
%   and source environment script for v.5.x.x

% removed ts_auto_process_fif_data
% created ts_calc_fif_motion to calculate motion between fif files
% changed mmil_M2x (from Anders via Vijay) to optionally change units
%   to degrees and millimeters

% rev 368

% changed fs_read_annotation to have "~" before mmil_check_nargs

% changed SetUpMMPS.csh to remove "if" statement checking for whether running
%   on mmilcluster, set default version to 222
% removed SetUpMMPS_mc1.csh

% changed by Vijay:
A    MMPS/matlab/mmil_utils/mmil_check_oblique.m
U    MMPS/matlab/EPI_Tools/EPI_Resample_Data.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exams.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exam.m
U    MMPS/matlab/REC_Analysis/REC_MMIL_Analyze_Long_Exams.m
U    MMPS/matlab/DTI_Utils/DTI_load_qmat.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_Exams.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_Exam.m
U    MMPS/matlab/DTI_Atlas/DTI_MMIL_Average_Atlas_Fibers.m
U    MMPS/matlab/mmil_tools/mmil_classify_GE.m
U    MMPS/matlab/mmil_tools/mmil_classify_Philips.m

% rev 374

% changed qmatjobs, qmatjobs2, etc. to use multiples of 1.96G for memory
%   limits instead of 2G

% changed mmil_write_regscripts to remove T2_type variable (unused)
% changed MMIL_Register_T2_to_T1 to not pass T2_type to mmil_write_regscripts

% changed MMIL_IcoResamp_FSRecon_Exams to not reset parms.dest_typestr

% changed by Vijay:
U    MMPS/matlab/mmil_tools/mmil_classify_Siemens.m
A    MMPS/matlab/mmil_tools/mmil_qmat_siemens.m
U    MMPS/matlab/DTI_Stream/DTI_MMIL_Calc_DT.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Register_Exams.m
U    MMPS/matlab/REC_Analysis/REC_MMIL_Summarize_DTI_Analysis.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Summarize_Aseg.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Aseg_Exam.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Summarize_CortSurf.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_CortSurf_Exam.m
U    MMPS/matlab/DTI_Utils/DTI_load_qmat.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
U    MMPS/parms/DTI_Fiber_Legend.csv

% rev 385

% changed rc_analyze_wforms to allow 'xlim_wform' parameter

% changed MEG_MMIL_RCSE, MMIL_Analyze_MEG_Exam(s) so help entries for
%   contvec, sfvec, and colvec state that they should be level indices
%   not actually values (to match rc_RCSE)
% changed rc_RCSE to allow either spatfreqs or sfreqs as column in cond_info

% changed MEG_MMIL_RCSE_GroupAvg and MEG_MMIL_Group_RCSE to work with hiC_flag
% changed mmil_args_MEG_MMIL_Group_RCSE to add hiC_flag

% changed mmil_classify_Siemens to fix warning message

% changed ts_dSPM to add raw_ncov_lambda with default = 0.1

% changed by Cooper:
U    MMPS/matlab/MMIL_Analysis/MMIL_Concat_SurfStats.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Summarize_MRI_DTI_csv.m
U    MMPS/matlab/MMIL_Utils/MMIL_Import_MRI_QC.m

% rev 388

% changed fs_recon to set rocks_flag = 0 if version>=500

% rev 389

% changed EPI_Resample_Data to not pass T2_type to mmil_write_regscripts
% changed MMIL_Process_DTI so warning refers to EPI_Resample_Data, not
%   DTI_Resample_Data
% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED; added comments, removed
%   some commented code, formatting changes
% renamed mmil_qmat_siemens to mmil_qmat_Siemens
% changed mmil_classify_Siemens to use mmil_qmat_Siemens
% changed mmil_qmat_Siemens to break when ndd>=SeriesInfo.ndiffdirs
%   (this is important for scans with multiple NEX, which are split
%    into separate DTI files by MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED)
% changed mmil_classify_Siemens to set SeriesInfo.ndiffdirs to ndd
%   if they do not match (some scans count b=0 images in ndiffdirs)

% rev 391

% changed DTI_MMIL_Set_StudyInfo_SNums so that subjects will be excluded
%   if ismember(-1,snums); this allows empty values to default to all scans

% rev 392

% changed ts_dSPM, MEG_MMIL_dSPM, MMIL_Analyze_MEG_Exam(s) to have
%   default noisenorm_identity_flag = 1

% rev 393

% created DTI_set_revflag_list with code from MMIL_Process_DTI
%   changed to set revflag_list = 0, not [0,1]
%   when parms.revflag = 2 and DTI_Sequence_Type = 4 or 5 (GE)
% changed MMIL_Process_DTI and DTI_MMIL_Load_Data to use DTI_set_revflag_list
% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to use V and Vr instead of
%   V1 and V2; changed so main scan is called rev for pepolar = 3
% changed comment in DTI_MMIL_Get_ScanInfo
% changed DTI_MMIL_Get_ScanInfo to set SessInfo.revflag correctly for DTI_ipp
% created mmil_read_mdhStruct, changed mmil_classify_Siemens and
%   mmil_qmat_Siemens to use it
% changed mmil_qmat_Siemens to return bval
% changed mmil_classify_Siemens to set bval based on mmil_qmat_Siemens output
% changed mmil_sort_dicoms to add extra "echo" in cmd so that
%   if dmcdump outputs nothing (for some invalid files), it will still split
%   output correctly

% rev 394

% changed mmil_classify_Siemens and mmil_qmat_Siemens to get bval correctly
% changed mmil_sort_dicoms to not put \n after dcmdump to avoid getting
%   errcode = 1 when non-dicoms are given to dcmdump

% changed by Mona:
U    webapps/drupal/sites/all/modules/mmil/mmil.module
U    webapps/drupal/sites/all/modules/mmil/mmil_upload.module

% rev 397

% changed by Cooper to exclude Phantom scans as JUNK:
U    MMPS/matlab/mmil_tools/mmil_classify_dicoms.m

% rev 398

% changed REC_MMIL_Analyze_DTI_Exams to get DTI_revflag from ProjInfo

% changed REC_MMIL_Long_Setup_Exams and REC_MMIL_Long_Register_Exams
%   to remove calls to MMIL_Check_Usage
% changed MMIL_Long_Setup_Exams and MMIL_Long_Register_Exams
%   to add calls to MMIL_Check_Usage
% moved DTI_MMIL_Calc_FiberStats from DTI_Atlas to DTI_Analysis

% rev 399

% changed REC_MMIL_Summarize_DTI_Analysis to get DTI_revflag from
%   ProjInfo

% changed MMIL_Process_Exams to have default DTI_snums_flag = 1
% changed REC_MMIL_Summarize_DTI_Analysis and REC_MMIL_Analyze_DTI_Exams
%   to get DTI_snums_flag from ProjInfo
% changed REC_MMIL_Summarize_DTI_Analysis to use parameter names without
%   'DTI_' prefix and get parameters from ProjInfo like REC_MMIL_Analyze_DTI_Exams

#############################################################################
#############################################################################

## MMPS_224: minor revision
## Don Hagler 09/07/11

% changed MMIL_Make_BEM_Surfs to pass forceflag to mmil_makeBEMsurfs_from_aseg
% changed mmil_makeBEMsurfs_from_aseg to pass forceflag to mmil_masksurf
%   and not hard-code forceflag = 0

% changed MMIL_Import_MEG to create link if SSS was already run on fif file

% changed comments in fs_load_subj and fs_read_surf

# Important Change! for FreeSurfer recon with version >= 5.0.0
% changed fs_recon and fs_check_status to use correct sequence of steps for
%   version >= 500
% changed MMIL_Freesurfer_Recon_Exam(s) and REC_MMIL_Freesurfer_Recon_Exams
%   to accept these options:
%  'talairach_flag','nu3T_flag','labelV1_flag','surfsegedit_flag'

% changed default scalefacts in MMIL_Summarize_DTI_Analysis,
%   REC_MMIL_Summarize_DTI_Analysis, and DTI_MMIL_Summarize_Fibers
%   one too many elements (volume)

% changed by Mona:
%   webapps/drupal/sites/all/modules/mmil/mmil.module
%   webapps/drupal/sites/all/modules/mmil/mmil_upload.module

% rev 403

% changed REC_MMIL_Summarize_DTI_Analysis to give error if
%  length(scalefacts) ~= length(measlist) if length(scalefacts)>1

% rev 404

% changed DTI_MMIL_Summarize_CortSurf to use this for column headers:
%   fprintf(fid,',"DT_%s_%s_csurf"',meas,lh_aparc_roi_data(k).roiname);

% rev 405

% changed reg_vol2hatl_rb_mmil so
%   sf_opt will be initialized with a value of 1

# Important Change! for Siemens structural scans
#   requires reprocessing and FS recon for anything processed with
#   MMPS 220 - 223
% changd MMIL_Register_and_Resample_MRI_Volumes so default unwarpflag = -1

% changed mmil_makeBEMsurfs_fromT1 to use mmil_unix instead of unix

% changed DTI_Fiber_Legend.csv to have ColorDescription column header,
%   changed "RGB Code" to "ColorRGB"

% changed DTI_MMIL_Analyze_Aseg_Exam and DTI_MMIL_Analyze_Fibers_Exam
%   so default b0_asegnorm_roilist = [4,43]
%   to only include lateral ventricles (exclude inf. lateral ventricles)

% changed MMIL_Convert_MRIRAWNONDICOM_to_MRIPROCESSED to use () for SeriesInfo
%   instead of {}; also corrected problem with checking wrong series dir

% rev 407

% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to only set splitflag=1
%   if ~rorevro_flag

% changed mmil_classify_Siemens to set pepolar = 3 for rorevro
% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to not set pepolar = 3
%   for rorevro



% changed by Cooper:
U    MMPS/matlab/MMIL_Tools/MMIL_Classify_MRIRAWDICOM.m
U    MMPS/matlab/REC_Stream/REC_MMIL_Classify_Exams.m
U    MMPS/matlab/MMIL_Stream/MMIL_PreProcess_Exams.m
U    MMPS/matlab/MMIL_Stream/MMIL_PreProcess_Exam.m
U    MMPS/matlab/REC_Analysis/REC_MMIL_Summarize_DTI_Analysis.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Summarize_MRI_DTI_csv.m
U    MMPS/matlab/ProjectsMods/reg_vol2hatl_rb_mmil.m


% rev 409

% changed reg_vol2hatl_rb_mmil to reconcile redundant changes
% changed MMIL_Classify_MRIRAWDICOM to change help
% changed MMIL_Process_Exam to accept DCM_Reject_Series
%   and pass to MMIL_Process_Raw_MRI
% changed MMIL_Process_Raw_MRI to accept RejectSeries
%   and pass to MMIL_Classify_MRIRAWDICOM
% changed MMIL_Check_StudyInfo to add DCM_RejectSeries to default_numvec_tags
%   and standard_tags
% changed MMIL_Process_Exams to get DCM_RejectSeries from StudyInfo
%   and pass to MMIL_Process_Exam
% created MMIL_Classify_Exams, made REC_MMIL_Classify_Exams a thin shell
%   use DCM_RejectSeries from StudyInfo
% changed MMIL_PreProcess_Exam to accept RejectSeries
%   and pass to MMIL_Classify_MRIRAWDICOM
% changed MMIL_PreProcess_Exams to accept ProjID, get DCM_RejectSeries
% created REC_MMIL_PreProcess_Exams as thin shell

# Important Change! requires rerunning dicom unpacking
% changed mmil_copy_dicoms so subdirectories in raw containers
%   are named differently 'study%d_series%04d'
% changed mmil_classify_dicoms to sort SeriesInfo chronologically
% changed MMIL_Classify_MRIRAWDICOM to not sort SeriesInfo, and not
%   save SortedSeriesList in ContainerInfo
% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED,
%   MMIL_Convert_MRIRAWNONDICOM_to_MRIPROCESSED, and
%   MMIL_Unpack_NONDICOM_Dir_to_Container to not use SortedSeriesList

% changed DTI_MMIL_Calc_DT to get ScanInfo using DTI_MMIL_Get_ScanInfo
%   if parms.nob0_flag

% changed ContainerInfo.scaninfo to ContainerInfo.ScanInfo:
%  BOLD_Stream/BOLD_MMIL_Get_ScanInfo
%  DTI_Stream/DTI_MMIL_GetValidScans
%  DTI_Stream/DTI_MMIL_Get_ScanInfo
%  DTI_Stream_OLD/DTI_MMIL_Export_DTIstudio
%  MMIL_Stream/MMIL_Freesurfer_Recon_Exam
%  MMIL_Stream/MMIL_IcoResamp_FSRecon_Exam
%  MMIL_Tools/MMIL_Apply_MRI_Corrections
%  MMIL_Tools/MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED
%  MMIL_Tools/MMIL_Convert_MRIRAWNONDICOM_to_MRIPROCESSED
%  MMIL_Tools/MMIL_Get_Gradwarp_Signature
%  MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes

% changed MMIL_Register_and_Resample_MRI_Volumes to use mmil_getfield
%   instead of getfielddefault

% changed to not use scaninfo:
%  DTI_Stream_OLD/DTI_MMIL_Calc_FOD_and_Resample
%  MMIL_Tools/MMIL_Transform_to_Head_Atlas

% changed to include SeriesIndex in ScanInfo:
%  MMIL_Tools/MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED
%  MMIL_Tools/MMIL_Convert_MRIRAWNONDICOM_to_MRIPROCESSED

% changed to write ScanInfo.csv with SeriesIndex:
%  MMIL_Tools/MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED
%  MMIL_Tools/MMIL_Convert_MRIRAWNONDICOM_to_MRIPROCESSED

% changed MMIL_Args to add MMIL_PreProcess_Exams and MMIL_Classify_Exams
% created mmil_args_MMIL_PreProcess_Exams and mmil_args_MMIL_Classify_Exams

% rev 410

#############################################################################
#############################################################################

## MMPS_225: minor revision
## Don Hagler 09/27/11

% changed by Jason Sherfey:

D    external/matlab/fieldtrip-20080624_private/preproc.m
A    external/matlab/NTools
A    external/matlab/NTools/nview
A    external/matlab/NTools/nview/Main.m
A    external/matlab/NTools/nview/hw_defn_nyusom.m
A    external/matlab/NTools/nview/Spectral.fig
A    external/matlab/NTools/nview/nview.m
A    external/matlab/NTools/nview/nview_notchfilter.m
A    external/matlab/NTools/nview/spectrumscope.m
A    external/matlab/NTools/nview/Main.fig
A    external/matlab/NTools/nview/nview_configure_channels_256.m
A    external/matlab/NTools/nview/analyze.m
A    external/matlab/NTools/nview/nview_configure_channels_nyucns.m
A    external/matlab/NTools/nview/exp_defn_jonathan_test.m
A    external/matlab/NTools/nview/hw_defn_nyucns.m
A    external/matlab/NTools/nview/exp_defn_adam.m
A    external/matlab/NTools/nview/init_exp_defn.m
A    external/matlab/NTools/nview/launch-nview.sh
A    external/matlab/NTools/nview/launch-timecode.sh
A    external/matlab/NTools/nview/timecodes
A    external/matlab/NTools/nview/timecodes/demodulate_timecode.m
A    external/matlab/NTools/nview/timecodes/gen_timecode.m
A    external/matlab/NTools/nview/timecodes/modulate_timecode.m
A    external/matlab/NTools/nview/exp_defn_template.m
A    external/matlab/NTools/nstream
A    external/matlab/NTools/nstream/doc
A    external/matlab/NTools/nstream/doc/INSTALLATION.txt
A    external/matlab/NTools/nstream/doc/ADDING_COMPILE_FILE.txt
A    external/matlab/NTools/nstream/lib
A    external/matlab/NTools/nstream/lib/libnstreamclient
A    external/matlab/NTools/nstream/lib/libnstreamclient/nstreamclient.c
A    external/matlab/NTools/nstream/lib/libnstreamclient/CMakeLists.txt
A    external/matlab/NTools/nstream/lib/libnstreamclient/nstreamclient.h
A    external/matlab/NTools/nstream/lib/libnspike
A    external/matlab/NTools/nstream/lib/libnspike/ringbuffer.h
A    external/matlab/NTools/nstream/lib/libnspike/nspike.h
A    external/matlab/NTools/nstream/lib/libnspike/daqengine.cc
A    external/matlab/NTools/nstream/lib/libnspike/daqengine.h
A    external/matlab/NTools/nstream/lib/libnspike/udpsocket.cc
A    external/matlab/NTools/nstream/lib/libnspike/masterdsp.cc
A    external/matlab/NTools/nstream/lib/libnspike/udpsocket.h
A    external/matlab/NTools/nstream/lib/libnspike/auxdsp.cc
A    external/matlab/NTools/nstream/lib/libnspike/masterdsp.h
A    external/matlab/NTools/nstream/lib/libnspike/auxdsp.h
A    external/matlab/NTools/nstream/lib/libnspike/channel.cc
A    external/matlab/NTools/nstream/lib/libnspike/channel.h
A    external/matlab/NTools/nstream/lib/libnspike/ext
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/mkinstalldirs
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/configure
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/include
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/include/cfulist.h
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/include/cfuthread_queue.h
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/include/cfutime.h
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/include/cfu.h
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/include/cfuopt.h
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/include/cfuhash.h
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/include/cfu.h.in
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/include/cfutypes.h
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/include/cfuconf.h
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/include/cfustring.h
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/include/cfutypes.h.in
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/AUTHORS
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/config.log
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/src
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/src/cfuopt.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/src/cfuhash.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/src/cfuconf.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/src/TODO
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/src/cfustring.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/src/libcfu-config.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/src/cfulist.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/src/cfuthread_queue.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/src/dummy.cpp
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/src/CMakeLists.txt
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/src/cfutime.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/src/cfu.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/ChangeLog
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/config.status
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/depcomp
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/README
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/AdditionalInfo.txt
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/configure.ac
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/autom4te.cache
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/autom4te.cache/output.1
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/autom4te.cache/traces.0
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/autom4te.cache/traces.1
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/autom4te.cache/requests
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/autom4te.cache/output.0
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/doc
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/doc/mdate-sh
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/doc/texinfo.tex
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/doc/libcfu.texi
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/doc/CMakeLists.txt
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/INSTALL
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/acinclude.m4
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/COPYING
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/missing
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/NEWS
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/aclocal.m4
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/CMakeLists.txt
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples/conf_example
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples/conf_example.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples/conf_example2
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples/conf_example2.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples/hash_usage
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples/hash_usage.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples/strings
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples/strings.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples/dummy.cpp
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples/CMakeLists.txt
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples/large_hash
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples/opt_example
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples/large_hash.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/examples/opt_example.c
A    external/matlab/NTools/nstream/lib/libnspike/ext/libcfu-0.03/install-sh
A    external/matlab/NTools/nstream/lib/libnspike/ext/CMakeLists.txt
A    external/matlab/NTools/nstream/lib/libnspike/netkeepalive.cc
A    external/matlab/NTools/nstream/lib/libnspike/hw_defines.h
A    external/matlab/NTools/nstream/lib/libnspike/netkeepalive.h
A    external/matlab/NTools/nstream/lib/libnspike/tests
A    external/matlab/NTools/nstream/lib/libnspike/tests/check_masterdsp.c
A    external/matlab/NTools/nstream/lib/libnspike/tests/check_auxdsp.c
A    external/matlab/NTools/nstream/lib/libnspike/tests/suites.h
A    external/matlab/NTools/nstream/lib/libnspike/tests/check_channel.c
A    external/matlab/NTools/nstream/lib/libnspike/tests/fakehw.c
A    external/matlab/NTools/nstream/lib/libnspike/tests/check_nspike.c
A    external/matlab/NTools/nstream/lib/libnspike/tests/check_ringbuffer.c
A    external/matlab/NTools/nstream/lib/libnspike/tests/check_daqengine.c
A    external/matlab/NTools/nstream/lib/libnspike/tests/testmacros.h
A    external/matlab/NTools/nstream/lib/libnspike/tests/fakehw.h
A    external/matlab/NTools/nstream/lib/libnspike/tests/CMakeLists.txt
A    external/matlab/NTools/nstream/lib/libnspike/tests/check_libnspike.c
A    external/matlab/NTools/nstream/lib/libnspike/libnspike.h
A    external/matlab/NTools/nstream/lib/libnspike/dsp.cc
A    external/matlab/NTools/nstream/lib/libnspike/dsp.h
A    external/matlab/NTools/nstream/lib/libnspike/CMakeLists.txt
A    external/matlab/NTools/nstream/lib/libnspike/nspike.cc
A    external/matlab/NTools/nstream/lib/libnspike/ringbuffer.cc
A    external/matlab/NTools/nstream/lib/libutil
A    external/matlab/NTools/nstream/lib/libutil/exception.cc
A    external/matlab/NTools/nstream/lib/libutil/exception.h
A    external/matlab/NTools/nstream/lib/libutil/CMakeLists.txt
A    external/matlab/NTools/nstream/lib/CMakeLists.txt
A    external/matlab/NTools/nstream/editall.sh
A    external/matlab/NTools/nstream/src
A    external/matlab/NTools/nstream/src/nstream.h
A    external/matlab/NTools/nstream/src/dataglovedaq.cc
A    external/matlab/NTools/nstream/src/start_nstream.m
A    external/matlab/NTools/nstream/src/dataglovedaq.h
A    external/matlab/NTools/nstream/src/dataout_test8.m
A    external/matlab/NTools/nstream/src/fglove.h
A    external/matlab/NTools/nstream/src/mex
A    external/matlab/NTools/nstream/src/mex/nstream_gettime_nspike.c
A    external/matlab/NTools/nstream/src/mex/nstream_getraw_nspike_16.c
A    external/matlab/NTools/nstream/src/mex/nstream_add_masterdsp.c
A    external/matlab/NTools/nstream/src/mex/nstream_get_dataglove_ts.c
A    external/matlab/NTools/nstream/src/mex/nstream_enable_dataglove.c
A    external/matlab/NTools/nstream/src/mex/nstream_getmu_nspike_4.c
A    external/matlab/NTools/nstream/src/mex/nstream_gettime_comedi.c
A    external/matlab/NTools/nstream/src/mex/nstream_getrawint_comedi_decimate.c
A    external/matlab/NTools/nstream/src/mex/nstream_getdio_ts.c
A    external/matlab/NTools/nstream/src/mex/nstream_set_filters.c
A    external/matlab/NTools/nstream/src/mex/nstream_stop_record.c
A    external/matlab/NTools/nstream/src/mex/nstream_getraw_nspike_4.c
A    external/matlab/NTools/nstream/src/mex/nstream_getmuint_nspike_4.c
A    external/matlab/NTools/nstream/src/mex/nstream_getraw_nspike_all.c
A    external/matlab/NTools/nstream/src/mex/nstream_start_record.c
A    external/matlab/NTools/nstream/src/mex/nstream_getrawint_nspike_4.c
A    external/matlab/NTools/nstream/src/mex/nstream_getraw_comedi_all.c
A    external/matlab/NTools/nstream/src/mex/nstream_getraw_nspike.c
A    external/matlab/NTools/nstream/src/mex/CMakeLists.txt
A    external/matlab/NTools/nstream/src/mex/nstream_getraw_comedi_decimate.c
A    external/matlab/NTools/nstream/src/mex/nstream_get_dataglove.c
A    external/matlab/NTools/nstream/src/mex/nstream_start_acquire.c
A    external/matlab/NTools/nstream/src/mex/nstream_getrawint_nspike_decimate.c
A    external/matlab/NTools/nstream/src/mex/nstream_getraw_comedi.c
A    external/matlab/NTools/nstream/src/mex/nstream_exit.c
A    external/matlab/NTools/nstream/src/mex/nstream_getmuint_nspike_16.c
A    external/matlab/NTools/nstream/src/mex/nstream_getdio.c
A    external/matlab/NTools/nstream/src/mex/nstream_add_auxdsp.c
A    external/matlab/NTools/nstream/src/mex/nstream_getrawint_nspike.c
A    external/matlab/NTools/nstream/src/mex/nstream_set_verbose.c
A    external/matlab/NTools/nstream/src/mex/nstream_getjoy_comedi.c
A    external/matlab/NTools/nstream/src/mex/nstream_set_channel.c
A    external/matlab/NTools/nstream/src/mex/nstream_getrawint_nspike_16.c
A    external/matlab/NTools/nstream/src/mex/nstream_getrawint_comedi.c
A    external/matlab/NTools/nstream/src/mex/nstream_set_dac_channel.c
A    external/matlab/NTools/nstream/src/mex/nstream_getraw_nspike_decimate.c
A    external/matlab/NTools/nstream/src/mex/nstream_getmu_nspike_16.c
A    external/matlab/NTools/nstream/src/mex/nstream_set_dac_gain.c
A    external/matlab/NTools/nstream/src/dataout_test.m
A    external/matlab/NTools/nstream/src/CMakeLists.txt
A    external/matlab/NTools/nstream/src/nstream.cc
A    external/matlab/NTools/nstream/src/start_nstream_y4.m
A    external/matlab/NTools/nstream/modules
A    external/matlab/NTools/nstream/modules/analogstate
A    external/matlab/NTools/nstream/modules/analogstate/module_analogstate.c
A    external/matlab/NTools/nstream/modules/analogstate/mex
A    external/matlab/NTools/nstream/modules/analogstate/mex/cmake
A    external/matlab/NTools/nstream/modules/analogstate/mex/cmake/FindMatlab.cmake
A    external/matlab/NTools/nstream/modules/analogstate/mex/nstream_get_digital_state.c
A    external/matlab/NTools/nstream/modules/analogstate/mex/nstream_get_analog_state.c
A    external/matlab/NTools/nstream/modules/analogstate/mex/CMakeLists.txt
A    external/matlab/NTools/nstream/modules/analogstate/CMakeLists.txt
A    external/matlab/NTools/nstream/modules/spikeextract
A    external/matlab/NTools/nstream/modules/spikeextract/mex
A    external/matlab/NTools/nstream/modules/spikeextract/mex/get_spike_dataint.c
A    external/matlab/NTools/nstream/modules/spikeextract/mex/set_spike_posthresh.m
A    external/matlab/NTools/nstream/modules/spikeextract/mex/set_spike_refractory.m
A    external/matlab/NTools/nstream/modules/spikeextract/mex/get_spike_data.c
A    external/matlab/NTools/nstream/modules/spikeextract/mex/set_spike_posthresh.c
A    external/matlab/NTools/nstream/modules/spikeextract/mex/set_spike_refractory.c
A    external/matlab/NTools/nstream/modules/spikeextract/mex/set_spike_negthresh.m
A    external/matlab/NTools/nstream/modules/spikeextract/mex/CMakeLists.txt
A    external/matlab/NTools/nstream/modules/spikeextract/mex/set_spike_negthresh.c
A    external/matlab/NTools/nstream/modules/spikeextract/module_spikeextract.c
A    external/matlab/NTools/nstream/modules/spikeextract/CMakeLists.txt
A    external/matlab/NTools/nstream/modules/CMakeLists.txt
A    external/matlab/NTools/nstream/misc
A    external/matlab/NTools/nstream/misc/matlab
A    external/matlab/NTools/nstream/misc/matlab/test5.m
A    external/matlab/NTools/nstream/misc/matlab/cap5m.m
A    external/matlab/NTools/nstream/misc/matlab/cap5.m
A    external/matlab/NTools/nstream/misc/matlab/generate_load.m
A    external/matlab/NTools/nstream/misc/matlab/scope.m
A    external/matlab/NTools/nstream/misc/matlab/cap45.m
A    external/matlab/NTools/nstream/misc/matlab/compare_ts.m
A    external/matlab/NTools/nstream/misc/matlab/test.m
A    external/matlab/NTools/nstream/misc/matlab/capinf.m
A    external/matlab/NTools/nstream/misc/matlab/test2.m
A    external/matlab/NTools/nstream/misc/matlab/test3.m
A    external/matlab/NTools/nstream/misc/matlab/test4.m
A    external/matlab/NTools/nstream/misc/mex
A    external/matlab/NTools/nstream/misc/mex/closeserial.m
A    external/matlab/NTools/nstream/misc/mex/openserial.c
A    external/matlab/NTools/nstream/misc/mex/closeserial.c
A    external/matlab/NTools/nstream/misc/mex/setparallel.c
A    external/matlab/NTools/nstream/misc/mex/writeserial.c
A    external/matlab/NTools/nstream/misc/mex/openserial.m
A    external/matlab/NTools/nstream/misc/mex/readserial.c
A    external/matlab/NTools/nstream/misc/mex/CMakeLists.txt
A    external/matlab/NTools/nstream/misc/preproc
A    external/matlab/NTools/nstream/misc/preproc/nspike_preproc.c
A    external/matlab/NTools/nstream/misc/preproc/nspike_preproc_4.c
A    external/matlab/NTools/nstream/misc/preproc/nspike_preproc_16.c
A    external/matlab/NTools/nstream/misc/preproc/comedi_preproc.c
A    external/matlab/NTools/nstream/misc/preproc/CMakeLists.txt
A    external/matlab/NTools/nstream/misc/preproc/myshare.h
A    external/matlab/NTools/nstream/misc/preproc/nspike_preproc_128.c
A    external/matlab/NTools/nstream/misc/CMakeLists.txt
A    external/matlab/NTools/nstream/CMakeLists.txt
A    external/matlab/NTools/ntools
A    external/matlab/NTools/ntools/load
A    external/matlab/NTools/ntools/load/ntools_audio_load_int.m
A    external/matlab/NTools/ntools/load/ntools_get_channels.m
A    external/matlab/NTools/ntools/load/ntools_get_sample_size.m
A    external/matlab/NTools/ntools/load/ntools_clean_load_int.m
A    external/matlab/NTools/ntools/load/ntools_decieeg_load_int.m
A    external/matlab/NTools/ntools/load/ntools_cleandecieeg_load_int.m
A    external/matlab/NTools/ntools/load/ntools_ieeg_load_int.m
A    external/matlab/NTools/ntools/load/ntools_nspike_load_int.m
A    external/matlab/NTools/ntools/load/ntools_load_samples.m
A    external/matlab/NTools/ntools/tests
A    external/matlab/NTools/ntools/tests/@test_nspike_to_ieeg
A    external/matlab/NTools/ntools/tests/@test_nspike_to_ieeg/set_up.m
A    external/matlab/NTools/ntools/tests/@test_nspike_to_ieeg/test_convert.m
A    external/matlab/NTools/ntools/tests/@test_nspike_to_ieeg/tear_down.m
A    external/matlab/NTools/ntools/tests/@test_nspike_to_ieeg/test_nspike_to_ieeg.m
A    external/matlab/NTools/ntools/tests/@test_ieeg_to_epoch
A    external/matlab/NTools/ntools/tests/@test_ieeg_to_epoch/test_data_corr_w_original.m
A    external/matlab/NTools/ntools/tests/@test_ieeg_to_epoch/test_ieeg_to_epoch.m
A    external/matlab/NTools/ntools/tests/@test_ieeg_to_epoch/test_epoch.m
A    external/matlab/NTools/ntools/tests/@test_ieeg_to_epoch/set_up.m
A    external/matlab/NTools/ntools/tests/@test_ieeg_to_epoch/tear_down.m
A    external/matlab/NTools/ntools/tests/run_all_tests.m
A    external/matlab/NTools/ntools/proc
A    external/matlab/NTools/ntools/proc/NTools_Process.fig
A    external/matlab/NTools/ntools/proc/ntools_procDecimateIEEG.m
A    external/matlab/NTools/ntools/proc/ntools_procGenerateNicoletSync.m
A    external/matlab/NTools/ntools/proc/ntools_procIEEG.m
A    external/matlab/NTools/ntools/proc/ntools_proc_decimate.m
A    external/matlab/NTools/ntools/proc/mex
A    external/matlab/NTools/ntools/proc/mex/ntools_decimate
A    external/matlab/NTools/ntools/proc/mex/ntools_decimate.c
A    external/matlab/NTools/ntools/proc/ntools_procCleanIEEG.m
A    external/matlab/NTools/ntools/proc/ntools_procDay.m
A    external/matlab/NTools/ntools/proc/ntools_procExtractComediAudio.m
A    external/matlab/NTools/ntools/proc/ntools_proc_convert.m
A    external/matlab/NTools/ntools/proc/ntools_procWavVideoSync.m
A    external/matlab/NTools/ntools/proc/ntools_procComediVideoSync.m
A    external/matlab/NTools/ntools/proc/ntools_procCleanDecIEEG.m
A    external/matlab/NTools/ntools/proc/NTools_Process.m
A    external/matlab/NTools/ntools/proc/private
A    external/matlab/NTools/ntools/proc/private/strip_double_suffix.m
A    external/matlab/NTools/ntools/proc/private/make_filename_root.m
A    external/matlab/NTools/ntools/proc/ntools_procNicoletExport.m
A    external/matlab/NTools/ntools/conv
A    external/matlab/NTools/ntools/conv/edfconvert
A    external/matlab/NTools/ntools/conv/edfconvert/hdrxml.c
A    external/matlab/NTools/ntools/conv/edfconvert/edf_spec.pdf
A    external/matlab/NTools/ntools/conv/edfconvert/edfconvert.c
A    external/matlab/NTools/ntools/conv/edfconvert/hdrxml.h
A    external/matlab/NTools/ntools/conv/edfconvert/edfconvert.h
A    external/matlab/NTools/ntools/conv/edfconvert/Makefile
A    external/matlab/NTools/ntools/conv/edfconvert/README
A    external/matlab/NTools/ntools/conv/ntools_epoch2edf.m
A    external/matlab/NTools/ntools/elec
A    external/matlab/NTools/ntools/elec/ntools_elec_savetxt.m
A    external/matlab/NTools/ntools/elec/ntools_elec_locpos.m
A    external/matlab/NTools/ntools/elec/ntools_elec_cal.m
A    external/matlab/NTools/ntools/elec/ntools_elec_dartel_warp.m
A    external/matlab/NTools/ntools/elec/ntools_elec_223.m
A    external/matlab/NTools/ntools/elec/ntools_elec_calc_grid.m
A    external/matlab/NTools/ntools/elec/ntools_elec_outer_brain.m
A    external/matlab/NTools/ntools/elec/ntools_elec_mgh_plot.m
A    external/matlab/NTools/ntools/elec/ntools_elec_view.m
A    external/matlab/NTools/ntools/elec/ntools_elec_projection.m
A    external/matlab/NTools/ntools/elec/ntools_elec_plot.m
A    external/matlab/NTools/ntools/elec/ntools_elec_grid.m
A    external/matlab/NTools/ntools/elec/ntools_elec_calc_depth.m
A    external/matlab/NTools/ntools/elec/tripatch.m
A    external/matlab/NTools/ntools/elec/ntools_elec_make_tri_file.m
A    external/matlab/NTools/ntools/elec/dartel
A    external/matlab/NTools/ntools/elec/dartel/dartel_warp.m
A    external/matlab/NTools/ntools/elec/dartel/dartel_warp_job.m
A    external/matlab/NTools/ntools/elec/ch2_mni_corrected_lh.mat
A    external/matlab/NTools/ntools/elec/immatch.m
A    external/matlab/NTools/ntools/elec/ntools_elec_bemproj.m
A    external/matlab/NTools/ntools/elec/ch2_mni_corrected_rh.mat
A    external/matlab/NTools/ntools/elec/fastmarch_mex.mexa64
A    external/matlab/NTools/ntools/elec/ntools_elec_position.m
A    external/matlab/NTools/ntools/elec/ntools_elec_interp_grid.m
A    external/matlab/NTools/ntools/elec/ntools_elec_get_elec_name.m
A    external/matlab/NTools/ntools/elec/ntools_elec_read_struct_data.m
A    external/matlab/NTools/ntools/elec/ntools_elec_xyz2mni.m
A    external/matlab/NTools/ntools/elec/fastmarch.m
A    external/matlab/NTools/ntools/elec/ntools_elec_locgui.m
A    external/matlab/NTools/ntools/elec/ntools_elec_calc_strip.m
A    external/matlab/NTools/ntools/elec/ntools_elec_savebin.m
A    external/matlab/NTools/ntools/elec/ntools_elec_convert_format.m
A    external/matlab/NTools/ntools/elec/ntools_elec_autocoreg.m
A    external/matlab/NTools/ntools/gen
A    external/matlab/NTools/ntools/gen/ntools_gen_add_coords.m
A    external/matlab/NTools/ntools/gen/ntools_gen_ft_data.m
A    external/matlab/NTools/ntools/gen/ntools_gen_recording_data.m
A    external/matlab/NTools/ntools/gen/ntools_gen_epoch_data.m
A    external/matlab/NTools/ntools/gen/ntools_gen_cont_data.m
A    external/matlab/NTools/ntools/dio
A    external/matlab/NTools/ntools/dio/ntools_dio_downsample.m
A    external/matlab/NTools/ntools/dio/ntools_dio_parse.m
A    external/matlab/NTools/ntools/dio/ntools_dio_view.m
A    external/matlab/NTools/ntools/misc
A    external/matlab/NTools/ntools/misc/ftest.m
A    external/matlab/NTools/ntools/misc/implode.m
A    external/matlab/NTools/ntools/misc/linefilter.m
A    external/matlab/NTools/ntools/misc/strip_path_dirs.m
A    external/matlab/NTools/ntools/misc/dpsschk.m
A    external/matlab/NTools/ntools/misc/escapeForShell.m
A    external/matlab/NTools/ntools/misc/mtfilt.m
A    external/matlab/NTools/ntools/misc/explode.m
A    external/matlab/NTools/ntools/misc/filenames.m
A    external/matlab/NTools/ntools/misc/ntools_subtract_reference.m
A    external/matlab/NTools/ntools/misc/erase_and_display.m
A    external/matlab/NTools/ntools/misc/strrep_recurse.m
A    external/matlab/NTools/ntools/misc/strip_svn_dirs.m
A    external/matlab/NTools/ntools/misc/file_size.m
A    external/matlab/NTools/ntools/misc/isfile.m
A    external/matlab/NTools/ntools/misc/lpfilter.m
A    external/matlab/NTools/ntools/misc/parse_8_bits.m
A    external/matlab/NTools/ntools/misc/sq.m
A    external/matlab/NTools/ntools/trial
A    external/matlab/NTools/ntools/hdr
A    external/matlab/NTools/ntools/hdr/ntools_hdrxml_write.m
A    external/matlab/NTools/ntools/hdr/ntools_hdrxml_read.m
A    external/matlab/NTools/ntools/hdr/private
A    external/matlab/NTools/ntools/hdr/private/get_hdr_name.m
U    MMPS/matlab/ts_iEEG/priv/ts_iEEG_makefigs.m
U    MMPS/matlab/ts_iEEG/priv/ts_iEEG_neuroscan2avg.m
U    MMPS/matlab/timesurfer/plots/ts_ezmultiplot.m
A    MMPS/matlab/timesurfer/plots/btq_confplot_3andC.m
A    MMPS/matlab/timesurfer/plots/topo.m
U    MMPS/matlab/timesurfer/plots/ts_ezplot.m
A    MMPS/matlab/timesurfer/plots/ts_plotcontrasts.m
A    MMPS/matlab/timesurfer/plots/btq_panels.m
U    MMPS/matlab/timesurfer/plots/visualizer.m
A    MMPS/matlab/timesurfer/plots/ts_syncview.m
U    MMPS/matlab/timesurfer/plots/ts_syncplot.m
A    MMPS/matlab/timesurfer/functions/ts_calc_ncov.m
A    MMPS/matlab/timesurfer/functions/ts_tf_dSPM.m
A    MMPS/matlab/timesurfer/functions/ts_process_data.m
A    MMPS/matlab/timesurfer/functions/extract_triggers.m
U    MMPS/matlab/timesurfer/functions/ts_matrix2epoch.m
A    MMPS/matlab/timesurfer/functions/ts_load_data.m
U    MMPS/matlab/timesurfer/functions/ts_visual_reject.m
U    MMPS/matlab/timesurfer/functions/ts_loadedf.m
A    MMPS/matlab/timesurfer/functions/ts_load_timefreq_data.m
A    MMPS/matlab/timesurfer/functions/ts_plv_statistics.m
U    MMPS/matlab/timesurfer/functions/ts_calc_combine_conditions.m
U    MMPS/matlab/timesurfer/functions/ts_import_events.m
U    MMPS/matlab/timesurfer/functions/ts_combine_data.m
U    MMPS/matlab/timesurfer/functions/ts_preproc.m
A    MMPS/matlab/timesurfer/functions/ts_sync.m
A    MMPS/matlab/timesurfer/functions/ts_BetweenSensorAngles.m
U    MMPS/matlab/timesurfer/functions/ts_trials2avg.m
U    MMPS/matlab/timesurfer/functions/ts_statistics_wrapper.m
U    MMPS/matlab/timesurfer/functions/ts_fieldtrip2data.m
U    MMPS/matlab/timesurfer/functions/ts_freqanalysis.m
U    MMPS/matlab/timesurfer/functions/ts_data_selection.m
A    MMPS/matlab/timesurfer/functions/ts_epoch_data.m
U    MMPS/matlab/timesurfer/functions/ts_reject.m
A    MMPS/matlab/timesurfer/functions/ts_MNE_epoch_fif.m
A    MMPS/matlab/timesurfer/functions/ts_MNE_loadfif.m
U    MMPS/matlab/timesurfer/functions/ts_zscore.m
A    MMPS/matlab/ts_fieldtrip/preproc.m

% rev 412

#############################################################################
#############################################################################

## MMPS_226: medium revision
## Don Hagler 09/28/11

% changed mmil_sort_dicoms to get only first occurrence of each tag

% changed mmil_classify_GE to set epi2_pepolarFLEX as DTI_ipp if
%   ~ismember(ndiffdirs,[27,45])

% removed executable property from these files
%      MMPS/matlab/timesurfer/functions/ts_tf_dSPM.m
%      MMPS/matlab/timesurfer/functions/ts_process_data.m
%      MMPS/matlab/timesurfer/functions/extract_triggers.m
%      MMPS/matlab/timesurfer/functions/ts_load_data.m
%      MMPS/matlab/timesurfer/functions/ts_calc_combine_conditions.m
%      MMPS/matlab/timesurfer/functions/ts_BetweenSensorAngles.m
%      MMPS/matlab/timesurfer/functions/ts_epoch_data.m
%      MMPS/matlab/timesurfer/functions/ts_MNE_epoch_fif.m
%      MMPS/matlab/timesurfer/functions/ts_MNE_loadfif.m

% rev 413

% changed mgh2dat to check if tmp_path is empty (then set to pwd)

% changed SetUpMEG.csh to adjust to change in mne directory setup

% changed rc_RCSE_fmincon_offset_search to fix betas2offsets
%   was incorrectly setting offsets for all locations to be the same

% changed ts_groupavg, AATL_MMIL_Average_r_bound, and AATL_MMIL_Average_thick
%   to use fs_groupavg instead of nonexistent fs_groupavg_old

% changed fs_groupavg so sig has same sign as tstat,
%   changed sig to pvals, tstat to tstats (to be similar to fs_groupavg_glm)

% changed MMIL_Analysis/MMIL_SurfGroupAvg_BOLD and timesurfer/ts_groupavg
%   to use pvals and tstats instead of sig and tstat

% changed rc_analyze_wforms to include complete range as extra bin for auc
% changed MEG_MMIL_RCSE_GroupAvg to not calculate mean across auc bins
%   (because averaging was being done after normalization)

% created fs_load_regressors
% created fs_design_glm
% created fs_calc_glm (similar to Voxelwise_GLM)
% changed fs_groupavg_glm to use fs_load_regressors,
%   fs_design_glm, and fs_calc_glm
% changed fs_groupavg to fix stdv calculation for individual condition
%   was getting too large values because using mean instead of sum
%   and tstats for unpaired, two-sample ttest used wrong stderr
% created mmil_merge_parms

% created ts_load_combcond_info
% changed ts_process_fif_data to create subfunctions, added ability
%   to combine conditions based on fname_combcond_info
% changed ts_combine_conditions (formatting only)
% changed ts_read_fif_chan, ts_read_fif_data, ts_read_fif_events,
%   and ts_read_fif_header (formatting and notes only)
% changed MMIL_Analyze_MEG_Exams to make sure RCSE_fstem_conds from VisitInfo
%   takes precedence over that from ProjInfo
% changed MMIL_Process_MEG_Exams and MMIL_Process_MEG_Exam to accept
%   PROC_post_combcond_flag, PROC_fname_combcond_info etc.
% changed MMIL_Process_MEG to accept post_combcond_flag, fname_combcond_info, etc..

% changed ts_dSPM to use strict option for mmil_args2parms
% changed MEG_MMIL_dSPM and MMIL_Analyze_MEG_Exam(s) to replace:
%   lh_sourcecov_wfile with lh_sourcecov_file
%   rh_sourcecov_wfile with rh_sourcecov_file
% changed MEG_MMIL_dSPM to replace eeg_flag with useEEG_flag
% changed MEG_MMIL_dSPM to add ico_FSContainerPath to excl_tags

% changed by Mona:
U    webapps/drupal/sites/all/modules/mmil/mmil_upload.module
A    dataportal
A    dataportal/sites
A    dataportal/sites/all
A    dataportal/sites/all/modules
A    dataportal/sites/all/modules/mmil
A    dataportal/sites/all/modules/mmil/mmil.css
A    dataportal/sites/all/modules/mmil/mmil_dp.module
A    dataportal/sites/all/modules/mmil/mmil_dp.info
A    dataportal/sites/all/modules/mmil/mmil_api.php
A    dataportal/code
A    dataportal/code/ImageViewer
A    dataportal/code/ImageViewer/base64.js
A    dataportal/code/ImageViewer/ImageViewer.display.inc
A    dataportal/code/ImageViewer/imageviewer.nate.php
A    dataportal/code/ImageViewer/ImageViewer.defaults.inc
A    dataportal/code/ImageViewer/content.inc
A    dataportal/code/ImageViewer/include
A    dataportal/code/ImageViewer/include/functions.inc
A    dataportal/code/ImageViewer/include/dbconn.inc
A    dataportal/code/ImageViewer/include/jquery-1.5.1.min.js
A    dataportal/code/ImageViewer/include/uploadFile.inc
A    dataportal/code/ImageViewer/flot
A    dataportal/code/ImageViewer/flot/jquery.flot.resize.min.js
A    dataportal/code/ImageViewer/flot/jquery.flot.min.js
A    dataportal/code/ImageViewer/flot/jquery.flot.selection.js
A    dataportal/code/ImageViewer/flot/jquery.flot.symbol.min.js
A    dataportal/code/ImageViewer/flot/FAQ.txt
A    dataportal/code/ImageViewer/flot/jquery.flot.navigate.js
A    dataportal/code/ImageViewer/flot/jquery.colorhelpers.js
A    dataportal/code/ImageViewer/flot/jquery.js
A    dataportal/code/ImageViewer/flot/jquery.flot.pie.min.js
A    dataportal/code/ImageViewer/flot/jquery.flot.fillbetween.js
A    dataportal/code/ImageViewer/flot/PLUGINS.txt
A    dataportal/code/ImageViewer/flot/jquery.flot.image.min.js
A    dataportal/code/ImageViewer/flot/jquery.flot.stack.js
A    dataportal/code/ImageViewer/flot/jquery.flot.selection.min.js
A    dataportal/code/ImageViewer/flot/jquery.min.js
A    dataportal/code/ImageViewer/flot/jquery.flot.navigate.min.js
A    dataportal/code/ImageViewer/flot/jquery.colorhelpers.min.js
A    dataportal/code/ImageViewer/flot/Makefile
A    dataportal/code/ImageViewer/flot/jquery.flot.fillbetween.min.js
A    dataportal/code/ImageViewer/flot/excanvas.js
A    dataportal/code/ImageViewer/flot/jquery.flot.stack.min.js
A    dataportal/code/ImageViewer/flot/API.txt
A    dataportal/code/ImageViewer/flot/jquery.flot.threshold.js
A    dataportal/code/ImageViewer/flot/jquery.flot.crosshair.js
A    dataportal/code/ImageViewer/flot/NEWS.txt
A    dataportal/code/ImageViewer/flot/jquery.flot.js
A    dataportal/code/ImageViewer/flot/jquery.flot.resize.js
A    dataportal/code/ImageViewer/flot/LICENSE.txt
A    dataportal/code/ImageViewer/flot/jquery.flot.symbol.js
A    dataportal/code/ImageViewer/flot/excanvas.min.js
A    dataportal/code/ImageViewer/flot/jquery.flot.pie.js
A    dataportal/code/ImageViewer/flot/jquery.flot.threshold.min.js
A    dataportal/code/ImageViewer/flot/README.txt
A    dataportal/code/ImageViewer/flot/jquery.flot.crosshair.min.js
A    dataportal/code/ImageViewer/flot/jquery.flot.image.js
A    dataportal/code/ImageViewer/flot/examples
A    dataportal/code/ImageViewer/flot/examples/basic.html
A    dataportal/code/ImageViewer/flot/examples/visitors.html
A    dataportal/code/ImageViewer/flot/examples/arrow-left.gif
A    dataportal/code/ImageViewer/flot/examples/data-japan-gdp-growth.json
A    dataportal/code/ImageViewer/flot/examples/symbols.html
A    dataportal/code/ImageViewer/flot/examples/multiple-axes.html
A    dataportal/code/ImageViewer/flot/examples/navigate.html
A    dataportal/code/ImageViewer/flot/examples/hs-2004-27-a-large_web.jpg
A    dataportal/code/ImageViewer/flot/examples/data-eu-gdp-growth-1.json
A    dataportal/code/ImageViewer/flot/examples/graph-types.html
A    dataportal/code/ImageViewer/flot/examples/data-eu-gdp-growth-3.json
A    dataportal/code/ImageViewer/flot/examples/data-eu-gdp-growth.json
A    dataportal/code/ImageViewer/flot/examples/arrow-right.gif
A    dataportal/code/ImageViewer/flot/examples/interacting.html
A    dataportal/code/ImageViewer/flot/examples/data-eu-gdp-growth-5.json
A    dataportal/code/ImageViewer/flot/examples/arrow-up.gif
A    dataportal/code/ImageViewer/flot/examples/percentiles.html
A    dataportal/code/ImageViewer/flot/examples/pie.html
A    dataportal/code/ImageViewer/flot/examples/turning-series.html
A    dataportal/code/ImageViewer/flot/examples/zooming.html
A    dataportal/code/ImageViewer/flot/examples/image.html
A    dataportal/code/ImageViewer/flot/examples/ajax.html
A    dataportal/code/ImageViewer/flot/examples/data-usa-gdp-growth.json
A    dataportal/code/ImageViewer/flot/examples/selection.html
A    dataportal/code/ImageViewer/flot/examples/thresholding.html
A    dataportal/code/ImageViewer/flot/examples/time.html
A    dataportal/code/ImageViewer/flot/examples/arrow-down.gif
A    dataportal/code/ImageViewer/flot/examples/layout.css
A    dataportal/code/ImageViewer/flot/examples/resize.html
A    dataportal/code/ImageViewer/flot/examples/tracking.html
A    dataportal/code/ImageViewer/flot/examples/annotating.html
A    dataportal/code/ImageViewer/flot/examples/realtime.html
A    dataportal/code/ImageViewer/flot/examples/stacking.html
A    dataportal/code/ImageViewer/flot/examples/data-eu-gdp-growth-2.json
A    dataportal/code/ImageViewer/flot/examples/interacting-axes.html
A    dataportal/code/ImageViewer/flot/examples/setting-options.html
A    dataportal/code/ImageViewer/flot/examples/data-eu-gdp-growth-4.json
A    dataportal/code/ImageViewer/flot/examples/index.html
A    dataportal/code/ImageViewer/ImageViewer.code.inc
A    dataportal/code/ImageViewer/custom_styles.inc
A    dataportal/code/ImageViewer/images
A    dataportal/code/ImageViewer/images/bluearrow_right.png
A    dataportal/code/ImageViewer/images/amberdot32.png
A    dataportal/code/ImageViewer/images/Axial32.png
A    dataportal/code/ImageViewer/images/amberdot16.png
A    dataportal/code/ImageViewer/images/bluearrow_up.png
A    dataportal/code/ImageViewer/images/rightarrow1.png
A    dataportal/code/ImageViewer/images/Back.gif
A    dataportal/code/ImageViewer/images/Forward.gif
A    dataportal/code/ImageViewer/images/reddot32.png
A    dataportal/code/ImageViewer/images/reddot16.png
A    dataportal/code/ImageViewer/images/magentadot32.png
A    dataportal/code/ImageViewer/images/help.png
A    dataportal/code/ImageViewer/images/bluearrow_down.png
A    dataportal/code/ImageViewer/images/magentadot16.png
A    dataportal/code/ImageViewer/images/Import.gif
A    dataportal/code/ImageViewer/images/Trash.gif
A    dataportal/code/ImageViewer/images/Export.gif
A    dataportal/code/ImageViewer/images/bluedot32.png
A    dataportal/code/ImageViewer/images/bluedot16.png
A    dataportal/code/ImageViewer/images/cyandot32.png
A    dataportal/code/ImageViewer/images/lightgraydot32.png
A    dataportal/code/ImageViewer/images/cyandot16.png
A    dataportal/code/ImageViewer/images/lightgraydot16.png
A    dataportal/code/ImageViewer/images/2rightarrow.png
A    dataportal/code/ImageViewer/images/bluearrow_left.png
A    dataportal/code/ImageViewer/images/greendot32.png
A    dataportal/code/ImageViewer/images/graydot32.png
A    dataportal/code/ImageViewer/images/greendot16.png
A    dataportal/code/ImageViewer/images/Sag32.png
A    dataportal/code/ImageViewer/images/graydot16.png
A    dataportal/code/ImageViewer/images/junk
A    dataportal/code/ImageViewer/images/junk/pdficonsmall.gif
A    dataportal/code/ImageViewer/images/junk/Cfdirectory.gif
A    dataportal/code/ImageViewer/images/junk/actionCancel.gif
A    dataportal/code/ImageViewer/images/junk/checkbox_selOSX.gif
A    dataportal/code/ImageViewer/images/junk/Retry_Connection.gif
A    dataportal/code/ImageViewer/images/junk/reload.png
A    dataportal/code/ImageViewer/images/junk/NewFolder.gif
A    dataportal/code/ImageViewer/images/junk/display_field.png
A    dataportal/code/ImageViewer/images/junk/Preferences.icns
A    dataportal/code/ImageViewer/images/junk/home.gif
A    dataportal/code/ImageViewer/images/junk/rightarrow2.png
A    dataportal/code/ImageViewer/images/junk/Minus.gif
A    dataportal/code/ImageViewer/images/junk/OsirixDownload.icns
A    dataportal/code/ImageViewer/images/junk/SaveForLater.gif
A    dataportal/code/ImageViewer/images/junk/MailSmall.tiff
A    dataportal/code/ImageViewer/images/junk/alertIconWin.gif
A    dataportal/code/ImageViewer/images/junk/downarrow2_m.png
A    dataportal/code/ImageViewer/images/junk/Cor.tif
A    dataportal/code/ImageViewer/images/junk/FolderIcon.tif
A    dataportal/code/ImageViewer/images/junk/exec.png
A    dataportal/code/ImageViewer/images/junk/AxialSmall.tif
A    dataportal/code/ImageViewer/images/junk/QT2.gif
A    dataportal/code/ImageViewer/images/junk/QT3.gif
A    dataportal/code/ImageViewer/images/junk/Export.icns
A    dataportal/code/ImageViewer/images/junk/Axial.tif
A    dataportal/code/ImageViewer/images/junk/zoomOut.gif
A    dataportal/code/ImageViewer/images/junk/check.gif
A    dataportal/code/ImageViewer/images/junk/redLight.tif
A    dataportal/code/ImageViewer/images/junk/Send.icns
A    dataportal/code/ImageViewer/images/junk/downarrow1.png
A    dataportal/code/ImageViewer/images/junk/VolumeRendering.tif
A    dataportal/code/ImageViewer/images/junk/Print.icns
A    dataportal/code/ImageViewer/images/junk/bottom.png
A    dataportal/code/ImageViewer/images/junk/downarrow2.png
A    dataportal/code/ImageViewer/images/junk/smalltrash.tif
A    dataportal/code/ImageViewer/images/junk/Cffile.gif
A    dataportal/code/ImageViewer/images/junk/pdf.png
A    dataportal/code/ImageViewer/images/junk/CorSmall.tif
A    dataportal/code/ImageViewer/images/junk/Send.gif
A    dataportal/code/ImageViewer/images/junk/Import.icns
A    dataportal/code/ImageViewer/images/junk/magnifier.gif
A    dataportal/code/ImageViewer/images/junk/refreshd.gif
A    dataportal/code/ImageViewer/images/junk/greenLight.tif
A    dataportal/code/ImageViewer/images/junk/2leftarrow.png
A    dataportal/code/ImageViewer/images/junk/zoomIn.gif
A    dataportal/code/ImageViewer/images/junk/uparrow2_m.png
A    dataportal/code/ImageViewer/images/junk/CD-R.icns
A    dataportal/code/ImageViewer/images/junk/save.png
A    dataportal/code/ImageViewer/images/junk/QTExport.icns
A    dataportal/code/ImageViewer/images/junk/def.png
A    dataportal/code/ImageViewer/images/junk/away.tif
A    dataportal/code/ImageViewer/images/junk/inbox.gif
A    dataportal/code/ImageViewer/images/junk/SagSmall.tif
A    dataportal/code/ImageViewer/images/junk/Plus.gif
A    dataportal/code/ImageViewer/images/junk/stop.gif
A    dataportal/code/ImageViewer/images/junk/Sag.tif
A    dataportal/code/ImageViewer/images/junk/SmallPrinter.tif
A    dataportal/code/ImageViewer/images/junk/favicon.ico
A    dataportal/code/ImageViewer/images/junk/exec_small.png
A    dataportal/code/ImageViewer/images/junk/Back.gif
A    dataportal/code/ImageViewer/images/junk/Forward.gif
A    dataportal/code/ImageViewer/images/junk/grid.png
A    dataportal/code/ImageViewer/images/junk/help_relation.png
A    dataportal/code/ImageViewer/images/junk/bord.png
A    dataportal/code/ImageViewer/images/junk/2rightarrow_m.png
A    dataportal/code/ImageViewer/images/junk/table.png
A    dataportal/code/ImageViewer/images/junk/Mail.icns
A    dataportal/code/ImageViewer/images/junk/ang_direct.png
A    dataportal/code/ImageViewer/images/junk/resize.png
A    dataportal/code/ImageViewer/images/junk/pdficonsmaller.png
A    dataportal/code/ImageViewer/images/junk/2leftarrow_m.png
A    dataportal/code/ImageViewer/images/junk/QTExportVR.icns
A    dataportal/code/ImageViewer/images/junk/2rightarrow.png
A    dataportal/code/ImageViewer/images/junk/CDRom.icns
A    dataportal/code/ImageViewer/images/junk/relation.png
A    dataportal/code/ImageViewer/images/junk/available.tif
A    dataportal/code/ImageViewer/images/junk/Query.gif
A    dataportal/code/ImageViewer/images/junk/Movie.icns
A    dataportal/code/ImageViewer/images/junk/trash.icns
A    dataportal/code/ImageViewer/images/2leftarrow.png
A    dataportal/code/ImageViewer/images/yellowdot32.png
A    dataportal/code/ImageViewer/images/Cor32.png
A    dataportal/code/ImageViewer/images/yellowdot16.png
A    dataportal/code/ImageViewer/ImageViewer.php
A    dataportal/code/ImageViewer/canvas2image.js
A    dataportal/code/ImageViewer/structure.js
A    dataportal/code/ImageViewer/index.php
A    dataportal/code/common
A    dataportal/code/common/mmil_dp_webapp
A    dataportal/code/common/mmil_dp_webapp/mmil_dp_webapp.module
A    dataportal/code/common/mmil_dp_webapp/mmil_dp_webapp.php
A    dataportal/code/common/mmil_dp_webapp/mmil_dp_webapp.css
A    dataportal/code/common/mmil_dp_webapp/mmil_dp_webapp.info
A    dataportal/code/common/doctype.inc
A    dataportal/code/common/login.inc
A    dataportal/code/common/php_vars_to_js_vars.inc
A    dataportal/code/common/variable_bulk_set.inc
A    dataportal/code/common/keys.display.inc
A    dataportal/code/common/user.display.inc
A    dataportal/code/common/header.inc
A    dataportal/code/common/conf.display.inc
A    dataportal/code/common/primary_menu_bar.inc
A    dataportal/code/common/common_styles.inc
A    dataportal/code/common/env.display.inc
A    dataportal/code/common/hook_bootstrap.inc
A    dataportal/code/common/common_scripts.inc
A    dataportal/code/common/files.display.inc
A    dataportal/code/common/app_defaults.inc
A    dataportal/code/common/server.display.inc
A    dataportal/code/common/cookie.display.inc
A    dataportal/code/common/title.inc
A    dataportal/code/common/permalink.inc
A    dataportal/code/common/get.display.inc
A    dataportal/code/common/favicon.inc
A    dataportal/code/common/index.php
A    dataportal/code/common/unauthenticated.inc
A    dataportal/code/common/session.display.inc
A    dataportal/code/common/apple_mobile.inc
A    dataportal/code/common/post.display.inc
A    dataportal/code/common/head_tag.inc
A    dataportal/code/common/request.display.inc
A    dataportal/code/common/footer.inc
A    dataportal/code/common/apple_mobile_scripts.inc
A    dataportal/code/common/authorization.inc
A    dataportal/code/common/meta_tags.inc

% rev 430

% changed ts_pointreg to use triplot (fieldtrip function) and
%   accept iskull and oskull
% changed MEG_MMIL_Reg2MRI to pass three files to ts_pointreg

% added mmil_args_ts_process_fif_data, changed MMIL_Args
% changed MEG_MMIL_Browse_Raw to use MEG_Args
% changed ts_process_fif_data to not load parms from file

% changed fs_paint help

% changed rc_RCSE, MEG_MMIL_dSPM, MEG_MMIL_RCSE,
%   MMIL_Analyze_MEG_Exams, and MMIL_Analyze_MEG_Exam
%   to allow RCSE_proc_infix and dSPM_proc_infix

% changed ts_roi_analysis so roi file list is correct if ico=0
% changed fs_write_annotation (help only)
% changed fs_read_surf_nverts to return nverts and nfaces (instead of surf)
% changed fs_load_subj to update call to fs_read_surf_nverts

% changed MEG_MMIL_dSRPM_ROI_GroupAvg to normalize to max instead of median
%   and changed order of default roi_colors

% created firsthippo.csh (orig by Lars T. Wetlye, mods by Don Hagler)
% created MMIL_Process_First to run FSL's FIRST to extract hippocampal volumes
% created MMIL_Choose_T1 to set fname_T1
% changed DTI_MMIL_Resample_Fibers; removed unused FSContainerPath
% changed DTI_MMIL_Analyze_Fibers_Exam to not pass FSContainerPath to
%   DTI_MMIL_Resample_Fibers; removed fname_T1; removed T1typeflag
% changed T1typeflag to T1type:
%   MMIL_Tools/MMIL_Register_T2_to_T1
%   MMIL_Utils/MMIL_Choose_T1
%   MMIL_Stream/MMIL_Process_Exam
%   MMIL_Stream/MMIL_Process_DTI
%   MMIL_Stream/MMIL_Process_BOLD
%   BOLD_Stream/BOLD_MMIL_Register_to_T1
%   DTI_Stream/DTI_MMIL_Register_to_T1
% changed to use MMIL_Choose_T1:
%   MMIL_Tools/MMIL_Register_T2_to_T1
%   MMIL_Stream/MMIL_Freesurfer_Recon_Exam
%   DTI_Atlas/DTI_MMIL_WarpToAtlas_Exam
%   MMIL_Longitudinal/MMIL_Long_Setup_Exam
% changed MMIL_Process_Exams and MMIL_Process_Exam to use MMIL_Process_First
%   added parameters STRUCT_first_flag and STRUCT_first_nu_flag
% created mmil_read_first_stats
% created MMIL_Summarize_First_Analysis

% changed fs_check_status to correctly return missing_files
% changed fs_group_roi_summary to use mmil_args2parms, pass FS_version to fs_check_status
% changed MMIL_IcoResamp_FSRecon_Exams to pass FS_version to MMIL_Get_FSReconStatus

% changed MMIL_Summarize_Long_DTI_Analysis to remove
%   unused batchrootdir, batchname, changed help formatting

% changed by Mona:
U    webapps/drupal/sites/all/modules/mmil/mmil_upload.module
U    webapps/drupal/sites/all/modules/mmil/mmil_qc.module
U    dataportal/code/ImageViewer/ImageViewer.display.inc
U    dataportal/code/ImageViewer/structure.js

% rev 437

% created fs_mni2tal_matrix, fs_read_talxfm, fs_tal2mni
%   fs_mni2ras, fs_mni2tal, fs_ras2mni, fs_nearest_verts, fs_tal2surf
%   fs_tal2labels, fs_labels2annot, fs_tal2annot

% changed fs_read_colorlut to throw error if file not found or not readable

% rev 438

% changed fs_tal2labels to use forceflag
% changed fs_labels2annot to create subj labels in outdir/labels
%   then get labels from that or indir depending on whether subj
%   matches source_subj
% created fs_label2label, changed fs_labels2annot to use it

% created MMIL_Get_FS_version, changed MMIL_Get_FSReconStatus to use it

% rev 439

% changed MMIL_IcoResamp_FSRecon_Exam to use standard make_average_subject
%   if FS_version >= 500

% rev 440

% changed fs_labels2annot to write all vertices

% changed BOLD_MMIL_Get_ScanInfo to initialize B0uw_ref_for, B0uw_ref_rev,
%   B0reg_ref_for, and B0reg_ref_rev as [] to avoid untrapped error when
%   session with BOLD has no for or rev

% changed MEG_MMIL_RCSE_GroupAvg to use shaded confidence intervals if
%   errbar_flag = 2 (not default)
% changed MEG_MMIL_RCSE_GroupAvg to accept 'diff_prefix' and 'diff_infix' and
%   to subtract waveforms after loading subject results
% changed mmil_args_MEG_MMIL_RCSE_GroupAvg to add 'diff_prefix' and 'diff_infix'

% created ts_fit_points_to_surf (code from Eran Mukamel)
% changed ts_pointreg to accept fitflag and run ts_fit_points_to_surf
% changed MEG_MMIL_Reg2MRI to accept fitflag and pass to ts_pointreg


% changed by Cooper:
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exams.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Concat_SurfStats.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Summarize_MRI_DTI_csv.m
U    MMPS/matlab/MMIL_Utils/MMIL_Import_MRI_QC.m
U    MMPS/matlab/MMIL_Tools/MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED.m
U    MMPS/matlab/mmil_tools/mmil_classify_dicoms.m

% rev 442

% changed fs_ico2ico to set SUBJECTS_DIR before mri_surf2surf

% changed mmil_padstr to use mmil_isint, not isint

% added firsthippo2.csh, matdet, changed MMIL_Process_Exam, MMIL_Process_First
%   to use FreeSurfer aseg and nu volumes

% changed by Cooper:
U    MMPS/matlab/mmil_tools/mmil_classify_GE.m

%  rev 446

% changed MMIL_Set_Common_RootDirs to initialize RootDirs = []

% changed BOLD_MMIL_Get_ScanInfo to check if 
%   (SessInfo.nscans_SE_rev > 0 && SessInfo.nscans_SE_rev > 0)
% changed MMIL_Process_BOLD to set variables to empty
%   when isempty(sA) or isempty(sB)

% changed mmil_sort_dicoms back to get all occurrences of each tag

% changed mmil_classify_Philips so 'SEEPI' scans get classified as BOLD_SE
%   (not just 'DWI')

% changed BOLD_MMIL_Register_to_T1 to look for 'BOLD_SE', not 'BOLD_SE_for'
%   and 'BOLD_SE_rev'

% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED
%   so check forceflag before converting BOLD_SE scans

% changed by Vijay:
U    MMPS/matlab/MMIL_Tools/MMIL_WarpToAtlas.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_MRI_Exams.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Summarize_MRI_Analysis.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Compile_MRI_Analysis.m
U    MMPS/matlab/DTI_Stream/DTI_MMIL_Resample_Fibers.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exams.m
U    MMPS/matlab/REC_Analysis/REC_MMIL_Analyze_MRI_Exams.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Convert_Fibers_to_Segmentation.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Fibers.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_AsegMask_Fibers.m
U    MMPS/matlab/DTI_Atlas/DTI_MMIL_Average_Atlas_Fibers.m
U    MMPS/matlab/DTI_Atlas/DTI_MMIL_WarpToAtlas_Exam.m

% created ts_timeclust
% created fs_resample_labels
% changed fs_labels2annot to use fs_resample_labels
% changed ts_roi_analysis to use ico_infix_flag (default = 0)
% changed MMIL_Analyze_MEG_Exam(s) and MEG_MMIL_dSPM_ROI to use ico_infix_flag

% rev 448

% changed mmil_classify_Siemens to check pe_rev_flag when
%   SequenceName is epse2d1_64

% changed MEG_MMIL_dSPM_ROI_GroupAvg to correct mistake with shaded
%   confidence interval

% changed fs_ico2ico to add presmooth option

% changed fs_read_fscolorlut to deblank(tline) before checking if empty
%   to fix error caused by space inserted in FreeSurferColorLUT.txt in 5.1.0

% changed REC_MMIL_Create_BEM_Exams to accept batchname

% changed MMIL_Create_BEM_Exams to accept ProjID and use MMIL_Check_ProjID
% created mmil_args_MMIL_Create_BEM_Exams
% changed MMIL_Args to add MMIL_Create_BEM_Exams as allowed context
% changed REC_MMIL_Create_BEM_Exams to be thin shell wrapper

% changed DTI_MMIL_Calc_DT to not run mmil_write_regscripts if errcode
%   from DTI_MMIL_Load_RegInfo

% changed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to skip MPR, Xeta,
%     FLASHlo, FLASHhi, B1HC_mag (etc.), if ImagesInAcquisition ~= nimgs
%     (but only if ImagesInAcquisition ~= 0)
%   also fixed warning message to correctly output series number, not i
%     (problem since MMPS_224)

% changed mmil_reg to use mmil_isrelative
% changed mmil_reg_average_volumes to pass binfile to mmil_reg
%   and to write all output to same path as fname_out
%   and to create separate tmpdir for each scan
%   NOTE: mmil_reg_average_volumes now works for MPR (without seg fault)
%     but gives slightly different results from mmil_average_volumes (mriRegister)

% added fsl_fmri_preproc.csh from Lars T. Westlye
% created BOLD_MMIL_Export_Data_for_FSL
% changed MMIL_Process_BOLD to call BOLD_MMIL_Export_Data_for_FSL
% changed MMIL_Process_Exam(s) so BOLD_export_flag may be 0, 1, or 2
% added flirt_bbr_ltw (to bin), epi_reg_ltw (to sh), and bbr.sch (to parms/ltw)

% changed MMIL_Process_BOLD and MMIL_Process_DTI to pass FSContainerPath
%   to MMIL_Register_T2_to_T1 only if bbregflag=1
% changed MMIL_Process_Exam to pass FSContainerPath to MMIL_Process_BOLD
%   and MMIL_Process_DTI, not tmpFSContainerPath

% changed MMIL_Process_BOLD to use export_smooth with default = 5
% changed MMIL_Process_Exam(s) to use BOLD_export_smooth with default = 5

% changed fs_resample_mgh to allow non-integer window_size, corrected
%   coding mistake with linear resampling (too many output frames)

% changed fs_colorlut to add code from fs_read_fscolorlut
% removed fs_read_fscolorlut
% changed fs_aseg_roi to use fs_colorlut

% created fs_extract_tseries
% created BOLD_MMIL_Extract_TSeries
% changed MMIL_Process_BOLD to call BOLD_MMIL_Extract_TSeries, use
%   extract_tseries_flag

% changed by Cooper or Vijay:
U    MMPS/matlab/fstools/fs_read_aseg_stats.m
A    MMPS/matlab/DTI_Stream/DTI_MMIL_Export_Data_for_FSL.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exams.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_DTI.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exam.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Structurals.m
U    MMPS/matlab/MMIL_Tools/MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED.m
U    MMPS/matlab/MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m
U    MMPS/matlab/MMIL_Tools/MMIL_WarpToAtlas.m
U    MMPS/matlab/mmil_tools/mmil_masksurf.m
U    MMPS/matlab/mmil_tools/mmil_warp_to_atlas.m
U    MMPS/matlab/mmil_tools/mmil_dct_reg_atlas.m
U    MMPS/matlab/mmil_tools/mmil_dct_brainmask.m
U    MMPS/matlab/MMIL_Utils/MMIL_Get_Container.m
U    MMPS/matlab/MMIL_Utils/MMIL_Import_MRI_QC.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_MRI_Exams.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Compile_Long_Analysis.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_Exams.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Concat_SurfStats.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Summarize_MRI_Analysis.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_Exam.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Summarize_Long_Analysis.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Compile_MRI_Analysis.m
U    MMPS/matlab/DTI_Atlas/DTI_MMIL_AtlasTrack_Fibers_Exam.m
U    MMPS/parms/MMIL_FSColorLUT.txt
A    MMPS/csh/fsl_dti_data.csh
A    MMPS/csh/fsl_dti_measlist.csh

% rev 458

% changed MMIL_Process_Exam(s) to use BOLD_extract_tseries_flag

% rev 459

% changed fs_multiclust default clust_thresh to 100

% created fs_write_ctab

% changed MMIL_Get_SurfStats to use StudyInfo(s).long
%   use {'fsurf','fsico'} as required_containers for 'icoarea'
% changed MMIL_Analyze_MRI_Exam to use mmil_isrelative
% changed MMIL_Check_StudyInfo to add 'long' to ContainerTypes and
%   standard_tags

% changed by Cooper:
U    MMPS/matlab/MMIL_Analysis/MMIL_Compile_Long_Analysis.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Concat_SurfStats.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Summarize_MRI_DTI_csv.m
U    MMPS/matlab/MMIL_Utils/MMIL_Get_Container.m

% rev 462

% changed MMIL_Concat_SurfStats, help only
% changed MMIL_Get_Container to allow 'long' ContainerType
%   changed ContainerStem for 'fsico' back to 'FREESURFERICO'

% rev 463

% changed ts_pointreg so "Fit Points" button only drawn if fitflag=1
%   and added lights_flag option, create 3 lights

% changed MMIL_Concat_SurfStats to correctly write csv file (wrong fmt_str)

% changed REC_MMIL_Analyze_Long_Exams and MMIL_Analyze_Long_Exams
%   so default sphsmoothsteps = [176,705,2819]

% changed ts_prep_MEG_info to set Coil_ori_tmp when sensor type = 3024

% changed MEG_MMIL_dSPM_ROI_GroupAvg to cycle through roi_colors in
%   plot_multisubj_responses and plot_groupavg_responses subfunctions

% changed MEG_MMIL_dSPM_ROI_GroupAvg so default offset = 0

% changed ts_calc_fif_motion to not use units_flag when calling mmil_M2x,
%   multiply motion_vec(1:3) by 1000

% reverted change to MMIL_Concat_SurfStats.m

% changed by Cooper
U    MMPS/matlab/MMIL_Analysis/MMIL_Concat_SurfStats.m

% changed by Vijay:
U    MMPS/matlab/DTI_Stream/DTI_MMIL_Export_Data_for_FSL.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exams.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_DTI.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exam.m
U    MMPS/matlab/DTI_Atlas/DTI_MMIL_AtlasTrack_Fibers_Exam.m
U    MMPS/matlab/mmil_tools/mmil_classify_Siemens.m
U    MMPS/matlab/mmil_tools/mmil_reg.m
U    MMPS/matlab/mmil_tools/mmil_jpdfreg_T1T2.m
U    MMPS/matlab/mmil_tools/mmil_resample_to_LIA.m

% changed by Mona
U    dataportal/sites/all/modules/mmil/mmil_dp.module
A    dataportal/code/Sample
A    dataportal/code/Sample/PING_content.inc
A    dataportal/code/Sample/content.inc
A    dataportal/code/Sample/custom_permalink.inc
A    dataportal/code/Sample/custom_styles.inc
A    dataportal/code/Sample/PCND_content.inc
A    dataportal/code/Sample/custom_scripts.inc
A    dataportal/code/Sample/index.php
A    dataportal/code/Sample2
A    dataportal/code/Sample2/content.inc
A    dataportal/code/Sample2/custom_permalink.inc
A    dataportal/code/Sample2/custom_styles.inc
A    dataportal/code/Sample2/custom_scripts.inc
A    dataportal/code/Sample2/index.php
U    dataportal/code/common/primary_menu_bar.inc

% rev 475

% merged change from Cooper in MMIL_Concat_SurfStats

% rev 476

% changed MMIL_Analyze_MEG_Exam(s) to accept RCSE_conditions
% changed MEG_MMIL_RCSE and rc_RCSE to accept conditions

% changed rc_analyze_wforms to not accept stderrflag (never used)
% changed mmil_args_rc_analyze_wforms to not include stderrflag

% changed MEG_MMIL_RCSE_GroupAvg to add comma after "SubjID"

% changed rc_analyze_wforms to accept mark_peaks_flag
% changed mmil_args_rc_analyze_wforms to include mark_peaks_flag

% created ts_plot_wforms

% changed ts_dSPM to fix fprintf with missing input

% changed by Mona:
U    dataportal/sites/all/modules/mmil/mmil_dp.module
U    dataportal/code/Sample/PING_content.inc
U    dataportal/code/Sample/content.inc
U    dataportal/code/Sample/PCND_content.inc
U    dataportal/code/common/login.inc
U    dataportal/code/common/header.inc
U    dataportal/code/common/primary_menu_bar.inc
U    dataportal/code/common/common_styles.inc
U    dataportal/code/common/hook_bootstrap.inc
U    dataportal/code/common/common_scripts.inc
U    dataportal/code/common/app_defaults.inc
U    dataportal/code/common/permalink.inc
U    dataportal/code/common/unauthenticated.inc

% rev 484

% changed ts_plot_wforms to accept wforms_err and plot error bars or
%   shaded confidence interval

% changed ts_plot_wforms to have vertical shaded region (clusters)

% created ts_resamp_wforms, ts_wforms_peaks, ts_wform_auc

% changed ts_wform_peaks and rc_analyze_wforms to fix code for
%   selecting largest peak
% changed ts_plot_wforms so input ranges and points are struct arrays
%   with numel equal to nconds

% renamed nan_mean to ts_nan_mean (originally from EEGLAB)
% changed ts_browseraw and ts_topoplotER to use ts_nan_mean

% created ts_plot_responses

% changed comment in fs_mni2ras

% changed EPI_ReorientVol to correctly adjust center coordinates

% changed by Vijay:
U    MMPS/matlab/mmil_utils/mmil_M2x.m
A    MMPS/matlab/mmil_utils/mmil_Mtxt2M.m
A    MMPS/matlab/mmil_tools/mmil_jpdfreg2atl_T1T2.m
U    MMPS/matlab/mmil_tools/mmil_sort_dicoms.m
U    MMPS/matlab/mmil_tools/mmil_classify_Siemens.m
U    MMPS/matlab/mmil_tools/mmil_reg.m
U    MMPS/matlab/mmil_tools/mmil_jpdfreg_T1T2.m
A    MMPS/matlab/mmil_tools/mmil_jpdfreg2subj_T1T2.m

% changed by Mona:
U    dataportal/sites/all/modules/mmil/mmil_dp.module

% rev 489

% changed ts_plot_wforms to use baseline_flag [0|1|2] with value 1
%   averaging baseline across all conditions

% changed ts_resamp_wforms to remove contrast_latency_flag and to add output
%   for mean and CI of wforms1 and wforms2

% renamed MEG_MMIL_dSPM_ROI to MEG_MMIL_dSROI
% renamed MEG_MMIL_dSPM_ROI_GroupAvg to MEG_MMIL_dSROI_GroupAvg
% created MEG_MMIL_GroupRCSE_Diff_Resamp

% changed uses of ndummy to skipTRs in:
BOLD_Stream/BOLD_MMIL_Export_Data_for_FSL
BOLD_Stream/BOLD_MMIL_Extract_TSeries
BOLD_Tools/BOLD_Correct_Data
BOLD_Tools/BOLD_MotionCorr
BOLD_Tools/BOLD_TShift
MMIL_Stream/MMIL_Process_BOLD
MMIL_Stream/MMIL_Process_Exam
MMIL_Stream/MMIL_Process_Exams
fstools/fs_extract_tseries

% changed BOLD_MMIL_Extract_TSeries to do detrending, normalization, and
%   regression of motion parameters
% created fs_load_tseries for loading extracted tseries csv files
%   very similar to fs_load_regressors
% changed MMIL_Process_BOLD to pass skipTRs and mc_flag to
%   BOLD_MMIL_Extract_TSeries

% changed MEG_MMIL_GroupRCSE_Diff_Resamp to create auc plots

% changed MEG_MMIL_Group_RCSE to optionally do bootstrap resampling
% changed mmil_args_MEG_MMIL_Group_RCSE to allow resamp options
% changed MEG_MMIL_GroupRCSE_Contrast to accept and pass along resamp options

% changed MEG_MMIL_Group_RCSE to optionally use individual subject IRLS weights
%   with reweight_init_flag
% changed mmil_Args_MEG_MMIL_Group_RCSE and MEG_MMIL_GroupRCSE_Contrast

% changed ts_plot_responses to use roinames instead of area_names
% changed MEG_MMIL_GroupRCSE_Diff_Resamp
% created MEG_MMIL_dSROI_GroupAvg_Diff_Resamp
% changed ts_plot_wforms to apply baseline correction to points amplitude
% changed ts_wform_peaks so default peak_pol = 1
% changed ts_wform_onset to set end of time onset to nan

% changed MMIL_Analyze_MEG_Exam(s) to accept RCSE_prior_zscore_flag and
%   RCSE_prior_sem_min
% changed MEG_MMIL_RCSE to accept prior_zscore_flag and prior_sem_min
% changed rc_RCSE and rc_RCSE_func to accept prior_zscore_flag and prior_sem_min
% changed rc_extract_prior to get S_sem and S_sem_ref
% changed rc_RCSE_fit_waveforms to pass S_sem_ref to rc_calc_ref_absdiff
% changed rc_calc_ref_absdiff to use varargin, accept S_sem_ref, sem_min


% changed by Vijay:
U    MMPS/matlab/fstools/fs_load_mgh.m
A    MMPS/matlab/fstools/fs_reorient.m
U    MMPS/matlab/fstools/fs_save_mgh.m
U    MMPS/matlab/DTI_Stream/DTI_MMIL_Calc_DT.m
U    MMPS/matlab/EPI_Tools/EPI_ReorientVol.m
U    MMPS/matlab/EPI_Tools/EPI_Register_Scans.m
U    MMPS/matlab/DTI_Tools/DTI_EddyCurrCorr.m
U    MMPS/matlab/DTI_Tools/DTI_Correct_Data.m
U    MMPS/matlab/DTI_Tools/DTI_MotionCorr.m
U    MMPS/matlab/DTI_Tools/DTI_Fit_Tensor.m
U    MMPS/matlab/DTI_Tools/DTI_Calc_DTmeas.m
U    MMPS/matlab/MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m
U    MMPS/matlab/DTI_Utils/plot_DTI_quiv.m
U    MMPS/matlab/mmil_tools/mmil_jpdfreg2atl_T1T2.m
U    MMPS/matlab/mmil_tools/mmil_qmat_Siemens.m
U    MMPS/matlab/mmil_tools/mmil_sort_dicoms.m
A    MMPS/matlab/mmil_tools/mmil_qmat_Philips.m
U    MMPS/matlab/mmil_tools/mmil_classify_Philips.m
U    MMPS/matlab/mmil_tools/mmil_reg.m
U    MMPS/matlab/mmil_tools/mmil_jpdfreg2subj_T1T2.m

% rev 502

% changed MMIL_Analyze_BOLD_Exam(s), BOLD_MMIL_GLM_Analysis, and
%   BOLD_MMIL_Fourier_Analysis to change paint_dist to projdist,
%   paint_frac to projfrac, paint_frac_flag to projfrac_flag,
%   paint_frac_avg to projfrac_avg, paint_dist_avg to projdist_avg

% created BOLD_MMIL_Resting_Analysis
% changed fs_paint to accept 'sphere_ico'
% created fs_load_motion
% changed fs_detrend_vol to call fs_load_motion

% changed MEG_MMIL_GroupRCSE_Diff_Resamp to accept rootdir and fname_cond_info
%   as required input, removed ProjID and user and optional input

% created MEG_MMIL_GroupRCSE_DiffAreas_Resamp

% changed BOLD_MMIL_Resting_Analysis to calculate correlations

% created atlases.2012.03.09
% removed hatl_afm_0.mat, hatl_afm_1.mat, hatl_afm_2.mat
% moved BOLD_reg*.mat to BOLD_reg subdir
% moved DTI_reg*.mat to DTI_reg subdir
% moved *_jpdf.mat to jpdfs
% removed holland_atlasNLR from atlases
% removed utils/reorient_AAatlas.m
% removed MMIL_Tools/MMIL_Transform_to_Head_Atlas.m
% removed PreprocessHeadModel/rebuild_head_atlas.m
% moved bm_hatl_afm.mat and hist2d_target.mat to T1_Atlas subdir
%   added bm_hatl_afm.mgz, bm_hatl_afm_mask.mgz, bm_hatl_afm_maskBroad.mgz
% moved pitu_afm.mat to PITU subjdir
% removed PreprocessHeadModel/test_coregister_headmodel_scans.m
% removed PreprocessHeadModel/coregister_headmodel_scans.m 
% removed PreprocessHeadModel/dctMorph_Reg2Atlas_mmil.m
% removed PreprocessHeadModel/dctMorph_bm_Atlas.m
% removed PreprocessHeadModel/dctMorph_vol2hatl_amd.m
% removed MMIL_Tools/MMIL_NLReg2Atlas_dev.m
% changed MMIL_Tools/MMIL_Calculate_T1Ratio.m
%   to get hist2d_target from T1_Atlas subdir
% changed PreprocessHeadModel/dctMorph_SkullStrip_amd.m
%   to get bm_hatl_afm from T1_Atlas subjdir
% changed PITU/PITU_Convert_Exam to use 'PITU/pitu_afm' when
%   calling dctMorph_SkullStrip_amd
% removed PITU/PITU_tmp.m
% changed PITU/PITU_Modify_Brainmask to use T1_Atlas and PITU subdirs
% changed to use T1_Atlas subjdir:
%   mmil_tools/mmil_warp_to_atlas.m
%   mmil_tools/mmil_dct_reg_atlas.m
%   mmil_tools/mmil_dct_brainmask.m
%   DTI_Atlas/DTI_MMIL_AtlasTrack_Fibers_Exam.m
%   MMIL_Tools/MMIL_WarpToAtlas.m
% changed to use BOLD_reg subdir
%   atlases/init_jpdf_FSNU_BOLD.m
% changed to use DTI_reg subdir
%   atlases/reinit_jpdf_FSNU_DTI.m
% changed to use jpds subjdir:
%   atlases/init_jpdf_FLASHHI_FLASHLO.m
%   atlases/init_jpdf_FLASHHI_MPR.m
%   atlases/init_jpdf_FSNU_BOLD.m
%   atlases/init_jpdf_FSNU_DTI.m
%   atlases/init_jpdf_MEDICHI_MEDICLO.m
%   atlases/init_jpdf_MPR_FLASHHI.m
%   atlases/init_jpdf_MPR_FLASHLO.m
%   atlases/init_jpdf_MPR_GECAL.m
%   atlases/init_jpdf_MPR_MEDICHI.m
%   atlases/reinit_jpdf_FSNU_DTI.m
%   utils/Register_Func_to_Struct.m
%   mmil_tools/mmil_rbreg_vol2vol_jpdf.m
%   MMIL_Stream/MMIL_Process_PET_Exam.m
% renamed utils/Register_Func_to_Struct.m to
%   mmil_tools/mmil_atlas_jpdfreg_func2struct.m
% changed to use mmil_atlas_jpdfreg_func2struct:
%   atlases/init_jpdf_MPR_GECAL.m
%   utils/EstimateB1RxRatio_GECal.m
% renamed utils/EstimateB1RxRatio_GECal.m to mmil_tools/mmil_estimate_B1RxRatio_GECal.m
% renamed utils/EstimateB1RxRatio_ADNI.m to mmil_tools/mmil_estimate_B1RxRatio_ADNI.m
% changed to use mmil_estimate_B1RxRatio_GECal and mmil_estimate_B1RxRatio_ADNI:
%   MMIL_Tools/MMIL_Apply_MRI_Corrections.m

% changed by Vijay:
U    fstools/fs_reorient.m
U    MMIL_Stream/MMIL_Process_Exams.m
U    MMIL_Stream/MMIL_Process_Exam.m
U    MMIL_Stream/MMIL_Process_Structurals.m
U    MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m
U    MMIL_Tools/MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED.m
U    mmil_tools/mmil_jpdfreg2atl_T1T2.m
U    mmil_tools/mmil_qmat_Siemens.m
U    mmil_tools/mmil_classify_GE.m
U    mmil_tools/mmil_qmat_Philips.m
U    mmil_tools/mmil_reg.m
A    mmil_tools/mmil_qmat_GE.m
U    mmil_tools/mmil_average_volumes.m
U    mmil_tools/mmil_jpdfreg_T1T2.m
U    mmil_tools/mmil_jpdfreg2subj_T1T2.m
U    DTI_Stream/DTI_MMIL_Export_Data_for_FSL.m
U    DTI_Utils/DTI_load_qmat.m

% NOTES: 
%   1. important change to T2 to T1 jpdf registration
%      fixed problem with sub-millimeter shift in resampled T2 output
%      *improved accuracy of registration
%
%   2. important change for T1 rigid-registration to atlas
%     optional prereg to give more robust registration to atlas,
%     for more uniform head tilt in MPR_res and dct mask
%     option for using either mmil_reg or mmil_mriRegister

%   'STRUCT_oldreg_flag': [0|1] use old registration mmil_mriRegister
%     otherwise use mmil_reg in mmil_average_volumes
%     {default = 0}
%   'STRUCT_prereg_flag': [0|1] whether to use the pre-rigid registration.
%     {default = 1}  

% for backward compatibility:
%   STRUCT_oldreg_flag = 1, STRUCT_prereg_flag = 0

% rev 505

% changed atlases link to point to atlases.2012.03.09

% rev 506

% renamed MMIL_WarpToAtlas to mmil_warp_to_atlas
% renamed MMIL_WarpFromAtlas to mmil_warp_from_atlas
% changed to use mmil_warp_to_atlas:
%   AATL_Stream/aatl_brainmask.m
%   AATL_Stream/AATL_MMIL_WarpToAtlas_Exam.m
%   DTI_Atlas/DTI_MMIL_AtlasTrack_Fibers_Exam.m
%   DTI_Atlas/DTI_MMIL_WarpToAtlas_Exam.m

% changed by Vijay:
U    MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m
D    mmil_tools/mmil_reg_average_volumes.m
A    mmil_tools/mmil_average_volumes_old.m
D    mmil_tools/mmil_average_volumes.m
A    mmil_tools/mmil_average_volumes.m
U    MMIL_Stream/MMIL_Process_Exams.m
U    MMIL_Stream/MMIL_Process_Exam.m
U    MMIL_Stream/MMIL_Process_Structurals.m

% rev 510

% changed oldrev_avgflag to oldreg_flag:
%   MMIL_Stream/MMIL_Process_Exam.m
%   MMIL_Stream/MMIL_Process_Exams.m
%   MMIL_Stream/MMIL_Process_Structurals.m
%   MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m

% rev 511

% removed BOLD_Stream/BOLD_MMIL_Extract_TSeries.m
% changed MMIL_Stream/MMIL_Process_BOLD to use BOLD_MMIL_Resting_Analysis
%   with ico_flag = 0 and roi_cc_flag = 0

% changed MMIL_Analyze_BOLD_Exam(s) to use BOLD_MMIL_Resting_Analysis
% changed BOLD_MMIL_Fourier_Analysis and BOLD_MMIL_GLM_Analysis to accept 
%   surfname and mask_midbrain_flag and use mmil_parms2args for fs_paint
% added mask_midbrain_flag to MMIL_Analyze_BOLD_Exam(s)
%   and BOLD_MMIL_Resting_Analysis

% changed by Vijay:
U    MMPS/matlab/MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m
U    MMPS/matlab/mmil_tools/mmil_reg.m
U    MMPS/csh/fsl_dti_data.csh

% rev 514

% moved to MEG_Analysis:
%   MMPS/matlab/MEG_Analysis/MEG_MMIL_dSPM_RCSE.m
%   MMPS/matlab/MEG_Analysis/MEG_MMIL_dSROI.m
%   MMPS/matlab/MEG_Analysis/MEG_MMIL_dSPM.m
%   MMPS/matlab/MEG_Analysis/MEG_MMIL_GroupRCSE_DiffAreas_Resamp.m
%   MMPS/matlab/MEG_Analysis/MEG_MMIL_RCSE_GroupAvg.m
%   MMPS/matlab/MEG_Analysis/MEG_MMIL_GroupRCSE_Contrast.m
%   MMPS/matlab/MEG_Analysis/MEG_MMIL_GroupRCSE_Diff_Resamp.m
%   MMPS/matlab/MEG_Analysis/MEG_MMIL_Group_RCSE.m
%   MMPS/matlab/MEG_Analysis/MEG_MMIL_dSROI_GroupAvg_Diff_Resamp.m
%   MMPS/matlab/MEG_Analysis/MEG_MMIL_dSROI_GroupAvg.m
%   MMPS/matlab/MEG_Analysis/MEG_MMIL_RCSE.m

% rev 515

% changed MMIL_Import_MEG to have moveflag to use MaxMove option with maxfilter
% changed MMIL_Process_MEG_Exam(s) to pass maxmove options to MMIL_Import_MEG

% rev 516

% changed DTI_MMIL_Calc_FiberStats to remove todo comment (vol as meas)

% changed MMIL_Args to not check context against allowed context list
% created mmil_args_MMIL_Freesurfer_Recon_Exams
% changed MMIL_Freesurfer_Recon_Exams to accept ProjID, etc.
% changed MMIL_Freesurfer_Recon_Exam to accept FS_full_recon_flag, etc.
% changed REC_MMIL_Freesurfer_Recon_Exams to be a thin shell

% rev 517

% changed MMIL_Get_StudyInfo to accept user, pass to MMIL_Get_ProjInfo
% changed MMIL_Get_StudyInfo to pass numvec_tags to MMIL_Get_ProjInfo
% changed MMIL_Get_ProjInfo to accept user, set RootDirs.home
% changed mmil_args_MMIL_Get_StudyInfo to include 'user' in extra_tags


% changed by Vijay:
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exam.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Raw_MRI.m
U    MMPS/matlab/MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m

% changed by Cooper:
U    MMPS/matlab/MMIL_Tools/MMIL_Classify_MRIRAWDICOM.m
U    MMPS/matlab/mmil_tools/mmil_sort_dicoms.m
U    MMPS/matlab/mmil_tools/mmil_classify_dicoms.m

% rev 520

% bug fixes in MMIL_Freesurfer_Recon_Exam(s)

% changed ts_plot_avg; added title option
%   visible_flag, outstem, tif_flag, and eps_flag

% created mmil_imagesc
% changed rc_plot_errmap to use mmil_imagesc and return output struct

% changed by Steve Deiss
U    MMPS/matlab/timesurfer/plots/ts_ezplot.m
A    MMPS/matlab/timesurfer/plots/txthilite.m
U    MMPS/matlab/timesurfer/functions/ts_avg2fif.m
U    MMPS/matlab/timesurfer/functions/ts_ICAfit_manual.m
U    MMPS/matlab/timesurfer/functions/ts_freqband_average.m
U    MMPS/matlab/timesurfer/functions/ts_manualICA.m
A    MMPS/matlab/timesurfer/functions/VR_Reject
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Reject_Gui_functions
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Reject_Gui_functions/VR_Channel_enable.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Reject_Gui_functions/VR_Sum_points.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Reject_Gui_functions/VR_zoom_in_out.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Reject_Gui_functions/VR_GUI_instructions.odt
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Reject_Gui_functions/VR_update.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Reject_Gui_functions/VR_Restore.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Reject_Gui_functions/visual_reject_plotall_GUI.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Reject_Gui_functions/VR_Plot_lines.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Reject_Gui_functions/VR_Channel_disable.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/ts_manual_reject.m
U    MMPS/matlab/timesurfer/functions/ts_calc_combine_conditions.m
U    MMPS/matlab/timesurfer/functions/ts_statistics_wrapper.m
U    MMPS/matlab/timesurfer/functions/ts_data_selection.m
U    MMPS/matlab/timesurfer/functions/ts_epoch_data.m
U    MMPS/matlab/timesurfer/functions/ts_reject.m
U    MMPS/matlab/ts_iEEG/priv/ts_iEEG_neuroscan2avg.m
A    MMPS/matlab/utils/randperm.m
A    MMPS/matlab/utils/readtext.m
A    MMPS/matlab/utils/import_presentation_log.m

% changed by Vijay:
U    MMPS/matlab/MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m
U    MMPS/matlab/mmil_tools/mmil_qmat_Siemens.m
U    MMPS/matlab/mmil_tools/mmil_classify_GE.m
U    MMPS/matlab/mmil_tools/mmil_qmat_Philips.m
U    MMPS/matlab/mmil_tools/mmil_dct_brainmask.m

% rev 542

% removed utils/skullstrip_mghvol
% removed utils/deg2rad
% removed utils/read_curv
% removed utils/reorient_to_LIA

% reorganized documentation, added new manual, example scripts

% changed by Steve:
A    MMPS/matlab/timesurfer/functions/ntools_mods
A    MMPS/matlab/timesurfer/functions/ntools_mods/ntools_gen_epoch_data.m
D    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Reject_Gui_functions
D    MMPS/matlab/timesurfer/functions/VR_Reject/ts_manual_reject.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Channel_enable.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Sum_points.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_zoom_in_out.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_GUI_instructions.odt
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_update.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Restore.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/visual_reject_plotall_GUI.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Plot_lines.m
A    MMPS/matlab/timesurfer/functions/VR_Reject/VR_Channel_disable.m
A    MMPS/matlab/timesurfer/functions/ts_manual_reject.m
D    MMPS/matlab/utils/randperm.m
D    MMPS/matlab/utils/readtext.m
D    MMPS/matlab/utils/import_presentation_log.m

% changed by Vijay:
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exams.m
A    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Register_DTI_Exam.m
A    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Register_Exam.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Register_Exams.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_DTI_Exams.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_DTI_Exam.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Summarize_Long_DTI_Analysis.m
U    MMPS/parms/LONGDTI/T1_NonLinReg_Parms.txt

% rev 554

% removed old documentation dir

% rev 555

% changed rc_define_retmap_from_retfit to not use deg2rad

% changed mmil_imagesc to make colorbar optional (cbar_flag)
% changed rc_plot_errmap to pass cbar_flag to mmil_imagesc

% changed by Vijay:
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Register_Exam.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_DTI_Exams.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_Exams.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_Exam.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_DTI_Exam.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Summarize_Long_Analysis.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Summarize_Long_DTI_Analysis.m

% changed rc_plot_errmap to accept sign_flag and std_flag

% rev 557

% created ts_baseline_wforms
% changed ts_plot_wforms help to correctly state what baseline_flag values do
%   1=baseline each condition independently,
%   2=baseline average across conditions)

% changed default auc_range to [0,350] in:
MEG_MMIL_RCSE_GroupAvg
MEG_MMIL_Group_RCSE
ts_wform_auc

% changed MEG_MMIL_GroupRCSE_Err_Resamp and rc_plot_errmap to accept t0 and t1

% changed BOLD_MMIL_Resting_Analysis to accept bandpass_flag, etc. and
%   do bandpass filtering with ts_freq_filt

% changed BOLD_MMIL_Get_ScanInfo to organize into subfunctions and
%   to set fstem and fstemlist (and handle BOLD_SE scantype)

% changed to use fstem from ScanInfo and
%   to pass fnamestem to BOLD_MMIL_Get_ScanInfo:
BOLD_Stream/BOLD_MMIL_Register_to_T1.m
BOLD_Stream/BOLD_MMIL_Load_RegInfo.m
BOLD_Analysis/BOLD_MMIL_Get_SurfStats.m
BOLD_Analysis/BOLD_MMIL_GLM_Analysis.m
BOLD_Analysis/BOLD_MMIL_Fourier_Analysis.m
BOLD_Analysis/BOLD_MMIL_Resting_Analysis.m

% changed to use fstemlist from ScanInfo
BOLD_Stream/BOLD_MMIL_Export_Data.m
BOLD_Stream/BOLD_MMIL_Export_Data_for_FSL.m

% changed to pass fnamestem to BOLD_MMIL_Get_ScanInfo:
MMIL_Stream/MMIL_Process_BOLD.m
BOLD_Stream/BOLD_MMIL_Export_Data_for_FSL.m
BOLD_Stream/BOLD_MMIL_Export_Data.m
BOLD_Analysis/BOLD_MMIL_Set_GLM_Stem.m
BOLD_Analysis/BOLD_MMIL_Set_Fourier_Stem.m
BOLD_Analysis/BOLD_MMIL_GLM_ROI_Analysis.m
BOLD_Analysis/BOLD_MMIL_Combine_Fourier_Sessions.m
MMIL_Analysis/MMIL_Analyze_BOLD_Exam.m

% changed MMIL_Analysis/MMIL_Analyze_BOLD_Exam.m to
%   accept fnamestem and pass to downstream functions

% changed BOLD_Stream/BOLD_MMIL_Manual_Register_Override.m to
%   pass fnamstem to BOLD_MMIL_Load_RegInfo:

% changed by Steve:
U    MMPS/matlab/timesurfer/functions/ts_process_data.m
U    MMPS/matlab/timesurfer/functions/ts_epoch_data.m

% changed by Vijay:
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_DTI_Exams.m
U    MMPS/matlab/MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m
U    MMPS/matlab/mmil_tools/mmil_reg.m

% changed by Cooper:
U    MMPS/matlab/MMIL_Analysis/MMIL_Concat_SurfStats.m

% rev 564

% changed MMIL_Concat_Surfstats (just added todo comment)

% added timesurfer/external_mods/eeglab/loadcnt.m
%   changed to use mmil_isint instead of isint

% moved timesurfer/functions/VR_Reject to timesurfer/vr_reject
% moved timesurfer/functions/ntools_mods to timesurfer/external_mods/ntools_mods

% rev 565

% moved timesurfer/external_mods/ntools_mods to timesurfer/external_mods/ntools
% moved ts_fieldtrip to timesurfer/external_mods/fieldtrip
% moved ts_iEEG to timesurfer/ieeg
% moved timesurfer/ieeg/usr_functions/* timesurfer/ieeg

% rev 566

% moved nwhite_DSI_FOD to RDSI
% moved PreprocessHeadModel/dctMorph_SkullStrip_amd.m to utils
% removed PreprocessHeadModel

% rev 567

% changed MMIL_Process_Exam and warp_freesurfer_surface to
%   not use tmp_ver when calling fileparts

% changed by Steve:
D    MMPS/matlab/timesurfer/functions/ts_vis_reject.m
A    MMPS/matlab/timesurfer/functions/ts_crossing.m
U    MMPS/matlab/timesurfer/functions/ts_loadedf.m
U    MMPS/matlab/timesurfer/functions/ts_epoch_data.m
D    MMPS/matlab/timesurfer/ts_vis_reject.m

% rev 573

% updated version.NOTES for MMPS_226

% rev 574

#############################################################################
#############################################################################

## MMPS_227: medium revision
## Don Hagler 03/27/12

% added isint to external/eeglab5.01b/functions
%   (to make old change to loadcnt.m by Jason Sherfey work again)
% NOTE: this goes against standard practice to never change functions
%   in "external" dir, but eeglab adds several directories to top of path
%   which made timesurfer/external_mods/eeglab/loadcnt.m lower on path
%   than external/matlab/eeglab5.01b/functions/loadcnt.m

% removed executable property from several eeglab functions

% changed by Vijay:

U    MMPS/matlab/DTI_Stream/DTI_MMIL_Register_to_T1.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exams.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_DTI.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exam.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Structurals.m
U    MMPS/matlab/MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m
U    MMPS/matlab/MMIL_Tools/MMIL_Register_T2_to_T1.m
U    MMPS/matlab/DTI_Atlas/DTI_MMIL_AtlasTrack_Fibers_Exam.m
U    MMPS/matlab/mmil_tools/mmil_jpdfreg2atl_T1T2.m
U    MMPS/matlab/mmil_tools/mmil_warp_to_atlas.m
U    MMPS/matlab/mmil_tools/mmil_jpdfreg_T1T2.m
U    MMPS/matlab/mmil_tools/mmil_dct_reg_atlas.m
U    MMPS/matlab/mmil_tools/mmil_jpdfreg2subj_T1T2.m
U    MMPS/matlab/mmil_tools/mmil_dct_brainmask.m

% rev 581

% removed timesurfer/external_mods/eeglab/loadcnt.m

% rev 582

% changed BOLD_MMIL_Get_ScanInfo to initialize ScanInfo, SessInfo, and errcode
%   in get_info subfunction

% rev 583

% changed mmil_warp_to_atlas to add semicolon after fname_reg

% moved dctMoprh_SkullStrip_amd to ProjectMods

% created mmil_dct_morph
% changed mmil_dct_reg_atlas to use mmil_dct_morph
% changed T1atlasname to atlasname:
%   mmil_tools/mmil_dct_reg_atlas
%   mmil_tools/mmil_warp_to_atlas
%   mmil_tools/mmil_dct_brainmask
%   DTI_Stream/DTI_MMIL_Register_to_T1
%   MMIL_Stream/MMIL_Process_DTI
%   MMIL_Stream/MMIL_Process_Exam
%   MMIL_Stream/MMIL_Process_Exams
%   MMIL_Stream/MMIL_Process_Structurals
%   MMIL_Tools/MMIL_Register_T2_to_T1
%   MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes
%   mmil_tools/mmil_jpdfreg2atl_T1T2
%   mmil_tools/mmil_jpdfreg2subj_T1T2
%   mmil_tools/mmil_jpdfreg_T1T2

% changed DTI_Atlas/DTI_MMIL_AtlasTrack_Fibers_Exam to allow regFA_flag

% changed fs_load_mgh and fs_save_mgh to
%   use RandStream instead of rand('twister')

% changed DTI_MMIL_Analyze_Fibers to have default fiber_infix = 'fiber_countatlas'
% changed DTI_MMIL_AsegMask_Fibers to set fiberdir using atlastrack_dir
% changed DTI_MMIL_Analyze_Fibers_Exam

% created DTI_AtlasTrack based on DTI_MMIL_AtlasTrack_Fibers_Exam
% changed DTI_MMIL_AtlasTrack_Fibers_Exam to use DTI_AtlasTrack

% copied /home/dale/matlab_junk/MorphometryToolbox/2_Viewers/showVol.m to
%   /space/md10/8/svn/mmildev/dhagler/mmil/MMPS/matlab/ProjectsMods/showVol.m

% changed MMIL_Process_Exam to pass STRUCT_T1type and DTI_ATL_regFA_flag
%   to DTI_MMIL_AtlasTrack_Fibers_Exam as T1type and regFA_flag, respectively
% changed MMIL_Process_Exams to add DTI_ATL_regFA_flag

% changed DTI_MMIL_Analyze_Fibers_Exam to pass atlastrack_dir
%   to DTI_MMIL_Analyze_Fibers
% changed DTI_MMIL_Analyze_Fibers to accept atlastrack_dir
% changed to remove options/tags atl_tensor_smooth_sigma and first_only_flag:
%   DTI_MMIL_Set_FiberInfix (also use use simpler names)
%   DTI_MMIL_Analyze_Fibers_Exam
%   DTI_Analysis/DTI_MMIL_AsegMask_Fibers
%   DTI_Analysis/DTI_MMIL_Convert_Fibers_to_Segmentation
%   DTI_Stream/DTI_MMIL_Resample_Fibers
% changed DTI_MMIL_Resample_Fibers to accept atlastrack_dir
%   and changed name of fiber_dir_res for DTIStudio_fiber_masks input
%   to DTIStudio_fiber_masks_resT1
% changed DTI_MMIL_AsegMask_Fibers to update fiber_dir
% removed DTI_Stream_OLD/DTI_MMIL_AtlasNorm_Fibers_Exam
% changed DTI_MMIL_Convert_Fibers_to_Segmentation to use atlastrack_dir

% reverted changes to MMIL_Register_and_Resample_MRI_Volumes

% changed by Vijay:
U    MMPS/matlab/MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m

% rev 587

% changed MMIL_Register_and_Resample_MRI_Volumes to
%   use atlasname not T1atlasname

% created mmil_bandpass_vol; loops over slices to save memory
% changed BOLD_MMIL_Resting_Analysis to use mmil_bandpass_vol

% changed DTI_MMIL_AtlasTrackFibers_Exam and DTI_AtlasTrack to so
%   default flipz_flag = true

% changed by Vijay:
U    MMPS/matlab/MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exams.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exam.m

% changed by Trevor:
A    MMPS/documentation/MMPS_manual.pdf
U    MMPS/documentation/MMPS_manual.doc
A    MMPS/documentation/MMPS_manual.odt

% rev 592

% changed DTI_AtlasTrack to resample T1 to T1_resDTI

% rev 593

% changed DTI_AtlasTrack to set thresh to 0 if regFA_flag = 1
% changed mmil_dct_morph resample input volume to atlas resolution

% rev 594

% changed DTI_MMIL_Read_Fiber_Legend to accept optional fname
% created DTI_Render_AtlasTrack

% rev 595

% changed by Vijay: (to make default atlasname = 'T1_Atlas/T1atl')
U    MMPS/matlab/PITU/PITU_Modify_Brainmask.m
A    MMPS/matlab/fstools/fs_intensitycorr.m
U    MMPS/matlab/DTI_Stream/DTI_MMIL_Register_to_T1.m
U    MMPS/matlab/DTI_Stream/DTI_MMIL_AtlasTrack_Fibers_Exam.m
U    MMPS/matlab/DTI_Tools/DTI_AtlasTrack.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exams.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_DTI.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exam.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Structurals.m
U    MMPS/matlab/MMIL_Tools/MMIL_Apply_MRI_Corrections.m
U    MMPS/matlab/MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m
A    MMPS/matlab/MMIL_Tools/MMIL_nuCorr_Structurals.m
A    MMPS/matlab/MMIL_Tools/MMIL_GradUnwarp_Structurals.m
U    MMPS/matlab/MMIL_Tools/MMIL_Register_T2_to_T1.m
A    MMPS/matlab/MMIL_Tools/MMIL_B1Corr_Structurals.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Convert_Fibers_to_Segmentation.m
U    MMPS/matlab/ProjectsMods/dctMorph_SkullStrip_amd.m
U    MMPS/matlab/mmil_tools/mmil_jpdfreg2atl_T1T2.m
A    MMPS/matlab/mmil_tools/mmil_check_B1corr.m
U    MMPS/matlab/mmil_tools/mmil_warp_to_atlas.m
U    MMPS/matlab/mmil_tools/mmil_dct_morph.m
U    MMPS/matlab/mmil_tools/mmil_jpdfreg_T1T2.m
U    MMPS/matlab/mmil_tools/mmil_dct_reg_atlas.m
U    MMPS/matlab/mmil_tools/mmil_jpdfreg2subj_T1T2.m
U    MMPS/matlab/mmil_tools/mmil_dct_brainmask.m

% rev 602

% created atlases.2012.04.12 with new T1_Atlas/T1_atlas.mat (broad-masked version of old bm_hatl_afm)
%   plus FA_Atlas/EPDTI_FA_atlas.mat and T2_Atlas/EPDTI_b0_atlas.mat
% changed atlases link to "../atlases/atlases.2012.04.12"

% changed to make default atlasname = 'T1_Atlas/T1_atlas':
DTI_Stream/DTI_MMIL_AtlasTrack_Fibers_Exam.m
DTI_Stream/DTI_MMIL_Register_to_T1.m
DTI_Tools/DTI_AtlasTrack.m
MMIL_Stream/MMIL_Process_DTI.m
MMIL_Stream/MMIL_Process_Exam.m
MMIL_Stream/MMIL_Process_Exams.m
MMIL_Stream/MMIL_Process_Structurals.m
MMIL_Tools/MMIL_Register_T2_to_T1.m
MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m
PITU/PITU_Modify_Brainmask.m
ProjectsMods/dctMorph_SkullStrip_amd.m
mmil_tools/mmil_dct_brainmask.m
mmil_tools/mmil_dct_reg_atlas.m
mmil_tools/mmil_jpdfreg2atl_T1T2.m
mmil_tools/mmil_jpdfreg2subj_T1T2.m
mmil_tools/mmil_jpdfreg_T1T2.m
mmil_tools/mmil_warp_to_atlas.m

# NOTE: for backward compatibility (to re-use freesurfer edits),
#       must use STRUCT_atlasname = 'T1_Atlas/bm_hatl_afm'

% rev 603

% changed to use mmil_dct_brainmask instead of dctMorph_SkullStrip_amd:
mmil_tools/mmil_rbreg_vol2vol_mi.m
mmil_tools/mmil_rbreg_vol2vol_jpdf.m
mmil_tools/mmil_atlas_jpdfreg_func2struct.m
atlases/init_jpdf_FSNU_BOLD.m
PITU/PITU_Convert_Exam.m
MMIL_Tools/MMIL_Register_MRI_to_MRI.m
MMIL_Stream/MMIL_Process_PET_Exam.m

% removed dctMorph_SkullStrip_amd

% changed to remove oldregflag and related options (e.g. fname_mask) and code:
BOLD_Stream/BOLD_MMIL_Register_to_T1.m
DTI_Stream/DTI_MMIL_Register_to_T1.m
MMIL_Tools/MMIL_Register_T2_to_T1.m

% removed DTI_AtlasReg_to_T1

% rev 604

% changed ts_plot_wforms to accept fig_size and tif_dpi options

% changed rc_RCSE_retmap_from_retfit to fix bug with checking size of offsets

% changed to remove samp_dur option:
%   mmil_args_MEG_MMIL_Group_RCSE
%   mmil_args_MEG_MMIL_RCSE_GroupAvg
%   MEG_MMIL_GroupRCSE_Contrast
%   MEG_MMIL_Group_RCSE
%   MEG_MMIL_RCSE_GroupAvg

% changed so default t1 = 350, and to set time based on t0, t1, and sfreq
%   MEG_MMIL_Group_RCSE
%   MEG_MMIL_RCSE_GroupAvg

% changed MEG_MMIL_GroupRCSE_Diff_Resamp to allow empty infix
% renamed MEG_MMIL_Group_RCSE to MEG_MMIL_GroupRCSE
% renamed MEG_MMIL_GroupRCSE_Diff_Resamp to MEG_MMIL_RCSE_GroupAvg_Diff_Resamp
% renamed MEG_MMIL_GroupRCSE_DiffAreas_Resamp to MEG_MMIL_RCSE_GroupAvg_DiffAreas_Resamp
% renamed MEG_MMIL_GroupRCSE_Err_Resamp to MEG_MMIL_RCSE_GroupAvg_Err_Resamp
% changed MEG_MMIL_GroupRCSE_Contrast to call MEG_MMIL_GroupRCSE
% renamed mmil_args_MEG_MMIL_Group_RCSE to mmil_args_MEG_MMIL_GroupRCSE
% changed MMIL_Args to list MEG_MMIL_GroupRCSE
% changed to not require fname_cond_info:
%   MEG_MMIL_RCSE_GroupAvg_Diff_Resamp, MEG_MMIL_RCSE_GroupAvg_DiffAreas_Resamp
% created MEG_MMIL_RCSE_GroupAvg_Resamp
% changed ts_plot_responses to accept fig_size

% changed by Vijay:
U    MMPS/matlab/MMIL_Tools/MMIL_Register_T2_to_T1.m
U    MMPS/matlab/mmil_tools/mmil_jpdfreg2atl_T1T2.m
U    MMPS/matlab/mmil_tools/mmil_jpdfreg_T1T2.m
U    MMPS/matlab/mmil_tools/mmil_dct_brainmask.m
U    MMPS/matlab/mmil_tools/mmil_jpdfreg2subj_T1T2.m
U    MMPS/matlab/mmil_tools/mmil_check_B1corr.m

% changed by Steve:
U    MMPS/matlab/timesurfer/functions/ts_loadedf.m

% rev 609

% changed by Vijay:
U    MMPS/matlab/DTI_Tools/DTI_AtlasTrack.m
U    MMPS/matlab/mmil_utils/mmil_check_oblique.m
A    MMPS/matlab/DTI_Utils/DTI_Oblique_Test.m

% changed by Trevor (to allow tractoview to run on any machine):
A    MMPS/lib/qt-3.3.3
A    MMPS/lib/qt-3.3.3/libqt.so.3
A    MMPS/lib/qt-3.3.3/README
A    MMPS/lib/qt-3.3.3/libqt.so.3.3.3
D    MMPS/bin/tractoview
A    MMPS/bin/tractoview
A    MMPS/bin/tractoview_bin
A    MMPS/bin/tractoview.sh

% rev 611

% changed DTI_EddyCurrCorr so driftcorr is boolean, changed header

% changed ts_plot_wforms to allow color vectors (use 'Color' option for plot)

% changed MEG_MMIL_RCSE_GroupAvg_Resamp to accept xlim_wform option
%   removed wforms_time0 and wforms_time1 options
%   added fig_size, markersize, etc.
% changed MEG_MMIL_RCSE_GroupAvg_Diff_Resamp to accept fig_size, etc.
% changed MEG_MMIL_RCSE_GroupAvg_DiffAreas_Resamp to accept fig_size, etc.
% changed MEG_MMIL_dSROI_GroupAvg_Diff_Resamp to reorganize into subfunctions
%   accept fig_size, markersize, etc.
% changed ts_plot_responses to use tif_dpi
% changed MEG_MMIL_*Resamp to accept fontname

% changed ts_plot_wforms to make parms.time a rowvec

% changed MEG_MMIL_GroupRCSE to set plot_parms.time

% changed MMIL_Check_RootDirs to use getenv('HOME')

% changed to accept sign_flag:
%   MEG_MMIL_RCSE_GroupAvg_DiffAreas_Resamp
%   MEG_MMIL_RCSE_GroupAvg_Diff_Resamp
%   MEG_MMIL_dSROI_GroupAvg_Diff_Resamp

% changed to include roi and cond in results struct:
%   MEG_MMIL_RCSE_GroupAvg_Resamp
%   MEG_MMIL_RCSE_GroupAvg_DiffAreas_Resamp
%   MEG_MMIL_RCSE_GroupAvg_Diff_Resamp
%   MEG_MMIL_dSROI_GroupAvg_Diff_Resamp
% created timesurfer/functions/ts_summarize_resamp_results.m
% changed mmil_write_csv to not error if cell array entries are empty
% changed to accept csv_flag, call ts_summarize_resamp_results:
%   MEG_MMIL_RCSE_GroupAvg_Resamp
%   MEG_MMIL_RCSE_GroupAvg_DiffAreas_Resamp
%   MEG_MMIL_RCSE_GroupAvg_Diff_Resamp
%   MEG_MMIL_dSROI_GroupAvg_Diff_Resamp

% changed fs_load_mgh and fs_save_mgh back to using rand('twister') instead
%   of RandStream

% changed by Vijay:
U    MMPS/matlab/REC_Analysis/REC_MMIL_Analyze_DTI_Exams.m
U    MMPS/matlab/MMIL_Tools/MMIL_nuCorr_Structurals.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Calc_FiberStats.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Fibers.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Resample_Fibers.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_AsegMask_Fibers.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
U    MMPS/matlab/DTI_Atlas/DTI_MMIL_Average_Atlas_Fiber.m
U    MMPS/parms/DTI_Fiber_Legend.csv

% rev 614

% as mmildev, created atlases.2012.05.02, added fiber_subdivisions to DTI_Atlas
%   and replaced AllSubjects with new atlas created by Vijay from adults
%   differences: used masked dct target to avoid stretching near parietal
%                used nu correct for structurals

% changed atlases link to point to atlases.2012.05.02

% rev 615

% created mmil_rowvec and mmil_colvec
% changed ts_resamp_wforms and ts_summarize_resamp_results to output
%   pvals for ranges

% changed by Vijay:
U    MMPS/matlab/REC_Analysis/REC_MMIL_Summarize_DTI_Analysis.m
U    MMPS/matlab/DTI_Atlas/DTI_MMIL_Average_Atlas_Fiber.m

% rev 617

% changed mmil_csv2struct to replace '[\s();]' with '_' (not just ' ')
% changed MMIL_Read_StudyInfo and MMIL_Read_ProjInfo to use mmil_csv2struct

% changed rc_RCSE_reweight_lsq:
%   use rc_plot_sources instead of plot_sources
%   use rc_plot_fitvar_results instead of plot_fitvar_results
%   calculate errvec as average across contrasts; previously only first (low)

% changed rc_RCSE_fit_waveforms to apply weights to all contrasts
%   previously only first (low)

% changed MEG_MMIL_GroupRCSE to remove unused calculation of err

% changed by Steve:
U    MMPS/matlab/timesurfer/functions/ts_statistics_wrapper.m

% changed by Vijay:
U    MMPS/matlab/DTI_Tools/DTI_AtlasTrack.m

% rev 620

# NOTE: for backward compatibility (to re-use freesurfer edits),
#       must use STRUCT_nu_flag = 0

% changed DTI_Fit_Tensor; cosmetic, adding spaces around "="

% created mmil_quick_brainmask based on EPI_BrainMask
% changed EPI_BrainMask to use mmil_quick_brainmask

% changed DTI_Fit_Tensor to call mmil_quick_brainmask,
%   changed settings for final mask dilation to make mask bigger

% rev 621

% moved DTI_Stream_OLD/DTI_MMIL_Export_DTIstudio.m to
%   DTI_Stream/DTI_MMIL_Export_DTIstudio.m
% removed RDSI
% removed DTI_Stream_OLD
% removed DTI_Tools/DTI_Fit_FOD.m

% changed by Vijay:

U    EPI_Tools/EPI_Resample_Data.m
U    MMIL_Stream/MMIL_Process_Exams.m
U    MMIL_Stream/MMIL_Process_DTI.m
U    MMIL_Stream/MMIL_Process_Exam.m
U    DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
U    DTI_Analysis/DTI_MMIL_Analyze_Fibers.m

% rev 625

% fixed typo in DTI_Fit_Tensor (extra ,)

% rev 626

% changed DTI_Fit_Tensor to use ctx_mgh2ctx before calling mmil_quick_brainmask
% removed DTI_Fit_Tensor_TEST

% rev 627

% changed DTI_Fit_Tensor to correctly pass clip_edges_width

% rev 628

% created DTI_apply_b0_scale
% changed DTI_calc_b0_scale to use mmil_check_nargs
% changed DTI_Fit_Tensor to use DTI_apply_b0_scale
% changed DTI_Fit_Tensor to create dilate_brain_mask sub function

% rev 629

% changed DTI_Calc_DTmeas to add volmask_dilated to header,
%   changed nvox_ROI to nvox

% created DTI_params2tensor and DTI_tensor2params
% changed DTI_Calc_DTmeas to use DTI_params2tensor

% created based on code from Nate White:
%  RSI_Tools/RSI_Calc_MSmeas.m
%  RSI_Tools/RSI_Fit_MultiShell.m
%  RSI_Tools/RSI_SH_matrix.m
%  RSI_Tools/RSI_FOD_matrix.m

% rev 630

% renamed tensor2components to DTI_tensor2components
% renamed components2tensor to DTI_components2tensor
% changed DTI_tensor2components and DTI_components2tensor to
%   use mmil_check_nargs
% changed DTI_components2tensor to use code from DTI_tensor2params

% changed to use DTI_tensor2components instead of tensor2components:
DTI_Atlas/DTI_MMIL_Average_Atlas_Fiber.m
DTI_Utils/DTI_Rotate_Tensors.m
DTI_Utils/DTI_smfiber_tensor.m

% changed to use DTI_components2tensor instead of components2tensor:
DTI_Atlas/DTI_MMIL_Average_Atlas_Fiber.m
DTI_Tools/DTI_AtlasTrack.m
DTI_Tools/DTI_Calc_Eig.m
DTI_Utils/DTI_Rotate_Tensors.m
DTI_Utils/DTI_smfiber_tensor.m

% changed to use DTI_components2tensor instead of DTI_params2tensor
DTI_Tools/DTI_Calc_DTmeas.m
RSI_Tools/RSI_Calc_MSmeas.m

removed DTI_params2tensor, DTI_tensor2params

% rev 631

% created RSI_Utils directory, moved RSI_SH_matrix and RSI_FOD_matrix into it

% rev 632
% rev 633

% copied RSI_Tools/RSI_Fit_MultiShell.m to DTI_Tools/DTI_Fit_MultiTensor.m
% copied RSI_Tools/RSI_Calc_MSmeas.m to DTI_Tools/DTI_Calc_MDTmeas.m
% renamed RSI_Tools/RSI_Fit_MultiShell.m to RSI_Tools/RSI_Fit_FOD.m
% renamed RSI_Tools/RSI_Calc_MSmeas.m to RSI_Tools/RSI_Calc_FODmeas.m

% rev 634
% rev 635

% renamed RSI_Tools/RSI_Fit_FOD.m to RSI_Tools/RSI_Fit_MultiFOD.m
% renamed RSI_Tools/RSI_Calc_FODmeas.m to RSI_Tools/RSI_Calc_MFmeas.m

% changed RSI_Calc_MFmeas to remove multi-tensor fits
% changed RSI_Fit_MultiFOD to remove multi-tensor fits
% changed RSI_Calc_MFmeas to remove restricted tensor measures
% created RSI_Calc_rDTmeas to calculate restricted tensor measures

% removed DTI_Tools/DTI_Fit_MultiTensor.m and DTI_Tools/DTI_Calc_MDTmeas.m

% created RSI_Tools/RSI_Synth_Vol.m

% changed DTI_Calc_DTMeas to use volmask_dilated

% rev 636

% changed RSI_Fit_MultiFOD to correctly scale Q matrix by bvals

% created RSI_Convert_MFmeas

% renamed load_dat to DTI_load_dat
% renamed save_dat to DTI_save_dat
% renamed dat2mgh to DTI_dat2mgh
% renamed mgh2dat to DTI_mgh2dat
% changed DT_mgh2dat, DTI_save_dat, DTI_dat2mgh, DTI_load_dat
%   to give actual errors, use mmil_check_nargs
% changed DTI_mgh2dat to allow frames as input
% changed to call DTI_load_dat:
%   DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exam.m
%   DTI_Utils/DTI_track_fibers.m
% changed to call DTI_save_dat:
%   DTI_Utils/DTI_Fiber_Path_to_Mask.m
%   DTI_Utils/DTI_track_fibers.m
% changed DTI_Fiber_Path_to_Mask to use mmil_check_nargs
% changed to call DTI_mgh2dat:
%   DTI_Tools/DTI_Convert_DTmeas.m
%   RSI_Tools/RSI_Convert_MFmeas.m

% rev 637

% changed RSI_Tools/RSI_Synth_Vol to accept options for adding isotropic
% removed RSI_Tools/RSI_Calc_rDTmeas

% rev 638

% removed fstools/fs_reorient_vol.m
% changed fs_reorient to return if in_orient is same as out_orient
% changed DTI_MMIL_Export_Data to use fs_reorient
% changed DTI_MMIL_Export_Data_for_FSL to add spaces before "="
% changed DTI_MMIL_Load_Data to correctly set default for min_ndirs and min_bval
% changed DTI_MMIL_Get_ScanInfo to add scans to DT_snums if
%   revflag==1 and ismember(pepolar,[1,3]);  choose B0uw_refs_rev if
%   ismember(pepolar,[1,3])

% created DTI_CSD_Tracto
% changed DTI_MMIL_CSD_Tracto_Exam to use DTI_MMIL_Load_Data and DTI_CSD_Tracto

% changed DTI_MMIL_Export_Data to use outdir instead of out_dir,
%   orient instead of out_orient, outstem instead of out_stem,
%   outtype instead of out_type
% changed DTI_MMIL_Export_Data_for_FSL to use outdir instead of out_dir
% changed MMIL_Process_DTI to pass outdir and orient to DTI_MMIL_Export_Data
% changed MMIL_Process_DTI to pass outdir to DTI_MMIL_Export_Data_for_FSL
% changed DTI_MMIL_Export_Data to flipx, etc. based on orient and orient_ref=LPS
% changed MMIL_Process_Exam to pass orient instead of out_orient to
%   DTI_MMIL_CSD_Tracto_Exam

% rev 639

% changed DTI_Read_DTIStudio_Fiber to create header with creation date

% rev 640
% rev 641

% removed parms/RSI/*.mat

% rev 642

% removed parms/RSI
 
% rev 643

% renamed DTI_Fiber_Path_to_Mask to DTI_fiber_path_to_mask
% renamed DTI_Read_DTIStudio_Fiber to DTI_read_DTIStudio_fiber
% changed DTI_MMIL_Import_DTIStudio_Fibers_Exam to call DTI_fiber_path_to_mask
% changed DTI_fiber_path_to_mask to call DTI_read_DTIStudio_fiber
% changed DTI_read_DTIStudio_fiber to reformat, change fiber structure fields
% changed DTI_fiber_path_to_mask to change fiber structure fields
% created DTI_write_DTIStudio_fiber
% created DTI_CSD_to_DTIStudio_fiber

% changed DTI_MMIL_Analyze_Fibers_Exam and DTI_AtlasTrack to set flipx_flag,
%   flipy_flag, and flipz_flag according to orient and orient_ref=LPS

% rev 644

% changed DTI_CSD_Tracto to call DTI_CSD_to_DTIStudio_fiber and to
%   save TractMask as CSD_fiber_count.mgz

% changed DTI_AtlasTrack to rename some variables related to fiber division
%   and combination, make some parms accessible to user, only divide fibers
%   if they are in parms.fibers, only combine fibers if they are in parms.fibers

% rev 645

% changed MMIL_Process_Exam(s) to fix errors and style problems in header

% rev 646

% changed DTI_CSD_Tracto to swap x and y dims in data volume, not qmat

% changed DTI_dat2mgh to update header

% changed DTI_MMIL_Get_ScanInfo to add parentheses to correctly set snums_DT
% created DTI_FACT_Tracto

% changed bin/tractoview.sh, commenting out all echo statements
%   and redirecting output of ldd to /dev/null

% changed DTI_CSD_Tracto to get fiber count from fiber path

% changed DTI_CSD_to_DTIStudio_fiber to subtract 0.5 (voxels)
%   from fiber coordinates

% changed by Vijay:
U    MMPS/matlab/DTI_Tools/DTI_Render_AtlasTrack.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Calc_FiberStats.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Convert_Fibers_to_Segmentation.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Resample_Fibers.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_Compile_ROIs.m
U    MMPS/matlab/DTI_Analysis/DTI_MMIL_AsegMask_Fibers.m
U    MMPS/matlab/REC_Analysis/REC_MMIL_Summarize_DTI_Analysis.m
U    MMPS/matlab/REC_Analysis/REC_MMIL_Analyze_DTI_Exams.m
U    MMPS/matlab/MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
U    MMPS/parms/DTI_Fiber_Legend.csv

% rev 649

% created view_fibers.csh (new wrapper for tractoview)

% created DTI_Utils/DTI_select_fibers.m

% rev 650

% created RSI_Utils/RSI_plot_FOD.m

% moved DTI_Utils/fast_interp1.m to mmmil_utils/mmil_fast_interp1.m
% changed DTI_EddyCurrCorr to use mmil_fast_interp1

% moved DTI_Utils/plot_DTI_quiv.m to DTI_Utils/DTI_plot_quiv.m
% moved DTI_Utils/plot_DTI_FA.m to DTI_Utils/DTI_plot_FA.m
% moved DTI_Utils/plot_DTI_cmap.m to DTI_Utils/DTI_plot_cmap.m
% moved DTI_Utils/plot_DTI_vals.m to DTI_Utils/DTI_plot_vals.m
% removed from DTI_Utils:
%   map_q2ico.m DTI_map_qmat2ico.m make_icoqmat.m
%   uicmd_icoplot_data.m, uicmd_icoplot_model.m

% changed to add mgz_flag to allow mgh extension:
%   RSI_Convert_MFmeas, RSI_Convert_FODmeas, DTI_Convert_DTmeas

% changed header of fs_resample_mgh
% renamed fs_resample_mgh to fs_resample_frames
% changed MEG_MMIL_dSROI_GroupAvg to reference fs_resample_frames,
%   not fs_resample_mgh
% changed ts_surf2movie to call fs_resample_frames,
%   not fs_resample_surf (which does not exist)
%   other style-related changes

% changed mmil_construct_M to switch upper(parms.orient)

% changed EPI_Resample_Data
%   to correctly calculate offset when using std_orient
%   to use interpm for resampling the EPI data
%   to change the header
%   to use mmil_smooth3d

% created mmil_resample
% changed mmil_smooth3d to set vol_out to real, convert input to single
%   if orig_type is not, convert output to double if that was orig_type
% changed mmil_estimate_B1RxRatio_GECal to give errors and WARNINGs, not ERRORs
% changed to use mmil_smooth3d and not use abs or real around it, not
%   convert back and forth between double and single:
%    AATL_Stream/aatl_brainmask.m
%    BOLD_Tools/BOLD_Correct_Data.m
%    DTI_Atlas/DTI_MMIL_Average_Atlas_Fiber.m
%    DTI_Utils/DTI_smfiber_tensor.m
%    EPI_Tools/EPI_Resample_Data.m
%    MMIL_Analysis/MMIL_Analyze_Long_DTI_Exam.m
%    MMIL_Tools/MMIL_Register_MRI_to_MRI.m
%    PITU/PITU_Modify_Brainmask.m
%    ctx_utils/ctx_Register_and_Normalize_Volumes.m
%    ctx_utils/ctx_get_gwtype.m
%    fstools/fs_erode_aseg.m
%    mmil_tools/mmil_dct_brainmask.m
%    mmil_tools/mmil_estimate_B1RxRatio_ADNI.m
%    mmil_tools/mmil_estimate_B1RxRatio_GECal.m
%    EPI_Tools/EPI_Resample_Data.m
%    ctx_utils/ctx_get_gwtype.m
%    fstools/fs_erode_aseg.m
%    fstools/fs_tal2surf.m
%    mmil_tools/mmil_dct_brainmask.m
%    mmil_tools/mmil_dilate_mask.m
%    mmil_tools/mmil_resample.m
% removed utils/smooth3d.m

% moved utils/smooth1d.m to mmil_utils/mmil_smooth1d.m
% moved utils/smooth2d.m to mmil_utils/mmil_smooth2d.m
% changed to use mmil_smooth2d:
%    rcse/functions/rc_retfit_func.m

% changed by Steve:
A    MMPS/matlab/timesurfer/functions/ts_addscript.m
A    MMPS/matlab/timesurfer/functions/ts_uncollapse.m
A    MMPS/matlab/timesurfer/functions/ts_collapse.m
U    MMPS/matlab/timesurfer/functions/ts_epoch_data.m

% rev 655

% changed DTI_plot_vals, DTI_plot_quiv, DTI_plot_FA, DTI_plot_cmap
%   to update headers

% rev 656

% changed MMIL_Check_RootDirs to try 10 times with 0.5 sec pause between attempts
%   before exiting with error because a RootDir does not exist
%   (have had file i/o problems with many jobs submitted simultaneously)

% changed by Vijay:
U    MMPS/matlab/REC_Analysis/REC_MMIL_Summarize_DTI_Analysis.m

% rev 658

% changed DTI_MMIL_AtlasTrack_Fibers_Exam to set thresh_prob and thresh_FA
%   depending on locflag, countflag, threshFAflag, etc.
%   changed thresh_prob when locflag = 1 (exchanged values for threshFAflag = 1 or 0)
% changed DTI_AtlasTrack to remove threshFAflag, simply use input
%   thresh_FA and thresh_prob

% changed mmil_dct_reg_atlas to use 'volmask' if found in atlas file
%   otherwise get volmask from 'bm' as usual

% changed DTI_CSD_Tract and DTI_FACT_Tracto to have empty outstem by default

% changed mmil_csv2struct to exclude columns with empty headers,
%   replace \? and - with _, and replace _+ with _

% changed mmil_save_sparse and mmil_load_sparse to return if ~mmil_check_nargs
% created mmil_utils/mmil_sparse2mgh.m

% changed DTI_MMIL_AtlasTrack_Fibers_Exam
%   to remove flipx_flag, flipy_flag, flipz_flag

% changed DTI_AtlasTrack
%   accept save_mgz_flag and convert sparse to mgz
%   use forceflag in divide_fibers and combine_fibers subfunctions
%   created subfunctions warp_fiber_from_atlas, warp_tensor_from_atlas,
%     calc_prob_dir, and calc_DTmeas_from_atlas
%   allow path_suffix option to replace default

% changed mmil_sparse2mgh to return fname_mgh
% changed DTI_tract_fibers to allow FA and V0 to have .mat extension
%   removed use of mrparms
%   removed _path from file name

% rev 659

% created parms/DTI_Fiber_Subdivisions_Legend.csv
% created documentation/AtlasTrack with info from Chris Pung
%   on fiber subdivisions in atlas space
% created atlases.2012.05.22 containing fiber subdivisions

% rev 660

% changed mmil_tools/mmil_resample.m to fix minor bugs

% rev 661

% changed to accept verbose_flag (default = 0):
%   DTI_Convert_DTmeas
%   RSI_Convert_MFmeas
%   RSI_Convert_FODmeas

% changed DTI_FACT_Tracto to pass outstem 'fiber_path' instead of 'fiber'

% changed mmil_dct_reg_atlas to fix bug (removed bad comma)

% rev 662

% changed DTI_AtlasTrack to not accept divide_fibers, to assume subdiv_fibers
%   is a vector, and to get fibernum from floor(subdiv_fibernum/10)

% changed by Steve:
U    MMPS/matlab/timesurfer/functions/ts_epoch_data.m

% changed by Vijay:
A    MMPS/matlab/MMIL_Stream/MMIL_QC_Exam.m
A    MMPS/matlab/MMIL_Stream/MMIL_QC_Exams.m
A    MMPS/matlab/mmil_args/mmil_args_MMIL_QC_Exam.m
U    MMPS/matlab/MMIL_Utils/MMIL_Args.m
A    MMPS/parms/DTI_FiberQC_Orientation.csv

% rev 665

% changed render_AtlasTrack.csh, view_fibers.csh, DTI_select_fibers.m

% changed by Vijay:
U    MMPS/matlab/DTI_Stream/DTI_MMIL_AtlasTrack_Fibers_Exam.m
U    MMPS/matlab/DTI_Tools/DTI_AtlasTrack.m
U    MMPS/matlab/MMIL_Stream/MMIL_QC_Exam.m
U    MMPS/matlab/MMIL_Stream/MMIL_QC_Exams.m
D    MMPS/matlab/mmil_args/mmil_args_MMIL_QC_Exam.m
U    MMPS/matlab/MMIL_Utils/MMIL_Args.m
U    MMPS/parms/DTI_FiberQC_Orientation.csv

% rev 670

% changed DTI_AtlasTrack
%   set volsz_DTI to volsz_V0(1:3), etc.

% rev 671

% changed DTI_AtlasTrack
%   for combining fibers, compare against union(fibers,subdiv_fibers)

% rev 672

% changed DTI_AtlasTrack
%   for combining fibers, if divide_fibers_flag = 0, only compare against fibers

% rev 673

% changed EPI_Resample_Data to recalculate offset using M_ref
%   even when std_orient not empty

% changed by Vijay:
U    MMPS/matlab/DTI_Tools/DTI_AtlasTrack.m

% rev 675

% renamed fs_voxsize_from_M to fs_voxsize
% changed to use fs_voxsize:
%   BOLD_Tools/BOLD_Correct_Data.m
%   mmil_tools/mmil_dct_brainmask.m
%   mmil_tools/mmil_resample.m

% changed mmil_resample to recalculate offset using M_ref
%   even when orient not empty

% rev 676

% changed MMIL_Process_Exam to use mmil_mkdir, to not check if batchname is
%   empty

% rev 677

#############################################################################
#############################################################################

## MMPS_228: minor revision
## Don Hagler 05/27/12

% updated version.NOTES with notes on MMPS_227

% rev 678

% changed BOLD_MMIL_Resting_Analysis to use "tmp" instead of "~" for unused
%   return arguments (not compatible with earlier matlab versions)

% changed DTI_read_DTIStudio_fiber to initialize pxyzChain as empty
%   use type 'single', and clear variables

% changed DTI_CSD_to_DTIStudio_fiber to initialize pxyzChain as empty
%   use type 'single', and clear variables

% changed mmil_jpdfreg2atl_T1T2, mmil_jpdfreg2subj_T1T2, mmil_jpdfreg_T1T2
%   for small, style issues (~mmil_args2parms)

% rev 679

% added by Vijay:
U    MMPS/matlab/MMIL_Stream/MMIL_QC_Exam.m
U    MMPS/matlab/MMIL_Stream/MMIL_QC_Exams.m
A    MMPS/matlab/mmil_utils/mmil_subplots.m

% rev 680

% changed RSI_Synth_Vol to accept 'rFOD_nscales' option

% rev 681

% changed mmil_subplots to check forceflag early, added clim option

% rev 682

% changed RSI_Synth_Vol to use correct number of parameters for nscales>1

% changed DTI_select_fibers to trim streamlines as they exit terminal ROIs

% changed mmil_subplots to remove spaces around individual images

% changed by Vijay:
U    MMPS/matlab/DTI_Stream/DTI_MMIL_Calc_DT.m
U    MMPS/matlab/DTI_Tools/DTI_Calc_DTmeas.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exams.m
U    MMPS/matlab/MMIL_Stream/MMIL_QC_Exam.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_DTI.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exam.m
U    MMPS/matlab/MMIL_Stream/MMIL_QC_Exams.m

% changed by Steve:
U    MMPS/matlab/timesurfer/functions/ts_epoch_data.m

% rev 686

% changed MMIL_Process_Exam(s) to use unpackflag

% rev 687

% changed DTI_Calc_DTmeas to make mask_flag optional

% rev 688

% changed MEG_MMIL_GroupRCSE and rc_RCSE_reweight_lsq so that
%   max is used if leverage_max_flag = 1

% created ts_dSPM_prep_forward, ts_dSPM_init_fiterr, ts_dSPM_set_chans,
%   ts_dSPM_calc_scalefacts, ts_dSPM_save_results, ts_dSPM_write_stc,
%   ts_dSPM_write_mgh, ts_dSPM_apply_inverse, ts_dSPM_data_scalematrix
% changed ts_dSPM to call new functions

% changed fs_erode_aseg to use "error" not "ERROR"
% created fs_resample_aseg
% changed fs_extract_aseg_tseries to use fs_resample_aseg
% changed fs_erode_mask to use mmil_smooth3d
% changed DTI_Utils/DTI_smoothfiber.m to use mmil_smooth3d
% created fs_extract_wm_tseries
% changed fs_detrend_vol to remove unused forceflag
% created fs_regress_tseries
% changed BOLD_MMIL_Resting_Analysis to add wm_flag, use fs_extract_wm_tseries
%   and fs_regress_tseries

% changed by Vijay:
U    MMPS/matlab/DTI_Stream/DTI_MMIL_AtlasTrack_Fibers_Exam.m

% rev 690

% changed fs_extract_aseg_tseries and fs_extract_wm_tseries to erode
%   after resampling to BOLD resolution
% changed BOLD_MMIL_Resting_Analysis so default aseg_erode_flag = 0

% rev 691

% changed mmil_args_MMIL_Analyze_BOLD_Exams to include 'RST' in arg_groups
% changed MMIL_Analyze_BOLD_Exams to include 'RST' in header NOTE
% changed MMIL_Analyze_BOLD_Exam(s) to accept more RST options including
%   bandpass, wm_flag, wm_erode_flag, aseg_erode_flag, etc.
% created MMIL_Analyze_rsBOLD_Exams

% rev 692

% changed DTI_MMIL_Export_Data to fix bug
%   (use of parms.dir instead of parms.outdir)
%   use mmil_mkdir, mmil_isrelative

% changed BOLD_MMIL_Ready_RefFit to set tags after parms.subjdir

% created mmil_usage and mmil_rsync in mmil_utils

% rev 693

% changed rc_write_viewscript to not use offscreen render because of error:
%   error while loading shared libraries: libtix8.1.8.3.so: cannot open shared object file: No such file or directory

% changed mmil_args_BOLD_MMIL_Read_RetFit to add forceflag to extra_tags
% changed MMIL_RetFit_BOLD_Exam to accept forceflag, not RF_forceflag
% changed MMIL_RetFit_BOLD_Exams to pass forceflag to MMIL_RetFit_BOLD_Exam,
%   not use RF_forceflag
% changed rc_ready_retfit to set forceflag in run_retfit script
%   based on parms.forceflag

% changed by Vijay:
U    MMPS/matlab/DTI_Tools/DTI_Correct_Data.m

% rev 695

% changed rc_retfit_func to check parms to make sure prereg parms are within
%   bounds
% changed rc_retfit_func to create new subfunctions
% changed rc_retfit_func to accept map_poly_flag, map_poly_order, map_poly_coef,
%   and map_poly_coef_range, and to include polynomial transformation
% changed rc_retfit to accept map_poly_flag, map_poly_order, map_poly_coef,
%   and map_poly_coef_range
% changed rc_ready_retfit and BOLD_MMIL_Ready_RetFit to accept
%   map_poly_flag, map_poly_order, and map_poly_coef_range
% changed MMIL_RetFit_BOLD_Exam(s) to accept RF_map_poly_flag,
%   RF_map_poly_order, and RF_map_poly_coef_range
% changed rc_retfit_func to only include variable parameters in beta

% changed DTI_select_fibers to constrain streamline coordinates to be less than
%   or equal to volsz

% rev 696

% updated MMPS_manual.doc, MMPS_manual.odt, and MMPS_manual.pdf from cjpung

% rev 697

% changed MMIL_RetFit_BOLD_Exam(s) default values for parameters
%   RF_map_radial_wedge_fact_range, RF_map_scale_u_range, RF_map_scale_v_range,
%   RF_map_wedge_fact_range,RF_map_v1_length_range, RF_map_v2_length_range,
%   RF_map_v3_length_range, RF_niter, RF_map_poly_flag, RF_map_poly_order
% changed BOLD_MMIL_Ready_RetFit, rc_ready_retfit, rc_retfit, rc_retfit_func
%   default values for corresponding parameters

% rev 698

% changed BOLD_MMIL_Resting_Analysis to allow wm_flag to be 1 or 2, allow
%   extraction of wm tseries but not regress out, put extraction
%   and regression in separate subfunctions
% changed MMIL_Analyze_rsBOLD_Exams, MMIL_Analyze_BOLD_Exam(s) accordingly

% changed fs_aseg_roi to also calculate median

% removed DTI_Stream/DTI_MMIL_Set_FOD_fstem.m

% removed utils/compute_scalefact_hist1d_amd and utils/histmean2d
%   (unused in MMPS)

% changed to add axes_linewidth option:
%   ts_plot_wforms, ts_plot_responses, MEG_MMIL_RCSE_GroupAvg,
%   MEG_MMIL_RCSE_GroupAvg_Resamp, MEG_MMIL_RCSE_GroupAvg_DiffAreas_Resamp,
%   MEG_MMIL_RCSE_GroupAvg_Diff_Resamp

% changed BOLD_MMIL_Resting_Analysis and MMIL_Analyze_rsBOLD_Exams to
%   accept mc_flag as 0, 1, or 2
% changed MMIL_Analyze_BOLD_Exam to pass mc_flag as either 0 or 2 to
%   BOLD_MMIL_Resting_Analysis
% changed BOLD_MMIL_Resting_Analysis and MMIL_Analyze_rsBOLD_Exams to
%   accept mc_bandpass_flag

% rev 699

% created mmil_aseg_analysis
% changed fs_erode_aseg to use "nvoxels" instead of "sigma", loop over nvoxels
% changed fs_aseg_roi and fs_erode_aseg to use varargin
% changed DTI_MMIL_Analyze_Aseg_Exam to use mmil_aseg_analysis,
%         extract values for nu.mgz resampled to DTI resolution
%         include 'outdir' option with 'DTI_aseg_analysis' as default
%           relative to ContainerPath if not full path
%         removed FOD references
% created DTI_MMIL_Create_Aseg_Mask to create brainmask and xcg mask in DTI space

% created mmil_gauss, mmil_gauss_err, mmil_gauss_lfit, mmil_gauss_nlfit,
%   mmil_gauss_irls, mmil_gauss2, mmil_gauss2_eval, mmil_gauss2_err,
%   mmil_gauss2_nlfit, mmil_gauss2_irls

% changed to use 'key',value pairs, exchange position of segname and funcname
%     when calling fs_aseg_roi:
%   MMIL_Analysis/MMIL_Analyze_Long_Exam.m
%   MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
%   REC_Analysis/REC_MMIL_Analyze_PET_Exam.m
%   fstools/fs_extract_aseg_tseries.m

% changed to use 'key',value pairs, use nvoxels instead of sigma
%    when calling fs_erode_aseg:
%   MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
%   fstools/fs_extract_aseg_tseries.m

% changed fs_erode_mask to use varargin, nvoxels instead of sigma

% changed to use 'key',value pairs, use nvoxels instead of sigma
%    when calling fs_erode_mask:
%   MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
%   fstools/fs_extract_wm_tseries.m

% changed to use erode_nvoxels instead of erode_sigma:
%   BOLD_Analysis/BOLD_MMIL_Resting_Analysis.m
%   MMIL_Analysis/MMIL_Analyze_BOLD_Exam.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exams.m \
%   MMIL_Analysis/MMIL_Analyze_Long_Exam.m
%   MMIL_Analysis/MMIL_Analyze_Long_Exams.m
%   MMIL_Analysis/MMIL_Analyze_MRI_Exams.m
%   MMIL_Analysis/MMIL_Analyze_rsBOLD_Exams.m
%   MMIL_Analysis/MMIL_Compile_Long_Analysis.m
%   MMIL_Analysis/MMIL_Compile_MRI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_Long_Analysis.m

% changed to use erode_nvoxels and remove FOD-related parameters:
%   MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
% changed MMIL_Analyze_DTI_Exams to use excl_tags instead of tags
%   use updated tags for aseg and mask
% changed MMIL_Analyze_DTI_Exam to put tags in parms
%   run DTI_MMIL_Create_Aseg_Mask

% changed DTI_MMIL_Manual_Register_Override to remove stray ' that would
%   have caused error
% changed DTI_MMIL_Analyze_Fibers_Exam to use tags in parms

% changed to remove FOD references:
%   DTI_Stream/DTI_MMIL_Manual_Register_Override.m
%   DTI_Analysis/DTI_MMIL_Analyze_CortSurf_Exam.m
%   DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
%   DTI_Analysis/DTI_MMIL_Calc_FiberStats.m
%   DTI_Analysis/DTI_MMIL_Compile_ROIs.m
%   DTI_Analysis/DTI_MMIL_Summarize_Aseg.m
%   DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
%   MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m

% rev 700

% changed MMIL_Process_BOLD and MMIL_Process_DTI to only set
%   fname_for and fname_ref if B0unwarp_flag=1

% rev 701

% changed by Vijay:
U    MMPS/matlab/MMIL_Stream/MMIL_Process_DTI.m
U    MMPS/matlab/MMIL_Stream/MMIL_QC_Exam.m
A    MMPS/matlab/EPI_Tools/EPI_iNorm_B0uw.m

% changed BOLD_MMIL_Resting_Analysis
%   to name wm_tseries.mat file with outstem
%   to set fname_motion = [] if mc_flag~=2

% rev 704

% changed ts_freq_filt to catch error where upper frequency limit is too high
%   gives WARNING message and clips values to limits
%   added zpad_flag option to pad with zeros on each end

% changed DTI_MMIL_Load_Data to add subfunction set_revflag_list
%   that is a copy of DTI_set_revflag_list
%   (sets revflag_list to 0 or 1 if revflag = 2 for integrated scans)
% changed MMIL_Process_DTI to add subfunction set_revflag_list
%   that is a modified version of DTI_set_revflag_list that sets
%   revflag_list = [0,1] if revflag = 2
% changed MMIL_Process_DTI to add subfunction set_qmat
%   use revflag, not parms.revflag when deciding whether to set qmat = []
% removed DTI_set_revflag_list

% changed mmil_bandpass_vol and BOLD_MMIL_Resting_Analysis to pass 1
%   as zpad_flag when calling ts_freq_filt

% changed rc_synth_sensors_from_RCSE to accept sources matrix

% removed rc_plot_crosstalk
% created rc_calc_crosstalk

% rev 705

% removed rc_plot_RCSE_fields
% renamed rc_plot_ret_fields to rc_plot_fields
% changed rc_plot_fields to use mmil_args2parms, ts_plot_vv_field
% created ts_plot_vv_field
% changed rc_plot_fields to use ts_plot_vv_field
% removed ts_plot_ring_fields
% renamed ts_fieldplot_avg to ts_plot_fields
% changed ts_plot_field to be very similar to rc_plot_fields
%   except only allows a single condition

% changed mmil_barh to correct help (barwidth not bar_width) and to
%   add legend_loc option

% changed rc_plot_sources to fix missing parms. with err_samp_dur

% changed mmil_subplots
%   check if files exist earlier
%   create outdir if necessary using mmil_mkdir
%   allow slice_fract option

% renamed MEG_MMIL_RCSE_GroupAvg_Err_Resamp to
%   MEG_MMIL_RCSE_GroupAvg_ErrMap_Resamp

% changed MEG_MMIL_RCSE_GroupAvg to save time courses of fit and err variance

% created new MEG_MMIL_RCSE_GroupAvg_Err_Resamp for err time course

% created  MEG_MMIL_RCSE_GroupAvg_Err_Resamp based on
%   MEG_MMIL_RCSE_GroupAvg_Resamp

% changed MEG_MMIL_RCSE_GroupAvg_Resamp to remove unnecessary ",:"
%   when indexing wforms

% changed by Steve Deiss:
A    MMPS/matlab/timesurfer/functions/ts_equate_conds.m
U    MMPS/matlab/timesurfer/functions/ts_data_selection.m
A    MMPS/matlab/timesurfer/functions/ts_bipolar.m
U    MMPS/matlab/timesurfer/functions/ts_manual_reject.m
U    MMPS/matlab/timesurfer/ts_groupavg.m
A    MMPS/matlab/timesurfer/ts_equate_conds.m

% changed by Vijay:
U    MMPS/matlab/EPI_Tools/EPI_iNorm_B0uw.m
U    MMPS/matlab/DTI_Tools/DTI_Correct_Data.m

% rev 717

% changed EPI_iNorm_B0uw to fix style issues with header

% rev 718

% changed mmil_reg to fix style issues with header
% changed EPI_Register_Scan to change wording of header

% renamed mmil_M2x to mmil_M_mat2vec, changed to return rotation
%   as clockwise
% changed mmil_check_oblique to use mmil_M_mat2vec, changed header
% moved mmil_construct_M to mmil_utils, changed to do y rotation clockwise
%   to be consistent with existing x and z rotations

% created BOLD_Estimate_Motion

% changed EPI_EstimateB0 and EPI_OptimizeB0 to use mmil_mkdir
% changed EPI_OptimizeB0 so output text file has "lambda2" not "lamda2"

% changed BOLD_MMIL_Resting_Analysis; added todo notes

% rev 719

% changed MMIL_Analyze_BOLD_Exam(s) and mmil_args_MMIL_Analyze_BOLD_Exams
%   to remove RST

% changed BOLD_MMIL_Resting_Analysis and MMIL_Analyze_rsBOLD_Exams
%   to use corr_roi_flag, corr_roi_ico_flag, and corr_ico_flag instead of
%     roi_cc_flag, ico_roi_flag, and ico_cc_flag
%   to change how output files are names (common outstem)
%   to create symbolic link when only a single data file
%   to accept corr_outfix and roi_outfix

% changed EPI_OptimizeB0 to adjust description of lambda2_vec in header
% changed default kernelWidthMax_vec to [25,30,35] and 
%                 lambda2_vec to [1100,1500,1900] in
%   BOLD_Tools/BOLD_Correct_Data.m
%   DTI_Tools/DTI_Correct_Data.m
%   EPI_Tools/EPI_OptimizeB0.m
%   MMIL_Stream/MMIL_Process_BOLD.m
%   MMIL_Stream/MMIL_Process_DTI.m
%   MMIL_Stream/MMIL_Process_Exam.m
%   MMIL_Stream/MMIL_Process_Exams.m

% changed by Steve Deiss:
A    MMPS/matlab/timesurfer/external_mods/fieldtrip/read_data.m
A    MMPS/matlab/timesurfer/external_mods/fieldtrip/read_biosig_header.m
A    MMPS/matlab/timesurfer/external_mods/fieldtrip/read_biosig_data.m
A    MMPS/matlab/timesurfer/external_mods/fieldtrip/preprocessing.m
A    MMPS/matlab/timesurfer/external_mods/fieldtrip/read_header.m
U    MMPS/matlab/timesurfer/functions/ts_loadedf.m

% rev 723

% renamed ts_resamp_wforms to ts_bootstrap_wforms, removed code for permutation,
%   significant time ranges, added bias correction and acceleration

% changed to use ts_bootstrap_wforms, remove bootstr_flag, jackknife_flag,
%   sign flag, disable ranges:
%  MEG_Analysis/MEG_MMIL_RCSE_GroupAvg_DiffAreas_Resamp.m
%  MEG_Analysis/MEG_MMIL_RCSE_GroupAvg_Diff_Resamp.m
%  MEG_Analysis/MEG_MMIL_RCSE_GroupAvg_Err_Resamp.m
%  MEG_Analysis/MEG_MMIL_RCSE_GroupAvg_Resamp.m
%  MEG_Analysis/MEG_MMIL_dSROI_GroupAvg_Diff_Resamp.m

% rev 724

% changed ts_bootstrap_wforms to set pval to lowest pval if val is less than
%   crit_vals_lo(1) or greater than crit_vals_hi(1)

% changed ts_wform_peaks to accept resfact, resample wforms to higher temporal
%   resolution so latencies are less jumpy
% changed ts_bootstrap_wforms, MEG_MMIL_RCSE_GroupAvg_DiffAreas_Resamp,
%   MEG_MMIL_RCSE_GroupAvg_Diff_Resamp, MEG_MMIL_RCSE_GroupAvg_Err_Resamp,
%   MEG_MMIL_RCSE_GroupAvg_Resamp, and MEG_MMIL_dSROI_GroupAvg_Diff_Resamp
%   to accept resfact with default = 10

% changed fs_tal2annot to create ctab file with random colors if not supplied
% changed fs_tal2annot, fs_tal2labels, fs_tal2surf to use/pass verbose
% changed fs_find_neighbors to use/accept verbose (defauult = 0)

% changed EPI_UnwarpB0 to use fs_vol_match
% changed EPI_UnwarpB0, EPI_EstimateB0, and EPI_OptimizeB0
%   to set orig_orient if swapxy_flag = 1

% changed by Hauke Bartsch
U    MMPS/matlab/mmil_tools/mmil_classify_GE.m

% rev 726

% changed fs_surf_roi_avg and fs_extract_aparc_tseries
%   to accept verbose (default = 0)

% changed BOLD_MMIL_Resting_Analysis to:
%   accept arbitrary number of fnames_aparc
%   save seed_roinames_full
%   exclude surf ROIs with name containing 'unknown'
%   use Fisher's r to z transformation
%   calculate mean motion for each scan and average across scans
%   calculate variance across time for aparc, aseg, and ico
%   save image of ROI correlations
%   accept revflag and pass to BOLD_MMIL_Get_ScanInfo

% changed MMIL_Analyze_rsBOLD_Exams to acept revflag

% removed utils/cmap_* (redundant with colormap_* functions)

% changed BOLD_MMIL_Get_ScanInfo to use parms.revflag to set fstem if BOLD_ape

% rev 727

% changed BOLD_MMIL_Resting_Analysis to accept fname_points and run fs_tal2annot

% rev 728

% changed MMIL_Analyze_rsBOLD_Exams to accept fname_points

% rev 729

% created BOLD_Tools/BOLD_UnwarpB0.m

% changed EPI_EstimateB0 and EPI_OptimizeB0 to not get ver from fileparts

% changed BOLD_Correct_Data to use BOLD_UnwarpB0, reorganized into subfunctions,
%   pass tshift options to BOLD_MotionCorr

% rev 730

% changed BOLD_MotionCorr to set outdir from fname_out,
%   make tmpdir relative to outdir, use mmil_mkdir

% changed BOLD_Correct_Data to revise header,
%   removed redundant fname_ref and ref_frame

% changed MMIL_Process_BOLD to add motion_B0uw_flag, motion_B0uw_iters,
%   min_trans, min_rot

% changed BOLD_TShift to set outdir from fname_out,
%   make tmpdir relative to outdir, use mmil_mkdir

% changed EPI_GradUnwarp to set outdir from fname_out, use mmil_mkdir

% changed MMIL_Process_Exam and MMIL_Process_Exams to add BOLD_motion_B0uw_flag,
%   BOLD_motion_B0uw_iters, BOLD_min_trans, BOLD_min_rot

% changed MMIL_Process_BOLD to document outfix
% changed MMIL_Process_Exam to document BOLD_outfix, pass to MMIL_Process_BOLD
% changed MMIL_Process_Exams to accept BOLD_outfix

% changed mmil_load_mgh_info to accept outdir
% changed BOLD_UnwarpB0 to use mmil_load_mgh_info
% changed BOLD_Correct_Data to set fname_motion_B0uw to be in outdir

% rev 731

% changed BOLD_Corect_Data and BOLD_UnwarpB0 to check that tmpdir exists
%   before trying to delete

% cosmetic changes to:
%   MMIL_nuCorr_Structurals, MMIL_GradUnwarp_Structurals, 
%   MMIL_B1Corr_Structurals, and MMIL_Apply_MRI_Corrections

% changed MMIL_Process_Exams to accept DCM_classify_file and look for
%   file in ProjInfo if empty, then pass to MMIL_Process_Exam
% changed MMIL_Process_Exam to accept DCM_classify_file, pass to 
%   MMIL_Process_Raw_MRI instead of series_classify_file
% changed MMIL_Process_Exam to use subfunctions

% rev 732

#############################################################################
#############################################################################

## MMPS_230: major revision
## Don Hagler 09/10/12

% changed MMIL_Set_Common_RootDirs to set 'orig' instead of 'tmp'
% changed MMIL_Process_Exam to:
%   put code from MMIL_Import_Raw_MRI into subfuction
%   put code from MMIL_Process_Raw_MRI into subfunction
% removed MMIL_Import_Raw_MRI and MMIL_Process_Raw_MRI
% renamed MMIL_Classify_MRIRAWDICOM to MMIL_Classify_Dicoms
%   changed MMIL_Process_Exam, MMIL_Classify_Exams

% renamed MMIL_Convert_MRIRAWDICOM_to_MRIPROCESSED to MMIL_Convert_MRIRAW_to_MRIPROC
% renamed MMIL_Convert_MRIRAWNONDICOM_to_MRIPROCESSED to MMIL_Convert_NonDicom_MRIRAW_to_MRIPROC
% renamed MMIL_Unpack_DICOM_Dir_to_Container to MMIL_Unpack_Dicoms
% renamed MMIL_Unpack_NONDICOM_Dir_to_Container to MMIL_Unpack_NonDicoms

% changed MRIRAWDICOM to MRIRAW:
%   MMIL_Stream/MMIL_Classify_Exams.m
%   MMIL_Stream/MMIL_Process_Exam.m
%   MMIL_Stream/MMIL_Process_Exams.m
%   MMIL_Tools/MMIL_Status_Report.m
%   MMIL_Tools/MMIL_Unpack_Dicoms.m
%   MMIL_Tools/MMIL_Unpack_NonDicoms.m
%   MMIL_Utils/MMIL_Check_StudyInfo.m
%   MMIL_Utils/MMIL_Check_StudyInfo.m
%   MMIL_Utils/MMIL_Get_Container.m
%   REC_Stream/REC_MMIL_Classify_Exams.m
%   REC_Stream/REC_MMIL_Status_Report_MRI.m

% changed MMIL_PreProcess_Exam to call MMIL_Unpack_Dicoms and MMIL_Classify_Dicoms
% changed MMIL_RootDirs_from_ProjInfo to remove support for old style rootdirs
% changed REC_MMIL_Status_Report_MRI to use RootDirs instead of ProjInfo

% changed MRIPROCESSED to MRIPROC:
%   MMIL_Stream/MMIL_Process_Exam.m
%   MMIL_Stream/MMIL_Process_Exams.m
%   MMIL_Tools/MMIL_Convert_MRIRAW_to_MRIPROC.m
%   MMIL_Tootls/MMIL_Convert_NonDicom_MRIRAW_to_MRIPROC.m
%   MMIL_Tools/MMIL_Status_Report.m
%   MMIL_Utils/MMIL_Get_Container.m
%   REC_Stream/REC_MMIL_Status_Report_MRI.m
%   MMIL_Stream/MMIL_Create_BEM_Exam.m
%   MMIL_Stream/MMIL_Freesurfer_Recon_Exam.m
%   MMIL_Stream/MMIL_Process_BOLD.m
%   MMIL_Stream/MMIL_Process_DTI.m
%   MMIL_Stream/MMIL_Process_First.m
%   MMIL_Stream/MMIL_Process_Structurals.m
%   MMIL_Stream/MMIL_QC_Exams.m
%   MMIL_Tools/MMIL_Apply_MRI_Corrections.m
%   MMIL_Tools/MMIL_B1Corr_Structurals.m
%   MMIL_Tools/MMIL_Get_Gradwarp_Signature.m
%   MMIL_Tools/MMIL_GradUnwarp_Structurals.m
%   MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m
%   MMIL_Tools/MMIL_Viewer.m
%   MMIL_Tools/MMIL_nuCorr_Structurals.m
%   MMIL_Utils/MMIL_Choose_T1.m
%   PETutils/ADNI_MMIL_Build_MRI_hist.m
%   REC_Stream/REC_MMIL_Status_Report_MRI.m
%   atlases/init_jpdf_FLASHHI_FLASHLO.m
%   atlases/init_jpdf_FLASHHI_MPR.m
%   atlases/init_jpdf_FSNU_DTI.m
%   atlases/init_jpdf_MEDICHI_MEDICLO.m
%   atlases/init_jpdf_MPR_FLASHHI.m
%   atlases/init_jpdf_MPR_FLASHLO.m
%   atlases/init_jpdf_MPR_GECAL.m
%   atlases/init_jpdf_MPR_MEDICHI.m
%   atlases/reinit_jpdf_FSNU_DTI.m
%   atlases/reinit_jpdf_FSNU_DTI.m
%   utils/rm_all_empty_files.m &

% renamed MMPS/perl/myrename to MMPS/perl/rename_files

% changed FREESURFERRECON to FSURF and FREESURFERICO to FSICO:
%   AATL_Stream/AATL_MMIL_AutoMask_Exams.m
%   AATL_Stream/AATL_MMIL_Average_BrainMask.m
%   AATL_Stream/AATL_MMIL_Average_SurfVals.m
%   AATL_Stream/AATL_MMIL_Average_r_bound.m
%   AATL_Stream/AATL_MMIL_Average_thick.m
%   AATL_Stream/AATL_MMIL_Freesurfer_Remake_Exams.m
%   AATL_Stream/AATL_MMIL_RigidRegToAtlas_Exams.m
%   AATL_Stream/AATL_MMIL_SetRootDirs.m
%   AATL_Stream/AATL_MMIL_Vol2Surf_Exams.m
%   AATL_Stream/AATL_MMIL_WarpToAtlas_Exams.m
%   BOLD_Analysis/BOLD_MMIL_Resting_Analysis.m
%   BOLD_Stream/BOLD_MMIL_Export_Data_for_FSL.m
%   DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
%   MMIL_Analysis/MMIL_Get_SurfStats.m
%   MMIL_Stream/MMIL_Create_BEM_Exam.m
%   MMIL_Stream/MMIL_Freesurfer_Recon_Exam.m
%   MMIL_Stream/MMIL_IcoResamp_FSRecon_Exam.m
%   MMIL_Stream/MMIL_Process_Exam.m
%   MMIL_Tools/MMIL_Status_Report.m
%   MMIL_Tools/MMIL_Viewer.m
%   MMIL_Utils/MMIL_Get_Container.m
%   MMIL_Utils/MMIL_Import_MRI_QC.m
%   REC_Analysis/REC_MMIL_Summarize_CortThick_forPET.m
%   REC_Analysis/REC_MMIL_Summarize_Volume_forPET.m
%   REC_Analysis/REC_MMIL_SurfGroupAvg_CortThick.m
%   REC_Analysis/REC_MMIL_SurfGroupAvg_CortThick_forPET.m
%   REC_Analysis/REC_MMIL_SurfGroupAvg_PET.m
%   REC_Stream/REC_MMIL_Export_MRI_QC.m
%   REC_Stream/REC_MMIL_Process_PET_Exams.m
%   REC_Stream/REC_MMIL_Status_Report_MRI.m
%   REC_Stream/REC_MMIL_Status_Report_PET.m
%   atlases/init_jpdf_FSNU_DTI.m
%   atlases/reinit_jpdf_FSNU_DTI.m
%   atlases/reinit_jpdf_FSNU_DTI.m

% changed REC_MMIL_Status_Report_MRI to remove FS4 status check

% rev 733

% changed MMIL_Convert_MRIRAW_to_MRIPROC to not convert BOLD or DTI
% created MMIL_Convert_MRIRAW_to_DTIPROC
% created MMIL_Convert_MRIRAW_to_BOLDPROC

% changed MMIL_Process_Exams to accept STRUCTflag
% changed MMIL_Process_Exam to:
%   accept STRUCTflag
%   call MMIL_Convert_MRIRAW_to_DTIPROC and MMIL_Convert_MRIRAW_to_BOLDPROC
%   use parms.Containers and parms.ContPaths structs
%   set RootDirs fields depending on ContainerType

% changed code and/or header to include proc_dti and proc_bold:
%   MMIL_Utils/MMIL_Set_Common_RootDirs.m
%   MMIL_Utils/MMIL_RootDirs_from_ProjInfo.m
%   MMIL_Utils/MMIL_Check_StudyInfo.m
%   MMIL_Utils/MMIL_Check_ProjID.m
%   MMIL_Utils/MMIL_Get_Container.m
%   MMIL_Utils/MMIL_Get_StudyInfo.m
%   MMIL_Utils/MMIL_Check_RootDirs.m

% changed MMIL_Check_RootDirs to set proc_dti and proc_bold to proc if empty

% changed to include proc_bold instead of proc
% and/or use BOLDPROC instead of MRIPROC:
%   MMIL_Stream/MMIL_Process_BOLD.m
%   BOLD_Stream/BOLD_MMIL_Get_ScanInfo.m
%   BOLD_Stream/BOLD_MMIL_Export_Data.m
%   BOLD_Stream/BOLD_MMIL_Export_Data_for_FSL.m
%   BOLD_Stream/BOLD_MMIL_Register_to_T1.m
%   MMIL_Analysis/MMIL_SurfGroupGLM_BOLD.m
%   MMIL_Analysis/MMIL_SurfGroupAvg_BOLD.m
%   MMIL_Analysis/MMIL_RetFit_BOLD_Exams.m
%   MMIL_Analysis/MMIL_Combine_Retinotopy_Exams.m
%   MMIL_Analysis/MMIL_Analyze_BOLD_Exams.m
%   MMIL_Analysis/MMIL_Analyze_BOLD_Exam.m
%   BOLD_Analysis/BOLD_MMIL_Get_SurfStats.m
%   BOLD_Analysis/BOLD_MMIL_GLM_ROI_GroupAvg.m
%   BOLD_Analysis/BOLD_MMIL_Average_Retinotopy.m
%   BOLD_Analysis/BOLD_MMIL_Combine_Fourier_Sessions.m
%   BOLD_Analysis/BOLD_MMIL_Fourier_Analysis.m
%   BOLD_Analysis/BOLD_MMIL_GLM_Analysis.m
%   BOLD_Analysis/BOLD_MMIL_Resting_Analysis.m

% changed DTI_Oblique_Test to use RootDir instead of PROC_ContainerPath

% changed to include proc_dti instead of proc
% and/or use DTIPROC instead of MRIPROC:

%   MMIL_Stream/MMIL_Process_DTI.m
%   DTI_Stream/DTI_MMIL_Convert.m
%   DTI_Stream/DTI_MMIL_Get_ScanInfo.m
%   DTI_Stream/DTI_MMIL_Register_to_T1.m
%   MMIL_Longitudinal/MMIL_Long_Setup_Exams.m
%   MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
%   DTI_Stream/DTI_MMIL_Check_StudyInfo.m
%   DTI_Atlas/DTI_MMIL_Average_Atlas_Fiber.m
%   DTI_Atlas/DTI_MMIL_Average_Atlas_Fibers.m
%   DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exam.m
%   DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exams.m
%   DTI_Atlas/DTI_MMIL_WarpToAtlas_Exams.m
%   DTI_Stream/DTI_MMIL_Convert.m
%   DTI_Utils/DTI_Oblique_Test.m

% changed to use FSContainerPath for regT1 if T1ContainerPath empty:
%   MMIL_Stream/MMIL_Process_BOLD.m
%   MMIL_Stream/MMIL_Process_DTI.m

% changed MMIL_nuCorr_Structurals to correctly group forceflag with ~exist

% changed DTI_MMIL_WarpToAtlas_Exams and DTI_MMIL_Import_DTIStudio_Fibers_Exams
%   to loop over StudyInfo (not dirs) and
%   use mmil_write_script instead of mmil_write_tags

% changed DTI_MMIL_Average_Atlas_Fibers:
%   changed parms_all to parms_filter
%   put valid inclusions modes into parms_filter
%   remove section of code checking VisitIDs, etc.
%   added required_containers = {'proc_dti'}, removed required_rootdirs
%   added qcflag = 1
%   check inclusion_modes against groups

% changed DTI_MMIL_Average_Atlas_Fiber:
%   removed check of QC
%   removed inclusion_mode
%   removed ATLDIR, replaced with outdir (default = pwd)

% changed MMIL_Check_ProjID accept user
%   updated mmil_args_MMIL_Check_ProjID

% rev 734

% changed to rename Difdirs to diffdirs:
%   DTI_Stream/DTI_MMIL_Get_ScanInfo.m
%   DTI_Stream/DTI_MMIL_Load_Data.m
%   DTI_Utils/DTI_load_qmat.m
%   mmil_tools/mmil_classify_GE.m
%   mmil_tools/mmil_classify_Philips.m
%   mmil_tools/mmil_classify_Siemens.m
%   mmil_tools/mmil_classify_dicoms.m

% created in MMPS/matlab/mmil_convert:
%   mmil_GE.m
%   mmil_Philips.m
%   mmil_Siemens.m
%   mmil_convert_DTI_GE.m
%   mmil_convert_DTI_Philips.m
%   mmil_convert_DTI_Siemens.m
%   mmil_convert_FMAP_GE.m
%   mmil_convert_FMAP_Siemens.m
%   mmil_serinfo_mrparms.m
%   mmil_set_ContainerInfo.m
%   mmil_write_ScanInfo.m
%   mmil_serinfo_dims.m
%   mmil_serinfo_FOV.m
%   mmil_check_series.m
%   mmil_check_nimgs_mismatch.m
%   mmil_convert_structural.m
%   mmil_convert_MEDIC.m
%   mmil_convert_GEB1CAL.m
%   mmil_convert_B1.m

% changed MMIL_Save_ContainerInfo to update header
% created MMIL_Save_ContainerInfo_ScanInfo to attach ScanInfo to ContainerInfo

% changed to create subfunctions and use new mmil_convert functions:
%   MMIL_Convert_MRIRAW_to_DTIPROC
%   MMIL_Convert_MRIRAW_to_BOLDPROC
%   MMIL_Convert_MRIRAW_to_MRIPROC

% changed MMIL_Convert_NonDicom_MRIRAW_to_MRIPROC to have same cntr fields
%   as MMIL_Convert_MRIRAW_to_MRIPROC

% changed mmil_estimate_B1RxRatio_ADNI to accept
%   BCmstem,BCpstem,HCmstem,HCpstem

% changed MMIL_B1Corr_Structurals to pass BCmstem,BCpstem,HCmstem,HCpstem
%   with scan numbers 1 and 2

% changed by Steve Deiss:
U    MMPS/matlab/timesurfer/external_mods/fieldtrip/freqanalysis.m
U    MMPS/matlab/timesurfer/functions/ts_freqband_average.m

% rev 737

% changed MMIL_Apply_MRI_Corrections to:
%   remove hidden parameters
%   give "ERROR" message and return, not error if errcode

% changed BOLD_Correct_Data to use mmil_load_mgh_info instead of fs_read_header

% changed MMIL_B1Corr_Structurals to add manufacturers and manufacturers_corr
%   as hidden parameters (to exclude Philips)
% changed MMIL_GradUnwarp_Structurals to:
%   give errcode=1 if missing gradwarpinfo
%   loop over suffixlist = {'B1',''}, break after first
% changed MMIL_nuCorr_Structurals to add 'B1' to suffixlist

% rev 738

% changed to remove FODmeaslist and FODscalefacts:
%   REC_MMIL_Analyze_DTI_Exams
%   REC_MMIL_Summarize_DTI_Analysis

% rev 739

% changed to copy extra tags, including manufacturer
% from ContainerInfo to SessInfo:
%   DTI_MMIL_Get_ScanInfo.m
%   BOLD_MMIL_Get_ScanInfo.m

% changed to only warn about missing gradwarpinfo if ~mmil_Philips(SessInfo):
%   MMIL_Process_DTI.m
%   MMIL_Process_BOLD.m

% rev 740

#############################################################################
#############################################################################

## MMPS_231: medium revision
## Don Hagler 09/13/12

% changed default kernelWidthMax_vec to [25,31,35] (only odd are allowed):
%   BOLD_Tools/BOLD_Correct_Data.m
%   BOLD_Tools/BOLD_UnwarpB0.m
%   DTI_Tools/DTI_Correct_Data.m
%   EPI_Tools/EPI_OptimizeB0.m
%   MMIL_Stream/MMIL_Process_BOLD.m
%   MMIL_Stream/MMIL_Process_DTI.m
%   MMIL_Stream/MMIL_Process_Exam.m
%   MMIL_Stream/MMIL_Process_Exams.m

% changed MMIL_Convert_MRIRAW_to_MRIPROC to replace 'Xeta2' with 'XetaT2'

% changed BOLD_MergeAPE to not set fname_motion_out if fname_motion_rev is empty

% changed MMIL_Process_BOLD to put try/catch around BOLD_MergeAPE

% changed MMIL_nuCorr_Structurals to separate check for existence of fname_in
%   and existence of fname_out (to avoid repeating nu correction on non-uw)

% changed to require proc_dti, not proc:
%   MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
%   DTI_Analysis/DTI_MMIL_Summarize_Fibers.m
%   DTI_Analysis/DTI_MMIL_Summarize_CortSurf.m
%   DTI_Analysis/DTI_MMIL_Summarize_Aseg.m
%   DTI_Analysis/DTI_MMIL_Calc_FiberStats.m
%   DTI_Analysis/DTI_MMIL_Compile_ROIs.m

% changed mmil_sort_dicoms to handle dicoms with multiple SeriesInstanceUIDs

% rev 741

% removed utils/rowvec.m and utils/colvec.m

% replaced uses of colvec with mmil_colvec:
%   MMIL_Analysis/MMIL_Concat_SurfStats.m
%   MMIL_Analysis/MMIL_Summarize_MRI_DTI_csv.m
%   MMIL_Analysis/MMIL_SurfGroupAvg_BOLD.m
%   rcse/rc_retfit.m

% replaced uses of rowvec with mmil_rowvec:
%   DTI_Tools/DTI_Fit_Tensor.m
%   MEG_Analysis/MEG_MMIL_RCSE_GroupAvg.m
%   MEG_Analysis/MEG_MMIL_dSROI_GroupAvg.m
%   MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
%   REC_Analysis/REC_MMIL_SurfGroupAvg_CortThick.m
%   REC_Analysis/REC_MMIL_SurfGroupAvg_CortThick_forPET.m
%   REC_Analysis/REC_MMIL_SurfGroupAvg_PET.m
%   fstools/fs_calc_fwhm.m
%   fstools/fs_thresh_surfstats.m
%   rcse/functions/rc_analyze_wforms.m
%   timesurfer/functions/ts_mgh2sourcecov.m
%   timesurfer/functions/ts_synth_sensors_from_dSPM.m
%   timesurfer/functions/ts_wform_auc.m
%   timesurfer/functions/ts_wform_onset.m
%   timesurfer/plots/ts_plot_wforms.m

% rev 742

% replaced uses of rowvec with mmil_rowvec:
mmil_tools/mmil_classify_GE.m
mmil_tools/mmil_detect_gradwarp.m
mmil_utils/mmil_merge_args.m

% replaced uses of colvec with mmil_colvec:
%   MMIL_Analysis/MMIL_SurfGroupGLM_BOLD.m
%   mmil_tools/mmil_quick_brainmask.m

% changed mmil_tools/mmil_write_regscripts.m to replace "mmmil" with "mmil"

% changed to use ext = '.mgz':
%   mmil_convert_structural
%   mmil_convert_MEDIC
%   mmil_convert_GEB1CAL
%   mmil_convert_FMAP_Siemens
%   mmil_convert_FMAP_GE
%   mmil_convert_B1

% copied mmil_convert_FMAP_GE to mmil_convert_FMAP
%   changed to handle both GE and Siemens

% changed to call mmil_convert_FMAP:
%   MMIL_Convert_MRIRAW_to_DTIPROC
%   MMIL_Convert_MRIRAW_to_BOLDPROC

% changed use use ext = '.mgz':
%   MMIL_Choose_T1
%   MMIL_Apply_MRI_Corrections
%   MMIL_B1Corr_Structurals
%   MMIL_Calculate_T1Ratio
%   MMIL_nuCorr_Structurals
%   MMIL_Register_and_Resample_MRI_Volumes
%   MMIL_Register_T2_to_T1
%   MMIL_Register_MRI_to_MRI
%   MMIL_Make_BEM_Surfs
%   MMIL_GradUnwarp_Structurals
%   MMIL_Get_Gradwarp_Signature

% changed to use '.mgz' instead of '.mgh':
%   BOLD_Stream/BOLD_MMIL_Register_to_T1.m
%   DTI_Atlas/DTI_MMIL_WarpToAtlas_Exam.m
%   DTI_Stream/DTI_MMIL_Register_to_T1.m
%   MMIL_Tools/MMIL_Status_Report.m
%   PETutils/ADNI_MMIL_Build_MRI_hist.m
%   REC_Stream/REC_MMIL_Status_Report_MRI.m

% rev 743

% changed MMIL_Calculate_T1Ratio to fix bug (ext not parms.ext)
% changed EPI_Resample_Data to use parms.ext = '.mgz'
% changed MMIL_GradUnwarp_Structurals to use .mgz instead of .mgh

% changed MMIL_Register_and_Resample_MRI_Volumes to display messages
%   before registration to atlas

% changed MMIL_Process_Exams to check proc_dti and proc_bold if newflag

% changed mmil_write_regscripts to use parms.ext = '.mgz'

% changed mmil_smooth3d to not require sig2 and sig3

% changed BOLD_MergeAPE to fix bug (no 'once' with isempty(regexp)

% changed to not get ver from fileparts:
%   DTI_Tools/DTI_AtlasTrack.m
%   BOLD_Analysis/BOLD_MMIL_Combine_Fourier_Sessions.m
%   BOLD_Analysis/BOLD_MMIL_Fourier_Analysis.m
%   BOLD_Analysis/BOLD_MMIL_GLM_Analysis.m
%   BOLD_Analysis/BOLD_MMIL_GLM_ROI_Analysis.m
%   BOLD_Analysis/BOLD_MMIL_Ready_RetFit.m
%   DTI_Analysis/DTI_MMIL_Analyze_CortSurf_Exam.m
%   DTI_Analysis/DTI_MMIL_Convert_Fibers_to_Segmentation.m
%   DTI_Stream/DTI_MMIL_Export_Data.m
%   MEG_Analysis/MEG_MMIL_RCSE.m
%   MEG_Analysis/MEG_MMIL_dSPM.m
%   MMIL_Analysis/MMIL_Analyze_Long_DTI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_Long_DTI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_Long_DTI_Exam.m
%   MMIL_Longitudinal/MMIL_Long_Register_DTI_Exam.m
%   MMIL_Longitudinal/MMIL_Long_Register_Exam.m
%   MMIL_Stream/MMIL_Import_MEG.m
%   MMIL_Stream/MMIL_Process_MEG.m
%   MMIL_Stream/MMIL_Process_MEG_Exam.m
%   MMIL_Tools/MMIL_Unpack_NonDicoms.m
%   MMIL_Utils/MMIL_Get_FSReconStatus.m
%   fstools/fs_mgh2BRIK.m
%   fstools/fs_paint.m
%   fstools/fs_resample_labels.m
%   mmil_tools/mmil_average_volumes.m
%   mmil_tools/mmil_average_volumes_old.m
%   mmil_tools/mmil_bbregister.m
%   mmil_tools/mmil_write_regscripts.m
%   utils/fileparts2.m
%   utils/warp_freesurfer_surface.m
%   timesurfer/functions/ts_MNE_epoch_fif.m
%   timesurfer/functions/ts_freqanalysis_fieldtrip.m
%   timesurfer/functions/ts_make_output_filename.m
%   timesurfer/functions/ts_session.m
%   timesurfer/functions/ts_timefreq_analysis.m
%   timesurfer/functions/ts_write_mscript.m
%   timesurfer/ieeg/process_iEEG_data.m
%   timesurfer/ieeg/ts_iEEG_FreqAnalysis.m
%   timesurfer/ieeg/ts_iEEG_Plot_TFR.m
%   timesurfer/ieeg/ts_iEEG_ProcessAvg.m
%   timesurfer/ieeg/ts_iEEG_ProcessEEG.m

% renamed utils/warp_freesurfer_surface to 
%   mmil_utils/mmil_warp_freesurfer_surface
% changed MMIL_Longitudinal/MMIL_Warp_Surf_Long.m to
%   use mmil_warp_freesurfer_surface

% renamed utils/fileparts2 to mmil_utils/mmil_fileparts
% changed ts_surf2movie to use mmil_fileparts instead of fileparts2

% rev 744

% changed DTI_AtlasTrack to use mmil_load_mgh_info

% changed fs_paint to use verbose option (default = false)

% created MMIL_Tools/MMIL_Fibers_to_Surf.m

% rev 745

% changed MMIL_Fibers_to_Surf to document options in header

% rev 746

% changed MMIL_Analyze_rsBOLD_Exams to use proc_bold not proc
% changed BOLD_MMIL_Resting_Analysis to give message and return
%   if no BOLD scans found
% changed BOLD_MMIL_Resting_Analysis to give message and return
%   if no valid BOLD scans found (e.g. only BOLD_SE)

% changed BOLD_MMIL_Resting_Analysis and MMIL_Analyze_rsBOLD_Exams
%   to include min_numTRs option

% changed BOLD_MMIL_Resting_Analysis to use load_data when calculating
%   ROI variance (to exclude ROIs with NaNs and 0s)

% rev 747

% changed mmil_classify_Philips to use correct default value ([]) for readoutFOV

% changed BOLD_MMIL_Resting_Analysis
%   to not exclude ROIs with NaNs and 0s
%   renamed functions load_roi_data and load_ico_data to
%     get_roi_data and get_ico_data

% changed DTI_Correct_Data to change vol_corr to vol (bug fix)

% rev 748

% changed DTI_MMIL_Analyze_Aseg_Exam to set and use DT_out_fstem

% changed BOLD_MMIL_Resting_Analysis to make ico var name 
%   like: ico7-var-lh.mgh, not ico7-lh-var.mgh

% changed DTI_AtlasTrack to resample fibers to correct T1 orientation

% changed MMIL_FIbers_to_Surf to add more fibers and subdiv_fibers as default

% changed DTI_Fiber_Subdivisions_Legend.csv to
%   change F-minor to Fminor, F-major to Fmajor
%   put "R" and "L" at begining of Fminor, Fmajor, and CC subdivisions
%   corrected mislabed Fmajor with Fminor

% rev 749

% created in mmil_utils:
%   mmil_cmap_blueblackred.m
%   mmil_cmap_cyanblueblackredyellow.m
%   mmil_cmap_redblackblue.m
%   mmil_cmap_redyellow.m

% changed MMIL_Fibers_to_Surf to change default values for thresh, presmooth
%   smoothsteps, and clust_min_val

% rev 750

% changed BOLD_MMIL_Resting_Analysis to
%   calculate mean motion including rotations

% created SurfView functions:
%   SurfView/sv_category_cvals.m
%   SurfView/sv_linear_cvals.m
%   SurfView/sv_show_surf.m
%   SurfView/sv_surf_view.m

% moved mmil_cmap_cyanblueblackredyellow to mmil_cmap_blueblackred
% changed mmil_cmap_redblackblue to reverse mmil_cmap_blueblackred
% removed utils/colormap_* functions
% changed functions that used utils/colormap_* functions:
%   BOLD_Analysis/BOLD_MMIL_Resting_Analysis.m
%   MMIL_Tools/MMIL_Viewer.m
%   mmil_utils/mmil_trimesh.m
%   rcse/plotting/rc_plot_RCSE_data.m
%   rcse/plotting/rc_plot_fields.m
%   rcse/plotting/rc_plot_ret_pots.m
%   rcse/plotting/rc_plot_ret_pots.m
%   timesurfer/plots/ts_plot_field.m
%   timesurfer/plots/ts_plot_vv_field.m

% changed MMIL_Process_Exam to set infix to parms.DTI_infix in two places

% changed MMIL_Process_Exams to ask for qmatjobs if unpackflag = 1

% changed REC_MMIL_Summarize_DTI_Analysis and MMIL_Summarize_DTI_Analysis
%   to use default scalefacts = [1,1,1,1,1]

% changed REC_MMIL_Get_StudyInfo to check if 
%   STRUCT_rawQCflag is field of ProjInfo

% changed BOLD_MMIL_Resting_Analysis to save mean_rotation and mean_displacement

% changed sv_surf_view to add '.tif' to outstem

% changed mmil_barh to set pos even if data_names not supplied

% rev 751

% changed MMIL_Analyze_Long_DTI_Exams to make header style conform

% created mmil_args_MMIL_Analyze_DTI_Exams; NOTE: gets all 'DTI' options
%   and nothing else -- this breaks convention, but is convenient

% changed MMIL_Analyze_DTI_Exams to accept ProjID, get options from ProjInfo

% changed to be more uniformly thin shelled:
%   REC_Analysis/REC_MMIL_Analyze_DTI_Exams.m
%   REC_Stream/REC_MMIL_Classify_Exams.m
%   REC_Stream/REC_MMIL_Create_BEM_Exams.m
%   REC_Stream/REC_MMIL_Freesurfer_Recon_Exams.m
%   REC_Stream/REC_MMIL_IcoResamp_FSRecon_Exams.m
%   REC_Stream/REC_MMIL_Long_Register_Exams.m
%   REC_Stream/REC_MMIL_Long_Setup_Exams.m
%   REC_Stream/REC_MMIL_PreProcess_Exams.m
%   REC_Stream/REC_MMIL_Process_Exams.m

% changed to make header style conform:
%   REC_Analysis/REC_MMIL_Analyze_Long_Exams.m
%   REC_Analysis/REC_MMIL_Analyze_MRI_Exams.m
%   REC_Analysis/REC_MMIL_Analyze_PET_Exams.m
%   REC_Stream/REC_MMIL_Import_PET_Exams.m
%   REC_Stream/REC_MMIL_Process_PET_Exams.m

% rev 752

% changed DTI_MMIL_Analyze_Fiber_Exam to use aseg_outdir, DTI_outdir,
%   and fiber_outdir

% renamed mmil_args_MMIL_Analyze_DTI_Exams.m to mmil_args_DTI.m
%   changed MMIL_Analyze_DTI_Exams to pass 'DTI' to MMIL_Args

% moved DTI_Stream/DTI_MMIL_Set_FiberInfix.m to DTI_Analysis

% changed MMIL_Analyze_DTI_Exams so default snums_flag = 1
%   added RootDirs to excl_tags, fixed extra [] in parms_filter

% created MMIL_Analysis/MMIL_Compile_DTI_Analysis.m

% rev 753

% created mmil_aseg_roicodes
% changed mmil_aseg_analysis and MMIL_Compile_DTI_Analysis
%   to use mmil_aseg_roicodes

% changed MMIL_Compile_DTI_Analysis to do aseg and cortsurf, concat

% rev 754

% changed MMIL_Check_ProjID to not get StudyInfo if parms.StudyInfo not empty

% changed MMIL_Summarize_DTI_Analysis to accept ProjID
%   call MMIL_Compile_DTI_Analysis

% removed DTI_MMIL_Summarize_Aseg, DTI_MMIL_Summarize_CortSurf,
%   and DTI_MMIL_Summarize_Fibers

% created DTI_Tools/DTI_AsegMask_Fibers.m
%   based on DTI_Analysis/DTI_MMIL_AsegMask_Fibers.m

% created mmil_tools/mmil_resample_vol based on utils/vol_resample_pad.m
% changed mmil_resample to call mmil_resample_vol

% created DTI_Tools/DTI_Fiber_Segmentation.m
%   based on DTI_Analysis/DTI_MMIL_Convert_Fibers_to_Segmentation.m

% renamed DTI_Analysis/DTI_MMIL_Set_FiberInfix to DTI_Tools/DTI_Set_FiberInfix
% changed functions that call DTI_MMIL_Set_FiberInfix:
%   DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
%   DTI_Analysis/DTI_MMIL_AsegMask_Fibers.m
%   DTI_Analysis/DTI_MMIL_Convert_Fibers_to_Segmentation.m
%   DTI_Analysis/DTI_MMIL_Resample_Fibers.m
%   DTI_Analysis/DTI_MMIL_Set_FiberInfix.m
%   DTI_Tools/DTI_AsegMask_Fibers.m
%   DTI_Tools/DTI_Fiber_Segmentation.m

% created DTI_Resample_Fibers based on DTI_MMIL_Resample_Fibers

% changed DTI_MMIL_AtlasTrack_Fibers_Exam
%   optionally resample to T1 resolution (call DTI_Resample_Fibers)
%   optionally mask with xcg, masksf (call DTI_AsegMask_Fibers)
%   optionally create fseg (call DTI_Fiber_Segmentation)

% changed MMIL_Process_Exam and MMIL_Process_Exams to accept DTI_xcg_flag,
%   DTI_masksf_flag, DTI_fseg_flag
% changed MMIL_Process_Exam to pass those options
%   to DTI_MMIL_AtlasTrack_Fibers_Exam

% renamed DTI_MMIL_AtlasTrack_Fibers_Exam to DTI_MMIL_AtlasTrack_Exam
% changed MMIL_Process_Exam to call DTI_MMIL_AtlasTrack_Exam

% moved DTI_Tools/DTI_Set_FiberInfix.m to DTI_Utils/DTI_set_fiber_infix.m

% changed to use DTI_set_fiber_infix:
%   DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
%   DTI_Analysis/DTI_MMIL_AsegMask_Fibers.m
%   DTI_Analysis/DTI_MMIL_Convert_Fibers_to_Segmentation.m
%   DTI_Analysis/DTI_MMIL_Resample_Fibers.m
%   DTI_Tools/DTI_AsegMask_Fibers.m
%   DTI_Tools/DTI_Fiber_Segmentation.m
%   DTI_Tools/DTI_Resample_Fibers.m

% created DTI_Transform_Fibers that runs
%   DTI_Resample_Fibers, DTI_AsegMask_Fibers, and DTI_Fiber_Segmentation
% changed DTI_MMIL_AtlasTrack_Exam to call DTI_Transform_Fibers instead of
%   DTI_Resample_Fibers, DTI_AsegMask_Fibers, and DTI_Fiber_Segmentation

% changed DTI_AtlasTrack to not resample T1 to T1_resDTI if already exists
%   (use forceflag)

% changed MMIL_Long_Setup_Exam to run DTI_MMIL_AtlasTrack_Exam instead
%   of DTI_MMIL_Resample_Fibers, DTI_MMIL_AsegMask_Fibers, and
%     DTI_MMIL_Convert_Fibers_to_Segmentation
%   call DTI_set_fiber_infix
%% NOTE: MMIL_Long_Setup_Exam requires testing
% removed DTI_MMIL_AsegMask_Fibers, DTI_MMIL_Resample_Fibers, and
%   DTI_MMIL_Convert_Fibers_to_Segmentation

% created fs_surf2surf based on fs_surf2ico
%   added trgsubj option, changed outfile to fname_out, other minor changes
% changed to call fs_surf2surf instead of fs_surf2ico, use trgsubj = 'ico':
%   BOLD_Analysis/BOLD_MMIL_Resting_Analysis.m
%   DTI_Analysis/DTI_MMIL_Analyze_CortSurf_Exam.m
%   fstools/fs_label_groupavg.m
%   timesurfer/ts_vestal.m
% removed fs_surf2ico

% changed fs_aparc_roi to include all values if minval is NaN (like fs_aseg_roi)
%   calculate median
% changed fs_surf_roi_avg to calculate median

% created mmil_cortsurf_analysis based on DTI_MMIL_Analyze_CortSurf_Exam
% change fs_surf_roi_avg to accept scalefact option
% changed mmil_cortsurf_analysis to use fs_surf_roi_avg instead of fs_aparc_roi
%   to accept resT1flag and resample data to T1 resolution before painting

% changed fs_aseg_roi to accept fname_colorlut, pass to fs_colorlut
% changed mmil_aseg_analysis to accept fname_aseg, fname_colorlut,
%   and call mmil_resample_vol instead of vol_resample_pad

% changed fs_multi_roi to accept scalefact
% created mmil_fiber_analysis based on DTI_MMIL_Analyze_Fibers

% rev 755

% changed DTI_set_fiber_infix to accept thresh_prob and thresh_FA
% changed mmil_fiber_analysis to pass thresh_prob and thresh_FA
%   to DTI_set_fiber_infix
% renamed DTI_AsegMask_Fibers to DTI_Mask_Fibers
%   accept thresh_FA and thresh_prob
% changed DTI_Transform_Fibers to use separate fseg_thresh_prob
%   pass thresh_FA and thres_prob to DTI_Mask_Fibers
% changed DTI_AtlasTrack to set fiber paths consistently
%   with DTI_Transform_Fibers using fiber_infix
% changed DTI_Fiber_Segmentation to check for resT1 and xcg files
%   set fseg_resT1flag and fseg_xcg_flag accordingly

% changed DTI_MMIL_AtlasTrack_Exam to use fseg_thresh_prob
% changed MMIL_Process_Exam and MMIL_Process_Exams to use DTI_fseg_thresh_prob

% change prob_thresh to thresh_prob and FAthresh to thresh_FA
%   DTI_Analysis/DTI_MMIL_Analyze_Fibers.m
%   DTI_Analysis/DTI_MMIL_Analyze_Fibers_Exam.m
%   DTI_Analysis/DTI_MMIL_Calc_FiberStats.m
%   DTI_Analysis/DTI_MMIL_Compile_ROIs.m
%   DTI_Tools/DTI_CSD_Tracto.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m

% changed change MMIL_Analyze_DTI_Exam
%   use subfunctions based on DTI_MMIL_Analyze_Aseg_Exam
%   loop over measures
%   accept T1 in measlist (nu.mgz) (replaced FS_input_list)
%   combine measlist and inputlist (replaced fname_input_list)
%   resample files to DTI resolution for aseg and fiber analysis
%   call mmil_fiber_analysis, mmil_aseg_analysis, and mmil_cortsurf_analysis
%   call DTI_Transform_Fibers

% rev 756

% changed MMIL_Compile_DTI_Analysis to be consistent with MMIL_Analyze_DTI_Exam
%   and expect roi_data from mmil_fiber_analysis and mmil_cortsurf_analysis
%     output mat files

% created DTI_Create_AsegMask from DTI_MMIL_Create_Aseg_Mask
%   accept fspath, M_T1_to_DTI, volsz_DTI, and M_DTI
%   use mmil_resample_vol instead of vol_resample_pad
% changed MMIL_Analyze_DTI_Exam to use DTI_Create_AsegMask
% changed DTI_MMIL_Create_Aseg_Mask to call DTI_Create_AsegMask
% moved DTI_Analysis/DTI_MMIL_Create_Aseg_Mask to
%       DTI_Stream/DTI_MMIL_Create_AsegMask

% removed DTI_MMIL_Analye_Fibers, DTI_MMIL_Analyze_Fibers_Exam,
%   DTI_MMIL_Analyze_CortSurf_Exam and DTI_MMIL_Analyze_Aseg_Exam

% changed DTI_MMIL_Calc_DT to use hidden DTcalc_dir parameter, pass to
%   DTI_MMIL_Set_DT_fstem, then create the directory from fileparts(fstem)
% changed DTI_MMIL_Set_DT_fstem to use hidden DTcalc_dir parameter
%   do not create output directory

% change DTI_MMIL_Set_DT_fstem to use DTI_MMIL_Get_ScanInfo instead
%   of DTI_MMIL_GetValidScans
% changed MMIL_Analyze_DTI_Exam to not call DTI_MMIL_ScanInfo directly
% changed to call DTI_MMIL_Get_ScanInfo instead of DTI_MMIL_GetValidScans
% removed DTI_Stream/DTI_MMIL_GetValidScans

% changed MMIL_Analyze_DTI_Exams to make parameters match MMIL_Analyze_DTI_Exam

% changed fs_colorlut to initialize fname if empty

% changed mmil_cortsurf_analysis to not pass scalefact for gwcont

% turned REC_MMIL_Summarize_DTI_Analysis into thin shell

% rev 757

% changed MMIL_Analyze_DTI_Exams to
%   remove reference to fname_input_list and FS_input_list
%   pass FSContainerPath as arg, not field of parms
% changed mmil_fiber_analysis to add xcg_suffix, masksf_suffix,
%   and fiber_atlasname
% changed MMIL_Analyze_DTI_Exam to include those in fiber_tags
% changed MMIL_Analyze_DTI_Exam to use interpm=0 when resampling
%   aseg to DTI resolution in norm_b0 subfunction
% changed mmil_cortsurf_analysis and mmil_fiber_analysis to put
%   'roi_data' at the end of output file names
%   changed MMIL_Compile_DTI_Analysis to set input file names accordingly

% rev 758

% changed fs_surf_roi_avg to call fs_colorlut and include roicode and full
%   roiname in output
% changed MMIL_Analyze_DTI_Exam to include fname_colorlut in cortsurf_tags
%   include fname_colorlut as hidden parameter (default = [])
% changed mmil_cortsurf_analysis to accept fname_colorlut, include
%   in roi_tags

% changed mmil_barh so text_v_offset and text_v_scale no longer necessary
% changed DTI_Analysis/DTI_MMIL_Calc_FiberStats.m to not use
%   text_v_offset or text_v_scale

% moved mmil_qmat_GE, mmil_qmat_Philips, and mmil_qmat_Siemens from
%   mmil_tools to mmil_utils

% created mmil_slicetiming_GE, mmil_slicetiming_Philips, and
%   mmil_slicetiming_Siemens in mmil_utils
% changed mmil_classify_GE, mmil_classify_Philips, and mmil_classify_Siemens
%   to call slicetiming functions if SeriesType starts with 'BOLD'
% changed MMIL_Classify_Exams to fix bug (ind instead of s)

% changed mmil_convert_BOLD_GE, mmil_convert_BOLD_Philips, and
%   mmil_convert_BOLD_Siemens to save slice_tpattern and slice_order
%   in ScanInfo

% changed by Adam Niese:
U    MMPS/matlab/timesurfer/plots/ts_ezmultiplot.m

% rev 760

% changed MMIL_Process_BOLD to get tpattern from ScanInfo,
%   pass to BOLD_Correct_Data
% changed BOLD_Correct_Data to not which tpattern was used

% changed MMIL_Compile_DTI_Analysis to set parms.fibers after checking for
%   intersection with fiber legend to exclude invalid fiber numbers
% changed MMIL_Compile_DTI_Analysis make change compile_fiber_analysis
%   and load_fiber_data functions to be compile_roi_analysis and
%   load_roi_data, accept roitype as input

% created MMIL_Compile_DTI_Analysis_Vals to compile ROI values
%   for each subject (not just averages)

% changed MMIL_Analyze_DTI_Exam and MMIL_Analyze_DTI_Exams to set default
%   minval to 1e-6

% created DTI_MMIL_Calculate_ROI_Dispersion to calculate median across subjects
%   of MAD (acros voxels) of ADC

% rev 761

% created mmil_wtd_median, mmil_wtd_mean, mmil_wtd_std
% changed fs_multi_roi to use mmil_wtd_* functions
%   save vals as unweighted

% renamed DTI_MMIL_Calculate_ROI_Dispersion to DTI_MMIL_Calc_ROI_Dispersion 
%   changed to calculated weighted mad when weights available (e.g. fibers)

% renamed fs_surf_roi_avg to fs_surf_roi
% changed functions that mention or call fs_surf_roi_avg:
%   fstools/fs_aparc_roi.m
%   fstools/fs_extract_aparc_tseries.m
%   mmil_tools/mmil_cortsurf_analysis.m

% changed fs_multi_roi to use varargin and mmil_args2parms
% changed functions that call fs_multi_roi:
%   MMIL_Analysis/MMIL_Analyze_Long_DTI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_Long_Exam.m
%   mmil_tools/mmil_fiber_analysis.m

% changed fs_multi_roi, fs_aseg_roi, and fs_surf_roi to save all vals
%   in "vals", changed fs_multi_roi to not save "raw_vals"
%   save nvals_valid, nvalid_invalid, set weights = 0 if invalid
% changed mmil_aseg_analysis, mmil_cortsurf_analysis, mmil_fiber_analysis
%   to use nvals and nvals_valid instead of nvox/nverts and nvals

% moved fstools/fs_multi_roi.m to mmil_analysis/mmil_multi_roi.m
% moved fstools/fs_aseg_roi.m to mmil_analysis/mmil_aseg_roi.m
% moved fstools/fs_surf_roi.m to mmil_analysis/mmil_surf_roi.m

% changed to use mmil_aseg_roi:
%   REC_Analysis/REC_MMIL_Analyze_PET_Exam.m
%   fstools/fs_extract_aseg_tseries.m
%   mmil_analysis/mmil_aseg_analysis.m
%   MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_Long_Exam.m

% changed to use mmil_surf_roi:
%   REC_Analysis/REC_MMIL_Analyze_PET_Exam.m
%   mmil_analysis/mmil_cortsurf_analysis.m
%   fstools/fs_extract_aparc_tseries.m
%   fstools/fs_aparc_roi.m (mention only)

% changed to use mmil_multi_roi:
%   mmil_analysis/mmil_fiber_analysis.m
%   fstools/fs_extract_wm_tseries.m
%   MMIL_Analysis/MMIL_Analyze_Long_DTI_Exam.m

% changed to use nvals and nvals_valid instead of nvox/nverts and nvals:
%   MMIL_Compile_DTI_Analysis.m
%   MMIL_Compile_DTI_Analysis_Vals.m
%   MMIL_Summarize_Long_DTI_Analysis.m

% changed functions to use mmil_surf_roi instead of fs_aparc_roi:
%   MMIL_Analysis/MMIL_Analyze_Long_DTI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_Long_Exam.m
%   MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
% removed fstools/fs_aparc_roi.m

% moved mmil_utils/mmil_aseg_roicodes.m to mmil_analysis/mmil_aseg_roicodes.m

% rev 762

% created mmil_nonsingleton_dim
% changed mmil_wtd_mean, mmil_wtd_std, mmil_wtd_med to accept dim
%   work on multi-dimensional matrices
% moved mmil_wtd_mean, mmil_wtd_std, mmil_wtd_med, and mmil_barh
%   from mmil_utils to mmil_analysis
% changed mmil_multi_roi to not loop over frames

% changed MMIL_Analyze_DTI_Exam to check if fibers exist
%   before transforming fibers and running fiber analysis

% created mmil_aseg_weights to calculate weights volume based on
%   data values (e.g. ADC) and dispersion values

% changed to correctly get volsz from fs_load_mgh:
%   mmil_analysis/mmil_multi_roi.m
%   mmil_analysis/mmil_fiber_analysis.m
%   DTI_Tools/DTI_Resample_Fibers.m
%   DTI_Tools/DTI_Mask_Fibers.m
%   DTI_Tools/DTI_Fiber_Segmentation.m

% changed mmil_aseg_roi to accept fname_weights
%   changed to use sub functions

% changed mmil_aseg_roi, mmil_multi_roi, and mmil_surf_roi to correctly
%   get nvals_invalid

% changed mmil_aseg_analysis to:
%   accept weights_flag, fname_vals, dispfact, dispvec, disp_roicodes
%   call mmil_aseg_weights, add fname_weights to roi_tags

% changed MMIL_Analyze_DTI_Exam to:
%   accept aseg_weights_flag, aseg_dispfact, aseg_dispvec, aseg_disp_roicodes
%   set fname_ADC
%   set weights-related parameters before calling mmil_aseg_analysis
%   add weights-related parameters to aseg_tags

% changed MMIL_Summarize_DTI_Analysis to include ProjID in outdir

% changed MMIL_Analyze_DTI_Exams to:
%   accept aseg_weights_flag, aseg_disp_fname, aseg_dispfact
%   load dispersion file, set aseg_dispvec, aseg_disp_roicodes

% changed MMIL_Compile_DTI_Analysis and MMIL_Summarize_DTI_Analysis
%   accept aseg_weights_flag, aseg_dispfact
%   include wtd_df4.0 in aseg file stem

% changed DTI_MMIL_Calc_ROI_Dispersion to:
%   average values across hemispheres
%   calculate weighted histograms

% rev 763

% renamed MMIL_Summarize_MRI_DTI_csv.m to MMIL_Combine_MRI_DTI_Summaries.m
%   changed DT_stats_patt to start with 'DTI' not 'DT'
%   removed nu_stats_patt and T1w_stats_patt (included in DTI now)

% created MMIL_Utils/MMIL_Get_ContInfo.m

% changed MMIL_Check_StudyInfo to calculate age with division by 365.25
%   and no calls to datevec

% created MMIL_Get_SubjInfo to add info from SubjInfo.csv to StudyInfo
%   and calculate Age from DOB and StudyDate

% rev 764

% changed mmil_write_csv to use parms and not reassign values
%   stylistic changes

% changed MMIL_Compile_DTI_Analysis
%   to acept continfo_flag and subjinfo_flag
%   to call MMIL_Get_ContInfo and MMIL_Get_SubjInfo

% changed MMIL_Summarize_DTI_Analysis
%   to acept continfo_flag and subjinfo_flag
%   to include fields from StudyInfo in output csv files
%   to make concat_flag=1 mean to not write individual csv files
%     but concat_flag=2 to write both individual and concatenated files

% changed MMIL_Analyze_DTI_Exams, MMIL_Analyze_DTI_Exam to accept
%   aseg_disp_scalefact, pass disp_scalefact to mmil_aseg_analysis
% changed mmil_aseg_analysis to accept disp_scalefact, pass to
%   mmil_aseg_weights as scalefact

% changed BOLD_Correct_Data to include tshift_flag, forceflag in motion_tags
%   include forceflag in tshift_tags
% changed MMIL_Process_Exams, MMIL_Process_Exam to accept BOLD_cleanupflag
% changed MMIL_Process_BOLD to accept cleanupflag, pass to BOLD_Correct_Data

% changed MMIL_Summarize_DTI_Analysis to check whether output files exist
%   before compiling results

% changed BOLD_TShift and BOLD_MotionCorr to:
%   use mmil_load_mgh_info
%   not do tshift if nframes <= max(1,skipTRs)
%     and motion correction if strcmp(fname_in,fname_ref)

% rev 765

% renamed RSI_Tools to rsi_tools
% renamed RSI_Utils to rsi_utils
% renamed SurfView to surfview
% renamed PETutils to pet_utils
% renamed BOLD_Tools to bold_tools
% renamed EPI_Tools to epi_tools
% renamed DTI_Tools to dti_tools
% renamed DTI_Utils to dti_utils

% renamed DTI_Mask_Fibers.m, DTI_Resample_Fibers.m, DTI_Fiber_Segmentation.m,
%   and DTI_Transform_Fibers.m to all-lowercase names
% changed DTI_MMIL_AtlasTrack_Exam and MMIL_Analyze_DTI_Exam to call
%   dti_transform_fibers

% renamed DTI_set_fiber_infix.m to dti_set_fiber_infix.m
% changed to used dti_set_fiber_infix:
%   MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
%   MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
%   dti_tools/DTI_AtlasTrack.m
%   dti_tools/dti_fiber_segmentation.m
%   dti_tools/dti_mask_fibers.m
%   dti_tools/dti_resample_fibers.m
%   dti_tools/dti_transform_fibers.m
%   mmil_analysis/mmil_fiber_analysis.m

% renamed DTI_mgh2dat.m to dti_mgh2dat.m
% changed to use dti_mgh2dat:
%   dti_tools/DTI_Convert_DTmeas.m
%   rsi_tools/RSI_Convert_MFmeas.m

% renamed DTI_dat2mgh.m to dti_dat2mgh.m
% changed to use dti_dat2mgh:
%   dti_tools/DTI_CSD_Tracto.m
%   dti_tools/DTI_FACT_Tracto.m

% rev 766

% renamed fstools to fsurf_tools

% renamed fs_normvol_asegroi to mmil_normvol_asegroi, stylistic changes
% changed MMIL_Analyze_DTI_Exam to call mmil_normvol_asegroi
% created mmil_normvol_linfit

% rev 767

% changed MMIL_Analyze_DTI_Exam, MMIL_Analyze_DTI_Exams,
%   MMIL_Compile_DTI_Analysis, MMIL_Compile_DTI_Analysis_Vals, and
%   MMIL_Summarize_DTI_Analysis to
%     include descriptions in header of b0, b0N, and T2w
%     use T2w as default instead of b0N (except MMIL_Compile_DTI_Analysis_Vals)
% changed MMIL_Analyze_DTI_Exam to create T2w using mmil_normvol_linfit
%   changed b0_asegnorm_roilist to b0N_roilist
%   changed b0N_DTcalc_flag to b0_norm_DTcalc_flag
%   added T2w_scalefact

% changed mmil_wtd_mad to also return wtd_med
% changed DTI_MMIL_Calc_ROI_Dispersion to return centers

% renamed DTI_write_DTIStudio_fiber.m to dti_write_DTIStudio_fiber.m
% changed DTI_CSD_to_DTIStudio_fiber to call dti_write_DTIStudio_fiber
% renamed DTI_read_DTIStudio_fiber.m to dti_read_DTIStudio_fiber.m
% changed DTI_select_fibers and DTI_fiber_path_to_mask
%   to call dti_read_DTIStudio_fiber
% renamed DTI_Rotate_qmat, DTI_Rotate_Tensors, and DTI_Rotate_Vectors
%   to dti_rotate_qmat, dti_rotate_tensors, and dti_rotate_vectors
% changed to call dti_rotate_* functions:
%   DTI_Atlas/DTI_MMIL_WarpToAtlas_Exam.m
%   dti_tools/DTI_AtlasTrack.m
%   dti_tools/DTI_Convert_DTmeas.m
%   dti_tools/DTI_MotionCorr.m
%   epi_tools/EPI_Resample_Data.m
%   rsi_tools/RSI_Convert_MFmeas.m
% renamed DTI_Read_ROImap to dti_read_roimap, use error, not return
% moved dti_utils/DTI_Oblique_Test.m to DTI_Stream/DTI_MMIL_Oblique_Test.m
% renamed DTI_CSD_to_DTIStudio_fiber.m to dti_CSD_to_DTIStudio_fiber.m
% changed DTI_CSD_Tracto to call dti_CSD_to_DTIStudio_fiber
% renamed DTI_CSD_Tracto.m to dti_CSD_tracto.m
% changed DTI_MMIL_CSD_Tracto_Exam to call dti_CSD_tracto
% renamed DTI_track_fibers.m to dti_track_fibers.m
% changed dti_transform_fibers, DTI_AtlasTrack, and DTI_FACT_Tracto
%   to call dti_track_fibers
% renamed DTI_load_dat.m and DTI_save_dat.m to dti_load_dat.m and dti_save_dat.m
%   dti_utils/DTI_fiber_path_to_mask.m
%   dti_utils/dti_track_fibers.m
%   DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exam.m
%   dti_utils/dti_track_fibers.m
% renamed dti_plot_FA.m, dti_plot_cmap.m, dti_plot_quiv.m, dti_plot_tensor.m,
%   and dti_plot_vals.m
% renamed DTI_M_to_R.m to dti_M_to_R.m
% changed dti_rotate_qmat, dti_rotate_tensors, and dti_rotate_vectors
%   to call dti_M_to_R
% renamed dti_tensor2components.m and dti_components2tensor.m
% changed to use dti_tensor2components and dti_components2tensor:
%   DTI_Atlas/DTI_MMIL_Average_Atlas_Fiber.m
%   dti_tools/DTI_AtlasTrack.m
%   dti_tools/DTI_Calc_DTmeas.m
%   dti_tools/DTI_Calc_Eig.m
%   dti_utils/DTI_smfiber_tensor.m
%   dti_utils/dti_plot_tensor.m
%   dti_utils/dti_rotate_tensors.m
% renamed dti_apply_b0_scale.m, dti_calc_b0_scale.m, dti_calc_fiber_overlap.m,
%   dti_calc_fiber_volume_ratio.m, dti_censor_frames.m,
%   dti_convert_bvecs2dirs.m, dti_export_DTIstudio.m, dti_fiber_path_to_mask.m,
%   dti_load_qmat.m, dti_read_GE_tensor_dat.m, dti_read_dirs.m,
%   dti_select_fibers.m, dti_smfiber_tensor.m, dti_smoothfiber.m,
%   dti_standardize_vec2atlas.m
% changed to call dti_* versions of functions above:
%   dti_tools/DTI_Fit_Tensor.m
%   rsi_tools/RSI_Fit_MultiFOD.m
%   DTI_Stream/DTI_MMIL_Load_Data.m
%   dti_tools/DTI_Correct_Data.m
%   DTI_Stream/DTI_MMIL_Export_DTIstudio.m
%   DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exam.m
%   dti_tools/DTI_CSD_Tracto.m
%   dti_tools/DTI_FACT_Tracto.m
%   DTI_Stream/DTI_MMIL_Export_DTIstudio.m
%   DTI_Stream/DTI_MMIL_Get_ScanInfo.m
%   DTI_Stream/DTI_MMIL_Load_Data.m
%   DTI_Atlas/DTI_MMIL_WarpToAtlas_Exam.m
% renamed dti_tools functions to lowercase:
%   DTI_AtlasTrack.m, DTI_CSD_Tracto.m, DTI_Calc_DTmeas.m, DTI_Calc_Eig.m,
%     DTI_Censor_Vol.m, DTI_Convert_DTmeas.m, DTI_Correct_Data.m,
%     DTI_Create_AsegMask.m, DTI_EddyCurrCorr.m, DTI_FACT_Tracto.m,
%     DTI_Fit_Tensor.m, DTI_MotionCorr.m, DTI_Render_AtlasTrack.m,
%     DTI_Synth_Vol.m to:
%   dti_AtlasTrack.m, dti_CSD_tracto.m, dti_FACT_tracto.m, dti_calc_DTmeas.m,
%     dti_calc_eig.m, dti_censor_vol.m, dti_convert_DTmeas.m,
%     dti_correct_data.m, dti_create_asegmask.m, dti_eddycurr_corr.m,
%     dti_fiber_segmentation.m, dti_fit_tensor.m, dti_mask_fibers.m,
%     dti_motion_corr.m, dti_render_AtlasTrack.m, dti_resample_fibers.m,
%     dti_synth_vol.m, dti_transform_fibers.m
% changed to call dti_* version of functions above:
%   DTI_Stream/DTI_MMIL_AtlasTrack_Exam.m
%   MMIL_Tools/MMIL_Fibers_to_Surf.m
%   dti_tools/dti_AtlasTrack.m
%   dti_tools/dti_convert_DTmeas.m
%   dti_tools/dti_calc_eig.m
%   dti_tools/dti_censor_vol.m
%   MMIL_Stream/MMIL_Process_DTI.m
%   dti_tools/dti_correct_data.m
%   DTI_Stream/DTI_MMIL_Create_AsegMask.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
%   dti_tools/dti_create_asegmask.m
%   dti_tools/dti_FACT_tracto.m
%   dti_tools/dti_calc_DTmeas.m
%   dti_tools/dti_fit_tensor.m
%   dti_utils/dti_plot_tensor.m
%   MMIL_Stream/MMIL_QC_Exam.m
%   DTI_Stream/DTI_MMIL_Calc_DT.m
%   dti_tools/dti_eddycurr_corr.m
%   dti_tools/dti_motion_corr.m
%   dti_tools/dti_synth_vol.m

% rev 769

% renamed BOLD_AtlasReg_to_T1.m, BOLD_Correct_Data.m, BOLD_Estimate_Motion.m,
%     BOLD_MergeAPE.m, BOLD_MotionCorr.m, BOLD_TShift.m, and BOLD_UnwarpB0.m to:
%   bold_atlasreg_to_T1.m, bold_correct_data.m, bold_estimate_motion.m,
%     bold_merge_APE.m, bold_motion_corr.m, bold_tshift.m, bold_unwarpB0.m
% changed to use bold_* functions above:
%   bold_tools/bold_atlasreg_to_T1.m
%   MMIL_Stream/MMIL_Process_BOLD.m
%   bold_tools/bold_correct_data.m
%   bold_tools/bold_estimate_motion.m
%   bold_tools/bold_unwarpB0.m
%   MMIL_Stream/MMIL_Process_BOLD.m
%   bold_tools/bold_merge_APE.m
%   bold_tools/bold_motion_corr.m
%   bold_tools/bold_tshift.m

% renamed EPI_BrainMask.m, EPI_EstimateB0.m, EPI_GradUnwarp.m,
%     EPI_OptimizeB0.m, EPI_Register_Scans.m, EPI_ReorientVol.m,
%     EPI_Resample_Data.m, EPI_UnwarpB0.m, EPI_iNorm_B0uw.m to:
%   epi_brainmask.m, epi_estimateB0.m, epi_gradunwarp.m,
%     epi_inorm_B0uw.m, epi_optimizeB0.m, epi_register_scans.m,
%     epi_reorient_vol.m, epi_resample_data.m, epi_unwarpB0.m
% changed to use epi_* functions above:
%   DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exam.m
%   epi_tools/epi_brainmask.m
%   epi_tools/epi_register_scans.m
%   dti_tools/dti_correct_data.m
%   epi_tools/epi_estimateB0.m
%   bold_tools/bold_correct_data.m
%   epi_tools/epi_gradunwarp.m
%   bold_tools/bold_unwarpB0.m
%   epi_tools/epi_optimizeB0.m
%   DTI_Stream/DTI_MMIL_Export_Data_for_FSL.m
%   epi_tools/epi_reorient_vol.m
%   epi_tools/epi_unwarpB0.m
%   MMIL_Stream/MMIL_Process_BOLD.m
%   MMIL_Stream/MMIL_Process_DTI.m
%   epi_tools/epi_resample_data.m
%   epi_tools/epi_inorm_B0uw.m
% changed epi_unwarpB0 to accept verbose option, default = true

% renamed rsi_tools/RSI_Calc_FODmeas.m, rsi_tools/RSI_Calc_MFmeas.m,
%     rsi_tools/RSI_Convert_FODmeas.m, rsi_tools/RSI_Convert_MFmeas.m,
%     rsi_tools/RSI_Fit_FOD.m, rsi_tools/RSI_Fit_MultiFOD.m,
%     rsi_tools/RSI_Synth_Vol.m, rsi_utils/RSI_FOD_matrix.m,
%     rsi_utils/RSI_SH_matrix.m, rsi_utils/RSI_plot_FOD.m to:
% rsi_tools/rsi_calc_FODmeas.m, rsi_tools/rsi_calc_MFmeas.m,
%     rsi_tools/rsi_convert_FODmeas.m, rsi_tools/rsi_convert_MFmeas.m,
%     rsi_tools/rsi_fit_FOD.m, rsi_tools/rsi_fit_MFOD.m,
%     rsi_tools/rsi_synth_vol.m, rsi_utils/rsi_FOD_matrix.m,
%     rsi_utils/rsi_SH_matrix.m, rsi_utils/rsi_plot_FOD.m

% rev 770

% changed MMIL_Classify_Dicoms to include slice_tpattern in serinfo_tags

% changed mmil_read_mdhStruct to use try/catch around read_mdhStruct_from_string

% changed mmil_slicetiming_Philips and mmil_slicetiming_Siemens to return
%   'unknown' if required dicom header fields are missing

% changed mmil_classify_dicoms to remove InstanceNumber, EchoTime, and
%   EchoTimes from default_values
%   (already set in SeriesInfo by mmil_sort_dicoms)
%   NaN for EchoTimes caused error for conveting MEDIC

% changed BOLD_MMIL_Resting_Analysis to save individual seed ROI
%   to ico correlation maps with option corr_roi_ico_maps_flag

% changed BOLD_MMIL_Resting_Analysis to pass fname_out instead of
%   outfile to fs_surf2surf

% renamed fs_extract_tseries, fs_extract_wm_tseries, fs_extract_aseg_tseries,
%   and fs_extract_aparc_tseries to mmil_* in mmil_analysis
% changed mmil_extract_aparc_tseries to only add ctx-hemi- to roiname if
%   not already there

% rev 771

% created MMIL_Compile_rsBOLD_ROI_Analysis

% rev 772

% copied mri_concat from FreeSurfer RH4-x86_64-R510 to MMPS/bin/mri_concat_510
% created mmil_concat
% created MMIL_Concat_rsBOLD_Surfstats
% changed fs_surf2surf to add 'mgz' as possible intype and outtype
% changed BOLD_MMIL_Resting_Analysis to add outtype as hidden parameter
%   with default = 'mgz'
% changed mmil_args2parms to make error messages lowercase

% rev 773

% changed MMIL_Process_Exam to change incorrect use of 
%   DTI_xcgflag to DTI_xcg_flag
% changed MMIL_Process_Exam and MMIL_Process_Exams to include default
%   values for DTI_xcg_flag, DTI_masksf_flag, and DTI_fseg_flag

% changed MMIL_Compile_rsBOLD_ROI_Analysis to save "motion" not "mean_motion"

% changed fs_recon to check for ERROR with tail -5

% changed MMIL_Compile_rsBOLD_ROI_Analysis to use qcflag

% changed MMIL_Summarize_DTI_Analysis to add info from StudyInfo to data
%   using style of MMIL_Concat_rsBOLD_SurfStats

% created MMIL_Summarize_rsBOLD_Network_Analysis

% renamed fsurf_tools/fs_3dDeconv.m to mmil_analysis/mmil_3dDeconv.m
% changed BOLD_MMIL_GLM_Analysis to use mmil_3dDeconv
% renamed fsurf_tools/fs_normdetrend.m to mmil_tools/mmil_normdetrend.m
% changed mmil_3dDeconv to use mmil_normdetrend

% renamed fsurf_tools/fs_glm_contrasts to mmil_utils/mmil_glm_contrasts.m

% renamed fsurf_tools/fs_calc_glm.m to mmil_utils/mmil_glm_calc.m
% renamed fsurf_tools/fs_design_glm.m to mmil_utils/mmil_glm_design.m
% renamed fsurf_tools/fs_detrend_vol.m to mmil_utils/mmil_detrend_vol.m
% renamed fsurf_tools/fs_regress_tseries.m to mmil_utils/mmil_regress_tseries.m
% renamed fsurf_tools/fs_load_motion.m to mmil_utils/mmil_load_motion.m
% renamed fsurf_tools/fs_read_HEAD_statsinfo.m to mmil_utils/mmil_read_HEAD_statsinfo.m
% changed fs_groupavg_glm to use mmil_glm_design, mmil_glm_contrasts,
%   and mmil_glm_calc
% changed BOLD_MMIL_Resting_Analysis to use mmil_detrend_vol,
%   mmil_load_motion, and mmil_regress_tseries
% changed fs_fourier to use mmil_detrend_vol
% changed mmil_3dDeconv to use mmil_read_HEAD_statsinfo
% created mmil_create_glt_files from subfunction in mmil_3dDeconv
% renamed fsurf_tools/fs_mgh2BRIK.m to mmil_utils/mmil_mgh2BRIK.m
% renamed fsurf_tools/fs_BRIK2mgh.m to mmil_utils/mmil_BRIK2mgh.m
% changed mmil_3dDeconv to use mmil_BRIK2mgh
% changed BOLD_Stream/BOLD_MMIL_Export_Data.m and DTI_Stream/DTI_MMIL_Convert.m
%   to use mmil_mgh2BRIK

% renamed mmil_regress_tseries to mmil_regress_vol
% changed mmil_detrend_vol to accept regressors matrix, call mmil_regress_vol

% changed BOLD_MMIL_Resting_Analysis to accept new options:
%   mc_deriv_flag, wm_preprep_flag, wm_deriv_flag
%   pass regressors to mmil_detrend_vol
%   allow for simultaneous regression of motion and wm_tseries
% changed mmil_concat to use varargin and mmil_args2parms
% changed MMIL_Concat_rsBOLD_SurfStats to call mmil_concat with 'key',value
% changed mmil_bandpass_vol to accept bandpass_zpad_flag with default = 1,
%   pass to ts_freq_filt
% changed BOLD_MMIL_Resting_Analysis to bandpass and concat wm tseries
% change MMIL_Analyze_rsBOLD_Exams to accept wm_deriv_flag, etc.

# Important Change!
% changed dti_convert_DTmeas to calculate TDC as mean of 2nd and 3rd
%   Eigenvalues, not 1st and 2nd
% changed dti_convert_DTmeas to output measures as MD, LD, and TD
%   instead of ADC, LDC, and TDC
% changed to use MD, LD, and TD:
%   DTI_Analysis/DTI_MMIL_Calc_FiberStats.m
%   DTI_Atlas/DTI_MMIL_Calc_ROI_Dispersion.m
%   DTI_Stream/DTI_MMIL_Calc_DT.m
%   DTI_Stream/DTI_MMIL_Export_Data_for_FSL.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
%   MMIL_Analysis/MMIL_Analyze_Long_DTI_Exam.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis_Vals.m
%   MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_Long_DTI_Analysis.m
%   MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
% renamed parms/LONGDTI/ADC_NonLinReg_Parms.txt to MD_NonLinReg_Parms.txt

% changed BOLD_MMIL_Resting_Analysis and MMIL_Analyze_rsBOLD_Exams
%   to accept max_scans option with default = 1

% rev 774

% change mmil_concat to accept option to accept meanflag and options
% changed MMIL_Concat_rsBOLD_Analysis to accept meanflag and options

% changed MMIL_Sumamrize_rsBOLD_Network_Analysis and MMIL_Summarize_DTI_Analysis
%   so outdir default is 'ROI_Summaries' and is put in MetaData if relative

% changed mmil_copy_dicoms to skip copying dicoms if ~isempty(errmsg)
% changed mmil_sort_dicoms to create subfunctions check_info and
%   remove_duplicates; check_info uses dicominfo for series with wrong
%   numbers of EchoTimes or InstanceNumbers

% changed MMIL_Summarize_rsBOLD_Network_Analysis to use network_flag
%   to give option to output all ROIs for each network, averaged across
%   all seeds in network that are not that ROI

% changed MMIL_Concat_rsBOLD_SurfStats and MMIL_Summarize_DTI_Analysis to
%   include SubjID and VisitID

% rev 775

% changed mmil_surf_roi to use fname_aparc instead of aparc, changed functions:
%   MMIL_Analysis/MMIL_Analyze_Long_DTI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_Long_Exam.m
%   MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
%   REC_Analysis/REC_MMIL_Analyze_PET_Exam.m
%   mmil_analysis/mmil_cortsurf_analysis.m
%   mmil_analysis/mmil_extract_aparc_tseries.m
% changed mmil_surf_roi to accept fname_weights, calculate weighted average

% changed MMIL_Analyze_MRI_Exam:
%   removed T1surfROI_flag
%   changed T1surf_flag to T1w_surf_flag
%   changed T1w_flag to T1w_aseg_flag
%   subfunctions
%   use mmil_cortsurf_analysis for T1w
%   use mmil_aseg_analysis for T1w
%   save aparc_stats with 'roi_data' struct including both lh and rh

% changed MMIL_Analyze_MRI_Exams:
%   accept ProjID as required, RootDirs as optional
%   no T1surfROI_flag
%   T1w_surf_flag instead of T1surf_flag
%   T1w_aseg_flag instead of T1w_flag
%   pass FSContainerPath and fsicopath to MIL_Analyze_MRI_Exam,
%     not RootDirs and StudyInfo

% changed REC_MMIL_Analyze_MRI_Exams into thin shell

% changed fs_read_aparc_stats:
%   create single aparc_stats output
%   loop over hemilist
%   do not get total area

% changed mmil_cortsurf_analysis to accept fname_weights, pass
%   to mmil_surf_roi
% changed mmil_surf_roi to set roiname to be like
%   sprintf('ctx-%s-%s%d',hemi,fstem,i)

% changed fs_ico2ico for style

% changed fs_surfmgh.csh to allow .mgz extension

% (as mmildev) created atlases.121105 with DTI_ROI_Dispersion and fuzzy_clusters
% changed atlases link to point to atlases.121105

% changed MMIL_Analyze_DTI_Exams to add aseg_disp_atlas_flag

% changed MMIL_Analyze_MRI_Exam:
%   added fnames_weights and weights_ico_flag options
%   check if fnames_weights exist
%   include fnames_weights in cortsurf_tags to pass to mmil_cortsurf_analysis
%   assume aparc_stats has combined lh and rh
%   calculate average thickness using mmil_surf_roi with fnames_weights
%     resample thickness to ico if weights_ico_flag (no smoothing)
%   calculate average icoarea using mmil_surf_roi with fnames_weights
%     resample icoarea to subj if ~weights_ico_flag (no smoothing)

% changed MMIL_Analyze_MRI_Exams to accept fuzzy_flag, fuzzy_order
%   pass fname_weights to MMIL_Analyze_MRI_Exam

% changed MMIL_Analyze_Long_Exam to output aparc ROI data with
%   lh and rh combined in one struct array
%   renamed aparc_change to roi_data
%   renamed aseg_change to roi_data

% changed MMIL_Compile_Long_Analysis to expect combined lh and rh
%   roi_data instead of aparc_change or aseg_change

% changed REC_MMIL_Summarize_CortThick_forPET.m to expect combined lh and rh
%   analysis/aparc_stats instead of stats/segstats

% rev 776

% changed MMIL_Compile_MRI_Analysis:
%   subfunctions
%   accept ProjID as required, RootDirs as optional
%   only include unique STRUCT_VisitIDs
%   assume aparc_stats and T1w_surf roi_data have combined lh and rh
%   load fuzzy ROI data
%   update to use correct names for T1w output

% changed REC_MMIL_Stats_Report_MRI to use FSURF not FREESURFERRECON

% changed MMIL_IcoResamp_FSRecon_Exams to use FSURF and FSICO

% changed mmil_aseg_analysis to not accept weights_flag
%   instead determine from whether fname_vals is supplied
% changed MMIL_Analyze_DTI_Exam to not pass weights_flag to mmil_aseg_analysis

% changed fs_read_aparc_stats to fix aparc_fname to fname_aparc
%   change aparc_stats to stats inside subfunction

% changed mmil_surf_roi to get hemi from regexp of fstem

% changed MMIL_Analyze_DTI_Exam to set outfix = 'cortsurf' before
%   calling mmil_cortsurf_analysis
% changed mmil_cortsurf_analysis to make default outfix = []

% changed mmil_cortsurf_analysis to calculate gwcont only for maps, not ROIs
%   and to not extract gwcont from maps

% changed REC_Analysis/REC_MMIL_Compile_MRI_Analysis into thin shell

% rev 777

% changed to make aseg_roilist include correct set of extra ROI codes
%   MMIL_Analysis/MMIL_Analyze_Long_Exams.m
%   MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_MRI_Exams.m
%   MMIL_Analysis/MMIL_Compile_MRI_Analysis.m
%   MMIL_Analysis/MMIL_Compile_Long_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_Long_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_MRI_Analysis.m


% changed to standardize header for aseg_roigroups and aseg_roigroups_flag:
%   MMIL_Analysis/MMIL_Analyze_Long_Exam.m
%   MMIL_Analysis/MMIL_Analyze_Long_Exams.m
%   MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_MRI_Exams.m
%   MMIL_Analysis/MMIL_Compile_Long_Analysis.m
%   MMIL_Analysis/MMIL_Compile_MRI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_Long_Analysis.m

% changed to remove aseg_roigroups_flag option:
%   MMIL_Analysis/MMIL_Compile_MRI_Analysis.m

% changed to not use asegplus_stats file name:
MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
MMIL_Analysis/MMIL_Compile_Long_Analysis.m
MMIL_Analysis/MMIL_Compile_MRI_Analysis.m

% changed MMIL_Summarize_MRI_Analysis:
%   accept ProjID as required, RootDirs as optional
%   subfunctions
%   continfo_flag, subjinfo_flag
% changed MMIL_Summarize_MRI_Analysis and MMIL_Compile_MRI_Analysis
%   to make fieldnames and csv file outfixes be more similar

% changed REC_Analysis/REC_MMIL_Summarize_MRI_Analysis into thin shell

% rev 778

% changed MMIL_Analyze_DTI_Exams to remove gwcont_flag

% changed MMIL_Compile_DTI_Analysis to:
%   loop over projdist_list for cortsurf
%   calculate gwcont, accept gwnorm_flag

% changed MMIL_Summarize_DTI_Analysis to:
%   loop over projdist_list for cortsurf
%   output gwcont

% changed MMIL_Compile_MRI_Analysis:
%   CortT1w instead of CortContrast
%   CortContrast instead of CortContrastRatio
%   SubCortT1w instead of T1w
%   use subcort_roicodes for SubCortVol

% rev 779

% changed mmil_convert_BOLD_Siemens to fix fstem_for and fstem_rev to fstem
% changed BOLD_MMIL_Get_ScanInfo to
%   choose B0uw_refs_rev and B0uw_refs_for not assuming BOLD_SE scans
%     are necessarily paired
%   select regT1_ref correctly if B0uw_refs_for or B0uw_refs_rev are empty

% changed MMIL_Analyze_Long_Exam to use mmil_mkdir, mmil_isrelative

% changed MMIL_Analyze_Long_Exam and MMIL_Analyze_Long_Exams to make default
%   outdir = 'analysis'

% created MMIL_Summarize_MRI_DTI_Analysis
% removed MMIL_Combine_MRI_DTI_Summaries

% renamed MMIL_Import_MRI_QC.m to MMIL_Import_FSRecon_QC.m
% changed MMIL_Get_QCInfo to accept QC_DTI
%   stop allowing 'REC_' prefix for QC files
% created MMIL_Import_DTI_QC
% changed MMIL_Get_StudyInfo and MMIL_Check_ProjID to accept QC_DTI

% changed to accept QC_DTI with default = true:
%   MMIL_Summarize_DTI_Analysis, MMIL_Compile_DTI_Analysis,
%   MMIL_Compile_DTI_Analysis_Vals, and MMIL_Summarize_MRI_DTI_Analysis

% changed to include QC_DTI in extra_tags:
%   mmil_args_MMIL_Check_ProjID.m
%   mmil_args_MMIL_Get_QCInfo.m
%   mmil_args_MMIL_Get_StudyInfo.m

% rev 780

% changed MMIL_Compile_DTI_Analysis_Vals to remove gwcont_flag
%   use projdist_list instead of projdist

% changed to document projdist_list:
%   MMIL_Analyze_MRI_Exam
%   MMIL_Analyze_MRI_Exams
%   MMIL_Compile_MRI_Analysis
%   MMIL_Summarize_MRI_Analysis
%   MMIL_Summarize_MRI_DTI_Analysis

% changed MMIL_Compile_MRI_Analysis to make all fieldnames and roinames
%   lower case
% changed MMIL_Summarize_MRI_DTI_Analysis to use MRI_results.all (not All)
% changed MMIL_Summarize_MRI_Analysis to use lower case fieldnames and outfixes
% changed MMIL_Compile_DTI_Analysis to include 'white' or 'gray' in roinames
%   instead of 'pdist'
% changed MMIL_Summarize_MRI_Analysis to loop over projdist_list
%   do not assume only two members
% changed MMIL_Summarize_DTI_Analysis to loop over projdist_list
%   do not loop over pvec inside summarize_roitype_analysis subfunction
%   set default concat_outfix = 'all', not 'All'
% changed to replace gwcont with contrast:
%   MMIL_Compile_DTI_Analysis
%   MMIL_Compile_MRI_Analysis
%   MMIL_Summarize_DTI_Analysis
%   MMIL_Summarize_MRI_Analysis

% changed to remove QC_DTIreg option or replace by QC_DTI:
%   MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis_Vals.m
%   MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_MRI_DTI_Analysis.m
%   MMIL_Utils/MMIL_Check_ProjID.m
%   MMIL_Utils/MMIL_Get_QCInfo.m
%   MMIL_Utils/MMIL_Get_StudyInfo.m
%   REC_Analysis/REC_MMIL_Analyze_Long_Exams.m
%   REC_Analysis/REC_MMIL_Summarize_Long_Analysis.m
%   REC_Stream/REC_MMIL_Get_StudyInfo.m
%   mmil_args/mmil_args_MMIL_Check_ProjID.m
%   mmil_args/mmil_args_MMIL_Get_QCInfo.m
%   mmil_args/mmil_args_MMIL_Get_StudyInfo.m

% changed MMIL_Get_QCInfo to only add QC fields if QC options are set
% changed MMIL_Check_StudyInfo to not include QC fields in standard_tags

% changed mmil_cortsurf_analysis to replace qwcont with contrast

% changed DTI_MMIL_Calc_ROI_Dispersion to remove gwcont
%   set projdist_list = projdist

% renamed MMIL_Get_SurfStats to MMIL_Get_MRI_SurfStats
% renamed MMIL_Concat_SurfStats to MMIL_Concat_MRI_SurfStats
%   changed to call MMIL_Get_MRI_SurfStats

% changed MMIL_Get_MRI_SurfStats to use correct fstem for T1surf and T1cont

% changed MMIL_Analyze_Long_Exam to use 'mgz' for outtype with fs_paint

% changed statsdir to analysis_outdir, set to 'analysis':
%   MMIL_Analysis/MMIL_Concat_MRI_SurfStats.m
%   MMIL_Analysis/MMIL_Get_MRI_SurfStats.m
%   MMIL_Tools/MMIL_Status_Report.m
%   REC_Analysis/REC_MMIL_SurfGroupAvg_CortThick.m
%   REC_Stream/REC_MMIL_Status_Report.m

% changed MMIL_Concat_MRI_SurfStats:
%   accept ProjID as required, RootDirs as optional
%   subfunctions, use mmil_concat
%   use MMIL_Check_ProjInfo, MMIL_Get_ContInfo, MMIL_Get_SubjInfo
%   no longer uses MMIL_Get_MRI_SurfStats

% changed REC_MMIL_Concat_SurfStats to be thin shell

% changed to put check for empty ProjID on single line:
%   REC_MMIL_Analyze_DTI_Exams.m
%   REC_MMIL_Analyze_MRI_Exams.m
%   REC_MMIL_Compile_MRI_Analysis.m
%   REC_MMIL_Concat_SurfStats.m
%   REC_MMIL_Summarize_DTI_Analysis.m
%   REC_MMIL_Summarize_MRI_Analysis.m

% changed MMIL_Compile_DTI_Analysis_Vals to add aseg_weights_flag

% changed DTI_MMIL_Calc_ROI_Dispersion to calculate hist_range
%   automatically for each meas from max(centers+3*dispersion)

% rev 781

% changed MMIL_Compile_DTI_Analysis to calculate fiber ROI volume
%   accept fiber_vol_flag, fiber_vol_norm_flag, fiber_vol_norm_code
%     and resolution (get from MMIL_ProjInfo.csv as DTI_resolution)
%   multiplied by prod(resolution)
%   normalized by ICV or total brain volume
%   do not create results.all with meas fields
%     instead results.all with all values for all roitypes and measures
% changed MMIL_Summarize_DTI_Analysis and MMIL_Summarize_MRI_DTI_Analysis
%   to use fiber_vol_flag, etc.

% rev 782

% updated version.NOTES

% rev 783

#############################################################################
#############################################################################

## MMPS_232: medium revision
## Don Hagler 11/13/12

% renamed utils/rm_all_empty_files to mmil_utils/mmil_rm_all_empty_files
%   added header text

% changed mmil_classify_dicoms to set default_values for PhaseEncodingLines,
%   nc, and nr
% changed mmil_serinfo_dims to check if nr and nc are empty, use
%   Rows and Columns instead

% created mmil_tools/mmil_read_classify_rules and
%   mmil_tools/mmil_classify_by_rules

% created mmil_classify directory
% moved mmil_tools/mmil_classify* to mmil_classify
% moved mmil_tools/mmil_*dicom* to mmil_classify
% moved mmil_utils/mmil_slice* to mmil_classify
% moved mmil_utils/mmil_isdicomfile.m to mmil_classify
% moved mmil_utils/mmil_qmat* to mmil_classify
% moved mmil_tools/mmil_detect_gradwarp.m to mmil_classify

% created mmil_init_serinfo (from mmil_classify_dicoms)
% created mmil_modify_serinfo (from mmil_classify_dicoms)
% created mmil_modify_serinfo_GE (from mmil_classify_GE)
% created mmil_modify_serinfo_Philips (from mmil_classify_Philips)
% created mmil_modify_serinfo_Siemens (from mmil_classify_Siemens)
% created mmil_sort_serinfo (from mmil_classify_dicoms)
% created mmil_classify_by_code
% changed mmil_classify_dicoms to use mmil_init_serinfo,
%   mmil_modify_serinfo, mmil_classify_by_code, mmil_classify_by_rules,
%   and mmil_sort_series

% changed MMIL_Classify_Dicoms to accept classify_file instead of
%   series_classify_file, use mmil_read_classify_rules
% changed MMIL_Classify_Exams to accept DCM_classify_file instead of
%   series_classify_file

% changed mmil_check_series to set valid_flag = 0 if serinfo.ignore = 1

% rev 784

% changed mmil_concat to reshape output to have [nverts,1,1] if meanflag=1
%   and is a surface file

% changed MMIL_Unpack_Dicoms to catch ERR
%   loop 10 times, pause 600 seconds if 'License Manager Error'
%   rethrow error on last attempt

% changed mmil_read_classify_rules to correctly handle varnames with
%   multiple '_'
% changed mmil_classify_by_rules to handle varnames that include '_dot_'

% changed mmil_classify_GE, mmil_classify_Siemens to remove call to
%   mmil_qmat_GE and mmil_qmat_Siemens
% changed mmil_modify_serinfo_Philips to remove call to mmil_qmat_Philips
% created mmil_qmat_DTI to call mmil_qmat_*
% changed mmil_classify_dicoms to call mmil_qmat_DTI

% created mmil_summarize_serinfo
% changed MMIL_Classify_Dicoms to call mmil_summarize_serinfo

% changed mmil_classify_by_rules and mmil_read_classify_rules to allow
%   matchi operation (use regexpi)

% replaced usage of getfielddefault with mmil_getfield:
%   BOLD_Analysis/BOLD_MMIL_Average_ROIs.m
%   BOLD_Analysis/BOLD_MMIL_GLM_ROI_GroupAvg.m
%   DTI_Stream/DTI_MMIL_Load_Data.m
%   MEG_Analysis/MEG_MMIL_GroupRCSE.m
%   MEG_Analysis/MEG_MMIL_RCSE_GroupAvg.m
%   MEG_Analysis/MEG_MMIL_dSROI_GroupAvg.m
%   MEG_Stream/MEG_MMIL_Reg2MRI.m
%   MMIL_Analysis/MMIL_Analyze_BOLD_Exams.m
%   MMIL_Analysis/MMIL_Analyze_MEG_Exams.m
%   MMIL_Stream/MMIL_Process_BOLD.m
%   MMIL_Stream/MMIL_Process_DTI.m
%   MMIL_Stream/MMIL_Process_MEG_Exams.m
%   MMIL_Tools/MMIL_B1Corr_Structurals.m
%   MMIL_Tools/MMIL_Get_Gradwarp_Signature.m
%   MMIL_Tools/MMIL_GradUnwarp_Structurals.m
%   MMIL_Tools/MMIL_nuCorr_Structurals.m
%   MMIL_Utils/MMIL_Check_StudyInfo.m
%   MMIL_Utils/MMIL_Get_QCInfo.m
%   MMIL_Utils/MMIL_RootDirs_from_ProjInfo.m
%   PITU/PITU_Convert_Exam.m
%   mmil_classify/mmil_classify_Philips.m
%   mmil_tools/mmil_check_B1corr.m
%   pet_utils/ReadPETdcmfiles.m
%   rcse/extra/rc_get_cond_info_from_prefix.m
% removed utils/getfielddefault.m

% changed mmil_modify_serinfo_Philips to get SequenceName
% changed mmil_classify_Philips to not get SequenceName from info,
%   use SeriesInfo(s).SequenceName instead

% changed mmil_qmat_DTI to set nb0 = 1 if nb0 = 0 (Siemens)
% changed mmil_classify_Siemens to not set nb0=1

% changed mmil_classify_by_rules to check if series_value is logical

% changed mmil_init_serinfo and mmil_modify_serinfo_Siemens to set
%   pe_rev_flag, pe_for_flag, and pe_extra_val
% changed mmil_classify_Siemens to not set pe_rev_flag, pe_for_flag,
%   not use info.Private_0019_1016, use SeriesInfo instead

% replaced GE_SequenceName with SequenceName and
%     GE_SequenceLabel with SequenceLabel:
%   mmil_classify/mmil_modify_serinfo_GE.m
%   mmil_classify/mmil_summarize_serinfo.m
%   MMIL_Tools/MMIL_Classify_Dicoms.m
%   mmil_classify/mmil_classify_GE.m
%   mmil_classify/mmil_classify_by_rules.m
%   mmil_classify/mmil_classify_dicoms.m
%   mmil_classify/mmil_init_serinfo.m
%   mmil_classify/mmil_read_classify_rules.m
%   mmil_convert/mmil_convert_DTI_GE.m

% replace PhaseEncodingLines with NumberOfPhaseEncodingSteps:
%   mmil_classify/mmil_init_serinfo.m
%   mmil_classify/mmil_modify_serinfo_Siemens.m
%   mmil_convert/mmil_convert_BOLD_GE.m
%   mmil_convert/mmil_convert_BOLD_Philips.m
%   mmil_convert/mmil_convert_BOLD_Siemens.m
%   mmil_convert/mmil_convert_DTI_GE.m
%   mmil_convert/mmil_convert_DTI_Philips.m
%   mmil_convert/mmil_convert_DTI_Siemens.m
%   mmil_convert/mmil_convert_FMAP.m
%   mmil_convert/mmil_convert_GEB1CAL.m

% created MMPS/parms/classify with MMIL_Series_Classify_All.csv and others
% changed MMIL_Process_Exams to use DCM_classify_set to
%   specify which one to use
%   default = 'All'
%   allow 'none', to not use rules
% changed mmil_classify_by_code to disable calls to mmil_classify_GE, etc.
%   with if 0

% changed MMIL_Classify_Dicoms to
%   accept ContainerPath, not ContainerRootDir and ContainerDir
%   remove warning off statement
% changed to pass ContainerPath to MMIL_Classify_Dicoms:
%   MMIL_Stream/MMIL_Classify_Exams.m
%   MMIL_Stream/MMIL_Process_Exam.m
% removed MMIL_PreProcess_Exam and MMIL_PreProcess_Exams

% change mmil_init_serinfo to not use excl_series, included in
%   MMIL_Series_Classify_All.csv instead

% rev 785

% changed MMIL_Classify_Exams to use DCM_classify_set

% changed mmil_qmat_DTI to not change ndiffdirs, nb0, bval for Philips
%   if nb0 = 1

% changed mmil_slicetiming_Philips to assume seq+z if slice_order is
%   close enough (allow for one or a few slices out of order)

% changed MMIL_Series_Classify_All.csv and MMIL_Series_Classify_Siemens.csv
%   to set ndiffdirs = 0 for BOLD_SE

% changed MMIL_Concat_rsBOLD_SurfStats to return fnames_log,
%   write fnamelist to log files

% changed mmil_concat to check output size even if meanflag ~= 1
%   added hidden check_size_flag with default = true

% rev 786

% changed BOLD_MMIL_Resting_Analysis to write correct output
%   for corr_roi_ico_maps_flag (was writing ico_data instead of Z)

% changed MMIL_Concat_rsBOLD_SurfStats to accept max_motion
%   exclude subjects with excessive motion

% changed fs_label2mgh to add ")" to regexp call

% changed fs_multiclust to convert labels to annotation file

% changed fs_write_ctab to add 1 to nteps to avoid error

% changed mmil_convert_DTI_Siemens to fix handling when rr_flag = 1
%   do not set splitflag=1 (use init val = 0)
%   set peoplar = 3

% rev 787

% changed MMIL_Analyze_rsBOLD_Exams to not error if fnames_aparc
%   has number of elements different than 2

% changed DTI_MMIL_WarpToAtlas_Exams to print correct function name
%   DTI_MMIL_WarpToAtlas_Exam instead of MMIL_RetFit_BOLD_Exam

% changed fs_write_ctab to accept roicolors as matrix
%   do not write 'unknown' if already included in roinames

% created fs_annot2labels
% created fs_annot2annot
% changed MMIL_Analyze_rsBOLD_Exams to accept fnames_fparc
% changed BOLD_MMIL_Resting_Analysis to accept fnames_fparc
%   and call fs_annot2annot

% changed mmil_surf_roi to not complain about fparc in file name
%   include hemi in roinames for fparc ROIs

% changed BOLD_MMIL_Resting_Analysis to set time based on size of ico data

% changed BOLD_MMIL_Resting_Analysis to use talrc_annot as outdir
%   for fs_tal2annot

% changed MMIL_Summarize_rsBOLD_Network_Analysis to allow 'talrc' roi_type
%   updated networks for roi_type 'fparc'

% changed fs_write_ctab to reset nroi if adding 'unknown'

% rev 788

% changed mmil_GE, mmi_Siemens, mmil_Philips to treat input
%   mri_info as struct array, return 1 if any scans have correct manufacturer
% changed mmil_modify_serinfo and mmil_classify_by_code to pass SeriesInfo
%   to mmil_GE, mmil_Siemens, mmil_Philips, instead of SeriesInfo(1)

% changed MMIL_Classify_Exams to use VisitID, not StudyInfo(ind).VisitID
%   (would cause error if StudyInfo is empty)

% changed MMIL_Compile_rsBOLD_ROI_Analysis to compile and save numTRs
% changed MMIL_Summarize_rsBOLD_Network_Analysis to save numTRs
% changed MMIL_Concat_rsBOLD_SurfStats to compile and save numTRs

% rev 789

% changed MMIL_Register_and_Resample_MRI_Volumes to
%   change formatting, cosmetic issues in header
%   smooth mask after resampling to atlas (if prereg_flag=0 and oldreg_flag=0)

% changed MMIL_Classify_Dicoms to copy container_tags from first
%   series that has ignore = 0

% changed MMIL_Summarize_rsBOLD_Network_Analysis to note
%   default value for network_flag (1)

% changed MMIL_Compile_rsBOLD_ROI_Analysis to set required_containers =
%   {'proc_bold','fsurf'}

% changed BOLD_MMIL_Resting_Analysis to save nreps
% changed MMIL_Compile_rsBOLD_ROI_Analysis to compile TR, nreps
%   and calculate sum of nreps, numTRs, mean of TRs
% changed MMIL_Summarize_rsBOLD_Network_Analysis to output TR, nreps
% changed MMIL_Concat_rsBOLD_SurfStats to compile and save TR, nreps

% moved mmil_glm_* from mmil_utils to mmil_analysis
% created mmil_glm_csv to calculate GLM fits to data in csv file
%   allow for numeric and categorical regressors
%   exclude rows with NaNs
%   allow quad_labels and cubic_labels to fit nonlinear terms for
%     some numeric regressors

% rev 790

% changed MMIL_Compile_MRI_Analysis to accept cortvol_flag, compile cort_vol

% changed MMIL_Summarize_MRI_Analysis to accept cortvol_flag,
%   include summary for cort_vol ROIs

% changed mmil_glm_calc to use names tstat, pval, and log10_pval
%   instead of tstats, raw_pvals, and pvals
% changed MMIL_SurfGroupGLM_BOLD to use tstat and log10_pval
% changed mmil_glm_csv to use tstat, pval, and log10_pval
% changed mmil_glm_calc to use nsubs and nvals instead of nvols and nvox
% changd mmil_glm_csv to output text file with N, dof, etc.

% renamed mmil_glm_csv to mmil_glm
%   changed to accept either csv or concatenated mgh/mgz file
%   merge fname_data and fname_reg if both supplied and fname_data is csv
% created mmil_merge_cells
% created mmil_merge_csv

% changed MMIL_Process_MEG_Exams to use mmil_mkdir

% changed MMIL_Process_Exams to set fields in tmp_parms based with
%   non-empty values in StudyInfo

% changed mmil_qmat_Siemens to catch error reading CSA header

% changed mmil_modify_serinfo_Philips to check if 'Item_1' isfield of tmp

% changed mmil_qmat_Philips to add comments
%   break if InstanceNumbers(i) >= 99
%   only set qmat and flip sign of qmat if dirmat is not empty

% changed mmil_concat to save M after checking size

% changed bold_correct_data to require nreps be > skipTRs + 2

% changed MMIL_Summarize_rsBOLD_Network_Analysis to include roi_type in
%   output mat file name

% rev 791

% changed MMIL_Import_MEG to remove trans_str var (not set) and correct
%   missing "-" before "format"

% changed MMIL_Import_FSRecon_QC to add space before "("

% changed MMIL_Compile_MRI_Analysis to make keep_flags boolean

% changed MMIL_Analyze_MRI_Exam to move check for fsico earlier, out of hemi loop
% changed MMIL_Analyze_MRI_Exams to accept verbose option

% changed MMIL_Import_DTI_QC to include \n in fprintf warning

% changed mmil_glm_contrasts to add 'group_contrast_flag'
% changed mmil_glm to pass categ_contrast_flag to mmil_glm_contrsats
%   as group_contrast_flag, make default = 0

% changed mmil_glm_design to accept baseflag
% changed mmil_glm_contrasts to accept baseflag,
%   accept groupregs as cell array of multiple sets of groupreg vectors
% changed mmil_glm to pass baseflag = 0 if groupregs ~isemtpy

% created mmil_define_rsBOLD_networks
%   (copied from subfunction of MMIL_Summarize_rsBOLD_Network_Analysis)
% changed MMIL_Summarize_rsBOLD_Network_Analysis to use mmil_define_rsBOLD_networks

% rev 792

% changed BOLD_MMIL_Resting_Analysis and MMIL_Analyze_rsBOLD_Exams
%   to set default values of mc_deriv_flag, wm_deriv_flag, and
%   wm_preprep_flag to true

% changed mil_args_MMIL_Process_Exams to add STRUCTflag

% changed mmil_define_rsBOLD_networks to modify fparc network definitions
%   removed PHC from default
%   removed MT from attention
%   created defaultA and defaultB, with three ROIs each (pCC in common)
%   created controlA and controlB, with three ROIs each (aCC in common)

% changed mmil_glm to replace empty cells with NaNs before checking numeric
%   (empty cells are considered numeric)

% changed mmil_glm_calc to return stderr for contrasts
%   calculate stdv as stderr * sqrt(n) (same as signa?)

% rev 793

% changed mmil_sort_dicoms to correctly remove duplicate InstanceNumbers

% changed mmil_modify_serinfo_Siemens to warn more specifically if
%   Private_0029_1020 tag is missing

% changed parms/classify/*.csv DTIrev to DTI_rev SeriesType
% changed all DTIrev to DTI_rev:
%   MMIL_Tools/MMIL_Convert_MRIRAW_to_DTIPROC.m
%   mmil_classify/mmil_classify_GE.m
%   mmil_classify/mmil_classify_Philips.m
%   mmil_classify/mmil_classify_Siemens.m
%   mmil_convert/mmil_convert_DTI_GE.m
%   mmil_convert/mmil_convert_DTI_Philips.m
%   mmil_convert/mmil_convert_DTI_Siemens.m

% changed mmil_serinfo_dims to convert nr, nc, and ns to double

% moved utils/read_dicom_4dvol.m to mmil_convert/mmil_read_dicom_4dvol.m
% moved utils/read_dicom_M.m to mmil_convert/mmil_read_dicom_M.m
% moved utils/read_dicomvol.m to mmil_convert/mmil_read_dicom_vol.m
% changed functions to mmil_read_dicom_*:
%   mmil_convert/mmil_read_dicom_vol.m
%   mmil_convert/mmil_read_dicom_4dvol.m
%   mmil_convert/mmil_read_dicom_M.m
%   ctx_utils/ctx_read_dicomvol.m
%   PITU/PITU_Convert_Exam.m
%   mmil_convert/mmil_convert_B1.m
%   mmil_convert/mmil_convert_MEDIC.m
%   mmil_convert/mmil_convert_structural.m
%   mmil_convert/mmil_convert_BOLD_GE.m
%   mmil_convert/mmil_convert_BOLD_Philips.m
%   mmil_convert/mmil_convert_BOLD_Siemens.m
%   mmil_convert/mmil_convert_DTI_GE.m
%   mmil_convert/mmil_convert_DTI_Philips.m
%   mmil_convert/mmil_convert_DTI_Siemens.m
%   mmil_convert/mmil_convert_FMAP.m
%   mmil_convert/mmil_convert_GEB1CAL.m

% changed to reorder fnames to have slices as inner loop, no convert_flag:
%   mmil_convert/mmil_convert_DTI_Philips.m
%   mmil_convert/mmil_convert_BOLD_Philips.m

% changed mmil_read_dicom_4dvol to catch error assigning im to vol
%   e.g. assignement dimension mismatch

% changed mmil_read_dicom_4dvol to read mosaic dicoms directly
%   not use mri_convert, removed tmpdir option

% changed mmil_read_dicom_M to get M from single file (mosaic)

% changed mmil_read_dicom_vol to use mmil_read_dicom_M

% changed to not pass outdir to mmil_read_dicom_4dvol
%   use mosaic_flag instead of convert_flag
mmil_convert/mmil_convert_BOLD_Siemens.m
mmil_convert/mmil_convert_DTI_Siemens.m
mmil_convert/mmil_convert_FMAP.m

% changed MMIL_Analyze_MRI_Exams to accept cortvol_flag

% rev 794

% changed MMIL_Analyze_MRI_Exam to
%   accept cortvol_flag, disable if missing necessary files
%   calculate cortical volume from thickness and area
%   smooth cortvol using fs_surf2surf
%   calculate weighted average cortvol using fuzzy clusters

% changed MMIL_Check_RootDirs to give message if check for rootdir
%   failed and will test again

% changed MMIL_Concat_MRI_SurfStats to accept 'cortvol' as datatype

% changed DTI_MMIL_Load_Data to continue if fname not found (avoid error)
% changed DTI_MMIL_Set_DT_fstem to exclude missing files

% changed aparc_roilist to exclude corpuscallosum (1004 and 2004):
%   'aparc_roilist',[1001:1003,1005:1034,2001:2003,2005:2034],[1,Inf],...
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis_Vals.m
%   MMIL_Analysis/MMIL_Compile_Long_Analysis.m
%   MMIL_Analysis/MMIL_Compile_MRI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_Long_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_MRI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_MRI_DTI_Analysis.m
%   mmil_analysis/mmil_aseg_analysis.m
%   mmil_analysis/mmil_aseg_roicodes.m

% changed MMIL_Compile_MRI_Analysis to calculate mean ROI
%   thickness weighted by area, T1w white and gray, contrast,
%   and total area and volume

% changed to put subj and cont info at beginning of spreadsheet:
%   MMIL_Summarize_MRI_Analysis.m
%   MMIL_Summarize_MRI_DTI_Analysis.m
%   MMIL_Summarize_rsBOLD_Network_Analysis.m

% changed MMIL_Get_QCInfo to
%   accept QC_BOLD option
%   call MMIL_Import_BOLD_QC
%   set QC based on QC_BOLD and QC_BOLDreg
% created MMIL_Import_BOLD_QC based on MMIL_Import_DTI_QC

% rev 795

% changed to include QC_BOLD:
mmil_args/mmil_args_MMIL_Check_ProjID.m
mmil_args/mmil_args_MMIL_Get_QCInfo.m
mmil_args/mmil_args_MMIL_Get_StudyInfo.m

% changed to accept QC_BOLD option:
MMIL_Utils/MMIL_Check_ProjID.m
MMIL_Utils/MMIL_Get_StudyInfo.m

% changed to include hidden QC_BOLD option:
MMIL_Analysis/MMIL_Analyze_BOLD_Exams.m
MMIL_Analysis/MMIL_Analyze_rsBOLD_Exams.m
MMIL_Analysis/MMIL_Compile_rsBOLD_ROI_Analysis.m
MMIL_Analysis/MMIL_Concat_rsBOLD_SurfStats.m
MMIL_Analysis/MMIL_RetFit_BOLD_Exams.m
MMIL_Analysis/MMIL_Summarize_rsBOLD_Network_Analysis.m

% changed MMIL_Get_ContInfo to continue if StudyInfo(s).raw is empty

% changed MMIL_Check_RootDirs to use %0.1f instead of %s
%   for message about pause duration

% changed mmil_glm_calc to calculate ssq, Fstat, and r for each contrast
%   and calculate exp_var for complete model
# NOTE: r is correct for single variable regression (e.g. age)
#   but is slightly different from result with partialcorr function

% changed MMIL_Compile_DTI_Analyis and MMIL_Compile_DTI_Analysis_Vals
%   to correct cortsurf infix

% rev 796

% changed MMIL_Get_QCInfo to change message about DTI QC and BOLD QC

% changed mmil_glm to accept outlier_labels and outlier_thresh

% changed MMIL_Summarize_DTI_Analysis to put subj and cont info at beginning
%   of spreadsheet

% changed mmil_merge_cells to choose merge_field as left-most
%   common column label in first set of vals

% changed mmil_barh to update header

% rev 797

% changed to accept QC_recon, with default = true:
%   MMIL_Analyze_DTI_Exams
%   MMIL_Compile_DTI_Analysis_Vals
%   MMIL_Analyze_rsBOLD_Exams
%   MMIL_Analyze_BOLD_Exams
%   MMIL_Summarize_rsBOLD_Network_Analysis

% changed mmil_barh to handle data with num_meas = 1

% changed MMI_Analyze_MRI_Exams to pass fsicopath as empty if
%   StudyInfo(s).fsico is empty

% created mmil_fuzzy_names
% changed MMIL_Analyze_MRI_Exam to rename fuzzy cluster roinames

% changed MMIL_Process_Exam(s) to accept DTI_locflag

% changed to accept QC_recon, with default = true:
%   MMIL_Compile_rsBOLD_ROI_Analysis
%   MMIL_RetFit_BOLD_Exams
%   MMIL_Concat_rsBOLD_SurfStats
%   MMIL_Analyze_BOLD_Exams

% rev 798

% as mmildev:
%   created atlases.2013.01.14 as copy of atlases.2012.11.06
%   created fiber_1014_mask.mat and fiber_1024_mask.mat in DTI_Atlas/fiber_subdivisions
%     using ~/mmildev/matlab/extra/recombine_fornix
% as dhagler:
%   created parms/DTI_Fiber
%   moved into parms/DTI_Fiber:
%     DTI_FiberQC_Orientation.csv 
%     DTI_Fiber_Legend.csv
%     DTI_Fiber_Subdivisions_Legend.csv
%   updated functions that use those files:
%     DTI_Atlas/DTI_MMIL_Calc_ROI_Dispersion.m
%     DTI_Stream/DTI_MMIL_Read_Fiber_Legend.m
%     MMIL_Analysis/MMIL_Compile_DTI_Analysis.m
%     MMIL_Analysis/MMIL_Compile_DTI_Analysis_Vals.m
%     MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m
%     MMIL_Analysis/MMIL_Summarize_MRI_DTI_Analysis.m
%     MMIL_Stream/MMIL_QC_Exam.m
%     MMIL_Tools/MMIL_Fibers_to_Surf.m
%   removed fibers 1011 and 1021 from DTI_Fiber_Legend.csv
%   updated to include 1014 and 1024:
%     DTI_Fiber_Legend.csv
%     DTI_FiberQC_Orientation.csv 
%     DTI_Fiber_Subdivisions_Legend.csv

% changed MMIL_Compile_MRI_Analysis to use mmil_fuzzy_names

% changed mmil_modify_serinfo_Siemens to set InPlaneRot to either of:
%   mdhStruct.sAdjDatadsAdjVolumeddInPlaneRot
%   mdhStruct.sSliceArraydasSlicel1rddInPlaneRot

% rev 799

% changed DTI_MMIL_Calc_ROI_Dispersion to use save with -v7.3 option

% changed MMIL_Analyze_DTI_Exams to set aseg_disp_fname to
%   DTI_ROI_Dispersion/DTI_aseg_dispersion.mat

% as mmildev:
%   updated dispersion calculations from
%     mmilping/MetaData/PING/DTI_ROI_Dispersion
%       DTI_aseg_dispersion.mat and DTI_fiber_dispersion.mat
%   renamed atlases.2013.01.14 to atlases.2013.01.15
%   linked atlases.2013.01.15 to clusters 0 and 3
%   rsync'd atlases.2013.01.15 to cluster 4

% as dhagler:
%   changed atlases link to point to ../atlases/atlases.2013.01.15 atlases

% changed DTI_MMIL_WarpToAtlas_Exams to update header

% changed dti_AtlasTrack to include 1014 and 1024 in subdiv_fibers

% changed dti_create_asegmask to accept xcg_suffix

% changed aseg_codes to xcg_codes:
DTI_Stream/DTI_MMIL_AtlasTrack_Exam.m
DTI_Stream/DTI_MMIL_Create_AsegMask.m
MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
dti_tools/dti_create_asegmask.m
dti_tools/dti_fiber_segmentation.m
dti_tools/dti_transform_fibers.m

% changed to accept xcg_codes:
MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
MMIL_Analysis/MMIL_Analyze_DTI_Exams.m

% changed dti_create_asegmask to create output with name like:
%   aseg_xcg_mask.mgz instead of aseg_xcgmask.mgz

% changed xcgmask to xcg_mask:
MMIL_Analysis/MMIL_Analyze_Long_DTI_Exam.m
MMIL_Longitudinal/MMIL_Long_Setup_Exam.m

% changed mmil_fiber_analysis to add xcg_suffix and masksf_suffix to
%   infix_tags

% changed DTI_MMIL_AtlasTrack_Exam to accept options
%   subdiv_fibers, divide_fibers_flag, and combine_fibers_flag
%   added those to track_tags
%   added 1014 and 1024 to trans_fibers
%   document xcg_suffix, xcg_codes, masksf_suffix

% changed MMIL_Process_Exam to accept options
%   DTI_subdiv_fibers, DTI_divide_fibers_flag, DTI_combine_fibers_flag,
%   DTI_xcg_suffix, DTI_xcg_codes, DTI_masksf_suffix

% changed MMIL_Analyze_DTI_Exams to accept masksf_suffix

% changed to use 1014 and 1024 fibers by default:
%   (wherever fiber 2000:2004 are used)
DTI_Atlas/DTI_MMIL_Calc_ROI_Dispersion.m
MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
MMIL_Analysis/MMIL_Compile_DTI_Analysis.m
MMIL_Analysis/MMIL_Compile_DTI_Analysis_Vals.m
MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m
MMIL_Analysis/MMIL_Summarize_MRI_DTI_Analysis.m
MMIL_Stream/MMIL_QC_Exam.m
dti_tools/dti_mask_fibers.m
dti_tools/dti_resample_fibers.m
dti_tools/dti_transform_fibers.m
mmil_analysis/mmil_fiber_analysis.m

% changed mmil_convert_FMAP to fix missing ")"

% rev 800

% renamed rc_calc_dip_spread to rc_nbrhd_dispersion
%   changed to not take abs of dot product
% renamed rc_calc_norm_dispersion to rc_angle_dispersion
%   return amean, dmean, and vmean

% changed MMIL_Analyze_DTI_Exam to pass xcg_suffix to check_fibers subfunction

% changed MMIL_Analyze_MEG_Exams to get retfit from proc_bold

% changed rc_RCSE_check_parms to set nbrhds = [] to avoid error
%   when vf2ctx_flag = 0

% added vfnorm_flag (default = false to be backward compatible):
%   rcse/functions/rc_calc_vf2ctx.m
%   rcse/functions/rc_RCSE_calc_vf2ctx.m
%   rcse/functions/rc_create_retfit_labels.m
%   rcse/functions/rc_RCSE_func.m
%   rcse/rc_RCSE.m
%   MEG_Analysis/MEG_MMIL_RCSE.m
% added RCSE_vfnorm_flag:
%   MMIL_Analysis/MMIL_Analyze_MEG_Exam.m
%   MMIL_Analysis/MMIL_Analyze_MEG_Exams.m
% changed rc_calc_vf2ctx to use vfnorm_flag to threshold
%   using weights normalized to max for each cortical location

% renamed w_maxnorm_thresh to w_thresh_patch:
%   set default = 0 for backward compatibility (for verts from retfit)
%   rcse/functions/rc_RCSE_check_parms.m
%   rcse/functions/rc_RCSE_func.m
%   rcse/functions/rc_construct_ret_mapping.m
% changed rc_construct_ret_mapping:
%   apply w_thresh_patch for verts
%   integrate verts and wfiles code
% added w_thresh_patch:
%   rcse/rc_RCSE.m
%   MEG_Analysis/MEG_MMIL_RCSE.m
% added RCSE_w_thresh_patch:
%   MMIL_Analysis/MMIL_Analyze_MEG_Exam.m
%   MMIL_Analysis/MMIL_Analyze_MEG_Exams.m

% rev 801

% changed rc_RCSE_full_nbrhood_search to use w_thresh_patch

% changed rendall to set fthresh, fmid, fslope before redraw

% changed rc_calc_ref_absdiff to add semicolon to not display sf

% changed default vfnorm_flag = 1
MEG_Analysis/MEG_MMIL_RCSE.m
MMIL_Analysis/MMIL_Analyze_MEG_Exam.m
MMIL_Analysis/MMIL_Analyze_MEG_Exams.m
rcse/rc_RCSE.m
rcse/functions/rc_RCSE_calc_vf2ctx.m
rcse/functions/rc_RCSE_func.m
rcse/functions/rc_create_retfit_labels.m

% changed rc_define_retmap_from_retfit to fix type (tmp_offests)

% rev 802

% updated version.NOTES

% rev 803

% updated links to DTI_Fiber_Legend.csv and DTI_Fiber_Subdivisions_Legend.csv

% rev 804

% updated change.NOTES

% rev 805

#############################################################################
#############################################################################

## MMPS_233: medium revision
## Don Hagler 01/22/13

% changed to set default niters = 2000
%   MEG_MMIL_RCSE_GroupAvg_DiffAreas_Resamp.m
%   MEG_MMIL_RCSE_GroupAvg_Diff_Resamp.m
%   MEG_MMIL_RCSE_GroupAvg_ErrMap_Resamp.m
%   MEG_MMIL_RCSE_GroupAvg_Err_Resamp.m
%   MEG_MMIL_RCSE_GroupAvg_Resamp.m
%   MEG_MMIL_dSROI_GroupAvg_Diff_Resamp.m

% changed rc_write_cond_info to write floats with 7 decimal places

% changed rc_synth_RCSE_noise to accept subjdir
% changed rc_synth_sensors_from_RCSE to set S_res to S if no resampling needed
% changed rc_synth_sensors_from_RCSE to check if forward_prefix is difference
%   from prefix
% created rc_synth_RCSE_offsets from rc_synth_RCSE_noise
% changed rc_synth_RCSE_offsets to accept sources matrix

% changed MMIL_Analyze_rsBOLD_Exams
%   removed wm_preprep_flag
%   replaced mc_deriv_flag and wm_deriv_flag with deriv_flag
% changed BOLD_MMIL_Resting_Analysis
%   removed wm_preprep_flag
%   removed extract_wm_tseries subfunction
%   renamed extract_each_wm_tseries subfunction to extract_wm_tseries
%   replaced mc_deriv_flag and wm_deriv_flag with deriv_flag
%   removed regress_wm_tseries subfunction

% rev 806

% changed mmil_modify_serinfo to set fname

% renamed mmil_extract_wm_tseries to mmil_extract_aseg_group_tseries
%   documented aseg_codes and mask_name
% changed BOLD_MMIL_Resting_Analysis
%   use mmil_extract_aseg_group_tseries
%   accept new options:
%     wm_codes
%     csf_flag, csf_codes, csf_erode_flag, csf_erode_nvoxels
%     brain_flag, brain_codes, brain_erode_flag, brain_erode_nvoxels
%   generized extract_group_tseries, prep_data, concat_data functions
%     use group_names for wm, csf, and brain
% changed MMIL_Analyze_rsBOLD_Exams to accept new options:
%   wm_codes
%   csf_flag, csf_codes, csf_erode_flag, csf_erode_nvoxels
%   brain_flag, brain_codes, brain_erode_flag, brain_erode_nvoxels

% rev 807

% changed MMIL_Analyze_rsBOLD_Exams to accept ico_trunc_flag
% changed BOLD_MMIL_Resting_Analysis
%   accept ico_trunc_flag
%   if ico_trunc_flag, always resamp to ico7, get subset in get_ico_data

% changed MMIL_Analyze_MEG_Exams to allow for non-atlas prior_prefix

% removed parms/DTI/tensor.dat
% changed dti_read_GE_tensor_dat so default fname = 'GE_tensor_14x.dat'
% added GE_RSI_tensor8.dat and GE_RSI_tensor9.dat to parms/DTI
%   (supplied by Josh Kuperman, specific to RSI sequence at UCSD cfMRI)

% changed mmil_classify_GE
%   set scan type to BOLD_ipp if sequence is epiRT_pepolarIPP
%   set gradunwarpflag = 0 if sequence is epiRT_pepolarAPE or epiRT_pepolarIPP
% changed mmil_convert_BOLD_GE to always rotate rev (pepolar=1)
%   if BOLD_ipp or BOLD_ape
% changed MMIL_Series_Classify_GE.csv and MMIL_Series_Classify_All.csv

% rev 808

% changed mmil_init_serinfo to initialize for tensor_fnum
% changed mmil_modify_serinfo to set tensor_fnum to value of Prive_0019_10b6

% changed MMIL_Series_Classify_GE.csv and MMIL_Series_Classify_All.csv
%  to classify RSI as DTI_flex
%  use tensor_fnum instead of ndiffdirs
% changed mmil_classify_GE to classify RSI as DTI_flex
%  use tensor_fnum instead of ndiffdirs
% changed MMIL_Series_Classify_GE.csv and MMIL_Series_Classify_All.csv
%  include column for tensor_fnum

% changed mmil_convert/mmil_convert_DTI_GE to set sequence type for DTI_flex
% changed mmil_convert_DTI_GE, mmil_convert_DTI_Philips,
%   and mmil_convert_DTI_Siemens to include tensor_fnum in scaninfo

% removed DTI_Stream/DTI_MMIL_Export_DTIstudio.m

% changed dti_load_qmat to use varargin
%   accept tensor_fnum and indir
% changed to pass tensor_fnum to dti_load_qmat:
%   DTI_Stream/DTI_MMIL_Get_ScanInfo.m
%   DTI_Stream/DTI_MMIL_Load_Data.m

% renamed GE_RSI_tensor8.dat and GE_RSI_tensor9.dat to
%   GE_flex_tensor8.dat and GE_flex_tensor9.dat

% changed mmil_convert_DTI_GE to treat DTI_flex same as DTI_ipp
% changed MMIL_Convert_MRIRAW_to_DTIPROC to add DTI_flex to list of DTI series

% changed to add flex_flag (or DTI_flex_flag or Fiber_flex_flag):
%   DTI_Analysis/DTI_MMIL_Calc_FiberStats.m
%   DTI_Analysis/DTI_MMIL_Compile_ROIs.m
%   DTI_Atlas/DTI_MMIL_Calc_ROI_Dispersion.m
%   DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exam.m
%   DTI_Atlas/DTI_MMIL_Import_DTIStudio_Fibers_Exams.m
%   DTI_Atlas/DTI_MMIL_WarpToAtlas_Exam.m
%   DTI_Atlas/DTI_MMIL_WarpToAtlas_Exams.m
%   DTI_Stream/DTI_MMIL_AtlasTrack_Exam.m
%   DTI_Stream/DTI_MMIL_CSD_Tracto_Exam.m
%   DTI_Stream/DTI_MMIL_Calc_DT.m
%   DTI_Stream/DTI_MMIL_Export_Data.m
%   DTI_Stream/DTI_MMIL_Export_Data_for_FSL.m
%   DTI_Stream/DTI_MMIL_Get_ScanInfo.m
%   DTI_Stream/DTI_MMIL_Load_Data.m
%   DTI_Stream/DTI_MMIL_Register_to_T1.m
%   DTI_Stream/DTI_MMIL_Set_DT_fstem.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
%   MMIL_Analysis/MMIL_Analyze_Long_DTI_Exams.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis_Vals.m
%   MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_Long_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_MRI_DTI_Analysis.m
%   MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
%   MMIL_Longitudinal/MMIL_Long_Setup_Exams.m
%   MMIL_Stream/MMIL_Process_DTI.m
%   MMIL_Stream/MMIL_Process_Exam.m
%   MMIL_Stream/MMIL_Process_Exams.m
%   MMIL_Stream/MMIL_QC_Exam.m
%   MMIL_Stream/MMIL_QC_Exams.m
%   atlases/reinit_jpdf_FSNU_DTI.m
%   mmil_args/mmil_args_DTI_MMIL_Import_DTIStudio_Fibers_Exams.m
%   mmil_args/mmil_args_DTI_MMIL_WarpToAtlas_Exams.m
%   mmil_args/mmil_args_MMIL_Long_Setup_Exams.m

% changed DTI_MMIL_Get_ScanInfo to use flex_flag to set snums_DT

% changed DTI_MMIL_Set_DT_fstem to return if ScanInfo is empty

% changed mmil_qmat_GE to set nb0=nb0-1 if SeriesType is DTI_flex

% rev 809

% changed DTI_MMIL_Set_DT_fstem and DTI_MMIL_Load_Data to add type 6 to
%   list of DTI_Sequence_Type in set_revflag_list

% rev 810

% changed MMIL_Process_DTI
%   not run DTI_MMIL_Calc_DT, DTI_MMIL_Export_Data,
%     or DTI_MMIL_Export_Data_for_FSL
%   removed options no longer necessary

% changed MMIL_Process_Exams
%   run DTI postprocessing steps directly
%     DTI_MMIL_Calc_DT, DTI_MMIL_Export_Data, and DTI_MMIL_Export_Data_for_FSL
%   removed unnecsesary options from call to MMIL_Process_DTI

% changed MMIL_Process_BOLD
%   not run BOLD_MMIL_Export_Data, BOLD_MMIL_Export_Data_for_FSL,
%     or BOLD_MMIL_Resting_Analysis
%   removed options no longer necessary

% changed MMIL_Process_Exams
%   run BOLD postprocessing steps directly
%     BOLD_MMIL_Export_Data, BOLD_MMIL_Export_Data_for_FSL,
%       and BOLD_MMIL_Resting_Analysis
%   removed unnecsesary options from call to MMIL_Process_BOLD

% changed DTI_MMIL_Load_Data to set bvals based on qmat if
%   DTI_Sequence_Type == 6 (DTI_flex)

% changed MMIL_Process_DTI to set bvals based on qmat if
%   DTI_Sequence_Type == 6 (DTI_flex)
%   pass bvals to dti_correct_data (for dti_eddycurr_corr)

% changed DTI_MMIL_Calc_DT and DTI_MMIL_Set_DT_fstem
%   remove formcflag
%   accept outdir and outfix

% created DTI_MMIL_Set_RSI_fstem
% created DTI_MMIL_Calc_RSI

% changed MMIL_Process_Exams and MMIL_Process_Exam
%   run DTI_MMIL_Calc_RSI
%   added options for RSI

% changed to use Ir, Ih, and If instead of 3-frame I:
%   rsi_calc_MFmeas, rsi_convert_MFmeas, and DTI_MMIL_Calc_RSI
%   

% created MMIL_Analyze_RSI_Exam

% rev 811

% changed mmil_multi_roi to accept frames, pass to fs_load_mgh
% changed mmil_fiber_analysis to accept frames (default = 1)
%   pass to mmil_multi_roi

% changed MMIL_Analyze_RSI_Exam to accept fnum,
%   pass frames to analyis functions
% created MMIL_Analyze_RSI_Exams

% changed MMIL_Compile_DTI_Analysis to allow it to be used for RSI measures

% changed full_DTstem_flag to full_fstem_flag:
%   DTI_Atlas/DTI_MMIL_Calc_ROI_Dispersion.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis_Vals.m
%   MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_MRI_DTI_Analysis.m

% changed full_RSIstem_flag to full_fstem_flag:
%   MMIL_Analysis/MMIL_Analyze_RSI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_RSI_Exams.m

% changed MMIL_Summarize_DTI_Analysis to allow it to be used for RSI measures
% created MMIL_Summarize_RSI_Analysis

% changed rsi_calc_MFmeas to only set volIf, volIh, volIr
%   depending on iso_restricted_flag, iso_hindered_flag, and iso_free_flag
% changed rsi_convert_MFmeas to continue if vol is empty

% changed MMIL_Analyze_DTI_Exams to include aseg_disp_atlas_flag in parms_filter

% changed mmil_glm to maintain order of data_labels
%   intersect was reodering alphabetically, but not updating data_labels
%   causing mismatch between labels and actual data values

% changed MMIL_Analyze_DTI_Exam(s) to accept b0N_erode_flag (default = 1)

% added options atlas_warp_flag, atlasdir, and atlasname to
%   MMIL_Analyze_DTI_Exam(s)
% changed MMIL_Analyze_DTI_Exam to warp measures to atlas
% changed mmil_warp_to_atlas to accept outstem and outstem_T1
% changed MMIL_Analyze_DTI_Exam to allow for RSI measures
% changed MMIL_Analyze_RSI_Exams to use MMIL_Analyze_DTI_Exam
% removed MMIL_Analyze_RSI_Exam

% changed mmil_aseg_brainmask to not save mr_parms

% changed mmil_BRIK2mgh to keep going if 3dTcat fails

% changed to set ScanInfo after converting vol (so failure omits scan from info)
%   mmil_convert/mmil_convert_B1.m
%   mmil_convert/mmil_convert_BOLD_GE.m
%   mmil_convert/mmil_convert_BOLD_Philips.m
%   mmil_convert/mmil_convert_BOLD_Siemens.m
%   mmil_convert/mmil_convert_DTI_GE.m
%   mmil_convert/mmil_convert_DTI_Philips.m
%   mmil_convert/mmil_convert_DTI_Siemens.m
%   mmil_convert/mmil_convert_FMAP.m
%   mmil_convert/mmil_convert_GEB1CAL.m
%   mmil_convert/mmil_convert_MEDIC.m
%   mmil_convert/mmil_convert_structural.m

% rev 812

% changed so input parameter is fname, not fname_in:
%   bold_estimate_motion
%   bold_motion_corr
%   bold_tshift

% changed epi_register_scans to use mmil_mkdir

% created dti_estimate_motion
% created dti_unwarpB0 to estimate motion and apply to B0dx

% changed bold_unwarpB0 to use mmil_resample_vol

% changed MMIL_Process_DTI and MMIL_Process_BOLD
%   pass phasedir instead of PhaseDir

% changed bold_unwarpB0 and dti_unwarpB0 to accept phasedir instead of PhaseDir

% changed dti_correct_data
%   new options: motion_B0uw_flag, motion_B0uw_iters
%   use subfunctions
%   use dti_unwarpB0, dti_estimate_motion
%   pass fname to dti_motion_corr
%   pass fname to dti_eddycurr_corr

% changed dti_motion_corr
%   accept fname instead of vol
%   use dti_estimate_motion
%   use mmil_resample_vol
%   save qmat and motion

% changed dti_eddycurr_corr
%   accept fname, fname_out, fname_DT

% changed MMIL_Process_DTI
%   added options: motion_B0uw_flag, motion_B0uw_iters, min_trans, min_rot
%   do not call epi_register_scans before dti_correct_data
%     (now done by dti_estimate_motion)

% changed MMIL_Process_Exam(s)
%   added DTI_motion_B0uw_flag, DTI_motion_B0uw_iters, DTI_min_trans, DTI_min_rot

% changed MMIL_Get_Gradwarp_Signature to use parms.ext, not .mgh
% changed MMIL_Status_Report to use parms.ext, not .mgh
% changed MMIL_Fibers_to_Surf to use outtype instead of mgh
% changed MMIL_Convert_NonDicom_MRIRAW_to_MRIPROC to use mgz not mgh

% changed MMIL_Process_DTI to use sub-functions for all steps

% created mmil_mean_motion
% changed BOLD_MMIL_Resting_Analysis to use mmil_mean_motion
% changed dti_motion_corr to use mmil_mean_motion
% changed dti_estimate_motion to return DTfit

% chaged dti_correct_data
%   censor volume as separate step before grad unwarp

% rev 813

% changed MMIL_Process_DTI
%   initialize errcode in each subfunction
%   use tparms not parms for epi_resample_data

% rev 814

% changed MMIL_Process_DTI
%   process reference scan first separately, reg to T1 and resample
%   process each scan, setting fname_ref as resampled reference scan

% chaged dti_correct_data
%   added parameters fname_B0uw_ref, fname_B0uw_mask, and fname_B0uw_reg
%   added set_fname_ref subfunction
%   set fname_ref for pre-B0uw motion correction

% changed epi_resample_data to use mmil_resample and mmil_resample_vol

% removed utils/resample_volume_to_isotropic.m

% changed to use mmil_resample_vol:
%   MMIL_Tools/MMIL_Register_T2_to_T1.m
%   MMIL_Tools/MMIL_Register_and_Resample_MRI_Volumes.m

% changed MMIL_Register_T2_to_T1 to use ContainerPath as outdir for
%   mmil_load_mgh_info

% changed dti_estimate_motion to not check if fname_mask exists
%   (will be created if needed by epi_register_scans)

% changed mmil_write_regscripts to not include _f0 in output files
%   if input fname_T2 is single frame

% changed DTI_MMIL_Load_RegInfo to look for _f0 file

% changed dti_correct_data to pass qmat=[], not qmat=0, when mc_flag = 0
% changed dti_motion_corr to give status message only once, not every frame
% changed dti_estimate_motion to give status message only once, not every frame
% changed dti_correct_data to use preB0uw_flag in correct_motion subfunction

% changed change dti_estimate_motion and dti_correct_motion to accept
%   intra_flag with default = 1
% changed dti_correct_data to set mc_intra_flag = 0 if ~mc_flag
%   or ~motion_B0uw_flag and ~preB0uw_flag
% changed dti_correct_data to load fname_qmat after motion correction
%   if preB0uw_flag and replace parms.qmat
% changed dti_correct_data to set tparms.fname_qmat if preB0uw_flag

% changed dti_correct_data to set DT_flag = 0 only if qmat is empty
%   not whether motion_B0uw_flag, mc_flag, and ecc_flag are true

% rev 815

% renamed REC_MMIL_Concat_SurfStats to REC_MMIL_Concat_MRI_SurfStats
% changed MMIL_Concat_MRI_SurfStats to add missing ")"

% changed ts_dSPM to end call to ts_dSPM_set_chans with ";"

% changed MMIL_Analyze_MEG_Exam and MMIL_Analyze_MEG_Exams to use
%   dSROI, not dSPM_ROI
% renamed mmil_args_MEG_MMIL_dSPM_ROI to mmil_args_MEG_MMIL_dSROI
% renamed mmil_args_MEG_MMIL_dSPM_ROI_GroupAvg to mmil_args_MEG_MMIL_dSROI_GroupAvg

% changed MMIL_Analyze_DTI_Exam
%   allow fnum to be a vector
%   change check_input_files to add r%d to full_meas if fnum>1

% changed DTI_MMIL_Manual_Register_Override to include RSIcalc and RSIanalysis

% changed dti_mask_fibers to accept fname_vals, apply dispersion weighting

% rev 816

% changed MMIL_Analyze_DTI_Exam to check if f>1, not fnum>1
%   change check_input_files to add s%d to full_meas if f>1

% changed DTI_MMIL_Set_DTI_fstem to give message if no DTI scans

% changed MMIL_Compile_DTI_Analysis to skip trying to load data
%   if fstem is empty (avoid message about missing files)

% changed MMIL_Summarize_DTI_Analysis and MMIL_Summarize_RSI_Analysis
%   accept RSI_outdir, RSI_outfix, DT_outdir, DT_outfix

% changed MMIL_Summarize_DTI_Analysis to loop over fnum for multiframe_measlist

% created dti_set_fiber_suffix
% changed dti_set_fiber_infix to call dti_set_fiber_suffix
% changed dti_transform_fibers
%   accept disp_flag, etc. for dispersion weighting
%   removed xcg_fibers and masksf_fibers subfunctions
%   call dti_set_fiber_suffix from mask_fibers subfunction
% changed aseg_weights_flag to aseg_disp_flag:
%   MMIL_Analyze_DTI_Exam.m
%   MMIL_Analyze_DTI_Exams.m
%   MMIL_Compile_DTI_Analysis.m
%   MMIL_Compile_DTI_Analysis_Vals.m
%   MMIL_Summarize_DTI_Analysis.m
%   MMIL_Summarize_MRI_DTI_Analysis.m
%   MMIL_Summarize_RSI_Analysis.m
% changed MMIL_Analyze_DTI_Exam and MMIL_Analyze_DTI_Exams to accept
%   fiber_disp_flag, fiber_dispvec, and fiber_dispfact, disp_suffix
%   accept disp_scalefact instead of aseg_disp_scalefact
% changed MMIL_Analyze_DTI_Exam
%   set aseg_flag=0 and fiber_flag=0 if no valid DTI scans
%     (and aseg_disp_flag=1 or fiber_disp_flag=1)
%   various changes related to fiber_disp_flag (e.g. check_fibers)

% rev 817

% changed mmil_aseg_analysis to use disp_suffix
% changed MMIL_Analyze_DTI_Exam to pass disp_suffix to mmil_aseg_analysis
% changed MMIL_Compile_DTI_Analysis and MMIL_Compile_DTI_Analysis_Vals
%   to use disp_suffix
% changed MMIL_Compile_DTI_Analysis_Vals to use aseg_dispfact
% changed MMIL_Summarize_DTI_Analysis and MMIL_Summarize_RSI_Analysis
%   to use disp_suffix
% changed MMIL_Summarize_DTI_Analysis and MMIL_Summarize_RSI_Analysis
%   to accept fiber_disp_flag and fiber_dispfact
% changed mmil_fiber_analysis to use disp_flag, disp_suffix, dispfact
%   call dti_set_fiber_suffix
% changed MMIL_Compile_DTI_Analysis and MMIL_Compile_DTI_Analysis_Vals
%   to use fiber_disp_flag, fiber_dispfact, call dti_set_fiber_suffix
% changed MMIL_Analyze_DTI_Exams to load fiber dispersion values
% changed MMIL_Analyze_DTI_Exams to match fiber_dispvec to fibers
%   using roicodes
% changed to replace disp_suffix with fiber_disp_suffix and aseg_disp_suffix:
%   MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis_Vals.m
%   MMIL_Analysis/MMIL_Summarize_RSI_Analysis.m
% changed dti_mask_fibers to use dispvec instead of dispersion

% changed MMIL_Concat_MRI_SurfStats
%   initialize fnames_mgz and fname_csv in check_output_files
%   use k for smoothing index, s for subject index
%   added 'cortvol' to set_datadir

% changed to add fiber_disp_xcg_flag:
%   MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
%   MMIL_Analysis/MMIL_Analyze_RSI_Exams.m
% changed dti_transform_fibers to accept disp_xcg_flag
%   pass to dti_mask_fibers
% changed dti_mask_fibers to accept disp_mask_flag
%   to allow aseg_codes to be independent of dispersion weighting

% rev 818

% changed BOLD_MMIL_Resting_Analysis and MMIL_Analyze_rsBOLD_Exams
%   set csf_flag and brain_flag default values to 0

% changed bold_correct_data to use PhaseDir not phasedir

% changed MMIL_Register_and_Resample_MRI_Volumes to add ";" to end of line

% changed MMIL_Summarize_DTI_Analysis to accept
%   aseg_disp_suffix and fiber_disp_suffix instead of disp_suffix

% changed MMIL_Analyze_DTI_Exam to add replace scalefact with disp_scalefact
%   in transform_tags

% rev 819

% created for ASL analysis:
%   MMIL_Analysis/MMIL_Analyze_ASL_Exam.m
%   MMIL_Analysis/MMIL_Analyze_ASL_Exams.m
%   MMIL_Analysis/MMIL_Compile_ASL_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_ASL_Analysis.m
% modified for ASL analysis:
%   MMIL_Utils/MMIL_Check_RootDirs.m
%   MMIL_Utils/MMIL_Check_StudyInfo.m
%   MMIL_Utils/MMIL_Get_Container.m
%   MMIL_Utils/MMIL_RootDirs_from_ProjInfo.m
%   mmil_utils/mmil_BRIK2mgh.m

% rev 820

% changed MMIL_Analyze_DTI_Exam to set disp_xcg_flag before calling
%   dti_transform_fibers

% changed bold_unwarpB0 to add ";" to end of line for setting vol_dx_res

% changed fs_erode_aseg to not display message for each ROI

% changed MMIL_Analyze_ASL_Exams to skip visits with missing raw_asl or fsurf
% changed MMIL_Analyze_ASL_Exam to set brain_flag=0
%   when calling mmil_aseg_brainmask

% changed MMIL_Summarize_MRI_DTI_Analysis to remove required_containers

% changed to allow fuzzy_order = 0:
%   MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_MRI_Exams.m
%   MMIL_Analysis/MMIL_Summarize_MRI_Analysis.m
%   MMIL_Analysis/MMIL_Compile_MRI_Analysis.m
% changed MMIL_Analyze_MRI_Exam to set fname_weights, etc. for fuzzy_order=0
% changed MMIL_Compile_MRI_Analysis to set fuzzy_nrois, etc. for fuzzy_order=0

% rev 821

% created fs_tal2weights

% changed MMIL_Summarize_MRI_Analysis and MMIL_Compile_MRI_Analysis
%   to accept aparc_flag (so we can disable aparc and do fuzzy ROIs only)

% changed fs_tal2weights to save text file with roinames
% changed MMIL_Analyze_MRI_Examt to load roinames from text file
% changed mmil_surf_roi to say "loading weights files"
% changed MMIL_Compile_MRI_Analysis to load roinames from text file

% rev 822

% changed MMIL_Process_Exam and MMIL_Process_Exams
%   reorder BOLD parameters in parms_filter
%   removed unused parameters (e.g. BOLD_BRIKflag, BOLD_niiflag)
% changed MMIL_Process_BOLD
%   use subfunctions
%   removed unused export_flag and export_type
% changed epi_resample_data to fix typo
% changed bold_motion_corr to not do tshift
% changed bold_tshift to change warning messages
% changed bold_correct_data to separate tshift from motion correction
% changed bold_merge_APE to accept verbose and output status messages
% changed bold_correct_data
%   do grad unwarp before motion correction if motion_b0uw_flag = 1
% changed bold_unwarpB0
%   apply B0 correction to fname_ref
%   set tparms.fname_ref
% changed bold_correct_data
%   pass fname_B0uw_ref to bold_unwarpB0 as fname_ref
%   add preB0uw_flag to correct_motion subfunction
% changed bold_motion_corr
%   accept intra_flag, to allow only between-scan registration
%   use bold_estimate_motion and mmil_resample (instead of 3dvolreg)
%   save motion_tseries to 1D file
% changed dti_estimate_motion to remove unused interpm, other minor changes
% changed bold_estimate_motion to use subfunctions, intra_flag
% changed bold_motion_corr to update estimate_tags
% changed bold_unwarpB0 to update motion_tags
% changed bold_correct_data to use fname_motion_1D and fname_motion_mat
%   updated motion_tags
% changed MMIL_Process_DTI
%   set gradunwarp_flag=0 after checking what it is
%   set M_T1_to_DTI and RegInfo empty if not parms.regT1flag
% changed MMIL_Process_BOLD
%   updated correct_tags
%   process reference scan separately first, then process others

% created atlases.2013.03.06 (as mmildev)
%   renamed T2_Atlas/EPDTI_b0_atlas.mat to T2_Atlas/T2_Atlas.mat
%   renamed FA_Atlas/EPDTI_FA_atlas.mat to FA_Atlas/FA_Atlas.mat
%   update DTI_ROI_Dispersion/DTI_fiber_dispersion.mat
%     from ~mmilping/MetaData/PING (now including Fxcut)
%   created rsBOLD directory, containing network_fparc and network_points
%     copyied from ~mmilbold/ProjInfo

% changed atlases link to point to atlases.2013.03.06 (as dhagler)

% rev 823

% changed ctx_resample_to_LIA to use mmil_resample_vol
% removed ctx_conform2cor
% created ctx_resample_to_ILA (replaces ctx_conform2cor)

% removed unused functions in ctx_utils:
%   ctx_Register_and_Normalize_Volumes.m
%   ctx_Resample_Volume.m
%   ctx_Rigid_Register_Volumes.m

% changed bold_motion_corr to remove maskoutput code (from dti_motion_corr)

% removed BOLD_reg_targ_BOLD_mask_edit*.mgh from BOLD_reg in atlases (as mmildev)

% changed mmil_mean_motion to handle motion_tseries with single frame
% changed MMIL_Process_BOLD to set tparms.infix before bold_merge_APE
% changed bold_correct_data to set fname_motion_mat and fname_motion_1D
%   differently if ~preB0uw_flag and ~parms.motion_B0uw_flag
% changed BOLD_MMIL_Fourier_Analysis and MMIL_Analyze_BOLD_Exam
%   to update header formatting
% changed to set motion 1D file name without complications (i.e. regexprep)
%   bold_merge_APE
%   BOLD_MMIL_Fourier_Analysis
%   BOLD_MMIL_GLM_Analysis
%   BOLD_MMIL_Resting_Analysis
% changed mmil_load_motion to set parms.nframes if empty
% changed bold_merge_APE to use mmil_load_motion, write motion without
%   two extra columns (RMSold and RMSnew)
% changed BOLD_MMIL_Load_RegInfo to check for first frame copy
% changed MMIL_Process_BOLD to use regT1_ref for registering to T1

% rev 824

% updated version.NOTES

% changed MMIL_Convert_MRIRAW_to_MRIPROC to fix error in convert_GEB1CAL subfunc
% changed MMIL_Process_Exam and MMIL_Process_Exams to restore parameter
%   BOLD_nii_out_orient
% changed MMIL_Process_BOLD to set save_reg_flag=0
%   for fname_ref_for and fname_ref_rev
% changed BOLD_MMIL_Get_ScanInfo
%   set SessInfo.revflag and snums_valid based on parms.revflag
%   check pepolar for APE and IPP scans (in case is 0 or 1)
% changed to return errcode=1 and give WARNING if no scans to convert:
%   MMIL_Convert_MRIRAW_to_BOLDPROC
%   MMIL_Convert_MRIRAW_to_DTIPROC
%   MMIL_Convert_MRIRAW_to_MRIPROC
% changed MMIL_Process_DTI and MMIL_Process_BOLD
%   check for B0uw_refs_for and B0uw_refs_rev, not reg_ref_for and reg_ref_rev
% changed MMIL_Process_BOLD to check pepolar before calling bold_merge_APE
% changed bold_unwarpB0 to use parms.M, not M

% rev 825

% changed bold_correct_data to set tparms.fname_ref, not tparms.fname_Ref
% changed MMIL_Process_DTI to comment out try/catch around dti_correct_data
% changed dti_motion_corr to remove interpm from estimate_tags
% changed bold_unwarpB0 to use fname_in, not fname_ref
% changed to use SessInfo.snums_valid:
%   BOLD_MMIL_Export_Data
%   BOLD_MMIL_Export_Data_for_FSL
% changed bold_motion_corr to call mmil_quick_brainmask if ~exist fname_mask
% uncommented try/catch in MMIL_Process_BOLD
% uncommented try/catch in MMIL_Process_DTI

% changed BOLD_MMIL_Resting_Analysis to fix mistake
% changed MMIL_Combine_Retinotopy_Exam to use proc_bold not proc

#############################################################################
#############################################################################

## MMPS_234: medium revision
## Don Hagler 03/15/13

% rev 826

% changed to accept check_complete_flag:
%   MMIL_Analyze_MRI_Exam, MMIL_Analyze_MRI_Exams,
%   MMIL_Compile_MRI_Analysis, MMIL_Summarize_MRI_Analysis
% changed MMIL_Compile_MRI_Analysis
%   not compile aparc stats if aparc_flag = 0
%   set fuzzy_full_fstem
% changed fs_tal2weights to write roinames as ctx-?h-roiname

% changed fs_label2labels to check parms.fname_out to make forceflag work

% changed so roi_rotation allowed range is [-180,180]:
%   BOLD_Analysis/BOLD_MMIL_Ready_RetFit.m
%   MMIL_Analysis/MMIL_RetFit_BOLD_Exam.m
%   MMIL_Analysis/MMIL_RetFit_BOLD_Exams.m
%   rcse/rc_ready_retfit.m
% changed to use ecc_fact:
%   rc_retfit_func, rc_retfit, rc_ready_retfit
%   BOLD_MMIL_Ready_RetFit, MMIL_RetFit_BOLD_Exam
%   MMIL_RetFit_BOLD_Exams

% changed MMIL_Convert_MRIRAW_to_MRIPROC, MMIL_Convert_MRIRAW_to_BOLDPROC,
%   and MMIL_Convert_MRIRAW_to_DTIPROC
%     return if errcode, not ~errcode
%     not get errcode from mmil_write_ScanInfo
% changed mmil_write_ScanInfo to only require 1 input

% changed rf_calc_vf2ctx to not match v3a with v3 using regexp
% changed rc_combine_retfit to use fit_fields hidden parameter
% change to pass area_colors to rc_plot_sources:
%   rc_RCSE
%   functions/rc_RCSE_func.m
%   functions/rc_RCSE_reweight_lsq.m
% changed MEG_MMIL_RCSE to pass area_colors to rc_RCSE
% changed MMIL_Analyze_MEG_Exam* to use RCSE_area_colors
% changed MEG_MMIL_GroupRCSE to set nareas to length of areas

% changed MEG_MMIL_dSROI_GroupAvg_Diff_Resamp
%   use parms.resamp_parm.peak_pol, not resamp_parms.peak_pol

% changed fsl_fmri_preproc.csh to set ps even if ndelete = 0

% created mmil_motion_stats from mmil_mean_motion, calculate more summary
%   measures from motion tseries
% changed BOLD_MMIL_Resting_Analysis to use mmil_motion_stats
%   save mode_motion, med_motion, etc.

% changed BOLD_MMIL_Fourier_Analysis to add sphere_flag, smoothsteps,
%   and sphsmoothsteps to paint_tags

% changed BOLD_MMIL_Export_Data_for_FSL to correctly set fname_motion

% changed MMIL_Compile_rsBOLD_ROI_Analysis to get additional
%   summary motion measures
% changed MMIL_Summarize_rsBOLD_Network_Analysis
%   include additional summary motion measures
%   use results_tags and motion_tags, include them in excl_tags

% changed BOLD_MMIL_Export_Data_for_FSL to pass TR/1000 to fsl_frmi_preproc.csh
%   and to not include extra %s in setting cmd

% changed MMIL_Analyze_MRI_Exams to accept fuzzy_smooth, with default = 2819
%   changed default sphsmoothsteps to be 2819 (not a vector like before)
% changed MMIL_Analyze_MRI_Exam to accept fuzzy_smooth, with default = 2819
%   changed analyze_fuzzy_* to pass fuzzy_smooth to fs_paint
%   changed to use smoothed files for cortvol if fuzzy_smooth>0

% created mmil_multiframe_subplots
% changed mmil_subplots to allow frame option
%   set number of columns equal to length of planestrings

% changed dti_fiber_segmentation to check for resT1 fibers first if resT1flag

% changed rc_retfit to set roi_rotation = [-roi_rotation,roi_rotation]
%   if two hemispheres but only one value

% rev 835
% rev 836

% changed randsurfsmooth.cpp to change help to have default niter = 1
%   make default surf = white

% removed redundant documentation/mmil

% rev 837

% changed mmil_read_dicom_4dvol
%   look for slice reversal with sSliceArrayducImageNumbTra,
%     sSliceArrayducImageNumbCor, or sSliceArrayducImageNumbSag
%     depending on slice plane
%   adjust offset if slices are reversed

% moved mmil_normdtrend to mmil_normdetrend

% changed mmil_3dDecon to check if motion_data has 7 columns
%   if so, pad with zeros to make 9 columns

% changed rc_define_retmap_from_retfit to skip missing areas
% changed rc_plot_sources
%   change area_colors and area_names defaults back to just V1, V2, and V3
%   match area_names to retmap area names with upper on both

% changed bold_motion_corr to accept afni_flag (default = 1)
%   use 3dvolreg and epi_resample_data first if mismatch in volsz or M

% changed MEG_MMIL_RCSE_GroupAvg to correctly initialize S_res with nconditions

% changed rc_retfit to use mmil_mkdir
% changed rc_combine_retfit to save labels

% changed MMIL_Get_SubjInfo to only set Age = [] if not a field already

% changed MEG_MMIL_dSROI_GroupAvg_Diff_Resamp
%   to always close figures if visible_flag = 1
%   use regexprep to replace '_' with ' ' for roiname to roistr (for titles)
% created MEG_MMIL_dSROI_GroupAvg_Resamp
% changed ts_dSPM to pass G_xyz to ts_dSPM_sourcecov
% changed MMIL_Analyze_MEG_Exam* so default dSPM_depthweight_p = 0.7
% changed rc_dSPM_RCSE to use mmil_mkdir
% changed MEG_MMIL_dSROI to remove unnecessary call to MMIL_Load_ContainerInfo
%   set rootdir to ContainerPath in mmil_args2parms
% changed rc_dSPM_RCSE to remove roi extraction and plotting
% changed MEG_MMIL_dSPM_RCSE to add options, call rc_dSPM_RCSE
% changed rc_dSPM_RCSE and MEG_MMIL_dSPM_RCSE to accept optional output prefix
% changed MMIL_Analyze_MEG_Exam* to add options for dSRC
% changed MMIL_Analyze_MEG_Exam to run dSROI_after dSPM_RCSE
% changed MEG_MMIL_dSPM_RCSE to accept ROI_outdir and ROI_outstem
%   not used, just accepted to make things easier
% changed rc_dSPM_RCSE to use RCSE_avg_data if dSPM_avg_data not found
% changed ts_roi_analysis to display messages only if doing it (~exist)
% changed rc_synth_sensors_from_RCSE to fix bug with handling
%   multiple contrast levels
% changed rc_dSPM_RCSE to preset dSPM_tags to fix problem with unrecognized
%   options (set by previous run of ts_dSPM)

% changed mmil_extract_aseg_group_tseries to accept outstem as parameter
% changed BOLD_MMIL_Resting_Analysis
%   pass outstem to mmil_extract_aseg_group_tseries
%   calculate mean volume
%   create brainmask from mean, with mean_flag and mean_thresh
%   apply brainmask to timeseries volume

% changed back to set ScanInfo before converting vol
%   (so failed scans are included in scaninfo)
% changed to add valid flag, set to 0 before conversion, 1 after success
%   mmil_convert/mmil_convert_B1.m
%   mmil_convert/mmil_convert_BOLD_GE.m
%   mmil_convert/mmil_convert_BOLD_Philips.m
%   mmil_convert/mmil_convert_BOLD_Siemens.m
%   mmil_convert/mmil_convert_DTI_GE.m
%   mmil_convert/mmil_convert_DTI_Philips.m
%   mmil_convert/mmil_convert_DTI_Siemens.m
%   mmil_convert/mmil_convert_FMAP.m
%   mmil_convert/mmil_convert_GEB1CAL.m
%   mmil_convert/mmil_convert_MEDIC.m
%   mmil_convert/mmil_convert_structural.m

% changed BOLD_MMIL_Get_ScanInfo and DTI_MMIL_Get_ScanInfo
%   to ignore scans with scaninfo.valid = false

% changed MMIL_Register_and_Resample_MRI_Volumes to
%   set nscans based on scaninfo.valid

% renamed MMIL_Summarize_rsBOLD_Network_Analysis
%   to MMIL_Summarize_rsBOLD_Analysis
%   changed to accept var_flag, roi_flag
%   changed network_flag to have values [0,1,2,3]
%   added roinames to specify which ROIs to include in output

% changed MMIL_Analyze_ASL_Exam(s) to accept fnames_fparc

% changed to fix typo "nhmemi":
%   MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
%   mmil_analysis/mmil_cortsurf_analysis.m
%   mmil_analysis/mmil_extract_aparc_tseries.m

% changed MMIL_Summarize_ASL_Analysis to accept fnames_fparc
% change MMIL_Compile_ASL_Analysis to accept fnames_fparc,
%   get ROI names from fnames_fparc
%   match ROIs by name, not code

% changed dti_load_qmat to have case {1,2,3,11,13} instead of {1:3,11,13}
%   changed Siemens_parms.diffdirs to Siemens_DiffDirs

% changed MMIL_Series_Classify_All.csv and MMIL_Series_Classify_Siemens.csv
%   to move rorevro series to top of Siemens DTI scans

% changed MMIL_Series_Classiy_All.csv and MMIL_Series_Classify_GE.csv
%   to add support for lowercase "rev"

% changed dti_load_qmat to flip y if using Siemens_DiffDirs file
%   for rorevro sequence used by VETSA

% updated version.NOTES

% rev 838

% changed MMIL_Analyze_DTI_Exam to always set full_meas
% changed MMIL_Analyze_RSI_Exams
%   use aseg_disp_flag, not aseg_weights_flag
%   use disp_scalefact, not aseg_disp_scalefact

% rev 839

#############################################################################
#############################################################################

## MMPS_235: minor revision
## Don Hagler 05/30/13

% changed ts_dSPM_calc_scalefacts to set sensor_labels
%   (used if flat channels detected)
%   and set flat channel threshold differently if ~amd_inverse_flag

% changed DTI_MMIL_Calc_ROI_Dispersion
%   pass aseg_disp_flag, etc. to MMIL_Compile_DTI_Analysis_Vals
%   save histograms to mat files

% changed MMIL_Analyze_DTI_Exam(s) to accept fseg_resT1flag

% changed dti_transform_fibers to add xcg_codes to fseg_tags

% changed MMIL_Analyze_DTI_Exam to accept wmparc_flag, do wmparc analysis
% created mmil_wmparc_roicodes
% changed MMIL_Analyze_DTI_Exams to accept wmparc_flag
% changed MMIL_Compile_DTI_Analysis_Vals to accept wmparc_flag, compile wmparc
% changed MMIL_Compile_DTI_Analysis to accept wmparc_flag, compile_wmparc
% changed MMIL_Summarize_DTI_Analysis to accept wmparc_flag
% changed DTI_MMIL_Calc_ROI_Dispersion to accept wmparc_flag
% changed aparc_flag to aseg_aparc_flag:
%   DTI_Atlas/DTI_MMIL_Calc_ROI_Dispersion.m
%   MMIL_Analysis/MMIL_Analyze_ASL_Exam.m
%   MMIL_Analysis/MMIL_Analyze_ASL_Exams.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exams.m
%   MMIL_Analysis/MMIL_Analyze_RSI_Exams.m
%   MMIL_Analysis/MMIL_Compile_ASL_Analysis.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis_Vals.m
%   MMIL_Analysis/MMIL_Summarize_ASL_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_MRI_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_RSI_Analysis.m
%   mmil_analysis/mmil_aseg_analysis.m
%   mmil_analysis/mmil_aseg_roicodes.m

% changed ts_groupavg to update style

% changed mmil_estimate_B1RxRatio_ADNI to use abs around mmil_smooth3d

% changed MMIL_Compile_MRI_Analysis
%   replace all_roinames with parms.all_roinames
%   replace all_roicodes with parms.all_roicodes

% changed MMIL_Compile_DTI_Analysis
%   replace DT_infix with DT_outfix for setting fstem
% changed MMIL_Compile_DTI_Analysis_Vals
%   allow RSI measures
%   set fstem as in MMIL_Compile_DTI_Analysis

% changed MEG_MMIL_RCSE_GroupAvg_Resamp to accept fill_alpha

% changed rscale_step default and range to match help:
%   rc_RCSE, rc_RCSE_func
%   MMIL_Analyze_MEG_Exams, MMIL_Analyze_MEG_Exam, MEG_MMIL_RCSE

% changed mmil_qmat_Siemens to quit if diffdirs is empty

% changed BOLD_MMIL_Resting_Analysis to adjust TR if numTRs ~= nreps
%   this doubles the TR for APE scans, increasing the cutoff for low pass filter

% changed rc_retfit to accept roi_excl_name, with default = 'exclude'
% changed rc_refit_func to accept roi_excl, exclude from err calculations

% created MMIL_Concat_DTI_SurfStats

% changed by Adam Niese:
U    MMPS/matlab/timesurfer/functions/ts_load_data.m
A    MMPS/matlab/timesurfer/functions/ts_load_nsX.m
A    MMPS/matlab/timesurfer/functions/ts_export_dat.m
A    MMPS/matlab/timesurfer/functions/ts_export_edf.m
U    MMPS/matlab/timesurfer/functions/ts_epoch_data.m
A    external/matlab/NPMK
A    external/matlab/NPMK/openNEV.m
A    external/matlab/NPMK/openNSx.m

% rev 842

# copied external/matlab/NPMK from svn copy to packages and clusters

% changed mmil_glm_calc to make ssq calculation work for surfaces
% changed mmil_merge_cells and mmil_merge_csv to accept merge_flag
%   to determine whether to use intersection or union

% changed fs_surf2surf to use --cortex, but only if FREESURFER_VER >= 400
% changed fs_paint to use fs_surf2surf for resample to sphere and smoothing
%   pass cortex_flag to fs_surf2surf with default = 1
%% NOTE: did not change fs_label_groupavg to pass cortex_flag to fs_surf2surf
%%    would need to separate the smoothing from sample to sphere as in
%%    fs_paint, and would only work if ico level = 7

% rev 843

% changed rc_retfit_func run_fine_fit to initialize min_sumcost = Inf
%   on first run to make sure costs are calculated and fit_parms created

% changed rc_retfit_func and rc_retfit
%   to use independent width parameters for v1p, v1m, v2p, v2m, v3p, and v3m
% changed rc_ready_retfit and BOLD_MMIL_Ready_RetFit to use map_v1_width_range
% changed MMIL_RetFit_BOLD_Exam and MMIL_RetFit_BOLD_Exams
%   to use RF_map_v1_width_range

% changed MMIL_Compile_MRI_Analysis to remove redundant fuzzy_order
%   from fname_mat in compile_T1w_fuzzy_data
% changed MMIL_Analyze_MRI_Exam to remove extra %d in setting fname_mat
% in analyze_fuzzy_T1w

% added run_all_MMPS.sh, created by Hauke Bartsch
% added parms/default_ProcSteps.csv

% rev 844

% changed by Hauke: MMPS/sh/run_all_MMPS.sh
% added by Hauke:   MMPS/sh/getValue.sh

% rev 847

% changed MMIL_Long_Setup_Exam to not warn about missing followup fsurf
%   use cat for adding to cell arrays

% changed rsi_calc_MFmeas to replace DTfit with MFfit
% changed dti_fit_tensor to change ny,nx to nx,ny in initializing volDT
% changed dti_fit_tensor to accept nonlin_flag, created new sub functions
% changed DTI_MMIL_Calc_DT to pass nonlin_flag to dti_fit_tensor
% changed MMIL_Long_Setup_Exam to pass nonlin_flag to DTI_MMIL_Calc_DT
% changed MMIL_Process_Exam and MMIL_Process_Exams
%    to accept DTI_nonlin_flag and pass nonlin_flag to DTI_MMIL_Calc_DT

% changed rc_retfit and rc_retfit_func to accept vacancy_fact
% changed rc_ready_retfit and BOLD_MMIL_Ready_RetFit
%   to accept vacancy_fact, map_logtrans_flag

% changed MMIL_RetFit_BOLD_Exam and MMIL_Analysis/MMIL_RetFit_BOLD_Exams
%   to accept RF_vacancy_fact and RF_map_logtrans_flag

% changed by Hauke:
U    MMPS/sh/run_all_MMPS.sh

% rev 850

% changed MMIL_Analyze_MRI_Exam
%   to include aseg_aparc_flag to in aseg_tags, not aparc_flag

% changed MMIL_Analyze_MRI_Exam and MMIL_Analyze_MRI_Exams
%   to accept aseg_aparc_flag (hidden)

% changed MMIL_Process_Exam and MMIL_Process_Exams
%   to use DTI_DT_nonlin_flag instead of DTI_nonlin_flag

% changed rsi_calc_MFmeas
%   created subfunctions
%   use nonlin_flag, set LB and UB

% rev 851

% changed MMIL_Analyze_DTI_Exam to change "nfum" to "fnum"

% rev 852

% changed by Hauke:
U    MMPS/sh/run_all_MMPS.sh

% rev 854

% changed DTI_MMIL_Get_ScanInfo to include ContainerPath in warnings

% rev 855

% changed fs_recon for v.5.3
%   added pctsurfcon, cortparc3, and parcstats3 steps

% rev 856

% changed fs_recon to fix missing curly bracket

% rev 857

% changed rsi_calc_FODmeas to accept mask_flag

% created rsi_fit_iso and rsi_synth_iso_vol

% changed parms/default_ProcSteps.csv
%   changed FreeSurfer to Freesurfer
%   added IcoResamp

% changed MMIL_Freesurfer_Recon_Exams to use qcsjobs2 if FS_version>=500

% changed rc_retfit_func to use rand instead of randn to pick values
%   between lbounds and ubounds

% changed MMIL_IcoResamp_FSRecon_Exams
%   to look for touch/remade* files instead of scripts/.remade*

% rev 859

% changed MMIL_Series_Classify_All.csv and MMIL_Series_Classify_GE.csv
%   to match classification for 3DGRASS scans (FLASHLo/PD)

% changed MMIL_Freesurfer_Recon_Exam and MMIL_Freesurfer_Recon_Exams
%   to change bemtype to BEMtype (to be consistent with MMIL_Create_BEM_Exams)

% changed mmil_glm to save volsz in results if ~parms.csv_flag
%   (instead of if parms.csv_flag, which caused error)

% changed to use mmil_printeps instead of printeps:
%   rcse/plotting/rc_plot_normvarerr.m
%   rcse/plotting/rc_plot_nonretdips.m
%   rcse/plotting/rc_plot_fitvar.m
%   rcse/plotting/rc_plot_errmap.m
%   rcse/plotting/rc_plot_areas.m
%   rcse/plotting/rc_plot_RCSE_datafit.m
%   rcse/plotting/rc_plot_RCSE_data.m
%   mmil_utils/mmil_imagesc.m

% rev 860

% changed BOLD_MMIL_Average_Retinotopy
%   to replace required_rootdirs with required_containers in tags_excl

% changed mmil_makeBEMsurfs_fromPD to set and pass tri_file_dir

% changed MMIL_Import_MEG
%   to not use -noss (no longer valid as of maxfilter v.2.1)
%   to accept rawflag

% rev 861

% changed by Hauke:
U    MMPS/sh/run_all_MMPS.sh

% rev 862

% changed bold_tshift to include hidden parameter minTRs to avoid
%   error when number of TRs < 5

% changed MMIL_Compile_DTI_Analysis_Vals
%   to set parms.info_tags

% Hauke change run_all_MMPS.sh to allow curly braces in ProcSteps.csv

% rev 864

% changed to add f0 to fstem_ref if nreps>1
%   BOLD_MMIL_Fourier_Analysis
%   BOLD_MMIL_GLM_Analysis
%   BOLD_MMIL_Resting_Analysis

% rev 865

% changed BOLD_MMIL_Get_ScanInfo to set fstem_regT1_ref
%   with f0 included if volsz(4)>1
% changed to use fstem_regT1_ref
%   BOLD_MMIL_Fourier_Analysis
%   BOLD_MMIL_GLM_Analysis
%   BOLD_MMIL_Resting_Analysis

% changed BOLD_MMIL_Resting_Analysis to set seed_roinames_full
%   when corr_seed_roinames not specified

% changed ts_sim_dSPM and ts_synth_sensors_from_dSPM to accept prefix_data
% changed ts_sim_dSPM to include dSPM_tags
% changed ts_sim_dSPM to find stcfiles in rootoutdir

% changed BOLD_MMIL_Fourier_Analysis to not use offscreen for tksurfer
%   (no longer works)

% changed mmil_read_dicom_vol to initialize vol with size [ncol,nrow,nslices]
%   not [nrow,ncol,nslices]

% rev 866

% Hauke changed run_all_MMPS.sh to fix parameter handling
%   with curly braces and ...

% rev 867

#############################################################################
#############################################################################

## MMPS_236: minor revision
## Don Hagler 08/07/13

% changed DTI_MMIL_WarpToAtlas_Exam and DTI_MMIL_WarpToAtlas_Exams
%   to update header info and fix bugs
%   accept sparse_flag
%   put all output in one WarpToAtlas subdirectory (with subdirectories)
% changed DTI_MMIL_Average_Atlas_Fiber to get files from WarpToAtlas dir

% changed MMIL_Analyze_MEG_Exams to update header formatting
% changed MMIL_Process_MEG_Exams to update header formatting
% changed MEG_MMIL_RCSE to use typestring to check for EEG sensors not type

% changed sv_surf_view to pass frame not f to fs_load_mgh

% changed DTI_MMIL_WarpToAtlas_Exams
%   to skip visits with empty proc_dti

% changed mmil_wtd_mad to make w optional

% changed to accept VisitIDs and SubjIDs:
%   MMIL_Utils/MMIL_Check_ProjID.m
%   MMIL_Utils/MMIL_Check_StudyInfo.m
%   MMIL_Utils/MMIL_Get_StudyInfo.m
% changed MMIL_Check_StudyInfo to restrict info to specific VisitIDs or SubjIDs
% changed to include VisitIDs and SubjIDs in extra_tags:
%   mmil_args/mmil_args_MMIL_Check_ProjID.m
%   mmil_args/mmil_args_MMIL_Get_StudyInfo.m
%   mmil_args/mmil_args_MMIL_Check_StudyInfo.m

% created mmil_glm_csv
% changed mmil_glm to save results.ind_included
% changed mmil_merge_cells to return ind1 and ind2
% changed mmil_glm to replace 'NA' in csv files with NaN

% rev 868

% changed mmil_glm_calc to use iteratively reweighted least squares
% changed mmil_glm and mmil_glm_csv to accept reweight options
# NOTE: new options undocumented for now because there remain issues to
#   work out related to rank-deficient design matrices
#   and adjusted sigma (and p-values) for robust estimation

% rev 869

% changed mmil_glm_calc to save madsigma in results

% changed MMIL_Summarize_DTI_Analysis and MMIL_Check_ProjID
%   to give warning, not error, if ProjID not found in ProjInfo
% changed DTI_MMIL_Get_ScanInfo
%   to check that ScanInfo has 'valid' field
%   to check that ScanInfo has 'tensor_fnum' field
% changed dti_load_qmat
%   to change "Philips_parms.diffdirs_32.txt" to "Philips_DiffDirs_32.txt"
% changed MMIL_Compile_MRI_Analysis to reset nrois after calculating mean vals
% changed MMIL_Compile_DTI_Analysis to calculate mean cortical values
% changed MMIL_Summarize_DTI_Analysis to add area_flag

% changed mmil_glm to accept mgh_contrast_labels to only save selected
%   contrasts as mgh/mgz files

% changed MEG_MMIL_dSROI_GroupAvg_Resamp
%   to accept conditions, cond_label, cond_lim

% changed mmil_motion_stats to calculate max_trans, max_rot
% changed BOLD_MMIL_Resting_Analysis to save max_trans, max_rot
% changed MMIL_Summarize_rsBOLD_Analysis to include more stats in motion_tags

% rev 870

% changed mmil_glm_calc to initialize madsigma as std

% changed MMIL_Summarize_MRI_DTI_Analysis to use DTI_analdir and DT_outfix
%   not aseg_indir, fiber_indir, and cortsurf_indir

% changed MMIL_IcoResamp_FSRecon_Exam to not return if already exists
%   just skip creation and then save ContainerInfo

% changed MEG_MMIL_dSPM to use typestring to check for EEG sensors not type

% changed MMIL_IcoResamp_FSRecon_Exams to set dest_typestr to include ico
%   if ico~=7
% changed MMIL_IcoResamp_FSRecon_Exam to not reset dest_typestr

% changed ts_dSPM
%   to set rh_dec_dips from rh_dip_info (if nodec_flag==1)
%   to not save G_xyz in inverse.mat file
%   to use -v7.3 option when saving forward.mat and forward_prep.mat files
%   to accept forward_only_flag
% changed ts_synth_sensors_from_dSPM to load forward_prep.mat file instead
%   of inverse.mat file
% changed MEG_MMIL_dSPM to accept forward_only_flag
% changed MMIL_Analyze_MEG_Exam* to accept dSPM_forward_only_flag
% changed ts_sim_dSPM
%   to allow ts_synth_sensors_from_dSPM to use different dSPM forward_prefix

% changed MMIL_Compile_rsBOLD_ROI_Analysis to save max_trans and max_rot
% changed BOLD_MMIL_Resting_Analysis
%   to accept aseg_roilist, include in extract_vol_tags
%   to accept fparc_flag, sample to surface if aparc_flag or fparc_flag == 1
% changed MMIL_Analyze_rsBOLD_Exams
%   to accept aseg_roilist
%   to accept fparc_flag
% changed MMIL_Summarize_rsBOLD_Analysis
%   to set mat_outfix with roi_infix, not roi_type

% changed ts_sim_dSPM to accept stc matrix

% changed MMIL_Compile_ASL_Analysis to calculate mean cortical values
% changed MMIL_Summarize_ASL_Analysis to accept area_flag

% changed mmil_motion_stats to accept absflag
%   allow calculation by sqrt sum of squares
%   calculate max_rz, max_dz, etc. and trans_frac
% changed BOLD_MMIL_Resting_Analysis to accept motion_absflag
% changed MMIL_Compile_rsBOLD_ROI_Analysis to get new motion measures

% changed MMIL_Summarize_DTI_Analysis to add wmparc_flag to ProjInfo_tags
% changed MMIL_Summarize_RSI_Analysis
%   to add wmparc_flag and wmparc_aparc_flag
%   to add area_flag

% changed ts_sim_dSPM to pass time to ts_synth_sensors_from_dSPM
% created ts_sim_spindle
% changed ts_sim_spindle to assume t0 and td are in msec

% changed MMIL_Analyze_RSI_Exams
%   to add wmparc_flag and wmparc_aparc_flag
%   to add wmparc_flag to ProjInfo_tags
% changed MMIL_Analyze_DTI_Exams
%   to add wmparc_flag to ProjInfo_tags
%   to set parms.frames = [] if cortsurf_resT1flag = 1
% changed mmil_cortsurf_analysis to set parms.frames = [] if parms.resT1flag = 1
% changed fs_paint to not pass verbose flag to fs_surf2surf

% rev 871

% changes to find_bem_surfs

% rev 872

% changed mmil_glm_calc to not give message about "less than tolerance"

% changed MEG_MMIL_dSROI_GroupAvg to define parms_filter in check_input
% changed MEG_MMIL_dSROI_GroupAvg_Resamp to save results to mat file
% created MEG_MMIL_Sensor_GroupAvg and mmil_args_MEG_MMIL_Sensor_GroupAvg
% changed ts_dSPM_set_chans to correct "purpose" statement
% created ts_set_chans
% changed ts_dSPM to update header

% changed MEG_MMIL_dSROI_GroupAvg_Resamp and MEG_MMIL_dSROI_GroupAvg_Diff_Resamp
%   to make default val of ranges_flag = "false", not "flag"

% changed dti_unwarpB0 to set fname_for_B0uw and fname_rev_B0uw
%   in check_input
% changed MMIL_Process_DTI to use catch me

% changed by Chun Chieh:
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exam.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exams.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Register_Exams.m
U    MMPS/matlab/MMIL_Analysis/MMIL_Analyze_Long_DTI_Exams.m

% rev 874

% changed MMIL_Series_Classify_All.csv and MMIL_Series_Classify_GE.csv
%   to require inversion_time > 0 for MPR (as in mmil_classify_GE)

% rev 875

% changed MMIL_Long_Setup_Exams to update formatting of header

% rev 876
% rev 877
% rev 878

% changed by Chun Chieh:
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exams.m
U    MMPS/matlab/MMIL_Longitudinal/MMIL_Long_Setup_Exam.m

% changed fsl_dti_measlist.csh to copy MD to MD, not TD to MD

% rev 881

% created mmil_calc_mean_lgi, mmil_create_cortex_label

% changed DTI_MMIL_Export_Data_for_FSL to update header formatting

% changed MMIL_Analyze_MRI_Exam
%   to not set aparc_flag = 0 before calling mmil_aseg_analysis
% changed to accept aparc_infix:
%   MMIL_Analyze_MRI_Exam, MMIL_Analyze_MRI_Exams,
%   MMIL_Compile_MRI_Analysis, MMIL_Summarize_MRI_Analysis
% changed fs_read_aparc_stats
%   to use aparc_infix instead of fstem_aparc
% changed fs_read_aparc_stats and mmil_surf_roi
%   to change valid roicode ranges to allow for a2009s

% created MMIL_Select_Struct_Series
% changed mmil_args2parms to make error message more accurate (triplet not pair)
% changed mmil_args_MMIL_Check_ProjID and mmil_args_MMIL_Get_StudyInfo
%   to include ignore_VisitInfo_flag in extra_tags
% changed MMIL_Get_StudyInfo and MMIL_Check_ProjID
%   to accept ignore_VisitInfo_flag
% changed MMIL_Select_Struct_Series
%   to accept add_missing_flag
%   set ignore_VisitInfo_flag

% changed by Chun Chieh to look for mgz files:
%   mmil_tools/mmil_estimate_B1RxRatio_GECal.m

% rev 883

% changed dti_unwarpB0 to set outdir for fname_for_B0uw and fname_rev_B0uw

% rev 884

% changed MEG_MMIL_dSROI_GroupAvg_Resamp to change default outdir and outstem
% changed MEG_MMIL_RCSE_GroupAvg_Resamp
%   to add plot_resps_flag
%   to save results to matfile

% changed MEG_MMIL_RCSE_GroupAvg_Diff_Resamp
%   to use subfunctions
%   to save results to matfile

% changed default outdir and outstem:
%   MEG_MMIL_dSROI_GroupAvg_Resamp.m
%   MEG_MMIL_dSROI_GroupAvg_Diff_Resamp.m
%   MEG_MMIL_Sensor_GroupAvg_Diff_Resamp.m
%   MEG_MMIL_RCSE_GroupAvg_Resamp.m
%   MEG_MMIL_Sensor_GroupAvg_Resamp.m
%   MEG_MMIL_RCSE_GroupAvg_Diff_Resamp.m
%   MEG_MMIL_RCSE_GroupAvg_DiffAreas_Resamp.m
%   MEG_MMIL_RCSE_GroupAvg_ErrMap_Resamp.m
%   MEG_MMIL_RCSE_GroupAvg_Err_Resamp.m

% changed ts_bootstrap_wforms to set results.time = parms.time

% changed to accept peak_pol and peak_range:
%   MEG_MMIL_RCSE_GroupAvg_DiffAreas_Resamp.m
%   MEG_MMIL_RCSE_GroupAvg_Diff_Resamp.m
%   MEG_MMIL_RCSE_GroupAvg_Err_Resamp.m
%   MEG_MMIL_RCSE_GroupAvg_Resamp.m
%   MEG_MMIL_Sensor_GroupAvg_Diff_Resamp.m
%   MEG_MMIL_Sensor_GroupAvg_Resamp.m
%   MEG_MMIL_dSROI_GroupAvg_Diff_Resamp.m
%   MEG_MMIL_dSROI_GroupAvg_Resamp.m

% changed ts_plot_responses to allow linewidth to be a vector

% changed to accept save_synth_data_flag:
%   rcse/rc_dSPM_RCSE.m
%   MEG_Analysis/MEG_MMIL_dSPM_RCSE.m
%   MMIL_Analysis/MMIL_Analyze_MEG_Exam.m
%   MMIL_Analysis/MMIL_Analyze_MEG_Exams.m

% rev 885

% changed rc_dSPM_RCSE to create output dir before trying to save synth data

% changed MMIL_Process_DTI to include outfix in fname_reg
# NOTE: this fixes serious problem with registration between scans
#   that affects any DTI sessions with separate B0 calibration scans (not IPP)
#   the error was introduced in MMPS_233

% rev 886

% changed rc_dSPM_RCSE to use dSPM_parms.prefix for output file name
%   for synth_data and fif files

% rev 887

% updated version.NOTES

#############################################################################
#############################################################################

## MMPS_237: medium revision
## Don Hagler 10/18/13

% changed ts_prep_EEG_info and ts_prep_MEG_info to include labels
% copied mxhang/gain_intpnt2chan.m to timesurfer/functions/ts_gain_intpnt2chan.m

% changed ts_dSPM_baseline_corr to not return modified parms
% changed ts_dSPM to not get parms from ts_dSPM_baseline_corr

% changed ts_calc_inverse_operator and ts_calc_inverse_operator_amd
%   to update headers and formatting

% created ts_calc_gainmat
%   adds openmeeg forward solution as an option

% removed ts_calc_bem_gainmat and ts_calc_sph_gainmat
% removed ts_tf_dSPM
% change ts_dSPM
%   use subfunctions
%   call ts_calc_gainmat instead of ts_calc_bem_gainmat and ts_calc_sph_gainmat
%   created subfunctions calc_data_scale_matrix, prep_noise, prep_forward,
%     baseline_corr, init_fit_struct, check_output, set_chans, write_stc_files
%     write_mgh_files, save_results, apply_inverse, sourcecov
% removed ts_dSPM_data_scalematrix, ts_dSPM_calc_scalefacts,
%   ts_dSPM_prep_forward, ts_dSPM_baseline_corr, ts_dSPM_init_fiterr,
%   ts_dSPM_check_output, ts_dSPM_set_chans, ts_dSPM_write_stc,
%   ts_dSPM_write_mgh, ts_dSPM_save_results, ts_dSPM_apply_inverse,
%   ts_dSPM_sourcecov
% changed ts_calc_inverse_operator to use varargin, subfunctions
%   accept prewhiten_flag with default = 0
%   consolidated with ts_calc_inverse_operator_amd
% removed ts_calc_inverse_operator_amd
% changed ts_dSPM to use prewhiten_flag instead of amd_inverse_flag
% changed ts_set_chans to return ind_bad, accept verbose
% changed ts_dSPM to call ts_set_chans

% changed rc_RCSE_prep_forward to use ts_calc_gainmat
% changed rc_RCSE_func to include parms.gainmat_tags

% changed ts_dSPM to set useEEG_flag and useMEG_flag
% changed ts_calc_gainmat to set G_xyz_MEG and G_xyz_EEG to []
%   if useMEG_flag or useEEG_flag = 0

% changed rc_RCSE_rand_offset_search, rc_RCSE_rand_rscale_search,
%         rc_RCSE_rand_rot_search, rc_RCSE_rand_rf_search,
%         rc_RCSE_rand_nbrhood_search, rc_RCSE_full_offset_search,
%         rc_RCSE_full_nbrhood_search, rc_RCSE_fmincon_offset_search
%   to call rc_plot_sources instead of plot_sources
%   to pass area_names and area_colors to rc_plot_sources
%   to call rc_plot_fitvar_results instead of plot_fitvar_results
% changed ts_dSPM to detect flat channels from scalefacts
%   and then recalculate chantype scalefacts
% changed rc_RCSE_func to use local subfunctions
%   changed GRAD_UNITSFACT to grad_unitsfact, etc.
%   moved code from rc_RCSE_check_parms to check_input, etc.
%   changed so parms are saved every time, regardless of forceflag
%   changed how scalefacts are calculated to be like ts_dSPM
% removed rc_RCSE_check_parms
% changed rc_simret to use parms.grad_unitsfact, etc.
% changed rc_RCSE_prep_forward to use parms.grad_unitsfact, etc.
% removed rc_RCSE_calc_nbrhds
% changed rc_calc_vf2ctx to not give status message
% changed rc_RCSE_func, rc_RCSE_rand_rf_search, and rc_RCSE_rand_scale_search
%   to use rc_calc_vf2ctx instead of rc_RCSE_calc_vf2ctx
% removed rc_RCSE_calc_vf2ctx
% moved code from rc_RCSE_prep_forward to rc_RCSE_func
% removed rc_RCSE_prep_forward
% changed rc_RCSE to accept nnbrs
% change rc_RCSE_func to include all vertices in nbrhds
%  in lh_verts and rh_verts

% changed rc_retfit_func, rc_retfit, rc_ready_retfit, BOLD_MMIL_Ready_RetFit
%   to accept roi_dilate_niters
% changed rc_retfit_func to dilate roi and resample original roi to grid
%   for use in vacancy cost and outbound penalty

% changed fs_smooth_sparse to use mmil_check_nargs

% changed to set default grid_offset_smooth = 0:
%   MEG_Analysis/MEG_MMIL_RCSE.m
%   MMIL_Analysis/MMIL_Analyze_MEG_Exam.m
%   MMIL_Analysis/MMIL_Analyze_MEG_Exams.m
%   rcse/rc_RCSE.m
%   rcse/functions/rc_RCSE_func.m
%   rcse/functions/rc_synth_RCSE_noise.m
%   rcse/functions/rc_synth_RCSE_offsets.m

% changed rc_combine_retfit to save area_data
%   with separate u and v, etc. for each area
% changed rc_load_retfit_results to loop over tags including area_data
% changed rc_define_retmap_from_retfit to use area_data if available

% created MEG_MMIL_Synth_RCSE
% changed MMIL_Analyze_MEG_Exam and MMIL_Analyze_MEG_Exams
%   to accept SRC options and call MEG_MMIL_Synth_RCSE
% created mmil_args_MEG_MMIL_Synth_RCSE

% changed rc_retfit_func
%   to normalize coordinates to size of original ROI, not dilated ROI

% changed to accept max_outbound_penalty:
%   rcse/rc_ready_retfit
%   BOLD_Analysis/BOLD_MMIL_Ready_RetFit.m
%   MMIL_Analysis/MMIL_RetFit_BOLD_Exam.m
%   MMIL_Analysis/MMIL_RetFit_BOLD_Exams.m

% changed to reduce minimum for map_scale_u, map_scale_v,
%     map_scale_u_range, and map_scale_v_range to 0.01:
%   rc_retfit_func, rc_retfit, rc_ready_retfit

% changed rc_retfit_func
%   to create roi_mask, err_mask, and data_mask
%   to set pol_r and pol_i to 0 outside of data_mask
%   to set err gradient (dpr_du, etc.) to 0 for
%     ind_exclude, ind_nondata, and ind_bad_nodes
%   to set pol_r_err to 1/std_pol_r etc. outside of data_mask
%   to set std_pol_r to max of std_pol_r and std_pol_i/2

% changed MEG_MMIL_GroupRCSE to use -v7.3 switch when saving subject data

% created_mmil_create_nft_mesh, mmil_convert_nft_mesh

% changed REC_MMIL_Analyze_Long_Exams to accept batchname
% changed MMIL_Analyze_Long_Exam
%   to pass FSContainerPath to MMIL_Analyze_MRI_Exam

% rev 889

% changed MEG_MMIL_RCSE_GroupAvg to add plot_subj_flag with default = false
% changed mmil_args_MEG_MMIL_RCSE_GroupAvg to add plot_subj_flag to extra_tags
% changed MEG_MMIL_GroupRCSE_Contrast to add plot_subb_flag

% changed ts_dSPM to fix problem with calculation of scalefacts

% changed ts_calc_gainmat
%   to create a temporary directory with a randomly generated number
%   to create a function to override the built-in tempdir function
%   to accept rootoutdir
% NOTE: this is so that multiple instances of openmeeg (e.g. running on cluster)
%   will not fill up /tmp
% changed to pass rootoutdir to ts_calc_gainmat:
%   rcse/functions/rc_RCSE_func.m
%   timesurfer/ts_dSPM.m

% changed ts_calc_gainmat so EEF_sf is positive, not negative
% changed conduct_scalefact to EEG_gain_scalefact, allow negative values:
%   MEG_Analysis/MEG_MMIL_RCSE.m
%   MEG_Analysis/MEG_MMIL_dSPM.m
%   MMIL_Analysis/MMIL_Analyze_MEG_Exam.m
%   MMIL_Analysis/MMIL_Analyze_MEG_Exams.m
%   mmil_args/mmil_args_rc_RCSE.m
%   rcse/rc_RCSE.m
%   rcse/rc_dSPM_RCSE.m
%   timesurfer/ts_dSPM.m
%   timesurfer/ts_vestal.m
%   rcse/functions/rc_RCSE_func.m
%   rcse/functions/rc_simret.m
%   rcse/functions/rc_synth_RCSE_noise.m
%   rcse/functions/rc_synth_RCSE_offsets.m
%   timesurfer/functions/ts_sim_dSPM.m

% changed to use prewhiten_flag instead of amd_inverse_flag:
%   MEG_Analysis/MEG_MMIL_dSPM.m
%   MEG_Analysis/MEG_MMIL_dSPM_RCSE.m
%   MMIL_Analysis/MMIL_Analyze_MEG_Exam.m
%   MMIL_Analysis/MMIL_Analyze_MEG_Exams.m
%   rcse/rc_dSPM_RCSE.m
%   rcse/rc_dSPM_RCSE.m
%   timesurfer/functions/ts_sim_dSPM.m

% changed rc_RCSE, MEG_MMIL_RCSE, MMIL_Analyze_MEG_Exam, MMIL_Analyze_MEG_Exams
%   to accept grad_scalefact, mag_scalefact, EEG_scalefact
% changed rc_RCSE_func to initialize scalefacts as zeros

% rev 890

% created utility functions for ts_bootstrap_wforms:
%   timesurfer/functions/ts_calc_bs_pval.m
%   timesurfer/functions/ts_calc_bs_ci.m
%   timesurfer/functions/ts_calc_bs_ci_bias.m
%   timesurfer/functions/ts_calc_bs_null_pval_bias.m
%   timesurfer/functions/ts_calc_bs_bias.m
%   timesurfer/functions/ts_calc_bs_acceleration.m
%   timesurfer/functions/ts_calc_bs_null_pval.m
%   timesurfer/functions/ts_calc_bs_pct_bias.m
%   timesurfer/functions/ts_calc_bs_pct.m
% changed ts_bootstrap_wforms to use new utility functions instead of
%   local subfunctions

% changed to make more general by adding input parameters
%     "conditions", "cond_label", "cond_lim", and "cond_varname":
%   MEG_MMIL_RCSE_GroupAvg_Diff_Resamp 
%   MEG_MMIL_RCSE_GroupAvg_Resamp
%   MEG_MMIL_dSROI_GroupAvg_Diff_Resamp
%   MEG_MMIL_Sensor_GroupAvg_Diff_Resamp

% changed to make more general by adding input parameters "cond_varname":
%   MEG_MMIL_dSROI_GroupAvg_Resamp
%   MEG_MMIL_Sensor_GroupAvg_Resamp

% changed to use -v7.3 switch when saving mat files:
%   MEG_MMIL_RCSE_GroupAvg_Diff_Resamp.m
%   MEG_MMIL_RCSE_GroupAvg_ErrMap_Resamp.m
%   MEG_MMIL_RCSE_GroupAvg_Resamp.m
%   MEG_MMIL_Sensor_GroupAvg_Diff_Resamp.m
%   MEG_MMIL_Sensor_GroupAvg_Resamp.m
%   MEG_MMIL_dSROI_GroupAvg_Diff_Resamp.m
%   MEG_MMIL_dSROI_GroupAvg_Resamp.m

% changed to calculate statistics for average across conditions
%    for peak, onset, and auc:
%   MEG_MMIL_RCSE_GroupAvg_Diff_Resamp.m
%   MEG_MMIL_Sensor_GroupAvg_Diff_Resamp.m
%   MEG_MMIL_dSROI_GroupAvg_Diff_Resamp.m

% rev 891

% updated documentation/setup/startup_MMPS.m from
%   /space/md7/1/pubsw/packages/MMPS/startup_MMPS.m

% created link from:
%   /space/md10/8/svn/mmildev/mmildev/mmil/MMPS/documentation/setup/startup_MMPS.m
% to:
%   /space/md7/1/pubsw/packages/MMPS/startup_MMPS.m

% copied setup scripts from /usr/pubsw/bin:
%   MMPS/documentation/setup/SetUpMMSW.csh
%   MMPS/documentation/setup/SetUpFSL.csh
%   MMPS/documentation/setup/startup_MMPS.m
%   MMPS/documentation/setup/SetUpMatlab.csh
%   MMPS/documentation/setup/SetUpMEG.csh
%   MMPS/documentation/setup/SetUpMEG_new.csh
%   MMPS/documentation/setup/SetUpAFNI.csh
% moved SetUpMEG_new.csh to SetUpMEG.csh

% rev 892

% removed external dir

% rev 893

% created SetUpMNE.csh from code in SetUpMEG_new.csh
% changed SetUpMEG.csh to be like old SetUpMEG.csh

% created versioning for external dir
% created link to external in MMPS

% as mmildev:
% created links to external in MMPS for all existing versions
% copied ~mmilrec17/matlab/MMPS_nonsvn/imagineMRI to:
%   /space/md7/1/pubsw/packages/MMPS/external/external.2013.11.08/matlab
% copied /space/md8/1/data/dhagler/work/projects/sleep/packages/OpenMEEG to:
%    /space/md7/1/pubsw/packages/MMPS/external/external.2013.11.08/OpenMEEG
% copied /space/md8/1/data/dhagler/work/projects/sleep/packages/NFT/NFT-2.3_64bit to:
%    /space/md7/1/pubsw/packages/MMPS/external/external.2013.11.08/NFT-2.3_64bit
% created link from external.2013.11.08/NFT-2.3_64bit/mfiles to:
%   external.2013.11.08/matlab/NFT-2.3
% copied /space/md8/1/data/dhagler/work/projects/sleep/packages/fieldtrip/fieldtrip-20110912 to:
%   /space/md7/1/pubsw/packages/MMPS/external/external.2013.11.08/matlab/fieldtrip-20110912
% copied /space/md8/1/data/dhagler/work/projects/sleep/packages/SmoothPatch to:
%   /space/md7/1/pubsw/packages/MMPS/external/external.2013.11.08/matlab/SmoothPatch

% changed MEG_MMIL_RCSE_GroupAvg to error if input files are missing

% changed dti_render_AtlasTrack to not deblank colors (already numeric)

% changed MMIL_Select_Struct_Series to create subplots, remove files

% created MMIL_Update_VisitInfo to add missing subjects, get SubjID

% rev 897

% changed rc_RCSE to accept tfvec like sfvec, find field tempfreq or tfreq

% changed to accept tfvec:
%   MEG_MMIL_RCSE, MMIL_Analyze_MEG_Exam, MMIL_Analyze_MEG_Exams

% changed MMIL_Select_Struct_Series to accept attempt_flag and attempt_window
%   combined review for subjects with multiple attempts

% rev 898

% changed DTI_MMIL_Export_Data_for_FSL
%   to pass forceflag to fs_dti_measlist.csh and fsl_dti_data.csh
%   to not load data if output already exists
%   to not call fs_dti_measlist.csh and fsl_dti_data.csh
%     if all output already exists
% changed fsl_dti_measlist.csh and fsl_dti_data.csh to use forceflag

% changed dti_AtlasTrack to save M_Atlas_to_Subj in extra rigid.mat file
%   for faster loading on reprocess
% changed dti_mask_fibers to check if output files exist before running

% changed BOLD_MMIL_Export_Data_for_FSL to not run fsl_fmri_preproc.csh
%   if summary.txt file already exists (unless forceflag = 1)

% rev 899

% set setup scripts to be executable

% rev 900

% changed MMIL_Process_Exam to add \n to WARNING

% created sv_complex_vals, mmil_cmap_polar, mmil_cmap_eccen

% rev 901

% changed sv_surf_view
%   to use subfunctions, forceflag
%   to accept colorscale option, handle linear, polar, eccen, and category

% rev 902

% changed to use error instead of ERROR or WARNING
%   MEG_MMIL_RCSE_GroupAvg
%   MEG_MMIL_Sensor_GroupAvg
%   MEG_MMIL_dSROI_GroupAvg

% changed ts_sim_dSPM to include openmeeg_flag in dSPM_tags

% changed ts_dSPM to fix gainmat_tags
%   useMEG_flag and useEEG_flag instead of usegMEG_flag and usegEEG_flag

% renamed dti_CSD_to_dtiStudio_fiber to dti_CSD_to_DTIStudio_fiber
% renamed dti_read_dtiStudio_fiber to dti_read_DTIStudio_fiber
% renamed dti_write_dtiStudio_fiber to dti_write_DTIStudio_fiber

% rev 903

% changed rc_retfit_func so in plot, backround area_codes are 0, not NaN
% changed rc_ready_retfit to regroup some parameters
% changed to use default prereg_nruns_quick = 2:
%   rcse/rc_ready_retfit.m
%   BOLD_Analysis/BOLD_MMIL_Ready_RetFit.m
%   MMIL_Analysis/MMIL_RetFit_BOLD_Exam.m
%   MMIL_Analysis/MMIL_RetFit_BOLD_Exams.m 

% changed MMIL_Analyze_BOLD_Exams
%   to pass proc_bold as ContainerType to MMIL_Get_Container

% changed BOLD_MMIL_GLM_ROI_Analysis
%   to pass ROI_names to rc_create_retfit_labels as area_names

% rev 904

% changed BOLD_MMIL_GLM_ROI_analysis
%   to set resp if norm_flag = 0
%   to set weights in combine_ROI_data if iresp_flag = 0
% changed BOLD_MMIL_GLM_ROI_GroupAvg to quit if missing data

% changed to use rf_r_inter:
%   MMIL_Analyze_MEG_Exam, MMIL_Analyze_MEG_Exams
%   MEG_MMIL_RCSE, rc_RCSE, rc_RCSE_func

% changed rc_calc_vf2ctx
%   to calculate separate mappings for each area
%     NOTE: this should prevent excess memory usage
%   to not save mappings as sparse, save vertex indices from area_masks instead
%     NOTE: this should save time (2-3 seconds per hemisphere)
%   to return vf2ctx as struct array with size = [nareas,nhemis]
% changed to use vf2ctx instead of vf2ctx_maps:
%   rcse/extra/rc_create_wfiles_from_retfit.m
%   rcse/functions/rc_RCSE_func.m
%   rcse/functions/rc_RCSE_mstart_offset_search.m
%   rcse/functions/rc_RCSE_rand_rf_search.m
%   rcse/functions/rc_RCSE_rand_rscale_search.m
%   rcse/functions/rc_RCSE_retmap_from_retfit.m
%   rcse/functions/rc_create_retfit_labels.m
%   rcse/functions/rc_define_retmap_from_retfit.m
% changed rc_define_retmap_from_retfit
%   to use separate vf2ctx for each area

% rev 905

% changed to use 'Color' when plotting allow use of rgb vectors as colors:
%   rc_plot_sources, MEG_MMIL_RCSE_GroupAvg, rc_analyze_wforms
%   BOLD_MMIL_GLM_ROI_GroupAvg, ts_plot_responses

% created ts_nan_std
% changed ts_nan_mean to use X and Y instead of in and out
% changed ts_bootstrap_wforms
%   to calculate wforms_bs_mean instead of wforms_mean_resamp
%   to calculate wforms_bs_sem as std of wforms_resamp_mean
%   to use wforms_bs_ci instead of wforms_mean_ci
%   to use ts_nan_std to calculate peak, onset, auc sem
% changed to use wforms_bs_ci instead of wforms_mean_ci:
%   MEG_Analysis/MEG_MMIL_RCSE_GroupAvg_DiffAreas_Resamp.m
%   MEG_Analysis/MEG_MMIL_RCSE_GroupAvg_Diff_Resamp.m
%   MEG_Analysis/MEG_MMIL_RCSE_GroupAvg_Err_Resamp.m
%   MEG_Analysis/MEG_MMIL_RCSE_GroupAvg_Resamp.m
%   MEG_Analysis/MEG_MMIL_Sensor_GroupAvg_Diff_Resamp.m
%   MEG_Analysis/MEG_MMIL_Sensor_GroupAvg_Resamp.m
%   MEG_Analysis/MEG_MMIL_dSROI_GroupAvg_Diff_Resamp.m
%   MEG_Analysis/MEG_MMIL_dSROI_GroupAvg_Resamp.m
% changed to use ts_nan_std to calculate peak, onset, auc sem:
%   MEG_Analysis/MEG_MMIL_RCSE_GroupAvg_Diff_Resamp.m
%   MEG_Analysis/MEG_MMIL_RCSE_GroupAvg_Resamp.m
%   MEG_Analysis/MEG_MMIL_Sensor_GroupAvg_Diff_Resamp.m
%   MEG_Analysis/MEG_MMIL_Sensor_GroupAvg_Resamp.m
%   MEG_Analysis/MEG_MMIL_dSROI_GroupAvg_CondAvg.m
%   MEG_Analysis/MEG_MMIL_dSROI_GroupAvg_Diff_Resamp.m
%   MEG_Analysis/MEG_MMIL_dSROI_GroupAvg_Resamp.m

% changed mmil_write_csv to make error message about col labels
%   specify second dim, not first

% rev 906

% changed mmil_glm to accept write_mgh_flag

% changed MMIL_Analyze_MEG_Exams to use qmatjobs2 for SRC and dSRC

% changed mmil_glm_csv to be more specific in finding nonlinear regressors
%   for scatter plots

% rev 907

# as mmildev:
#   linked eternal.2013.11.08 to mmilcluster and mmilcluster3
#   rsync'd external.2013.11.08 to mmilcluster4

% changed SetUpMMPS.csh
%   to set MMPS_EXT to MMPS_DIR/external instead of MMPS_PARENT/external
%   to add MMPS_EXT/OpenMEEG/bin to path
%   to check that dirs exist before adding to path
%   to add MMPS_EXT/OpenMEEG/lib to LD_LIBRARY_PATH (if it exists)

% rev 908

% changed ts_gain_xyz2norm to comment out fprintf messages
% changed ts_synth_sensors_from_dSPM to give G_norm as output
%   and accept G_norm as input
% created ts_synth_spindles_from_dSPM
% changed ts_postprocess_avg to update header format
% changed ts_synth_sensors_from_dSPM
%   to pass baseline_flag = 0 to ts_postprocess_avg
%   to pass pad_nsamples to ts_postprocess_avg
% changed ts_synth_sensors_from_dSPM to accept verbose

% rev 909

% changed ts_synth_spindle_from_dSPM
%   to accept npatches, npatches_pool, and npatch_radius options

% changed rsi_fit_MFOD to allow division by 0 with norm_flag
%   (nans set to 0 later)

% changed dti_correct_data to save censor_mat and censor_err in mat file

% changed MMIL_Classify_Dicoms to add '_REJECT' to SeriesType for reject series
%   instead of replacing series type with 'REJECT'

% created MMIL_Select_DTI_Series

% created ts_extract_spindles (works with August Tan's spindle detection output)

% changed MMIL_Series_Classify_Siemens.csv to correct the first column header
%   to be "SeriesType"

% changed ts_extract_spindles to adjust sample index for
%   data, convolved, and smoothed

% created ts_calc_spindle_metrics

% rev 910

% changed mmil_reorient_for_nft to use fs_reorient
% created mmil_nft_seg
% changed fs_mri_convert to update header

% changed mmil_makeBEMsurfs_fromT1 to use mmil_mkdir, accept options string

% created external_mods dir, moved ProjectMods to external_mods/Projects
% created external_mods/NFT
% copied nft_get_config to external_mods/NFT

% rev 911

% changed nft_get_config to set nft_dir

% changed mmil_convert_MEDIC to remove "vols" (unused)

% changed mmil_copy_dicoms to save sorted EchoTimes
# NOTE: this fixes problem with conversion of MEDIC scans
#   for studies with those scans,
#     raw and proc containers should be deleted and regenerated

% changed mmil_copy_dicoms to not convert forceflag to uint8

% changed mmil_check_series to not sort (already done by mmil_copy_dicoms)
%   and to not set fnames (use existing FileNames instead)

% changed to use FileNames instead of fnames:
%   mmil_convert_B1.m
%   mmil_convert_BOLD_GE.m
%   mmil_convert_BOLD_Philips.m
%   mmil_convert_BOLD_Siemens.m
%   mmil_convert_DTI_GE.m
%   mmil_convert_DTI_Philips.m
%   mmil_convert_DTI_Siemens.m
%   mmil_convert_FMAP.m
%   mmil_convert_GEB1CAL.m
%   mmil_convert_MEDIC.m
%   mmil_convert_structural.m

% rev 912

% changed MMIL_Process_MEG to update header
%   create ContainerInfo before running ts_process_fif_data

% changed ts_read_fif_events to correctly handle lack of events

% changed ts_avg_fif_data to update header

% changed ts_process_fif_data
%   to only warn (not error) if evnts is empty
%   and to create dummy event

% changed startup_MMPS to only add spm5b to path if fieldtrip-20110912 not found

% rev 913

% changed startup_MMPS to clear fieldtrip_dir

% rev 914

% changed MMIL_Check_StudyInfo to fix age calculation
%   (was using StudyDate and DOB
%    not StudyInfo(s).StudyDate and StudyInfo(s).DOB)

% changed ts_synth_spindles_from_dSPM
%   to correct problem with setting amp depending on uniform_flag
%   to add indy_flag

% created mmil_corr_mat to calculate correlation coefficients for two matrices
% created mmil_classify_columns
% changed mmil_glm to use mmil_classify_columns
% created mmil_twin_analysyis
% added mx dir containing some mx scripts written for VETSA
% added mx167 to bin

% rev 915

% changed MMIL_Import_FSRecon_QC to use mmil_csvs2struct, save QC as FSQC
% changed MMIL_Get_StudyInfo to get QC info even if qcflag = 0
% changed MMIL_Get_QCInfo to use FSQC
%   NOTE: allowed for old style ASEGQC and SurfaceQC with 'good','bad','average'

% rev 916

% changed MMIL_Import_DTI_QC to use mmil_csvs2struct, save QC as DTIQC
% changed MMIL_Get_QCInfo to use numeric DTIQC
%   NOTE: allowed for old style DTIQC with 'good','bad','average'

% changed mmil_estimate_B1RxRatio_ADNI to accept ext as optional input
% changed mmil_estimate_B1RxRatio_GE to use varargin
%   accept MPR, FLASHhi, and FLASHlo as stypes (not MPR, HIFA, and LOFA)
% changed MMIL_B1Corr_Structurals to pass options
%   to mmil_estimate_B1RxRatio_ADNI and mmil_estimate_B1RxRatio_GE
% changed mmil_atlas_jpdfreg_func2struct to use varargin
%   handle stypes of FLASHhi and FLASHlo
% changed mmil_estimate_B1RxRatio_GE and init_jpdf_MPR_GECAL
%   to use 'key',values for mmil_atlas_jpdf_func2struct
% changed mmil_dct_brainmask to include mfilename in warning
% changed mmil_check_B1corr to not set B1corr_flag = 1 if coilname is 'BODY'

% changed mmil_classify_by_rules to catch error with construction of expression

% changed MMIL_Summarize_MRI_DTI_Analysis to use concat_outfix

% changed rsi_fit_MFOD to clarify comments

% moved rsi_FOD_matrix, rsi_SH_matrix, and rsi_plot_FOD to rsi_tools
% removed rsi_utils

% rev 917

% created rsi_plot_FOD_vox
% changed rsi_fit_MFOD to accept ADC_iso_vals, etc.
% changed rsi_calc_MFmeas to output volI
% created rsi_fit_ROI

% rev 918

% created rsi_fit_ROI_DT, rsi_fit_ROI_MFI, and rsi_fit_ROI_MI
% changed rsi_fit_ROI to perform nonlinear fitting for ADC_long, ADC_free, etc.
% changed rsi_fit_ROI, rsi_fit_MFOD, rsi_fit_ROI_MFI, rsi_fit_ROI_MI,
%   and rsi_fit_iso to make upper bounds for L0 or I be 100
% changed rsi_fit_ROI_DT, rsi_fit_ROI_MFI, and rsi_fit_ROI_MI
%   to make norm_err calculation work for single voxel fitting
% changed rsi_fit_ROI to force beta_val to be within beta_range

% changed MMIL_Process_Exam to add ";" to silence display of ContainerRootDir

% changed MMIL_Summarize_MRI_DTI_Analysis to have separate subjinfo_tags

% rev 919

% changed by Hauke (to allow '-', '+', and '^' in VisitID):
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exam.m
U    MMPS/matlab/MMIL_Stream/MMIL_Classify_Exams.m
U    MMPS/matlab/MMIL_Stream/MMIL_Process_Exams.m
U    MMPS/csh/qmatjob
U    MMPS/csh/runmatjob

% rev 921

% changed ts_set_chans to only require nargin>1 (not 2)

% used dos2unix to convert fast_univariate_AE.mx

% changed ts_synth_sensors_from_dSPM and ts_synth_spindles_from_dSPM
%   to accept grad_noise, mag_noise, and EEG_noise

% changed mmil_twin_analysis to fix problems with writing mx input files

% changed MMIL_Long_Register_Exams to update header
% changed MMIL_Analyze_Long_Exams to accept ProjID as required input
% removed REC_MMIL_Analyze_Long_Exams
% removed REC_MMIL_Summarize_MRI_Analysis
% removed REC_MMIL_Summarize_DTI_Analysis
% removed REC_MMIL_Concat_MRI_SurfStats
% removed REC_MMIL_Compile_MRI_Analysis
% removed REC_MMIL_Analyze_MRI_Exams
% removed REC_MMIL_Analyze_DTI_Exams
% removed REC_MMIL_Process_Exams
% removed REC_MMIL_PreProcess_Exams
% removed REC_MMIL_Long_Setup_Exams
% removed REC_MMIL_Long_Register_Exams
% removed REC_MMIL_IcoResamp_FSRecon_Exams
% removed REC_MMIL_Freesurfer_Recon_Exams
% removed REC_MMIL_Create_BEM_Exams
% removed REC_MMIL_Classify_Exams

% rev 922

% changed mmil_args_MMIL_Long_Register_Exams to remove require_rootdirs, etc.
%   and update name in header
% created mmil_args_MMIL_Analyze_Long_Exams
% changed MMIL_Compile_Long_Analysis to accept ProjID as required input
% removed REC_MMIL_Compile_Long_Analysis
% changed MMIL_Summarize_Long_DTI_Analysis to update header
% changed MMIL_Summarize_Long_Analysis to accept ProjID as required input
% removed REC_MMIL_Summarize_Long_Analysis

% rev 923

% changed MMIL_Analyze_Long_Exam to use hidden option analyze_mri_tags

% rev 924

% changed MMIL_Long_Register_Exam
%   updated header
%   commented out check if outdir exists

% changed MMIL_Analyze_Long_Exam to use mmil_multi_roi, not fs_multi_roi
% changed MMIL_Summarize_Long_Analysis
%   to use getenv('HOME')
%   to make default analysis_outdir = 'analysis', not 'T1analysis'

% changed ts_plot_responses to accept fill_err_flag and fill_alpha

% changed sv_surf_view to squeeze vals for categorical
%   made inflated the default surfname

% changed MMIL_Compile_DTI_Analysis to add erode to infix for wmparc

% changed MMIL_Compile_DTI_Analysis to load mean_motion, mean_trans, and mean_rot
% changed MMIL_Summarize_DTI_Analysis to include mean_motion, etc.

% changed mmil_normvol_linfit to return sf and r, optionally save to mat file

% changed MMIL_Analyze_DTI_Exam to save T2w sf and r in mat file

% changed MMIL_Summarize_MDTI_DTI_Analysis to include motion, T2_sf, etc.
%   to accept wmparc_flag and wmparc_aparc_flag

% rev 925

% changed MMIL_Compile_Long_Analysis
%   to return data_baseline and data_followup
%   added subfunctions

% changed MMIL_Summarize_Long_Analysis
%   to interleave columns for baseline and change
%   options to omit baseline or use followup (calculated) instead of change

% rev 926

% changed DTI_MMIL_Get_ScanInfo to accept verbose option

% changed ts_synth_spindles_from_dSPM to create topoplot at time of max
% changed ts_topoplot_avg to use mmil_args2parms, allow 'grad' chantype

% changed ts_extract_hpts_from_fiff to include eeg and label eeg_ref
% changed ts_pointreg to display eeg and eeg_ref in different colors

% renamed rc_peakdet to mmil_peakdet
% changed to use mmil_peakdet:
%   rc_analyze_wforms
%   ts_wforms_peaks
% changed to refer to mmil_peakdet:
%   MEG_MMIL_GroupRCSE_Contrast
%   MEG_MMIL_RCSE_GroupAvg
%   MEG_MMIL_dSROI_GroupAvg

% created ts_find_spindles
%   original (ts_locate_spindles) by Xi Jiang, with extensive mods by DH
% created mmil_extrema
%   original by Carlos Aguilera (downloaded from matlab central)
%   reformatted header

% rev 927

% changed ts_find_spindles to accept sfreq as required input, etc.

% rev 928

% changed ts_find_spindles to accept trimmed_epochs_flag (default = 0)
%   so as to return epochs with fixed durations centered on spindles

% changed MMIL_Summarize_MRI_DTI_Analysis to correctly handle T2w and motion
%   for subjects with missing DTI data (initialize vector with NaNs)

% changed MMIL_Series_Classify_*.csv
%   to include matchi SequenceLabel column
%   for All, GE, and Strict
%     moved "MMILDTI" to matchi SequenceLabel column
%     changed epi2_pepolar row (DTI_ipp) to set gradwarpinfo_dot_unwarpflag = 0
% changed mmil_detect_gradwarp to discard edges if all zeros before
%   testing fraction of zeros in border
# NOTE: requires reprocessing DTI data
#   with forced reclassification
#   (e.g. remove MRIRAW*/ContainerInfo.mat and MRIRAW*/SeriesInfo.csv)

% changed mmil_atlas_jpdfreg_func2struct to use parms.jpdffname instead of jpdffname
% changed MMIL_B1Corr_Structurals to set fname_hires before checking

% rev 929

% changed by Adam
U    MMPS/matlab/timesurfer/functions/ts_collapse.m

% rev 930

% changed MEG_MMIL_Reg2MRI to update header

% changed mmil_read_mdhStruct to return errcode if failed to read correctly
% changed mmil_modify_serinfo_Siemens to check errcode from mmil_read_mdhStruct

% changed MMIL_Freesurfer_Recon_Exams to update header

% created parms/QUARC_robust
%   copied from /home/holland/ADNI/old/paramsRobustRerun04

% changed MMIL_Register_and_Resample_MRI_Volumes to produce _res file
%   when there is a single file and no corrections

% changed to accept STRUCT_nativeflag or nativeflag:
%   MMIL_Register_and_Resample_MRI_Volumes
%   MMIL_Process_Structurals
%   MMIL_Process_Exam
%   MMIL_Process_Exams

% changed to accept gca_dir, gca, and gca_skull
%   fs_recon
%   MMIL_Freesurfer_Recon_Exam
%   MMIL_Freesurfer_Recon_Exams

% rev 931

% changed MMIL_Summarize_Long_Analysis to catch mistakes in specifying
%   visit numbers

% changed find_bem_surfs cpp files to include stdlib.h, etc.
%   recompiled find_bem_surfs
% changed mmil_makeBEMsurfs_fromPD to add "/" to end of tri_file_dir
#   NOTE: tri_file_dir must end with "/"
#         or will get seg fault because tri file is not actually read
#         and values of -1 are later used to index an array -> seg fault

% changed MMIL_Register_and_Resample_MRI_Volumes
%   to include MEDIChi and MEDIClo in default scantypes

% changed MMIL_Analyze_MRI_Exam
%   to add tic statement in analyze_aseg_T1w

% changed MMIL_Process_Exam and MMIL_Process_Exams
%   to include MEDIChi and MEDIClo in default scantypes

% changed mmil_rbreg_vol2vol_jpdf
%   to set type2 to HIFA if is MEDICHI
%   to set type2 to LOFA if is MEDICLO

% changed mmil_jpdfreg_T1T2, mmil_jpdfreg2atl_T1T2, and mmil_jpdfreg2subj_T1T2
%   to update header, add spaces after =

% changed MMIL_nuCorr_Structurals
%  to remove FLASHlo, MEDIClo, and XetaT2 as scantypes
% changed MMIL_Apply_MRI_Corrections
%   to set nu_scantypes and only apply nu correction for those
% changed MMIL_Register_and_Resample_MRI_Volumes
%   to no use nu if loFA

% changed MMIL_Create_BEM_Exam and MMIL_Create_BEM_Exams to update header

% changed MMIL_Register_and_Resample_MRI_Volumes
%   to set suffix in subfunction
%   properly handle uw, nu

% changed mmil_rbreg_vol2vol_jpdf to use varargin, accept jpdfdir
% changed mmil_average_volumes and mmil_average_volumes_old to pass
%   key,value pairs to mmil_rbreg_vol2vol_jpdf
% renamed atlases dir to jpdf
% created init_jpdf_MPR_MEDICHI and init_jpdf_MPR_MEDICLO
% changed to pass key,value pairs to mmil_rbreg_vol2vol_jpdf
% and to write output jpdf file to pwd:
%   init_jpdf_FSNU_BOLD
%   init_jpdf_FSNU_DTI
%   init_jpdf_FLASHHI_FLASHLO
%   init_jpdf_FLASHHI_MPR
%   init_jpdf_MEDICHI_MEDICLO
%   init_jpdf_MPR_FLASHHI
%   init_jpdf_MPR_FLASHLO
% changed atlases link to point to:
%   /space/md18/2/data/mmildev/MMPS/atlases/atlases.2014.06.09

% changed MMIL_Register_and_Resample_MRI_Volumes
%   to copy fname_ref_res is atlasflag=1 and only one scan

% changed ts_find_spindles
%   to simplify edge detection and spindle rejection
%   to return rejected spindles

% rev 932

% created ts_sim_rand_spindles
% changed ts_find_spindles to exclude duplicate epochs

% rev 933

% changed mmil_nft_seg to accept root_indir, root_outdir, and outdir

% created ts_plot_spindles and ts_plot_spindles_vert
% changed ts_loadcnt to not get fourth output from fileparts
% changed ts_find_spindles to check for spindle at beginning and end of data

% changed mmil_create_nft_mesh to accept verbose option
% changed fs_mri_convert to accept verbose option
% created mmil_remakeBEMsurfs_withNFT

% rev 934

% changed MMIL_Create_BEM_Exam and MMIL_Create_BEM_Exams
%   to accept PD_NFT as BEMtype
% changed MMIL_Make_BEM_Surfs to call mmil_makeBEMsurfs_withNFT
% changed mmil_convert_nft_mesh to accept mesh_suffix instead of outstem
% renamed mmil_remakeBEMsurfs_withNFT to mmil_makeBEMsurfs_withNFT
% changed mmil_makeBEMsurfs_withNFT
%   to accept cpath and fspath as required
%   to accept fstem_aseg and fname_brain as optional
% changed MMIL_Copy_BEM_Surfs to work with bem_PD_NFT
% changed MMIL_Freesurfer_Recon_Exam
%   to allow PD_NFT as BEMtype
% changed MMIL_Copy_BEM_Surfs to create links without "4" at the end
%   e.g. inner_skull.tri, not inner_skull4.tri

% changed to use BEM surfs without "4" at the end:
%   MEG_Stream/MEG_MMIL_Reg2MRI.m
%   MEG_Analysis/MEG_MMIL_dSPM.m
%   MMIL_Analysis/MMIL_Analyze_MEG_Exam.m
%   MMIL_Analysis/MMIL_Analyze_MEG_Exams.m
%   rcse/rc_RCSE.m
%   timesurfer/ts_dSPM.m
%   timesurfer/ts_vestal.m
%   rcse/functions/rc_RCSE_func.m
%   rcse/plotting/rc_plot_ret_pots.m
%   timesurfer/plots/ts_headplot_avg.m

% changed fs_graymid to correctly check status from unix

% changed ts_find_spindles and ts_plot_spindles
%   to correctly calculate fft frequencies

% rev 935

% changed mmil_wtd_mad to correct header to state that w is optional
% changed mmil_wtd_mad to padd dim to mmil_wtd_median
% changed ts_find_spindles
%   to use mmil_wtd_mad
%   to offset and normalize peak_wavecoef and edge_wavecoef by med and mad

% changed mmil_construct_M to fix incorrect specification for some orients
%   e.g. ILA and SLP

% rev 936

% changed ts_find_spindles
%   to set default wavelet_edge_thresh = 3

% updated atlases link
%   ../atlases/atlases.2014.06.09

% rev 937

% changed ts_find_spindles
%   to exclude rejects that overlap with accepted spindles

% changed ts_calc_spindle_metrics
%   to correctly calculate fft freqs
%   to calculate mean R and R2 matrix

% changed ts_synth_spindles_from_dSPM
%   to remove todo comments about using ts_calc_spindle_metrics

% renamed ts_calc_spindle_metrics to ts_analyze_spindles
% changed ts_analyze_spindles to accept results from ts_find_spindles

% changed_ts_find_spindles to adjust default wavelet_freqs
% created ts_convolve_spindles (copied code from ts_find_spindles)

% rev 938

#############################################################################
#############################################################################

## MMPS_238: medium revision
## Don Hagler 02/28/14

% updated version.NOTES

% rev 939

% changed ts_find_spindles
%   to reject based on max fourier power (instead of mean)

% changed MMIL_Process_Exam to pass DT_outdir and DT_outstem to
%   DTI_MMIL_AtlasTrack_Exam
% changed DTI_MMIL_AtlasTrack_Exam to accept DT_outdir and DT_outfix
%   and pass to DTI_MMIL_Set_DT_fstem

% changed MMIL_Summarize_MRI_Analysis to accept baseflag
% changed MMIL_Compile_MRI_Analysis to document baseflag

% added mri_concat_530 to bin (copied from FreeSurfer v.5.3.0)
% changed mmil_concat to use mri_concat_530 by default

% changed dti_render_AtlasTrack to update default fiber_suffix

% changed mmil_makeBEMsurfs_withNFT to allow full path for output_bem_dir

% rev 940

% changed ts_preproc to accept notch_tb option
% changed ts_find_spindles to accept and save chan_labels
% changed ts_analyze_spindles to pass on chan_labels to output
% changed ts_find_spindles to demean data and supress warnings for detrend

% copied MMIL_Import_DTI_QC from mmilrec17/matlab/MMPS_nonsvn

% created mmil_analyze_fuzzy_concat

% created ts_calc_laminar_ecd

% updated MMIL_Select_Struct_Series and MMIL_Select_DTI_Series
%   from mmilrec17 (multiple changes)
% created MMIL_Select_FLEX_Series (from mmilrec17)

% changed fs_label2mgh to update header
% changed fs_surf2surf to accept options parameter
% changed sv_surf_view to change ven view to infl or infr
% changed sv_show_surf to accept infl and infr (rotated +-90 degrees)

% changed fs_read_trisurf to correct error message to include fname

% changed fs_tal2weights
%   to write roi_info for each hemi
%   accept namelabel

% changed sv_category_cvals
%   to clip cvals values greater than 1
%   to scale color intensity based on maximum value across categories

% created mmil_group_rois

% rev 941

% changed mmil_group_rois to purify groups through iteration

% changed ts_analyze_spindles to accept spindle_dur_thresh
%   and update prob

% created ts_detect_spindles
% changed ts_find_spindles to call ts_detect_spindles

% changed MMIL_Select_DTI_Series
%   to break up large block of code into functions
%   to correctly handle multiple attempts
%   to plot multi-frame diffusion weighted images

% changed fs_tal2weights to use '-' instead of '_' in fname_csv and fname_txt
% changed mmil_analyze_fuzzy_area to check for new roinames file name format

% changed mmil_group_rois
%   to accept fname_info and pass information to fname_out_info csv file
%     with group numbers added as first column
%   to document optional parameters

% changed MMIL_Select_Struct_Series
%   to make output file have "_Selection" not "_SeriesSelection" in name

% changed mmil_define_rsBOLD_networks
%   to change pMFG to pMTG

% changed ts_detect_spindles
%   to use verbose
%   to handle spindles at end of data in the same way as at beginning of data
%     (in find_spindle_epochs)

% changed MMIL_Select_DTI_Series
%   to set result = [] earlier (needed if nscans = 0)
%   to update header (default b0_movie_flag = 0)
%   to set RejectSeries to 0 if zero_reason and RejectSeries empty

% changed MMIL_Select_Struct_Series
%   to correctly handle concatenation across multiple attempts
%     (setting ind_series_tmp and ind_scan_tmp)

% rev 942

% changd MMIL_Select_DTI_Series
%   to only skip multi-attempt visits if all visits have
%     at least one scan accepted or rejected

% changed ts_detect_spindles to save data_mad
% changed ts_plot_spindles to accept annot_flag
%   write text annotations to plots (npeaks, amp, dur, F ratio)

% changed mmil_glm to accept verbose option (to fix error)

% changed ts_analyze_spindles to work if nchans==1

% changed ts_find_spindles, ts_detect_spindles, and ts_plot_spindles
%   to make default min_peak_deflection = 1

% changed mmil_group_rois to accept kmeans_flag
%   use kmeans instead of svd as alternative method

% removed ts_plot_spindles_vert
% changed ts_find_spindles to save data_filt_narrow and data_filt_broad
% changed ts_detect_spindles
%   to save data_filt_narrow and data_filt_broad
%   to calculate data_filt_broad_mad and data_filt_narrow_mad
%   to count npeaks from data_filt_narrow
% changed ts_plot_spindles
%   to use double-size plot for data (if vert_flag = 1)
%   to arrange subplots in grid if vert_flag = 0
%   to count npeaks from data_filt_narrow

% updated MMIL_FSColorLUT.txt to copy values from FreeSurferColorLUT.txt v5.3.0
% changed aseg_roilist to include CC ROI codes:
%   MMIL_Analyze_MRI_Exam.m
%   MMIL_Analyze_MRI_Exams.m
%   MMIL_Compile_MRI_Analysis.m
%   MMIL_Summarize_MRI_Analysis.m

% changed ts_find_spindles and ts_detect_spindles
%   to accept mask

% changed ts_calc_gainmat to return [s,m] from rmdir to silence error

% created MMIL_Concat_Long_SurfStats
% changed MMIL_Concat_MRI_SurfStats to not allow dv

% rev 945

% changed mmil_glm and mmil_glm_csv to accept interaction_labels

% changed mmil_args_MMIL_Freesurfer_Recon_Exams
%   to include BEMtype, not bemtype

% changed MMIL_Analyze_DTI_Exam to prepend DT_outfix to T2w_sf

% changed ts_topoplotER to not display comment over image

% changed ts_topoplot_avg to accept zlim

% changed MMIL_Import_DTI_QC
%   to correct comment
%   to initialize DTIQC = []

% changed MMIL_Import_FSRecon_QC
%   to initialize FSQC = []

% changed MMIL_Summarize_RSI_Analysis to accept motion_tags, T2w_tags, info_tags

% changed MMIL_Summarize_MRI_Analysis to include insula in aparc codes

% changed fs_surf2surf to update header

% created mmil_struct2csv

% changed MMIL_Select_Struct_Series to correctly discard and continue

% removed AATL_Stream

% rev 946

% changed MMIL_IcoResamp_FSRecon_Exams to update header
%   to not use mymkdir
% removed utils/mymkdir

% changed MMIL_IcoResamp_FSRecon_Exam (non-consequential)

% created MMIL_Warp_WMMask_to_Atlas_Exams and mmil_warp_wmmask_to_atlas

% changed mmil_glm to not overwrite output csv files unless forceflag=1

% changed ts_detect_spindles and ts_plot_spindles
%   to use data_filt_broad instead of data_filt_narrow for counting npeaks

% changed ts_find_spindles to remove plot_fourier_flag

% changed ts_detect_spindles to calculate basic spindle metrics
%   amp, dur, F_ratio, spindle_power, nonspindle_power, npeaks

% changed ts_dSPM to use absflag when calling ts_mgh2sourcecov
%   not threshabs

% changed ts_mgh2sourcecov to accept thresh_flag
%   to simplify code for creating sparse matrix with ncomponents per dip

% changed ts_dSPM to accept sourcecov_thresh_flag
%   to pass as thresh_flag ot ts_mgh2sourcecov
%   this allows use of continuous (not-binarized) source cov values

% changed fs_fourier to update header

% changed startup_MMPS to remove fieldtrip-20110912 from path
%   distchck in fieldtrip-20110912/multivariate/external/murphy/KPMstats
%     was overriding built-in matlab function
%     and causing problems for fs_fourier when calling fcdf
% created mmil_addpath_new_fieldtrip
% changed ts_calc_gainmat to call mmil_addpath_new_fieldtrip if openmeeg_flag

% rev 947

% changed ts_process_fif_data to update header
% changed ts_avg_fif_data to fix bug if saveepochs_flag = 1

% changed MMIL_Get_Container to replace ^ with \^ in regexp
%   prevent VisitIDs with "^" from causing problems

% changed ts_calc_fif_motion to use mmil_M_mat2vec instead of mmil_M2x

% rev 948

% changed mmil_analyze_fuzzy_concat to accept roinames

% changed ts_find_spindles to call ts_convolve_spindles

% changed ts_convolve_spindles and ts_find_spindles
%   to change default wavelet_freqs to [9:0.5:17]

% changed ts_convolve_spindles to add excl_perc option with default = 100

% removed timesurfer/timesurfer.m

% changed ts_analyze_spindles to change default spindle_freq_low to 9

% changed ts_plot_spindles to change default
%   nonspindle_freq_low and nonspindle_freq_high to 5 and 8
%   and spindle_freq_low to 9

% changed ts_find_spindles and ts_detect_spindles
%   to change default nonspindle_freq_high to 8

% changed to accept relative_edge_thresh_flag and relative_edge_thresh:
%   ts_find_spindles, ts_detect_spindles, ts_analyze_spindles

% changed ts_analyze_spindles to extract data between start and end of spindle
%   for recalculating prob and timing

% changed fs_intensitycorr to use mmil_check_nargs

% rev 949

% created fs_wmseg
% changed fs_recon
%   to accept nu_flag, nocort_flag (instead of subcort_flag)
%     noaseg_flag, and steps
%   to use subfunctions
% changed MMIL_FreeSurfer_Recon_Exam and MMIL_FreeSurfer_Recon_Exam
%   to accept nu_flag
% changed MMIL_FreeSurfer_Recon_Exam to pass nocort_flag
%   to fs_recon
% changed mmil_args_MMIL_Freesurfer_Recon_Exams to include nu_flag in extra_tags

% rev 950

% changed ts_analyze_spindles
%   to calculate between-channel onset differences
%   to calculate between-channel phase differences
%   to calculate timing_relative and timing_fixed
%     removed relative_edge_thresh_flag as input parameter

% changed mmil_makeBEMsurfs_fromT1
%   to remove unused smoothing variable

% created fs_brainmask

% changed mmil_masksurf to update header

% changed mmil_quick_brainmask to correct method for finding threshold

% created fs_nu_corr

% rev 951

% changed fs_brainmask and fs_wmseg to use fs_nu_corr
% changed MMIL_nuCorr_Structurals to use fs_nu_corr
% removed fs_intensitycorr

% created fs_T1_corr
% changed fs_brainmask and fs_wmseg to use fs_T1_corr

% changed fs_wmseg to use fs_brainmask

% changed mmil_normdetrend to update header

% changed fs_smooth to update header and use mmil_check_nargs

% changed ts_analyze_spindles
%   to calculate std of fft freq and amp for each chan
%   to calculate mean and std of fft power spectra for each chan

% changed ts_plot_spindles
%   to initialize ylim_filt_broad and ylim_filt_narrow
%   to remove ylim_filt

% changed ts_detect_spindles to exclude spindles too close to edges of data

% changed fs_tal2surf to allow MNIflag to be a vector

% changed MMIL_Register_and_Resample_MRI_Volumes
%   to adjust M_atl_to_subj based on reg to dct atlas
%   when STRUCT_prereg_flag = 1
# NOTE: this will require re-processing and re-recon for
#   studies using STRUCT_prereg_flag = 1

% created mmil_estimate_bsbc and mmil_apply_bsbc

% rev 952

% created mmil_estimate_B1RxRatio and mmil_calc_signal_and_noise
% created mmil_logit and mmil_smoothfun1d
% changed mmil_estimate_bsbc to use mmil_logit and mmil_smoothfun1d

% changed to accept FS_version (for checking complete):
%   MMIL_Analyze_MRI_Exam
%   MMIL_Analyze_MRI_Exams
%   MMIL_Summarize_MRI_Analysis
%   MMIL_Compile_MRI_Analysis
% changed to pass FS_version to MMIL_Get_FSReconStatus:
%   MMIL_Analyze_MRI_Exam
%   MMIL_Compile_MRI_Analysis

% changed mmil_makeBEMsurfs_withNFT to fix creation of masks from meshes

% changed ts_convolve_spindles to give option to return all frequencies
%   or combine across frequencies by average or max

% changed ts_detect_spindles and ts_find_spindles
%   to add reject_peakrate_flag, min_peakrate, and max_peakrate
%   to change reject_npeaks_flag and min_npeaks to reject
%     based on number of peaks (not peak rate)

% rev 953

% changed ts_convolve_spindles and ts_find_spindles
%   to make default wavelet_freqs = [10:16]

% changed ts_find_spindles to accept filt_tfrac (undocumented)
%   with default = 0.3

% changed ts_analyze_spindles
%   to accept recalc_prob_flag (default = 0)
%   to reshape instead of squeeze (fix error if nchans=1)

% created mmil_smooth3d_pad
% changed mmil_estimate_B1RxRatio to use mmil_smooth3d_pad

% changed fs_recon to accept uchar_flag to prevent rescaling of orig.mgz

% changed fs_paint to allow meas = 'area'
%   use --jac option with mri_surf2surf

# Important Change! may require changes to scripts calling these functions
% changed to change icoarea to area:
%   MMIL_Analysis/MMIL_Analyze_MRI_Exams.m
%   MMIL_Analysis/MMIL_Analyze_MRI_Exam.m
%   MMIL_Analysis/MMIL_Compile_MRI_Analysis.m
%   MMIL_Analysis/MMIL_Concat_Long_SurfStats.m
%   MMIL_Analysis/MMIL_Concat_MRI_SurfStats.m
%   MMIL_Analysis/MMIL_Get_MRI_SurfStats.m
%   MMIL_Analysis/MMIL_Summarize_MRI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_MRI_DTI_Analysis.m

% renamed mmil_analyze_fuzzy_area to mmil_analyze_fuzzy_icoarea

% rev 954

% changed MMIL_Analyze_MRI_Exams to not set tmp_parms.fsicopath
% changed MMIL_Analyze_MRI_Exam to fix bugs in checking whether stale analysis

% changed MMIL_IcoResamp_FSRecon_Exams to correct header

% changed ts_plot_wforms to add xzero_line_flag option

% added qmajjobs2 and qmajjobs3

% changed fs_brainmask to add res2raw_flag option

% rev 955

% created ts_prep_spindle_data
% changed ts_find_spindles to call ts_prep_spindle_data
% changed ts_convolve_spindles to accept offset_flag
% changed ts_find_spindles and ts_detect_spindles
%   to make default spindle_freq_low = 10 and spindle_freq_high = 16
% changed ts_convolve_spindles and ts_find_spindles
%   to allow wavelet_win to equal 0:
% changed ts_prep_spindle_data to not use wavelets
% changed ts_find_spindles, ts_detect_spindles, and ts_analyze_spindles
%   to not use wavelet options

% changed mmil_struct2csv to squeeze data
% changed fs_tal2weights
%   to use sign of x to infer hemi
%   to accept MNIlabel, get MNIflag from fname_points
% changed mmil_group_rois to label groups according to correlation with aparc

% chanted ts_find_spindles and ts_prep_spindle_data
%   to set default power_flag = 0 and offset_flag = 1

% rev 956

% changed ts_find_spindles and ts_prep_spindle_data
%   to accept wavelet_flag, wavelet_peak_width, wavelet_peak_win, etc.

% changed MMIL_Concat_MRI_SurfStats to accept user option
% changed MMIL_Import_FSRecon_QC
%   to put setdiff list in {}
%   to set FSQC from AsegQC and SurfQC (for backward compatibility with PING)

% changed fs_nu_corr to add Talairach transform to header

% removed MMIL_Stream/MMIL_QC_Exam.m and MMIL_QC_Exams.m
% created MMIL_Tools/MMIL_QC_Struct_Exam.m and MMIL_QC_Struct_Exams.m
% created MMIL_Tools/MMIL_QC_DTI_Exam.m and MMIL_QC_DTI_Exams.m

% changed MMIL_Choose_T1 to update header

% changed MMIL_Check_StudyInfo to set QC = -100 if missing container
%   instead of -1 (that mean bad QC, set by MMIL_Get_QCInfo)

% changed mmil_analyze_fuzzy_concat to use mmil_load_mgh_info
%   instead of fs_read_header

% rev 957

% changed to include 'flex_' in full_meas if flex_flag = 1:
%   MMIL_Analyze_DTI_Exam
%   MMIL_Compile_DTI_Analysis
%   MMIL_Compile_DTI_Analysis_Vals

% changed dti_correct_data to update header

% changed epi_optimizeB0 to update header

% changed fs_brainmask to update comments
% changed fs_wmseg to accept conform_flag and conform_options
%   run conform_input
% changed fs_brainmask to set fname_out when finished
% changed fs_T1_corr to set fname_out if parms.fname_out already exists

% rev 958

% changed to accept nonlin_flag:
%   dti_correct_data, dti_eddycurr_corr
% changed to accept b0_thresh:
%   dti_fit_tensor, dti_eddycurr_corr, dti_correct_data,
%   dti_estimate_motion, dti_motion_corr
% changed dti_correct_data to update tags parameters (e.g. tensor_tags)

% rev 959

% changed fs_nu_corr to cd to tmpdir before running talairach

% changed MMIL_Concat_DTI_SurfStats to set contflag_list = 0 if npdist~=2

% changed ts_plot_spindles to accept image_flag

% changed rc_construct_ret_forward to update header
% changed rc_construct_ret_mapping to update header
% changed rc_RCSE_func to update header

% changed so norm_weights_flag makes units nA m / mm^2 instead of nA / m:
%   rc_RCSE, rc_RCSE_func

% changed ts_find_spindles and ts_prep_spindle_data
%   to accept norm_chanavg_flag and offset_chanavg_flag
%   to rename option nonspindle_norm_flag to nonspindle_corr_flag

% rev 960

% changed ts_analyze_spindles to calculate peak timing differences

% changed dti_fit_tensor
%   to not set bvals(i_b0) to 0 if < b0_thresh
%   to set DTfit.bvals based on qlength

% changed mmil_modify_serinfo_Siemens to check for possible tab in field name
% changed mmil_qmat_Siemens to load bvals from each frame for multi-shell
% changed mmil_read_mdhStruct to handle new startstr for Siemens Prisma

% changed mmil_qmat_GE
%   cosmetic changes only

% changed DTI_MMIL_Load_Data to get bvals from qmat file
# Important Change! 
# NOTE: this is important for DTI_flex scans
#       before, all frames get the same b-value
#       would have made DTI and RSI fits invalid

% changed epi_resample_data
%   to set extension of fname_reg to .mat
%   to set fname_qmat suffix to be _res_qmat.mat

% changed dti_plot_cmap to set b0_thresh = eps instead of 120

% rev 961

% changed ts_prep_spindle_data
%   to return data_raw with optional notch_filter
%   to always calculate low_power and high_power
%   to save sfreq, labels, and time

% changed ts_find_spindles
%   to return spindle_results and spindle_data
%   to pass spindle_data to ts_detect_spindles
%   to rename "chan_labels" to "labels"

% changed ts_detect_spindles
%   to not return full length data matrices in results
%   to accept data struct (output of ts_prep_spindle_data)
%   to rename "chan_labels" to "labels"

% changed ts_analyze_spindles
%   to rename "chan_labels" to "labels"

% changed MMIL_Process_DTI to fix warning messages

% changed DTI_MMIL_Load_Data to get diffdirs from ScanInfo(s)

% changed ts_detect_spindles
%   to save reject_types
%   to accept spindle_chans in calc_F_ratio and calc_npeaks functions
% changed ts_plot_spindles to use ind_spindle instead of ind_spindle_all

% changed fs_paint to allow sulc as meas

% changed mmil_glm_csv to accept legend_flag

% created MMIL_Concat_ASL_SurfStats
% changed MMIL_Analyze_ASL_Exams
%   to update header
%   to check proc_asl instead of proc_dti

% rev 962

% changed ts_nan_std to return real component only

% changed mmil_dct_morph to update comments

% changed ts_detect_spindles
%   to fix error by replacing spindle_chans with reject_chans

% created mmil_corr_wm_bias_spsm and mmil_corr_wm_bias_dct

% changed ts_detect_spindles
%   to fix error in excluding epochs with peakrate out of bounds

% changed fs_wmseg to cd into outdir before running mri_segment
%   so segment.dat is created in outdir, not cwd

% changed mmil_dct_morph to set volstd before volmask
%   so that if volstd not supplied, voxels outside mask set to stdbgval (ignore)

% changed mmil_barh to accept fontname

% changed MMIL_Select_DTI_Series to check if ind_series_tmp is empty
%   before trying to add it to scans for selection

% changed ts_detect_spindles to update peakrate after reject npeaks

% changed DTI_MMIL_Get_ScanInfo to set SessInfo.revflag = 1
%   if there are only rev scans

% changed fs_recon to append messages to recon-all.log for non-recon-all steps
%   e.g. ~nu_flag, ~rescale_orig_flag

% changed mmil_glm_csv to update comments about "networks" to "variables"

% changed MMIL_Import_MEG to add 'resting' to exclude_files

% changed mmil_convert_BOLD_GE to allow BOLD_SE type

% rev 963

% changed ts_detect_spindles to fix problem with rej_chan_flag
%   excluding the wrong channels

% changed mmil_barh for minor formatting fixes

% changed ts_detect_spindles to fix excl_flags for low_thresh

% changed MMIL_Update_VisitIDs to deal with numeric VisitIDs

% changed ts_dip_info
%   to calculate normal vectors directly (without Projects toolbox)
%   to replace NaNs in face angles with 0s

% changed ts_dSPM to add ";" after calc_sourcecov_orient_constr

% created ts_calc_fband_envelope

% created ts_calc_surf_normals
% changed ts_dip_info to use ts_calc_surf_normals

% changed ts_find_spindles and ts_prep_spindle_data
%   to accept norm_postsmooth_flag
%   to accept butter_flag and butter_order

% changed ts_detect_spindles
%   to only require 1 input arg
%   to not error if reject_types is empty

% changed rsi_calc_MFmeas and rsi_calc_FODmeas to calculate new measures
%   e.g. volLD, volLT, volND, volNT
% changed rsi_convert_MFmeas
%   to allow additional output measures
%   added to default measlist and nii_measlist
%   updated header
% changed rsi_convert_FODmeas
%   added to default measlist and nii_measlist
%   updated header

% changed DTI_MMIL_Calc_RSI
%   added new measures to default measlist and nii_measlist
%   updated header
%   to remove Ir, Ih, and If from measlist
%     depending on iso_restricted_flag, iso_hindered_flag, and iso_free_flag
% added new measures to RSI_measlist:
%   MMIL_Analyze_DTI_Exam
%   MMIL_Summarize_DTI_Analysis
%   MMIL_Compile_DTI_Analysis
%   MMIL_Compile_DTI_Analysis_Vals
%   MMIL_Concat_DTI_SurfStats
% added new measures to multiframe_measlist:
%   MMIL_Analyze_DTI_Exam
%   MMIL_Summarize_DTI_Analysis
% added new measures to measlist and updated header:
%   MMIL_Analyze_RSI_Exams
%   MMIL_Summarize_RSI_Analysis

% changed MMIL_Summarize_Long_DTI_Analysis
%   updated header

% rev 964

% changed DTI_MMIL_Load_Data
%   to change tmp_Bvals to tmp_bvals
% changed dti_eddycurr_corr
%   changed default driftcorr = 0
%     (this can cause artifactual scaling for multi-b-value data)
% changed dti_fit_tensor
%   channged default thresh = 0.5 (for brainmask)
%     thresh = 0.9 causes mask to include only very bright voxels
%     this was a problem for some scans, e.g. 32 channel  
% changed dti_correct_data and MMIL_Process_DTI
%   added driftcorr option (default = 0)
% changed MMIL_Process_Exam and MMIL_Process_Exams
%   added DTI_driftcorr option (default = 0)
# Important Change! 
# NOTE: this is important for DTI_flex scans
#         should reprocess any RSI data
#       also note that driftcorr=1 may be needed for some DTI data
#         e.g. PING Philips

% rev 965

% changed ts_detect_spindles
%   to set spindle_mask = spindle_mask_orig if ind_reject is empty

% changed fs_tal2weights to accept hemi_thresh option

% rev 966

% changed DTI_MMIL_Calc_DT and DTI_MMIL_Calc_RSI
%   to add tic/toc statements for tensor/RSI fit and err calc

% changed RSI measures starting with "L" to start with "F"
%     need to rename "LD" RSI measure to not overlap with DTI measure with same name
%     changed all LX (L0,L2,L4,LD,LT) to FX (F0,F2,F4,FD,FT)
%   DTI_Stream/DTI_MMIL_Calc_RSI.m
%   MMIL_Analysis/MMIL_Analyze_DTI_Exam.m
%   MMIL_Analysis/MMIL_Analyze_RSI_Exams.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Compile_DTI_Analysis_Vals.m
%   MMIL_Analysis/MMIL_Concat_DTI_SurfStats.m
%   MMIL_Analysis/MMIL_Summarize_DTI_Analysis.m
%   MMIL_Analysis/MMIL_Summarize_RSI_Analysis.m
%   rsi_tools/rsi_calc_FODmeas.m
%   rsi_tools/rsi_calc_MFmeas.m
%   rsi_tools/rsi_convert_FODmeas.m
%   rsi_tools/rsi_convert_MFmeas.m
% changed all "nlfit_L" to "nlfit_F":
%   rsi_tools/rsi_fit_ROI_MFI.m
%   rsi_tools/rsi_plot_FOD.m
%   rsi_tools/rsi_fit_MFOD.m
%   rsi_tools/rsi_fit_ROI.m
% change fname_L2 to fname_F2:
%   DTI_Stream/DTI_MMIL_Calc_RSI.m
# Important Change! 
# NOTE: this is important for RSI calculation and analysis
#         should rerun RSIcalc and RSIanalysis

% changed ts_topoplot_avg to set cfg.zlim = 'maxmin' if zlim is empty

% rev 967

% changed mmil_sort_dicoms to display warnings

% changed ts_synth_spindles_from_dSPM to add sensor corr matrix image

% changed ts_manualICA to update header

% changed fs_paint to use outdir if outstem is supplied and is relative
% changed fs_read_regdat to update header
% changed fs_write_regdat to update header
% changed mmil_resample_by_regdat to update header

% created mmil_paint

% changed ts_calc_laminar_ecd
%   to replace badchans with weighted average of neighbors
%   to apply Gaussian smoothing kernel across channels

% rev 968

% changed ts_calc_laminar_ecd
%   to remove unused sfreq parameter
%   to require 2D data matrix (no longer allow 3D matrix with epochs)
%   to use ts_prep_laminar

% created ts_prep_laminar to replace bad chans and apply smoothing

% changed mmil_cortsurf_analysis and mmil_fiber_analysis
%   to add outdir to outstem only if it is not empty

% created mmil_gwcsurf_analysis

% changed MMIL_Analyze_DTI_Exam and MMIL_Analyze_DTI_Exams
%   to accept options for and run gwcsurf analysis

% changed DTI_MMIL_Load_Data
%   to get bvals from ScanInfo

% changed MMIL_Import_MEG.m to skip files that fail to import (maxfilter)

% changed fs_write_ctab
%   to include "unknown" with code 0 and color = [0,0,0]
%   to replace color for "unlabeled" with [0,0,0]

% created fs_rois2annot

% changed dti_select_fibers
%   changed verbose_flag to verbose
%   added option to input fiber directly and bypass reading of fname_fiber

% changed MMIL_Compile_DTI_Analysis and MMIL_Summarize_DTI_Analysis
%   to accept options for and summarize gwcsurf analysis

% rev 969

% changed mmil_cortsurf_analysis to accept mask_midbrain_flag
% changed to add mask_midbrain_flag to cortsurf_tags:
%   MMIL_Analyze_MRI_Exam 
%   MMIL_Analyze_DTI_Exam
%   MMIL_Analyze_ASL_Exam
% changed mmil_cortsurf_analysis to remove mbmask_flag

% changed MMIL_IcoResamp_FSRecon_Exam
%   to display message that talairach transform is being restored

% rev 970

% updated version.NOTES

% rev 971

#############################################################################
#############################################################################

## MMPS_240: medium revision
## Don Hagler 10/08/15

% changed ts_plot_wforms to use axes_linewidth for zero lines

% creatd mmil_fparc2wmparc and mmil_fparc2fibers

% changed to set default thresh = 0.5
%   rsi_fit_FOD, rsi_fit_MFOD, rsi_fit_iso

% changed fs_recon
%   to accept make_surfs_noauto_flag and make_surfs_parms_file

% changed mmil_estimate_bsbc
%   to accept smooth_flag, clip_flag, prctile
%   reduced default lambda_sm to 1e3 (tighter fit)
%   note: this allows for a better match and larger range of x values

% changed fs_tal2weights to check for empty coordinates

% rev 972

% changed rc_fit_wforms to update header (area_colors, not area_color)

% changed fs_nu_corr to update header
%   and corrected default fname_out

% changed to add tal_flag:
%   MMIL_nuCorr_Structurals
%   MMIL_Apply_MRI_Corrections
%   MMIL_Process_Structurals

% changed to add STRUCT_tal_flag:
%   MMIL_Process_Exam
%   MMIL_Process_Exams

% changed mmil_corr_wm_bias_spsm and mmil_corr_wm_bias_dct
%   to make ratio_range relative to median ratio
% created mmil_wm_corr

% created MMIL_wmCorr_Structurals

% changed MMIL_Apply_MRI_Corrections to call MMIL_wmCorr_Structurals
% changed MMIL_Process_Structurals
%   to accept wmbc_flag, include in apply_tags, reg_tags
% changed MMIL_Process_Exam
%   to accept STRUCT_wmbc_flag, pas to MMIL_Process_Structurals
% changed MMIL_Process_Exams to accept STRUCT_wmbc_flag
% changed MMIL_Register_and_Resample_MRI_Volumes
%   to accept wmbc_flag
% changed default nu_flag = 0:
%   MMIL_Process_Exam
%   MMIL_Process_Exams
%   MMIL_Process_Structurals
%   MMIL_Apply_MRI_Corrections
%   MMIL_Register_and_Resample_MRI_Volumes

% rev 973

% changed to accept FS_rescale_orig_flag:
%   MMIL_Freesurfer_Recon_Exam
%   MMIL_Freesurfer_Recon_Exams

% changed dt_AtlasTrack to create paths for fiber subdivisions

% changed MMIL_RootDirs_from_ProjInfo and MMIL_Check_RootDirs
%   to add orig_pet_pib

% rev 974

% created fs_select_points

% created qc tcl scripts (from scripts used for PLING, created by Matt Erhart)
%   qc_fsurf.tcl, qc_fseg.tcl, qc_dti_reg.tcl, qc_rsi_F2.tcl
% removed unused tcl scripts:
%   loadpet.tcl, tkdti.tcl, tkfa.tcl, tkmedit_aseg.tcl,
%   tkreg.tcl, maketiff_f.tcl
% added tkmedit_example.tcl (example tcl script downloaded from MGH fswiki)

% removed MMIL_Viewer

% rev 975

% created MMIL_FSReconQC
% renamed qc_fsurf.tcl to qc_recon.tcl

% rev 976

% changed MMIL_Select_Struct_Series to update selection for non-multi scans
% changed MMIL_FSReconQC to skip when STRUCT_VisitID is not same as VisitID
% changed MMIL_Compile_MRI_Analysis to match unique STRUCT_VIsitIDs to VisitIDs

% changed MMIL_Get_QCInfo to check that field names exist
% changed MMIL_Import_DTI_QC to fix setdiff Warning

% changed MMIL_Concat_DTI_SurfStats to allow gwcsurf_flag option
% 	and to compile mean motion

% created ts_calc_fft

% rev 977

% changed MMIL_Analyze_MRI_Exam to use outstem cortvol-sphere
% changed to accept and use sulc_flag:
%   MMIL_Analyze_MRI_Exam
%   MMIL_Analyze_MRI_Exams
%   MMIL_Summarize_MRI_Analysis
%   MMIL_Compile_MRI_Analysis
%   MMIL_Concat_MRI_SurfStats

% created mmil_convert_BOLD

% changed MMIL_Process_Exam to handle missing proc

% changed ts_calc_fft to correct header

% created abcd_autoQC dir containing:
%    abcd_check_T1.m
%    abcd_check_T1_image.m
%    abcd_check_T1_protocol.m
%    abcd_check_T2.m
%    abcd_check_T2_image.m
%    abcd_check_T2_protocol.m
%    abcd_check_dMRI.m
%    abcd_check_dMRI_image.m
%    abcd_check_dMRI_protocol.m
%    abcd_check_fMRI.m
%    abcd_check_fMRI_image.m
%    abcd_check_fMRI_protocol.m
%    abcd_check_series.m

% changed MMIL_Process_Exams and MMIL_Process_Exam
%   to accept preprocflag

% changed mmil_convert_DTI_GE
%   to give error if pepolar is not 2 or 3 for DTI_ipp
%   to set ipp_flag = 1 for DTI_flex only if pepolar>1

% rev 978

% changed mmil_qmat_GE
%   so 1 is not subtracted from nb0 if DTI_flex unless pepolar>1

% changed mmil_convert_BOLD_Philips
%   to handle BOLD_td type

% changed MMIL_Process_DTI
%   to add vox2ras_maxdiff
%   so DTI processing does not quit if vox2ras matrices
%     are just slightly different (e.g. rounding error)

% changed mmil_qmat_Philips
%   to stop loading qmat when slice position changes
%   to only skip last rep if orient = [0 0 0] (for PING, not ABCD)

% changed mmil_convert_DTI_Philips
%   to only skip last rep if there is one extra rep (nfiles = ns*(nreps+1))

% changed DTI_MMIL_Export_Data
%   to update header

% created MMIL_Convert_Exam and MMIL_Convert_Exams

% created MMIL_autoQC_Exam and MMIL_autoQC_Exams
% created mmil_fsl_calc_tSNR

% changed MMIL_autoQC_Exam to report mean_motion

% changed dti_motion_corr
%   so fname_qmat will have .mat extension

% changed MMIL_Update_VisitInfo
%   to actually use SubjID_pattern parameter

% added GE_flex_tensor1.dat to parms/DTI
%   tensorABCD.dat file supplied by Josh Kuperman
%   used with ABCD DTI_flex sequence (which has fnum = 1)

% added GE_flex_tensor6.dat to parms/DTI
%   tensor6.dat file supplied by Josh Kuperman
%   to be used for VETSA3
%   contains 51 and 54 direction multi-shell designs

% changed ts_analyze_spindles
%   to accept mask parameter
%   to exclude delays containing artifact masked time points
%   to calculate intervals between epoch centers

% created mmil_multislice_subplots
% changed mmil_multiframe_subplots
%   to correct default outstem

% changed mmil_multislice_subplots, mmil_multiframe_subplots, and mmil_subplots
%   to accept plim and plim_flag and set clim using prctile

% changed mmil_fsl_calc_tSNR to convert mean and std to mgz

% changed DTI_MMIL_Get_ScanInfo to not return early if nargout < 2

% changed mmil_multislice_subplots, mmil_multiframe_subplots, and mmil_subplots
%   to use mmil_subplot_tight

% changed mmil_multiframe_subplots
%   to accept groups vector

% changed fs_copy_mgh
%   to use keepsingle = 1 to save memory

% changed fs_load_mgh
%   to set headeronly = 0 if headeronly is empty

% changed MMIL_autoQC_Exam
%   to create images for manual review
% changed MMIL_autoQC_Exams
%   to include ContainerType in job name

% rev 979

% changed MMIL_autoQC_Exam
%   to add "auto" to qcinfo.mat file name
%   to accept export_flag

% created qmajjobs4 and qmajjobs7

% created MMIL_manualQC_Exam
% created MMIL_manualQC_Exams

% created mmil_headmask

% changed mmil_mean_motion and mmil_motion_stats
%   to use pi/180 instead of 2*pi/360

% changed MMIL_autoQC_Exam
%   to reorder motion parameters for fMRI (FSL to AFNI)
%   to use mmil_motion_stats

# NOTE: prior to the following changes, there was a mismatch in the order of
#       motion parameter estimates with mmil_load_motion and mmil_M_mat2vec
% renamed mmil_load_motion to mmil_load_motion_1D
% changed mmil_load_motion to reorder parameters to be dx,dy,dz,rx,ry,rz
%   with rotations clockwise (in degrees)
% changed mmil_mean_motion and mmil_motion_stats to use new order
% changed to update header for description of motion_tseries:
%   bold_tools/bold_estimate_motion.m
%   dti_tools/dti_estimate_motion.m
% changed to remove reorder_motion parameter:
%   bold_tools/bold_correct_data.m
%   bold_tools/bold_estimate_motion.m
%   bold_tools/bold_motion_corr.m
%   bold_tools/bold_unwarpB0.m
%   dti_tools/dti_correct_data.m
%   dti_tools/dti_estimate_motion.m
%   dti_tools/dti_motion_corr.m
% changed to not change rotation to CCW:
%   bold_tools/bold_estimate_motion.m
%   dti_tools/dti_estimate_motion.m
%   bold_tools/bold_motion_corr.m
% changed bold_motion_corr to not reorder or flip sign of rotation
%   (already done by mmil_load_motion_1D)
% changed to use mmil_load_motion_1D instead of mmil_load_motion:
%   BOLD_Analysis/BOLD_MMIL_Resting_Analysis.m
%   bold_tools/bold_merge_APE.m
%   bold_tools/bold_motion_corr.m
%   mmil_utils/mmil_detrend_vol.m
% changed BOLD_MMIL_Resting_Analysis to use dx,dy,dz,rx,ry,rz order
% changed MMIL_autoQC_Exam to use dx,dy,dz,rx,ry,rz order

% rev 980

% created mmil_load_motion_par
% changed MMIL_autoQC_Exam to use mmil_load_motion_par

% changed MMIL_manualQC_Exam to use mmil_unix instead of unix

% created rc_landmark_reg
% created rc_apply_time_warp
% created rc_reverse_time_warp

% changed fs_roi2annot to use parms.roi_label

% changed to accept checkflag:
%   MMIL_Check_StudyInfo
%   MMIL_Get_StudyInfo
%   MMIL_Check_ProjID
% changed to include checkflag in extra_tags:
%   mmil_args_MMIL_Get_StudyInfo
%   mmil_args_MMIL_Check_StudyInfo
%   mmil_args_MMIL_Check_ProjID
% created MMIL_Quick_StudyInfo

% rev 981

% changed MMIL_manualQC_Exams
%   to use MMIL_Quick_StudyInfo
%   to not save SeriesInfo or ScanInfo (not used)
% changed MMIL_autoQC_Exams
%   to not save SeriesInfo (not used)
%   to not set 'checked' field

% changed MMIL_Compile_MRI_Analysis
%   to not get sulcavg from aparc_stats
%   to load sulc aparc values from roi_data mat file
% changed MMIL_Analyze_MRI_Exam
%   to calculate average sulc for aparc ROIs
% changed mmil_surf_roi
%   to check for empty annot_name

% changed mmil_sort_dicoms
%   to exclude dicoms with InstanceNumber = -1, not entire series

% changed mmil_analyze_fuzzy_concat
%   to check if roinames already has size [nroi,nhemi]

% renamed ts_calc_laminar_ecd to ts_calc_laminar_csd
%   includes haming_flag

% changed mmil_multiframe_subplots
%   to only use unique frame indices
%   (in case frame_fracts has more elements than frames)

% changed mmil_fsl_calc_tSNR to allow TR up to 100

% changed MMIL_manualQC_Exam to first display tv images only,
%   then more if "m" is pressed at QC prompt

% changed mmil_multislice_subplots
%   to set clim to empty if it contains nans or only one unique value (e.g. 0)
% changed mmil_multiframe_subplots
%   to set clim to [0 1] if it contains nans or only one unique value (e.g. 0)
% changed mmil_subplots
%   to set clim to empty if it contains nans or only one unique value (e.g. 0)
%   to set clim based on plim only for selected slices (to save memory)

% changed MMIL_autoQC_Exams to make default convert_flag = 1

% changed dti_fit_tensor to check if nb0>0 before using volb0
% changed mmil_qmat_DTI to adjust spacing

% changed MMIL_Analyze_RSI_Exams and MMIL_Summarize_RSI_Analysis
%   to use gwcsurf_flag and gwcsurf options

% changed mmil_modify_serinfo_Philips
%   to check if tmp.Item_1 is empty

% changed to allow [0|1|2] values for gradunwarp and B0unwarp_flag
%     (STRUCT, BOLD, and DTI)
%   MMIL_Process_Exams
%   MMIL_Process_Exam
%   MMIL_Process_Structurals
%   MMIL_Process_DTI
%   MMIL_Process_BOLD
%   dti_correct_data
%   bold_correct_data
% changed to quit on error only if gradunwarp_flag==2
%   MMIL_Apply_MRI_Correction
% changed to remove require_BOuw_flag
%     check if B0unwarp_flag==2 instead
%   MMIL_Process_DTI
%   MMIL_Process_BOLD
%   dti_correct_data
%   bold_correct_data
% changed to skip processing if gradwarp info is missing and gradunwarp_flag==2
%   MMIL_Process_DTI
%   MMIL_Process_BOLD

% rev 982

% changed MMIL_autoQC_Exam
%   to add DTI_conv_meas_list, including V0

% changed MMIL_RegisterMMIL_Register_and_Resample_MRI_Volumes
%   to check if gradunwarp_flag==1, allow non uw

% created mmil_save_fig
% created mmil_dti_rb_subplots
% changed mmil_printeps
%   to handle situation where fignum is an object (e.g. MATLAB R2015b)

% rev 983

% changed MMIL_Convert_MRIRAW_to_MRIPROC
%   to support TSE2D scan type (2D turbo/fast spin echo)

% changed mmil_paint to accept frame, use fs_load_mgh to load single frame
% changed mmil_gwcsurf_analysis
%   to pass frame to mmil_paint
%   to pass empty frames to mmil_surf_roi

% changed mmil_classify_by_rules
%   to use mmil_rowvec on string series_value

% changed mmil_modify_serinfo_Philips
%   to use mmil_getfield to get Private_2001_1020
%     to avoid error if field does not exist

% rev 984

% changed mmil_modify_serinfo_Philips
%   to use mmil_getfield to get PulseSequenceName from tmp.Item_1
%     to avoid error if field does not exist

% changed MMIL_manualQC_Exam
%   to have hidden parameter infix_list
%   to include tv and SAG images in initial call to eog

% changed mmil_csv2struct
%   to replace . with _ in column headers

% changed mmil_glm
%   to check if regnames is a cell array or not (i.e. string)
% changed mmil_glm_calc
%   to change warning if the number of parameters matches the number of data points

% created ts_calc_bs_val_pval and ts_calc_bs_val_pval_bias

% changed rc_landmark_reg to accept multi_landmark_flag

% changed rc_revserse_time_warp to check that warping function is monotonic

% created ts_nbrhd_covar and ts_roi_nbrhd_covar

% changed ts_dSPM to accept smooth_constr_type
%   allow neighborhood and ROI constraints

% changed MMIL_summarizeQC to check if qcinfo is empty before calling mmil_struct2csv

% changed MMIL_FSReconQCC to use mmil_unix

% changed MMIL_manualQC_Exam in review_images subfunction
%   to initialize manual_qcinfo to empty
%   and return early if manual_qcinfo is still empty after trying

% rev 985

% changed mmil_multislice_subplots
%   to subsample values when using prctile to reduce memory usage

% changed mmil_dti_rgb_subplots
%   to check if clim is empty before scaling img_FA

% changed MMIL_Process_DTI
%   to check DTI_Sequence_Type in set_qmat (for rorevro sequence)

% changed MMIL_wmCorr_Structurals to update header
% changed MMIL_Register_and_Resample_MRI_Volumes
%   to accept image_range
%   to clip values outside image_range if wmbc_flag = 1
% changed mmil_average_volumes, and mmil_average_volumes_old
%   to accept image_range
%   to clip values outside image_range if image_range not empty

% changed to allow [0|1|2] values for gradunwarp and B0unwarp_flag
%     (STRUCT, BOLD, and DTI)
%   MMIL_Process_Exam (should have been changed earlier but wasn't)

% changed MMIL_Get_Gradwarp_Signature
%   to quit if manufacturer is not 'GE Medical Systems'
%   to save ScanInfo to ScanInfo_GWS.mat and reload to save in ContainerInfo
%   this avoids getting gradwarp signature every time
%     (because ContainerInfo.mat is newly written every time by Convert)

% rev 986

% changed MMIL_Register_and_Resample_MRI_Volumes
%   to check if (~exist(fname_mask_res,'file') && parms.prereg_flag)

% changed sv_category_cvals
%   to remove extra ','

% changed MMIL_Register_and_Resample_MRI_Volumes
%   set fname_ref to fname_ref_res if atlasflag = 1

% rev 987

% changed MMIL_Register_and_Resample_MRI_Volumes
%   to only apply image_range to wmbc_scantypes

% changed MMIL_Process_DTI and MMIL_Process_BOLD
%   to set BOunwarp_flag to 0 if missing scans and B0unwarp_flag ~= 2

% changed mmil_qmat_Siemens
%   to determine index of DiffusionGradientDirection in CSAImageHeaderInfo

% created MMIL_postQC_dMRI_Exam

% rev 988

% created MMIL_postQC_Exam
%   based on MMIL_postQC_dMRI_Exam
%   with changes to display and store QU information

% changed xmatjobs
%   to increase delays

% changed to replace '^' with '_' in VisitID or SubjID for jobID:
%   and to limit jstem to 20 characters (to avoid matlab error with long names)
MMIL_Classify_Exams
MMIL_Create_BEM_Exams
MMIL_Freesurfer_Recon_Exams
MMIL_IcoResamp_FSRecon_Exams
MMIL_Process_Exams
MMIL_Process_MEG_Exams
MMIL_Warp_WMMask_to_Atlas_Exams
MMIL_autoQC_Exams
MMIL_QC_Struct_Exams
MMIL_QC_DTI_Exams
MMIL_Convert_Exams
MMIL_Analyze_ASL_Exams
MMIL_Analyze_BOLD_Exams
MMIL_Analyze_DTI_Exams
MMIL_Analyze_Long_DTI_Exams
MMIL_Analyze_Long_Exams
MMIL_Analyze_MEG_Exams
MMIL_Analyze_MRI_Exams
MMIL_Analyze_rsBOLD_Exams
MMIL_Combine_Retinotopy_Exams
MMIL_RetFit_BOLD_Exams
MMIL_Long_Setup_Exams
MMIL_Long_Register_Exams

% rev 989

updated version.NOTES

% rev 990

#############################################################################
#############################################################################

## MMPS_241: minor revision
## Don Hagler: 08/04/16

#############################################################################
#############################################################################

% added abcd_fiona and MB_recon
%   MB_recon is for multi-band recon code from GE
%   abcd_fiona is:
%     MMPS/matlab/abcd_fiona/abcd_fiona_unpack.m
%     MMPS/matlab/abcd_fiona/abcd_SubjID.m
%     MMPS/matlab/abcd_fiona/abcd_fiona_unpack_all.m
%     MMPS/matlab/abcd_fiona/abcd_fiona_check_json.m

% rev 991

% changed abcd_fiona_unpack_all
%   to compare datenum for json and unpack* file

% changed abcd_fiona_check_json
%   to check if P file json file is empty
% changed abcd_fiona_unpack
%   to make regexp for P file more selective (use ^ and $)

% changed MMIL_Import_MEG
%   to skip files that fail to import (maxfilter)

% created abcd_fiona_unpack_pfile
% changed abcd_fiona_unpack_all
%   to set SubjID to PatientID if PatientName is empty
% created abcd_fional_unpack_pfile_all
% changed abcd_fiona_unpack
%   to also look for dicoms (in pdir) with *.dcm pattern (umich)
% changed abcd_fiona_check_json
%   to allow '_' within SubjID for pfile tar pattern

% changed abcd_fiona_unpack_pfile and abcd_fiona_unpack
%   to use larger P file if there are multiple

% created ts_calc_laminar_ecd

% changed abcd_fiona_unpack
%   to use alternate naming for dicom dir name (umich)

% changed abcd_fiona_unpack_pfile_all
%   to include extra enty in fpat_list (umich)

% changed mmil_copy_dicoms
%   to reset cmd to [] for each series
%   to set variable for fname_out
%     (cmd lines were too long, getting truncated)

% rev 992

% changed abcd_fiona_unpack and abcd_fiona_unpack_pfile
%   to catch recon errors

% changed abcd_fiona_unpack_all and abcd_fiona_unpack_pfile_all
%   to remove old .recon* files
%   to skip creating job if there are .*_error files

% renamed "unpack" functions
%   abcd_fiona_import.m
%   abcd_fiona_import_all.m
%   abcd_fiona_import_pfile.m
%   abcd_fiona_import_pfile_all.m

% rev 993

% changed abcd_fiona_unpack_all and abcd_fiona_unpack
%   to use force_err_flag

% changed mmil_merge_args
%   to force inds to be a rowvec

% created abcd_pc:
%   abcd_pc.m
%   abcd_pc_GE.m
%   abcd_pc_Siemens.m
%   abcd_pc_all.m
%   abcd_summarize_pc.m

% changed abcd_summarize_pc
%   to reorder columns (with series_col_order parameter)
%   to use switch instead of if, elseif, elseif ...
%   to change names of some subfunctions (e.g. get_hardcode_pGUID)
%   to add more PatientIDs to get_hardcode_pGUID

% rev 994

% changed abcd_fiona_import_all
%   to catch error with abcd_fiona_check_json
%   caused by json file without SeriesNumber

% changed abcd_fiona_import
%   to recognize Philips Medical Systems
%   to print out fname_pfile only if ~errcode

% changed MMIL_Freesurfer_Recon_Exams
%   to use mmil_mkdir

% changed mmil_dct_reg_atlas
%   to load atlas into variable (rather than directly in memory)
%     and test that fields exist rather than variables exist
%     this avoids an error that occurs in newer versions of matlab (e.g. R2014b)
%       but not old versions (e.g. R2011a)

% changed mmil_logstr
%   to revise header
%   to change formatting

% changed abcd_fiona_import_all
%   to optionally create logfile

% changed abcd_fiona_import
%   to include \n at end of "ERROR" messages

% created MMIL_ABCD_FIONA_Import_Exams

% rev 995

% changed abcd_fiona_import
%   to check for "Philips Medical Systems" instead of "PHILIPS MEDICAL SYSTEMS"
%   to check ref.dat and vrgf.dat files
%     (must have at least one, but if more than one, must remove extras)

% changed abcd_fiona_import_all and MMIL_ABCD_FIONA_Import_Exams
%   to accept phantom_flag

% changed abcd_fiona_import
%   to handle json/tgz filenames with spaces

% added parms/DTI/GE_flex_tensor7.dat

% removed abcd_autoQC

% rev 996

% changed abcd_summarize_pc
%   to control concatenation in reorder_tags subfunction
%     (avoids error in matlab R2011a)
%   to remove pGUID hardcoding for particular cases
%   to set pGUID to invalid if not a valid NDAR ID

% changed mmil_sort_dicoms
%   to report number of files before constructing cmd
%   edited comment from JCR

% renamed MMIL_manualQC_Exams to MMIL_rawQC_Exams
% renamed MMIL_manualQC_Exam to MMIL_rawQC_Exam
% changed MMIL_rawQC_Exam
%   to save raw_qcinfo instead of manual_qcinfo
%   to accept reviewerID, include in outfix
% changed MMIL_rawQC_Exams
%   to accept reviewerID

% removed old QC functions:
%   MMIL_QC_DTI_Exam.m
%   MMIL_QC_DTI_Exams.m
%   MMIL_QC_Struct_Exam.m
%   MMIL_QC_Struct_Exams.m

% moved QC functions from MMIL_Tools to MMIL_Stream
%   MMIL_autoQC_Exam.m
%   MMIL_autoQC_Exams.m
%   MMIL_postQC_Exam.m
%   MMIL_postQC_Exams.m
%   MMIL_rawQC_Exam.m
%   MMIL_rawQC_Exams.m
%   MMIL_summarizeQC.m

% renamed MMIL_summarizeQC to MMIL_Summarize_QCInfo
% changed MMIL_Summarize_QCInfo
%   to accept reviewerIDs
%   to compile raw_qcinfo for each reviewerID

% changed MMIL_autoQC_Exam
%   to save qcinfo as auto_qcinfo

% changed abcd_pc_all
%   to display message about how to run jobs

% changed abcd_summarize_pc
%   to get NDAR_VisitID from incoming json files
%   to not create jsonlist.txt file

% changed abcd_fiona_import_all
%   to check date of tar file instead of json file
%   to delete unpackdir if tar file is newer than check file
%     instead of deleting check file

% moved everything in abcd_fiona and abcd_pc to abcd
% removed abcd_fiona and abcd_pc

% rev 997

% created_abcd_get_NDAR_ID
% changed abcd_summarize_pc to use abcd_get_NDAR_ID

% renamed abcd_SubjID to abcd_get_SubjID
% changed abcd_get_SubjID
%   to accept fstem and series_info
%   to call abcd_get_NDAR_ID
%   to get SubjID from NDAR_SubjID
%   to get SubjID from series_info if NDAR_SubjID is empty

% changed abcd_fiona_import
%   to use abcd_get_SubjID
%   StudyTime includes ".", remove everything after and including the "." (Siemens)

% changed abcd_fiona_import_all
%   to use abcd_get_SubjID

% changed abcd_fiona_import_pfile
%   to use abcd_get_SubjID

% rev 998

% updated abcd_pc_GE; changes from Jose Antolin:
%   one allowed value for things like scan duration
% updated abcd_summarize_pc; changes from Jose Antolin:
%   use abcd_get_NDAR_ID, not abcd_NDAR_ID

% changed abcd_get_SubjID
%   to check for PhantomLocalHuman_001_SITE and PhantomTravelingHuman_001_SITE patterns
%   to remove underscores, dots, spaces, minus signs, or plus signs
%     (instead of replacing them)

% changed abcd_fiona_import
%   to remove existing links even without forceflag (if .renamed file does not exist)

% changed abcd_summarize_pc
%   to check that indir exists

% updated abcd_pc_Siemens; changes from Jose Antolin
%   to use try/catch to skip series without SequenceName (e.g. phsyio PMU)

% changed MMIL_Summarize_QCInfo
%   to set rawQC_info = [] in case of mismatch
%   to loop over nscans in load_raw_qcinfo

% changed abcd_pc_GE, abcd_pc_Siemens, and abcd_pc_Philips
%   to replace '/' with '_' in PatientID
%     (causes error when writing json)

% changed MMIL_Process_BOLD, in process_data
%   to loop  over 1:length(snums_valid) instead of snums_valid
%     (weird inconsistenty between matlab versions!)

% changed bold_correct_data
%   to accept 'unknown' for tpattern
%   to skip tshift if tpattern is 'unknown'

% changed MMIL_Summarize_QCInfo
%   to include indir instead of VisitID (not defined) in warning

% rev 999

% renamed abcd_get_NDAR_ID to abcd_get_pGUID
% changed abcd_get_pGUID
%   to also get EventName, SessionTtype
% changed abcd_get_SubjID
%   to use abcd_get_pGUID
%   to not try to parse PhantomLocalHuman, etc.
% changed abcd_summarize_pc
%   to use abcd_get_SubjID
%   to not require NDAR at beginning of pGUID

% changed MMIL_autoQC_Exam
%   to save seriesinfo (includes SUID and SEUID)

% changed MMIL_Summarize_QCInfo
%   to output StudyInstanceUID and SeriesInstanceUID
%   to loop over nscans when copying raw QC entries

% changed MMIL_autoQC_Exam
%   to skip checking files if fnamelist is empty

% changed abcd_fiona_import_all
%   to accept separate_series_flag
%   to add separate_series_flag to tags
% changed abcd_fiona_import
%   to accept separate_series_flag
%   to append se<SeriesNumber> to VisitID
% changed MMIL_ABCD_FIONA_Import_Exams
%   to accept separate_series_flag
%   to add separate_series_flag to tags

% changed MMIL_Process_BOLD
%   to loop over snums_valid inside recombine_ape_scans

% updated abcd_pc_GE and abcd_pc_Siements; changes from Jose Antolin:
%   updated allowed values
% updated abcd_pc_all; changes from Jose Antolin:
%   removed check for flog (does not exist)

% renamed MMIL_ABCD_FIONA_Import_Exams to ABCD_FIONA_Import_Exams
% moved ABCD_FIONA_Import_Exams to matlab/ABCD (from matlab/abcd)

% created ABCD_Check_PC_Exams

% changed ABCD_FIONA_Import_Exams
%   to prepend batchname with ProjID

% changed abcd_summarize_pc
%   to update header
%   to add forceflag and check if output files exist

% created ABCD_Summarize_PC

% changed abcd_pc
%   to create .finished file in outdir
%   instead of writing to abcd_pc_processed_list.txt

% changed abcd_pc_all
%   to check for .finished file
%   instead of comparing to abcd_pc_processed_list.txt

% changed ABCD_Summarize_PC
%   to remove reinitialization of parms = []

% changed abcd_summarize_pc
%   to set EventName = 'baseline_year_1_arm_1' if empty

% updated abcd_pc_Philips
%   changed from Jose to match Philips protocol
%   removed stray ' from informationString

% changed mmil_3dDeconv.m
%   to work with empty fname_motion
%   to allow detrend = 3
%   to include scan number in output file names (e.g. motion, detrend)

% changed mmil_create_glt_files
%   to allow detrend = 3

% changed abcd_summarize_pc
%   to write additional status messages
%   to add ; after 'umich'

% changed mmil_fsl_calc_tSNR
%   to use -refvol 0

% changed mmil_motion_stats
%   to accept thresholds,  return subthresh_nvols, etc.

% changed MMIL_autoQC_Exam
%   to report subthresh scan time and percentages, etc.

% changed MMIL_Sumamrize_QCInfo
%   to report subthresh scan time, etc.

% changed mmil_3dDeconv
%   to include parms.stim_labels{c} in tmp_iresp_fstem_out
%   instead of cond%d (c)

% created ABCD_Merge_PC_QC
% changed ABCD_Summarize_PC and abcd_summarize_pc
%   to not write session summary, not include "series" in output name

% changed abcd_fiona_import
%   to correct ERROR message about missing ref.dat

% created abcd_extract_eprime_mid
%   to create 1D files from eprime-derived csv file for MID task

% rev 1000

% changed MMIL_postQC_Exams
%   to call MMIL_postQC_Exam, not MMILM_postQC_dMRI_Exam

% changed MMIL_rawQC_Exam
%   to input qualitative scores

% renamed MMIL_Summarize_QCInfo to MMIL_Summarize_QC

% changed MMIL_Summarize_QC
%   to output qualitative scores

% changed sv_surf_view
%   to turn axis off

% changed mmil_create_glt_files
%   to add conds_contrast parameter
%   to correct header

% changed mmil_3dDeconv
%   to accept conds_contrast

% changed MMIL_Summarize_QC
%   to use raw_qcinfo(j).ftype_list instead of raw_qcinfo.ftype_list

% changed ABCD_FIONA_Import_Exams
%   to set indir to be 'outbox' subdirectory within each site dir

% created abcd_compile_visits
% created ABCD_Compile_Visits

% changed abcd_summarize_pc
%   to look for incoming jsons in outbox subdirectories

% changed MMIL_Process_Exam
%   to write progress files in raw dir

% changed MMIL_Process_Exams
%   to check progress files if newflag

% changed MMIL_autoQC_Exams
%   to accept newflag (default = 1)

% created MMIL_Quick_Check_ProjID
% changed MMIL_Update_VisitInfo to use MMIL_Quick_Check_ProjID

% changed MMIL_autoQC_Exams
%   to use info_tags, qc_tags
%   to use MMIL_Quick_Check_ProjID

% changed MMIL_Process_Exams
%   to use MMIL_Quick_Check_ProjID

% changed abcd_fiona_import
%   to delete P file after successful recon

% changed abcd_fiona_check_json
%   to check for Manufacturer field to see if is a pfile json file
%   (StudyInstanceUID was recently added to json file, breaking old code)

% changed MMIL_Process_Exams
%   to use mmil_getfield when getting values from StudyInfo
%   including STRUCT_VisitID, DTI_ScanNums, BOLD_ScanNums, DCM_RejectSeries

% changed ABCD_FIONA_Import_Exams
%   to revert back to not using 'outbox' subdirectory within each site dir

% changed abcd_summarize_pc
%   to revert back to not using outbox subdirectories

% updated abcd PC functions with changes from Jose Teruel
%   abcd_get_SubjID.m
%   abcd_pc.m
%   abcd_pc_GE.m
%   abcd_pc_Philips.m
%   abcd_pc_Siemens.m

% changed MMIL_Process_Exams
%   to set default BOLD_motion_B0uw_flag and DTI_motion_B0uw_flag = 0
%   to include 'info_tags' in excl_tags

% rev 1001

% changed abcd_compile_visits
%   to check if fname_info exists

% created abcd_radreview and ABCD_RadReview

% changed MMIL_Analyze_MRI_Exam
%   to fix type "mesa" instead of "meas"

% changed abcd_radreview
%   to use ismember instead of setdiff to exclude previously reviewed scans
%   (was excluding duplicates)

% created ABCD_Analyze_BOLD_Exams
%   based on MMIL_Analyze_BOLD_Exams
%   removed Fourier options
%   call ABCD_Check_Eprime

% created ABCD_Analyze_BOLD_Exam
%   based on MMIL_Analyze_BOLD_Exam

% changed abcd_check_eprime and ABCD_Check_Eprime
%   to output fnames_out

% created mmil_args_ABCD_Analyze_BOLD_Exams

% changed mmil_sort_serinfo
%   to correct function name and header

% created ABCD_Compile_Exam
% renamed ABCD_Compile_Visits to ABCD_Compile_Exams
% changed ABCD_Compile_Visits
%   to incorporate code from abcd_compile_visits
%   to create job scripts to run ABCD_Compile_Exam
% removed abcd_compile_visits

% changed ABCD_Compile_Exam
%   to write unpacking.txt file to raw dir, not progress subdir

% changed MMIL_Process_Exam and MMIL_Process_Exams
%   to write unpacking.txt file to raw dir, not progress subdir

% changed MMIL_Get_Container
%   to set output to empty if ContainerDir is empty

% changed MMIL_rawQC_Exams
%   to accept date_range

% changed MMIL_rawQC_Exam
%   to remove todo note about date_range

% changed abcd_radreview
%   to print StudyDate as %d, not %s

% changed MMIL_Check_RootDirs
%   to add incoming and unpack to ContainerTypes

% created ABCD_Cleanup

% updated abcd PC functions with changes from Jose Teruel
%   abcd_pc_GE.m
%   abcd_pc_Philips.m
%   abcd_pc_Siemens.m

% changed abcd_check_eprime
%   to include SeriesInstanceUID in output
%   to accept tasknames instead of series_types

% changed ABCD_Analyze_BOLD_Exams
%   to match series in containers to series in eprime
% changed ABCD_Analyze_BOLD_Exam
%   to remove Fourier code, GLM_flag and 'GLM_' tags
%   to get taskname from csv file name
%   to run abcd_extract_eprime_mid
%   to construct stim_fnames

% changed MMIL_Process_Exam
%   to set STRUCT_VisitID to VisitID if empty

% changed ABCD_Compile_Exams
%   to set subj_info = [] if no reviewed or no good series
%   (was letting all series pass if all not reviewed or all no good)

% changed MMIL_postQC_Exam
%   to add todo notes

% changed DTI_MMIL_Calc_DT and dti_fit_tensor
%   to use scalefacts_flag with default = 0

% changed BOLD_MMIL_GLM_Analysis
%   to accept conds_contrast, pass to mmil_3dDeconv
% changed ABCD_Analyze_BOLD_Exam
%   to pass conds_contrast to BOLD_MMIL_GLM_Analysis

% changed ABCD_Analyze_BOLD_Exam
%   to call abcd_set_contrasts_mid
% created abcd_set_contrasts_mid

% rev 1002

% changed BOLD_MMIL_GLM_Analysis
%   to check numel(stim_fnames), not length(stim_fnames)
%   to accept stim_labels, pass to mmil_3dDeconv
% changed ABCD_Analyze_BOLD_Exam
%   to accept stim_labels, pass to BOLD_MMIL_GLM_Analysis

% changed ABCD_Analyze_BOLD_Exams
%   to make concat_flag accept 0, 1, or 2

% updated with changes from Jose Teruel:
%   abcd_check_eprime.m : save to one combined output file
%   abcd_get_SubjID.m : truncate NDAR ID at 16 characters
%   abcd_pc_Siemens.m : recognize new sequence name

% changed abcd_check_eprime
%   removed unnecessary subfunctions
%   added check_siteName subfunction

% changed abcd_extract_eprime_mid
%   to add todo notes

% renamed abcd_check_eprime to abcd_check_eprime_all
% changed ABCD_Check_Eprime to call abcd_check_eprime_all

% changed mmil_3dDeconv
%   to put gltmat and 1D files in subdirs

% changed mmil_read_HEAD_statsinfo to not change labels
%   previously was removing anything after initial '_'

% changed ABCD_Summarize_PC
%   to use parms.outstem

% created ABCD_Inventory

% created abcd_check_eprime
% changed abcd_check_eprime_all to use abcd_check_eprime
% changed ABCD_Analyze_BOLD_Exams
%   to use new eprime info field names

% changed ABCD_Analyze_BOLD_Exam
%   to use stim_labels and {conds_contrast.name}
%     instead of stats_info labels (truncated)

% changed MMIL_rawQC_Exams
%   to accept precheck_flag and fname_qcinfo parameters
%   to exclude previously QC'd visits
%   to exclude visits outside date range

% rev 1003

% changed ABCD_Analyze_BOLD_Exams, ABCD_Analyze_BOLD_Exam, mmil_3dDeconv
%   to accept stim_times_flag, stim_times_model, and stim_times_nbasis
% changed mmil_3dDeconv to optionally use -stim_times instead of -stim_file
% changed mmil_create_glt_files to accept stim_times options

% changed mmil_3dDeconv
%   to put quotes around file names and model name
% changed abcd_extract_eprime_mid
%   to write txt files with event times in units of TRs, not seconds
% changed abcd_check_eprime_all
%   to preselect task fMRI series before looping over series
% changed mmil_3dDeconv
%   to pass stim_times_flag, stim_times_model, stim_times_nbasis
%       to mmil_create_glt_files

% removed abcd_fiona_import_pfile and abcd_fiona_import_pfile_all
% changed abcd_summarize_pc
%   to not pass tinfo to abcd_get_SubjID
%   to set EventName = 'invalid' if empty
% changed abcd_fiona_import_all
%   to not pass jinfo to abcd_get_SubjID
%   to only use SubjID to check if phantom
%   to add human_phantom_flag and testQA_flag
%   to pre-filter fnames for phantom, humanphantom, and testQA

% changed qmatjob and qmajjob to create .isrunning and .finished files

% changed abcd_fiona_import_all
%   to use subfunctions
% renamed abcd_fiona_check_json to abcd_check_json
% renamed abcd_fiona_import to abcd_import
% renamed abcd_fiona_import_all to abcd_import_all
% renamed ABCD_FIONA_Import_Exams to ABCD_Import_Exams

% changed mmil_3dDeconv
%   to enter "*" if stimulus is not represented in a given run

% changed ABCD_Analyze_BOLD_Exams
%   to use "Philips Medical Systems" to match manufacturer instead of "PHILIPS"

% changed mmil_merge_cells
%   to remove rows with empty values in merge_field column
%   to remove rows with duplicate values in merge_field column

% changed mmil_read_mdhStruct
%   to use first endpos after startpos to select string

% changed MMIL_Process_Exam
%   to write unpacking.txt and preprocessing.txt even if errcode = 1
%   to avoid rerunning for visits with only junk scans (e.g. localizer)

% changed abcd_import_all
%   to check for missing fname_tar before checking file dates
%   to check that fname_tar exists

% changed MMIL_Process_Exam
%   to skip writing progress file if raw container does not exist
%   to write preprocessing.txt file if unpacking ended with errcode
%   to write different message in progress file if errcode

% changed abcd_import_all
%   to accept PMU_flag, with default to not import PMU files

% created ABCD_Load_Inventory
%   to create dated mat file copy of inventory csv file

% changed ABCD_Import_Exams
%   to accept and pass to abcd_import_all:
%     'phantom_pat_list','humanphantom_pat_list','testQA_pat_list'

% updated from Jose Teruel
%   abcd_pc_Philips

% added from Jose Teruel
%   abcd_summarize_pc_report

% changed abcd_check_eprime_encoding
%   to always check encoding to set fname correctly

% rev 1004

% as mmildev
% created external.2017.01.08:
% created links to everything except matlab/Projects
% changes to matlab/Projects/VolumeToolbox/6_DistortionCorrection/gradient_nonlinearity/gradient_data
%   added gradwarp files for Siemens Skyra, Connectome Skyra, and Prisma
%   added gradwarp files for GE 750W
% changes to matlab/Projects/VolumeToolbox/6_DistortionCorrection/gradient_nonlinearity/gradient_data/create_data_files
%   added coeff .grad files and gradParams .m files 
% files copied from /home/kuperman/matlab/create_data_files on 01/08/2017
%   siemens_skyra_dP.mgh
%   siemens_skyra_dL.mgh
%   siemens_skyra_dH.mgh
%   siemens_connectome_dP.mgh
%   siemens_connectome_dL.mgh
%   siemens_connectome_dH.mgh
%   ge_xrmw_dP.mgh
%   ge_xrmw_dL.mgh
%   ge_xrmw_dH.mgh
%   siemens_prisma_dP.mgh
%   siemens_prisma_dL.mgh
%   siemens_prisma_dH.mgh
% changed vol_unwarp_grad.m
%   to use gwtype=10 for mr750w
%   to use gwtype=11 for Siemens Skyra
%   to use gwtype=12 for Siemens Connectome Skyra
%   to use gwtype=13 for Siemens Prisma

% as dhagler
% changed ctx_get_gradwarpinfo
%     to assign gwtype=10 for mr750w
%     to assign gwtype=11 for Siemens Skyra
%     to assign gwtype=12 for Siemens Connectome Skyra
%     to assign gwtype=13 for Siemens Prisma
% changed to recognize additional gw types:
%   mmil_tools/mmil_unwarp_grad.m
%   epi_tools/epi_gradunwarp.m
%   bold_tools/bold_correct_data.m
%   dti_tools/dti_correct_data.m
% change link to point to external.2017.01.08

% as mmildev,
% rsync external.2017.01.08 to mmilcluster3 and mmilmcluster4
% removed broken tractoview_tools links on clusters

% changed abcd_import_all
%   to skip if json info lacks SeriesDescription

% changed ABCD_Analyze_BOLD_Exams
%   to skip visits if error loading ContainerInfo

% changed MMIL_Analyze_MRI_Exam
%   to use cortvol-sphere as input for fuzzy analysis

% changed MMIL_rawQC_Exams
%   for precheck to not have error if no QC has been done

% changed mmil_3dDeconvolve
%   added todo note about converting to BRIK and setting TR

% changed ctx_get_gradwarpinfo
%   to add extra ")" to fix error

% rev 1005

% changed MMIL_Compile_MRI_Analysis
%   to compile sulc for aparc before calculating mean values
%   use surf_roicodes instead of aparc_roicodes
%     to compile sulc and T1w aparch values

% changed ABCD_Compile_Exams
%   to accept ndar_flag

% changed MMIL_Summarize_QC and ABCD_Summarize_QC
%   to put output in ~/MetaData/ProjID

% changed to use MetaData instead of ProjInfo:
%   ABCD_Summarize_PC
%   ABCD_RadReview
%   ABCD_Merge_PC_QC
%   ABCD_Load_Inventory
%   ABCD_Inventory
%   ABCD_Compile_Exams
%   ABCD_Check_Eprime
%   MMIL_Summarize_QC
%   abcd_check_eprime_all
%   abcd_summarize_pc_report
%   abcd_radreview

% changed ABCD_Cleanup
%   to include 'pc' in ContainerTypes to check/remove

% changed ABCD_Inventory
%   to save iinfo even if json file does not exist or is not readable

% changed abcd_import_all
%   to include dates in message about forcing unpack because
%     tgz is newer than unpack check file

% changed abcd_summarize_pc_report
%   to create outdir
%   to change indentation

% changed MMIL_rawQC_Exams
%   to add comments
%   to accept alt_reviewerIDs and max_nrev

% changed MMIL_rawQC_Exam
%   to accept alt_reviewerIDs and max_nrev
%   to determine nrev and compare to max_nrev

% changed abcd_summarize_pc
%   to create outdir

% changed abcd_import_all
%   to accept check_dates_flag, with default = 0
%   to only check dates if check_dates_flag = 1
% changed ABCD_Import_Exams
%   to accept check_dates_flag, with default = 0
%   to pass check_dates_flag to abcd_import_all

% changed MMIL_rawQC_Exam
%   to reset fname_qcinfo within review_images
%   to call report_qcinfo separately
%   to skip report_qcinfo if fname_qcinfo does not exist

% changed ABCD_Compile_Exams
%   to replace 'invalid' pGUID with SubjID inferred from VisitID
%   to accept compliant_flag (default = 1)
%     to give option to ignore protocol compliance

% changed ABCD_Compile_Exam
%   to copy/link each file/dir within orig dir separately
%     and test if it already exists first
%   to use unique VisitIDs

% updated abcd_check_eprime
%   changes by Jose Teruel to check for pGUID match

% changed abcd_import_all and ABCD_Import_Exams
%   to accept check_dates_flag and check_md5sum_flag
%   to compare md5sum files and possibly force re-import

% rev 1006

% changed abcd_import and abcd_import_all to use md5sum instead of md5sum_server

% changed ABCD_Compile_Exams
%   to pass SeUIDs to ABCD_Compile_Exam

% changed abcd_import_all
%   to check if string from md5sum file is empty
%   to give WARNING if mstr is empty or does not match pattern

% changed ABCD_Compile_Exam
%   to accept SeUIDs
%   to select specific series from VisitID (for if multiple series)

% changed ctx_get_gradwarpinfo
%   to allow either 'prisma_fit' or 'prisma' as gwtype 13

% changed abcd_import_all, abcd_import, and ABCD_Import_Exams
%   to accept check_md5sum_server_flag,
%   force_unpack_err_flag, force_recon_err_flag, and force_rename_err_flag

% changed abcd_check_json
%   to compare jinfo.SequenceName to list of multi-band sequence names for GE
%   to return fname_tar = [] if P-file tgz is missing when recon required
% changed abcd_import_all to check earlier if fname_tar is empty
% changed ABCD_Copmile_Exam to display messages for each copied raw dir

% added abcd_pcqc_redcap
%   from Jose Teruel

% changed ABCD_Analyze_BOLD_Exam
%   to set paint_flag = 0 and resamp_flag = 0
%     instead of error if fspath is empty or does not exist

% changed ABCD_Analyze_BOLD_Exams
%   to  remove num_conds

% changed ABCD_Analyze_BOLD_Exam
%   to remove num_conds
%   to set_stim_fnames using stim_labels
%     instead of dir (previously had mismatch between stim_fnames and stim_labels)

% changed mmil_3dDeconv
%   to check if stim_vec is * while writing multi-run stim txt file
%   to display status/progress messages
%   to read * from stim txt file with fscanf if load fails (try/catch)

% changed run_all_MMPS.sh
%   to accept suffix parameter, add to lockfile

% changed abcd_import
%   to fix type 'upack' to 'unpack'

% changed mmil_detect_gradwarp
%   to include dcmfname in error message

% changed MMIL_Summarize_QC
%   to calculate nrev
% changed MMIL_rawQC_Exam
%   to not check nrev if forceflag=1

% changed MMIL_Summarize_QC
%   to check for duplicate SeriesInstanceUIDs (fieldmap)
%   and combine QC and notes

% changed MMIL_Check_RootDirs
%   to add 'pc'
% changed MMIL_RootDirs_from_ProjInfo and MMIL_Set_Common_RootDirs
%   to add 'incoming','unpack', and 'pc'

% changed MMIL_postQC_Exams to accept additional dMRI specific parameters
% changed MMIL_postQC_Exam to handle dMRI, fMRI, and FSURF containers
% updated qc tcl scripts, removing unnecessary variants
% added qc_recon2.tcl and qc_recon_quick.tcl

% changed dti_load_qmat
%   to updated header

% changed MMIL_postQC_Exam and MMIL_postQC_Exams
%   to accept 'reviewerID', 'alt_reviewerIDs', and 'max_nrev'

% rev 1007

% changed MMIL_Summarize_Long_Analysis

% changed MMIL_Check_RootDirs, MMIL_RootDirs_from_ProjInfo, and
%         MMIL_Set_Common_RootDirs
%   to add 'qc'

% changed abcd_import
%   to loop over all files in unpacked dir and check whether isdicomfile

% changed MMIL_postQC_Exam
%   to include 'resT1' in FA or ND file name if resT1_flag = 1
% changed MMIL_postQC_Exams
%   to accept fname_tcl_fsurf, fname_tcl_FA, fname_tcl_T2, fname_tcl_fseg
% renamed qc_recon.tcl to qc_recon_extra.tcl
% renamed qc_recon2.tcl to qc_recon.tcl
% changed MMIL_postQC_Exam
%   to make default fname_tcl_fsurf = qc_recon.tcl

% changed BOLD_MMIL_Get_ScanInfo
%   to include snums_SEpep and snums_SE_for or snums_SE_rev in snums_valid

% changed MMIL_Summarize_QC
%   to return from check_duplicate_qcinfo if SeUIDs is not a cell array of strings
%   to check_duplicate_qcinfo outside of loop

% changed abcd_load_csv
%   to say "info", not "inventory" in status message

% changed abcd_radreview
%   to accept fname_enrollment
%   to only include enrolled subjects if fname_enrollment not empty
% changed ABCD_RadReview
%   to accept fname_enrollment and pass to abcd_radreview

% updated with changes from Jose Teruel:
%   abcd_incoming_enrolled_pc_reports.m
%   abcd_pcqc_redcap.m
%   abcd_summarize_pc.m

% added new, created by Jose Teruel:
%   abcd_extract_eprime_nback.m
%   abcd_set_contrasts_nback.m

% changed MMIL_Summarize_QC
%   to continue if a series has no duplicate in check_duplicate_qcinfo

% changed ABCD_RadReview
%   to make default enflag = 0
% changed abcd_radreview
%   to not require QC field if qcflag = 0

% Jose changed mux_epi_main
%   to save results to mat file
% Jose created call_write_dicoms
%   to load mat file and write dicoms

% changed abcd_import
%   new parameters tmpdir, mb_dicoms_flag, and mb_cleanup_flag
%   to copy physio files from tmpdir to unpackdir

% changed abcd_check_json
%   to use jinfo.SequenceName if it exists as field

% copied call_mux_epi_main to mb_recon
% copied mux_epi_main to mb_mux_epi
% renamed call_write_dicoms to mb_write_dicoms
% changed abcd_import
%   to use mb_recon and mb_write_dicoms
% changed abcd_import, abcd_import_all, and ABCD_Import_Exams
%   to accept mb_tmpdir, mb_dicoms_flag, and mb_cleanup_flag

% changed mb_mux_epi
%   to remove dicom writing and unnecessary input parameters
% changed mb_recon
%   to accept outdir, outstem, forceflag
%   to pass outfile to mb_mux_epi
% changed mb_write_dicoms
%   to get mat files from indir
%   to get maxim from mat file

% changed abcd_import, abcd_import_all, and ABCD_Import_Exams
%   to accept force_dicoms_err_flag
%   to allow mb_dicoms_flag to have value of 2 (write dicoms only)

% changed abcd_import
%   to give WARNING if mb_tmpdir does not exist at time of cleanup
%   to delete err files at time of rename if force err flag

% changed ABCD_Analyze_BOLD_Exam
%   to use abcd_extract_eprime_nback and abcd_set_contrasts_nback

% changed abcd_import_all
%   to change parms.jinfo to jinfo and parms.unpackdir to unpackdir
%   when checking mb_dicoms_flag

% changed abcd_import_all
%   to not skip job when recon is finished if ~mb_dicoms_flag

% changed abcd_incoming_enrolled_pc_reports
%   Jose added report for events in incoming but missing pc for one or more ABCD series
%   changed to include all events, with 0s or 1s
%   to standardize indentation, added comments

% changed mb_recon
%   to comment out "warning off"
% changed mb_write_dicoms
%   to add "warning off"

% changed MMIL_Update_VisitInfo
%   to allow for VisitNumber in SubjID_pattern

% changed MMIL_Summarize_Long_Analysis
%   fixed labels from mmil_strsplit

% Jose created ABCD_PCQC_REDCap
% Jose created ABCD_Incoming_Enrolled_PC_Reports
% Jose changed abcd_incoming_enroled_pc_reports
%   to accept varargin
% Jose changed abcd_pcqc_redcap
%   to accept varargin

% changed abcd_check_json
%   to first determine if recon required
%   then find P-file tgz
%   to create multiband_flag and missing_pfile_flag

% changed abcd_import_all
%   to find tgz files instead of json files
%   to extract json file from tgz if missing

% Jose changed abcd_summarize_pc_report
%   to include rootdir in args2parms
% Jost changed abcd_pc_Siemens
%   to set seriesType to T1_Collection if SeriesDescription is Collection

% changed abcd_import
%   to set forceflag = 1 if mb_tmpdir is missing (and recon required)

% changed MMIL_Summarize_QC
%   to set revdisp = 1 if there is disparity between QC for different reviewers

% changed abcd_import
%   to write recon dicoms to mb_tmpdir, then tar/untar into unpackdir
% changed abcd_import_all
%   to check file size of tgz before and exclude files > 1GB
%     for extraction of json files
%   to check for json file inside tgz before extracting

% changed abcd_import_all
%   to allow job to be created if mb_dicom_flag = 2 and recon_required_flag = 1
%     even if tgz file does not exist (i.e. was deleted after recon)

% changed abcd_check_json
%   to check file format and quit if output contains 'DICOM'

% as mmildev
% copied external.2017.01.08 to external.2017.02.22
% files copied from /home/kuperman/matlab/create_data_files on 02/22/2017
%   siemens_skyra_dP.mgh
%   siemens_skyra_dL.mgh
%   siemens_skyra_dH.mgh
%   siemens_prisma_dP.mgh
%   siemens_prisma_dL.mgh
%   siemens_prisma_dH.mgh

% as dhagler
% change link to point to external.2017.02.22

% created qmatjobs_nolimit_slow and qmatjobs_nolimit_V_slow

% rev 1008

% changed abcd_import_all
%   to create subfunction check_json_file
%   to extract json file from tgz into unpack dir
%     if does not exist or is not ASCII

% changd abcd_import
%   to comment out check for ASCII (now done in abcd_import_all)
%   to not copy json file if name is identical

% changed ABCD_RadReview
%   to set parms.indir = RootDirs.incoming
%     (incoming added to MMIL_ProjInfo.csv for mmilrec14 and mmilrec18)

% changed ABCD_Import_Exams
%   to set indir = RootDirs.incoming, etc.

% added functions created by Sean Hatton:
%   MMIL_FSLong_Base_Exams.m
%   MMIL_FSLong_Get_Container.m
%   MMIL_FSLong_Register_Exams.m
%   MMIL_FSLong_Summary.m

% changed MMIL_RootDirs_from_ProjInfo
%   to add 'fslong'

% changed abcd_radreview
%   to include ReadyReview column

% changed ABCD_Import_Exams
%   to set outdir, not origdir

% changed abcd_import
%   to accept indir

% changed abcd_radreview
%   to write value for ReadyReview column

% changed MMIL_FSColorLUT
%   to correct the labels for fiber tracts 139-150 (swap LEFT and RIGHT)

% Jose changed abcd_pc_GE, abcd_pc_Philips, and abcd_pc_Siemens
%   to handle scan parameter variants
%   to make "incomplete" variable more specifically detect missing files
%     (not extra files)

% changed abcd_import_all
%   to append to log file again instead of overwriting (for each site)

% created abcd_check_import
%   to create reports on contents of incoming dir
% created ABCD_Check_Import
%   to create batchjobs to run abcd_check_import for each site

% changed abcd_check_json
%   to not require SeriesTime in json file

% changed rsi_convert_MFmeas
%   to loop over frames when resampling to T1 resolution

% renamed ABCD_Incoming_Enrolled_PC_Reports to ABCD_Incoming_Reports
% renamed abcd_incoming_enrolled_pc_reports to abcd_incoming_report
% changed abcd_incoming_report
%   to make single output csv with info about series in incoming
% changed ABCD_Incoming_Reports
%   to call abcd_incoming_report

% added abcd_incomingtopc_report

% renamed ABCD_Incoming_Reports to ABCD_Check_Incoming
% renamed abcd_incoming_report to abcd_check_incoming
% changed abcd_check_incoming
%   to save results as incoming_series_info and incoming_event_info

% changed abcd_check_import and ABCD_Check_Import
%   to set default infix = 'incoming_event_info'
%   to set indir to MetaData/DAL_ABCD_QC, not incoming_reports

% renamed abcd_check_qced to abcd_check_event_qc

% changed abcd_pcqc_redcap and ABCD_PCQC_REDCap
%   to remove e_suffix_fname parameter and not used enrolled_subjects

% Feng Xue created abcd_incomingtopc_report and ABCD_Incomingtopc_Report

% changed abcd_check_import and ABCD_Check_Import
%   to set default forceflag = 1

% changed abcd_check_import
%   to compare SeriesType to list of valid types
%   to set fdir instead of tmp as output from fileparts
%   to load from mat file to tmp without eval
%   to save 'pguidevent' to mat file, not 'tmp'

% changed abcd_check_event_qc
%   to change iqc_event_QCd to iqc_event_qcd

% rev 1009

% updated version.NOTES

% rev 1010

#############################################################################
#############################################################################

## MMPS_242: minor revision
## Don Hagler: 03/14/17

#############################################################################
#############################################################################

% changed mmil_motion_stats
%   to accept nodyflag
%   to calculate framewise-displacement without y translation

% changed MMIL_autoQC_Exam
%   to run mmil_motion_stats twice, with and without nodyflag=1
%   to save motion_stats_nody and motion_fd_nody

% changed MMIL_Summarize_QC
%   to use motion_stats_nody for mean_motion and mean_trans

% changed mmil_twin_analysis
%   to accept ico parm

% changed MMIL_Summarize_Long_Analysis
%   to use cellfun instead of mmil_splitstr

% updated version.NOTES

% rev 1011

#############################################################################
#############################################################################

## MMPS_243: minor revision
## Don Hagler: 03/19/17

#############################################################################
#############################################################################

% changed mmil_twin_analysis
%   to set v_seed for rh with offset for lh nverts

% changed MMIL_Process_Exam
%   to set STRUCT_VisitID = VisitID for all container types (including orig)

% changed MMIL_autoQC_Exam
%   to use only first frame in calc_brain_SNR
%   to calculate min, max, and median in calc_brain_SNR
%   to call calc_brain_SNR for dMRI and fMRI

% changed abcd_check_eprime
%   to check for separate extra_eprimedir
%   to add eprime_extra_file_found
%   to add eprime_extra_pguid_match

% changed ABCD_Merge_PC_QC
%   to set default merge_field to VisitID

% changed mmil_twin_analysis
%   to read results file with mmil_readtext
%     and replace '******' with 0
%     (one row in F column)

% changed MMIL_autoQC_Exam
%   to report brain_SNR values for all types

% changed abcd_radreview
%   to send last good scan within an event

% removed qmatjobs_nolimit_slow
% created qmatjobs_nolimit_himem

% changed mmil_twin_analysis
%   to set v_labels if isempty and ico~=7

% changed MMIL_autoQC_Exam and MMIL_autoQC_Exams
%   to accept cleanupflag
% changed MMIL_autoQC_exam
%   to remove mgh files at end

% changed ABCD_Cleanup
%   to check for raw qcinfo before deleting

% changed MMIL_autoQC_Exams
%   to skip job if no mgz files found

% rev 1012

% changed MMIL_Select_DTI_Series and MMIL_Select_FLEX_Series
%   to update ind_series_tmp before checking nframesok

% changed ABCD_Cleanup
%   to set RootDirs using MMIL_Get_ProjInfo

% changed abcd_import
%   to create rename_error files for more reasons
%     instead of actual error messages

% created ABCD_Concat_taskBOLD_SurfStats

% rev 1013

% changed BOLD_MMIL_Resting_Analysis
%   to calculate max_trans across multiple scans instead of averaging

% changed ABCD_Analyze_BOLD_Exam
%   to save each contrast as a separate mgz file
%   to save motion.mat and info.mat files

% changed ABCD_Concat_taskBOLD_SurfStats
%   to add TR, numTRs, nreps, motion, to output csv for each task

% changed ABCD_Analyze_BOLD_Exam
%   to set nframes in threshold_output subfunc

% changed ABCD_Compile_Exams
%   to accept complete_flag, with default =  true
%   to change how i_good is obtained

% changed ABCD_Concat_taskBOLD_SurfStats
%   to fix bugs

% changed ABCD_Analyze_BOLD_Exam
%   to use "-" instead of "_" in output file names
%     (to match behavior of fs_paint)
%   to include multiple scans in snum_sets if nscans>1 and concat_flag>0

% changed MMIL_Select_FLEX_Series
%   to remove irrelevant, old comments

% copied MMIL_Select_DTI_Series to MMIL_Select_DTI_Series_NEW
%   changed to only exclude invalid scans for a specific type
%   to accept outfix

% changed mmil_create_glt_files
%   to use %0.2f instead of %d for normalized values

% changed abcd_radreview
%   to use REDCap variable names as column headers

% changed qcshjob to output .isrunning and .finished files
% changed bcshjob to direct output to .out file
% changed qcshjobs_memlimit and qcshjobs_nolimit to not pass .csh to qcshjob
% changed qcshjob to source "$2.csh"

% changed MMIL_Compile_rsBOLD_ROI_Analysis and MMIL_Summarize_rsBOLD_Analsysis
%   to remove smean_frac and trans_frac

% removed MMIL_Select_FLEX_Series
% changed MMIL_Select_DTI_Series
%   to accomodate DTI_flex (RSI) data
%   to keep correspondence between ind_select_attempts and ind_study_attempts
%     by using cat instead of union

% changed abcd_import_all
%   to check force_rename_err_flag and remove unpackdir if rename_error file exists

% rev 1014

% changed abcd_import
%   to use sprintf instead of fprintf when setting errmsg (for rename_error)

% changed mmil_jpdfreg_T1T2 and mmil_jpdfreg2atl_T1T2
%   to update header

% changed MMIL_Select_Struct_Series
%   to keep correspondence between ind_select_attempts and ind_study_attempts
%     by using cat instead of union

% changed ABCD_Compile_Exams
%   to fix missing bracket
%   to fix "ABCD_Completed" to "Completed"

% changed MMIL_autoQC_Exams
%   to accept qccont_flag, with default = 1 (but must specify qc in ProjInfo)

% changed MMIL_autoQC_Exam
%   to accept proc_outdir
%   to save everything except tifs and qcinfo to proc_outdir

% changed MMIL_rawQC_Exams
%   to accept qccont_flag, with default = 1
%   sets outdir to matching QC container (qc RootDir specified in ProjInfo)

% changed MMIL_Summarize_QC
%   to include min, max, and median from bain_SNR
%   to include brain_SNR for dMRI and fMRI
%   to accept qccont_flag, set indir

% changed MMIL_autoQC_Exam
%   to accept outdir_group_flag (hidden parameter)
%   to chmod g+w outdir

% changed MMIL_autoQC_Exams
%   to accept outdir_group_flag (hidden parameter)
%   to set outdir_group_flag = 1 if qccont_flag = 1

% changed mmil_read_mdhStruct
%   to turn warnings off for read_mdhStruct_from_string

% changed MMIL_Process_BOLD
%   if fname_ref is empty, set fname_mask and fname_reg to empty
%   NOTE: fixes bug, in which fileparts being used on empty
%         applies in cases with separate forward and reverse field map scans

% created csh scripts for submitting jobs on cluster with queues
%   qmatjobs3_highdisk
%   qmatjobs3_highdisk2
%   qmatjobs_highdisk
%   qmatjobs_highdisk2
%   qmatjobs_lowdisk
%   qmatjobs_lowdisk2
%   qmatjobs_memlimit_V_highdisk
%   qmatjobs_memlimit_V_highdisk2
%   qmatjobs_memlimit_V_lowdisk
%   qmatjobs_memlimit_V_lowdisk2
%   qmatjobs_memlimit_highdisk
%   qmatjobs_memlimit_highdisk2
%   qmatjobs_memlimit_lowdisk
%   qmatjobs_memlimit_lowdisk2

% rev 1015

% additions and changes from Feng Xue on data tracking:

A       MMPS/matlab/abcd/abcd_check_missingseries.m
A       MMPS/matlab/abcd/abcd_check_event_eprimemissing.m
A       MMPS/matlab/abcd/abcd_check_incomingtopc.m
M       MMPS/matlab/abcd/abcd_radreview.m
A       MMPS/matlab/abcd/abcd_check_incoming2radreview.m
M       MMPS/matlab/abcd/abcd_check_incoming.m
M       MMPS/matlab/abcd/abcd_pcqc_redcap.m
A       MMPS/matlab/abcd/abcd_merge_pcqc.m
A       MMPS/matlab/abcd/abcd_combine_import.m
M       MMPS/matlab/abcd/abcd_check_import.m
A       MMPS/matlab/ABCD/ABCD_Check_Missingseries.m
A       MMPS/matlab/ABCD/ABCD_Check_Event_PCQC.m
A       MMPS/matlab/ABCD/ABCD_Check_Incomingtopc.m
M       MMPS/matlab/ABCD/ABCD_RadReview.m
A       MMPS/matlab/ABCD/ABCD_Check_Incoming2Radreview.m
M       MMPS/matlab/ABCD/ABCD_Check_Incoming.m
A       MMPS/matlab/ABCD/ABCD_Merge_PCQC.m
A       MMPS/matlab/ABCD/ABCD_Combine_Import.m
M       MMPS/matlab/ABCD/ABCD_Check_Import.m
A       MMPS/matlab/ABCD/ABCD_Check_Event_EprimeMissing.m

% changed mmil_dti_rgb_subplots
%   to not use rgb2ind (causing bad images for some datasets)

% changed mmil_average_volumes
%   to accept XetaT2 as input_scantype
% changed MMIL_Register_and_Resample_MRI_Volumes
%   to handle XetaT2 as scantype
% changed MMIL_Process_Exams, MMIL_Process_Exam, MMIL_Process_Structurals
%   to include XetaT2 in STRUCT_scantypes

% changed MMIL_Summarize_QC
%   to catch error in loading mat file

% changed ABCD_Analyze_BOLD_Exams and ABCD_Analyze_BOLD_Exam
%   to accept analysis_outfix with default = 'analysis'
%   include at the end of analysis output directory

% changed mmil_average_volumes
%   to set M_res_to_ref to eye(4) for T2

% changed mmil_jpdfreg2subj_T1T2, mmil_jpdfreg2atl_T1T2, mmil_jpdfreg_T1T2
%   to accept hidden 'smoothmask_flag' with default = true (for prior behavior)

% changed MMIL_Register_and_Resample_MRI_Volumes
%   to pass smoothmask_flag = false to mmil_average_volumes
% changed mmil_average_volumes
%   to accept smoothmask_flag and pass to mmil_jpdf_T1T2

% changed MMIL_Freesurfer_Recon_Exams
%   to accept FS_T2_flag and FS_fstem_T2
% changed MMIL_Freesurfer_Recon_Exam
%   to accept FS_T2_flag and FS_fstem_T2
%   to use MMIL_Choose_T2
%   to pass FS_fstem_T2 as fstem_T2 to MMIL_Choose_T2
% changed fs_recon
%   to accept fname_T2, to include 'T2pial' step
% created MMIL_Choose_T2

% changed MMIL_rawQC_Exams
%   to accept revdisp_flag, with values 0, 1, and 2
%   to look at revdisp values in qcinfo
%   to set forceflag = 1 if revdisp

% rev 1016

% changed MMIL_rawQC_Exam
%   to use outdir in messages instead of indir

% changed MMIL_Get_ContInfo
%   to use MMIL_Get_Container if raw field not set in StudyInfo

% changed mmil_glm
%   to replace spaces with underscore in categorical variable values

% changed ABCD_Compile_Exams
%   to use intersect instead of union when finding good QC, PC, and complete series

% changed ABCD_Analyze_BOLD_Exams and ABCD_Analyze_BOLD_Exam
%   to set default stim_times_model to 'GAM'
    
% changed MMIL_Get_QCInfo
%   to accept QC_RSI option
%   to import RSI QC file
% changed MMIL_Import_DTI_QC
%   to display correct field names in warning message
% created MMIL_Import_RSI_QC
%   copied MMIL_Import_DTI_QC, changed DTI to RSI

% changed mmil_args2parms
%   to check if valid_fields is empty (i.e. if options_schema is empty)
%   before calling setdiff (causes error in newer versions of matlab; e.g. R2014b)

% changed DTI_MMIL_Calc_DT
%   to set fname_FA (independent of forceflag), check if it exists

% created abcd_extract_eprime_sst (by M. Daniela Cornejo Ramirez)
% created abcd_set_contrasts_sst (by M. Daniela Cornejo Ramirez)

% changed ABCD_Analyze_BOLD_Exam
%   to use abcd_extract_eprime_sst and abcd_set_contrasts_sst

% changed ABCD_Concat_taskBOLD_SurfStats
%   to use abcd_set_contrasts_sst

% changed DTI_MMIL_WarpToAtlas_Exam
%   to load measures from individual files
%   to get fiber_maps dir in AtlasTrack
%   to give WARNING if dir_fiber does not exist
%   to accept fiber_maps_infix
% changed DTI_MMIL_WarpToAtlas_Exams
%   to accept fiber_maps_infix

% changed ABCD_Check_Eprime
%   to correct header info
% changed ABCD_Analyze_BOLD_Exams
%   to accept eprime_rootdir, eprime_indir, pass to ABCD_Check_Eprime

% changed ABCD_Summarize_PC
%   to accept incoming_dir

% created mmil_jpdfreg_GESE
%   based on mmil_jpdfreg2subj_T1T2

% rev 1018

% changed mmil_qmat_Philips
%   to return with WARNING message if ImagePositionPatient is missing

% rev 1019

% updated version.NOTES

% rev 1020

#############################################################################
#############################################################################

## MMPS_244: minor revision
## Don Hagler: 06/29/17

#############################################################################
#############################################################################

% changed dti_fit_tensor
%   to accept max_bval
%   to reduce qmat, bvals, vol, etc. to bvals < max_bval

% changed to accept max_bval:
%   DTI_MMIL_Calc_DT
%   DTI_MMIL_Set_DT_fstem
%   MMIL_Process_Exam
%   MMIL_Process_Exams
%   DTI_MMIL_Export_Data_for_FSL

% changed dti_fit_tensor
%   to include i_fit field in DTfit
% changed DTI_MMIL_Calc_DT
%   to use DTfit.i_fit

% rev 1021

% changed to use mmil_load_mgh_info instead of fs_read_header:
%   mmil_extract_aseg_tseries
%   mmil_extract_aparc_tseries
%   mmil_extract_aseg_group_tseries

% changed BOLD_MMIL_Resting_Analysis
%   to remove skipTRs from tags for extract functions
%   to use '-v7.3' when saving mat files

% created ABCD_Analyze_rsBOLD_Exams
%   copied from MMIL_Analyze_rsBOLD_Exams
% created ABCD_Analyze_rsBOLD_Exam
%   copied from BOLD_MMIL_Resting_Analysis

% created mmil_args_ABCD_Analyze_rsBOLD_Exams
% changed mmil_args_ABCD_Analyze_BOLD_Exams
%   to include undocumented parameters

% changed fs_wmseg
%   to document 'verbose' parameter

% changed abcd_import_all
%   to set default 'phantom_pat_list' to {'ABCDPhantom'}
%     instead of {'ABCDPhantom\d{3}'}

% rev 1022

% changed fs_erode_mask
%   to remove unused "results" variable

% as mmildev
% created external.2017.07.13
% created links to everything except matlab/Projects
% copied from ~dale/matlab_junk to matlab/Projects
% copied from 2017.02.22/matlab/Projects/VolumeToolbox/6_DistortionCorrection
%   files with dates > 2011

% as dhagler
% change external link to point to external.2017.07.13

% created mmil_wmseg
%   based on Anders' corSeg_amd

% rev 1023

% changed mmil_wmseg
%   to also save brain mask (skull stripped image of brain)

% changed MMIL_wmCorr_Structures
%   to remove fname_out from mmil_args2parms

% changed abcd_import
%   to set sdir based on dicom metadata if available instead of json

% changed MMIL_Register_and_Resample_MRI_Volumes
%   to add XetaT2 to wmbc_scantypes

% changed MMIL_wmCorr_Structurals
%   to add XetaT2 to scantypes
%   to register XetaT2 to first T1w (MPR) image

% changed mmil_jpdfreg2subj_T1T2
%   to comine T1 parms.fname_T1_mask and fname_atlmask_T2
%   not T1 parms.fname_T1_mask and parms.fname_atlasT2_mask

% changed mmil_wmseg
%   to dilate brain mask

% changes from Feng Xue:
U    MMPS/matlab/abcd/abcd_check_eprime.m
U    MMPS/matlab/abcd/abcd_check_missingseries.m
U    MMPS/matlab/abcd/abcd_check_event_pcqc.m
A    MMPS/matlab/abcd/abcd_check_pc2qc.m
U    MMPS/matlab/abcd/abcd_check_event_eprimemissing.m
U    MMPS/matlab/abcd/abcd_pc_GE.m
A    MMPS/matlab/abcd/abcd_load_projinfo_all.m
A    MMPS/matlab/abcd/abcd_save_cache.m
U    MMPS/matlab/abcd/abcd_pc_Siemens.m
U    MMPS/matlab/abcd/abcd_check_incomingtopc.m
A    MMPS/matlab/abcd/abcd_check_kspace_tgz.m
A    MMPS/matlab/abcd/abcd_get_coiltype.m
U    MMPS/matlab/abcd/abcd_radreview.m
U    MMPS/matlab/abcd/abcd_pc_Philips.m
U    MMPS/matlab/abcd/abcd_check_incoming2radreview.m
U    MMPS/matlab/abcd/abcd_check_incoming.m
U    MMPS/matlab/abcd/abcd_pcqc_redcap.m
U    MMPS/matlab/abcd/abcd_merge_pcqc.m
U    MMPS/matlab/abcd/abcd_check_eprime_all.m
U    MMPS/matlab/abcd/abcd_check_import.m
U    MMPS/matlab/ABCD/ABCD_Check_Eprime.m
U    MMPS/matlab/ABCD/ABCD_Check_Missingseries.m
U    MMPS/matlab/ABCD/ABCD_Check_Event_PCQC.m
U    MMPS/matlab/ABCD/ABCD_Check_Incomingtopc.m
A    MMPS/matlab/ABCD/ABCD_Check_Kspace_Tgz.m
U    MMPS/matlab/ABCD/ABCD_RadReview.m
U    MMPS/matlab/ABCD/ABCD_Check_Incoming2Radreview.m
U    MMPS/matlab/ABCD/ABCD_Check_Incoming.m
A    MMPS/matlab/ABCD/ABCD_Check_PC2QC.m
U    MMPS/matlab/ABCD/ABCD_Merge_PCQC.m
U    MMPS/matlab/ABCD/ABCD_Check_Import.m
U    MMPS/matlab/ABCD/ABCD_Check_Event_EprimeMissing.m
A    MMPS/matlab/mmil_utils/mmil_sortstruct.m
Updated to revision 1028.

% rev 1028

% changed MMIL_wmCorr_Structurals
%   to use T2w_image_range parameter, with default = [0,2000]

% changed MMIL_Apply_MRI_Corrections
%   to include 'XetaT2' in nu_scantypes and wmbc_scantypes

% changed MMIL_wmCorr_Structurals
%   to cleanup tmpdir

% changes from Feng Xue:
U    MMPS/matlab/abcd/abcd_check_eprime.m
U    MMPS/matlab/abcd/abcd_check_json.m
A    MMPS/matlab/abcd/abcd_2mgz.m
U    MMPS/matlab/abcd/abcd_check_eprime_all.m
U    MMPS/matlab/ABCD/ABCD_Check_Eprime.m
A    MMPS/bin/dcm2niix
Updated to revision 1036.

% rev 1036

% changes to add T2w to MRI analysis:
% DH 07/11/2017
%   changed MMIL_Analyze_MRI_Exams
%     to accept proc_aseg_flag, proc_surf_flag
%     to accept proc_inputlist, proc_outputlist, proc_scalefacts
%   changed MMIL_Analyze_MRI_Exam
%     to accept proc_aseg_flag, proc_surf_flag
%     to accept proc_indir, proc_inputlist, proc_outputlist, proc_scalefacts
% DH 07/17/2017
%   changed MMIL_Summarize_MRI_Analyais
%     to add 'proc_outputlist' as parameter
% DH 07/18/2017
%   changed MMIL_Compile_MRI_Analysis
%     to add 'proc_outputlist' as parameter (default = [])

% rev 1037

% copied mghread to external_mods/Projects
%   from /usr/pubsw/packages/MMPS/MMPS_DJH/external/matlab/Projects/MorphometryToolbox/1_10/MGH/mghread.m
%   changed to not get versn from fileparts (avoid warning)

% changed by Feng Xue:
U    MMPS/matlab/abcd/abcd_check_event_eprimemissing.m
Updated to revision 1039.

% rev 1039

% changed by Feng Xue:
U    MMPS/matlab/ABCD/ABCD_Check_Eprime.m
Updated to revision 1040.

% changed mmil_3dDeconv
%   to output x1D file

% changed abcd_import
%   to not return parms.fname_dicom from write_recon_dicoms subfunction

% changed by Feng Xue:
U    MMPS/matlab/abcd/abcd_2mgz.m
U    MMPS/matlab/abcd/abcd_check_eprime_all.m

% rev 1043

% changed ABCD_Import_Exams
%   to set default 'phantom_pat_list' to {'ABCDPhantom'}
%     instead of {'ABCDPhantom\d{3}'}

% changed mmil_qmat_Philips
%   put ImagePositionPatient in single quotes

% changed by Feng Xue:
% commented checkpoint and skppedseries functionality in abcd_check_import.m since it's really not useful now.
% rev 1044

% changed by Feng Xue:
% modified abcd_merge_pcqc.m to use try & catch for better error handling.
% rev 1047

% updated change.NOTES

% rev 1048

% changed abcd_import_all
%   to skip import for ImageType 'SCREEN SAVE'

% rev 1049

% changed abcd_import_all
%   to change message when ImageType is 'SCREEN SAVE'

% rev 1050

% changed abcd_import
%   in get_dicom_file, if dicom not found in P-file tgz
%   unpack scanner dicom tgz and find first dicom file

% rev 1051

% DH 07/19/2017
%   changed bold_unwarpB0
%     to register fname_for or fname_rev to fname_ref
%   changed to accept regref_B0uw_flag (default = 1)
%   and set default motion_B0uw_flag = 0:
%     bold_unwarpB0
%     bold_correct_data
%     MMIL_Process_Exams
%     MMIL_Process_Exam
%     MMIL_Process_BOLD

% DH 07/20/2017
%   changed bold_unwarpB0
%     to save fname_reg for registration between fname_ref and fname_for/fname_ref

% DH 07/20/2017
%   changed mmil_jpdfreg_GESE
%     to accept niters and regmask_flag
%     to create mask from fname_SE
%     to register masks as pre-registration

% DH 07/21/2017
%   changed bold_unwarpB0
%     to create separate regGESE directory for each fstem_GE

% DH 07/23/2017
%   changed BOLD_MMIL_Get_ScanInfo
%     to include fields regT1_ref_for and regT1_ref_rev
%   changed MMIL_Process_BOLD
%     to register SE images to regT1 ref intead of GE ref
%   changed bold_correct_data
%     to set afni_flag = 0 if intra_flag = 0

% DH 07/24/2017
%   changed bold_motion_corr
%     to use fs_copy_mgh and create motion_1D with zeros
%       if nframes = 1 and fname_in matches fname_ref

% DH 07/25/2017
% changed bold_correct_data
%   to set reference for motion correction to empty (self)
%     if preB0uw_flag && parms.regref_B0uw_flag

% DH 07/26/2017
% changed bold_unwarpB0
%   to calculate voxratio as voxsize_dx(1)/voxsize(1)
%     instead of inverse
%   to only smooth and resampled dx if voxratio>1

% DH 07/29/2017
% changed MMIL_Process_BOLD
%   to correctly set save_reg_flag and regref_flag
%   when calling set_resample_parms

% changed bold_motion_corr
%   to use mmil_mkdir(parms.tmpdir)
%     before copying file for one-frame motion corr

% rev 1052

% updated change.NOTES

% rev 1053

% changed ABCD_Check_PC_Exams
%   to use get RootDirs from MMIL_Get_ProjInfo
%   to set default rootdir to []

% rev 1054

% changed MMIL_wmCorr_Structurals
%   to make default ratio_range = []
%   to accept niters_spsm

% changed mmil_wm_corr, mmil_corr_wm_bias_spsm, MMIL_wmCorr_Structurals
%   to accept niters_spsm, with default = 3
%   to set default lambda2 = 5

% changed mmil_wm_corr and MMIL_wmCorr_Structurals
%   to accept n3flag, with default = true

% changed abcd_import
%   to check for sdir with SeUID only

% changed to accept max_bval:
%   MMIL_Analyze_DTI_Exam
%   MMIL_Analyze_DTI_Exams
%   MMIL_Compile_DTI_Analysis
%   MMIL_Summarize_DTI_Analysis

% changed MMIL_Analyze_DTI_Exams
%   to put excl_tags and ProjInfo_tags in parms

% rev 1055

% changed mmil_jpdfreg2subj_T1T2
%   to name temporary directory T2_to_atlT2_01 instead of DTI_to_atlT2_01

% rev 1056

% changed mmil_wm_corr
%   to allow additional variables to pass from mmil_wm_corr to mmil_wmseg
%   related to brain mask dilation

% changed MMIL_Register_and_Resample_MRI_Volumes
%   to accept T2w_image_range

% changed mmil_load_mgh_info
%   to save and return mr_parms

% changed mmil_average_volumes
%   to use mmil_load_mgh_info
%   to correctly set fname_ref to first input file

% changed mmil_wm_corr
%   to accept lambda0 and lambda1

% changed mmil_wmseg
%   to accept wm_codes, set default = [1,9,19,21] (previously hardcoded as [1 9])
%   1 = cortical wm, 9 = cerebellar wm, 19 = brainstem, 21 = wm hypointensity

% changed MMIL_wmCorr_Structurals
%   to update corr_tags

% changed default dilation parameters:
%   mmil_wmseg
%   mmil_wm_corr

% changed abcd_pc_all
%   to remove ' after "indir" in call to mmil_args2parms

% rev 1057

% changed abcd_check_incoming2radreview (XFG)
%   converted upper cases mrif variables to lower cases

% rev 1058

% changed mmil_wmseg
%   to set default wm_codes = [1,9,17,19,21] (17 = ventral DC)

% changed ABCD_Analyze_rsBOLD_Exam
%   to accept concat_flag with default = false
%   to loop over scans and calculate average correlations if concat_flag = false
% changed ABCD_Analyze_rsBOLD_Exams
%   to accept concat_flag with default = false

% changed to accept scanner flag:
%   ABCD_Check_Eprime
%   abcd_check_eprime_all
%   ABCD_Analyze_BOLD_Exams

% changed abcd_check_eprime_all
%   to get filesys info two ways

% changed ABCD_Analyze_BOLD_Exams
%   to remove eprime_tags

% rev 1059

% updated change.NOTES

% rev 1060

% updated change.NOTES

% rev 1061

% changed mmil_define_rsBOLD_networks
%   to remove defaultA, defaultB, controlA, controlB networks

% rev 1062

% updated change.NOTES

% rev 1063

% changed MMIL_Compile_rsBOLD_Analysis
%   to quit if nsubs==0
%   to initialize results = []

% changed MMIL_Summarize_rsBOLD_Analysis
%   to quit if results isempty

% rev 1064

% Changed decode_pguidevent function in abcd_check_eprime_all.m (XFG)
%       %EventName = sprintf('%s_%s_%s',k{3},k{4},k{5});
%       EventName = strjoin(kk(3:end),'_');

% rev 1065

% changed ABCD_Analyze_rsBOLD_Exams and ABCD_Analyze_rsBOLD_Exam
%   to set default mask_flag = 0
%   to set default mask_thresh = 0.7

% rev 1066

% updated change.NOTES

% rev 1067

% Changed decode_pguidevent function in abcd_check_eprime_all.m NOT to use strjoin(XFG)

% rev 1068

% Changed abcd_check_eprime.m to seek txt first (XFG)

% rev 1069

% changed abcd_import
%   to not display errcode after write_recon_dicoms

% rev 1070

% Added SeriesTime in abcd_check_eprime_all.m and modified abcd_check_pc2qc.m (XFG)
% to exclude undefinied series and make sure only one 1 exists in procfaile/waitautoqc/needrawqc vars.

% rev 1071

% updated abcd_check_incoming2radreview.m (XFG)

% rev 1072

% Reverted abcd_check_eprime_all.m to previous version since there is a StudyInstanceUID_SeriesTime column (XFG) 

% rev 1074

% Added SeriesTime in abcd_check_eprime_all.m since Octavios made some changes already (XFG) 

% rev 1075

% updated change.NOTES

% rev 1076

% created mmil_intrascan_stdev
% created mmil_interscan_stdev

% added OrchestraEpiMultiPhaseSolo.exe
%   linux 64 executable for offline recon of GE dv26 multiband data

% rev 1077

% changed mmil_intrascan_stdev
%   to calculate coef of var for intrascan stdev
%   to display number of missing files

% changed mmil_interscan_stdev and mmil_intrascan_stdev
%   to change field names in results struct

% rev 1078
% rev 1079

% changed ABCD_Analyze_BOLD_Exam and ABCD_Analyze_BOLD_Exams
%   to add aseg and aparc ROI analysis

% rev 1080

% updated change.NOTES

% rev 1081

% changed mmil_aseg_analysis
%   to set csv_flag = 0 if length(frames) > 1

% rev 1082

% changed mmil_interscan_stdev and mmil_intrascan_stdev
%   to accept verbose
%   to list missing files

% changed MMIL_Process_BOLD
%   to accept stdev_flag and stdev_plotflag
%   to run mmil_intrascan_stdev and mmil_interscan_stdev

% rev 1083

% changed MMIL_Process_BOLD
%   to include snums_SEpep for and rev in stdev calculations

% changed mmil_interscan_stdev and mmil_intrascan_stdev
%   to update messages displayed

% created qmatjobs5 and qmatjobs6

% rev 1084

% changed MMIL_Process_BOLD
%   to change outdir to 'inter' not 'intra' for snums SE

% rev 1085

% changed MMIL_Process_BOLD
%   to remove keyboard statement

% rev 1086

% M       matlab/abcd/abcd_2mgz.m
% A       matlab/fsurf_tools/fs_load_nifti_hdr.m
% A       matlab/fsurf_tools/fs_load_nifti.m
% M       bin/dcm2niix
% A       sh/merge_csv.sh
% A       sh/check_lck_wait.sh
% A       sh/projinfo_parser.sh

% rev 1087 (XFG)

% changed mmil_twin_analysis
%   to update header
%   to write nv.txt file

% changed fast_univariate_ACE.mx
%   to set number of values to loop to 4661 from 20000
%   to read nv.txt file
% changed fast_univariate_AE.mx
%   to set number of values to loop to 4661 from 20000

% created qmajjobs5 and qmajjobs6

% rev 1088

% changed MMIL_rawQC_Exams
%   to sort visits by date if date_range is not empty

% rev 1089


% changed abcd_check_pc2qc.m (XFG)

% rev 1090

% changed abcd_import_all and ABCD_Import_Exams
%   to accept 'require_subjid_flag'

% changed abcd_summarice_pc
%   to include site codes for bch, chop, and ucsf (for PCGC)

% changed ABCD_Concat_taskBOLD_SurfStats
%   to remove comment about loading eprime info

% created mmil_aparc_roicodes

% changed BOLD_MMIL_GLM_Analysis
%   to include "_scan_" in outdir if nscans>2

% changed BOLD_MMIL_Set_GLM_Stem
%   to include "_scan_" in outdir if nscans>2

% rev 1091

% changed abcd_check_pc2qc.m (XFG)

% rev 1092

% changed abcd_pc_GE.m to allow 120/180 images (XFG)

% rev 1093

% changed MMIL_Quick_StudyInfo
%   to set STRUCT_VisitID

% created ABCD_Summarize_taskBOLD_Analysis

% rev 1094

% changed MMIL_Quick_StudyInfo
%   to call check_info subfunction

% rev 1095

% changed ABCD_Summarize_taskBOLD_Analysis
%   to remove call to compile_motion (previously combined with compile_scan_info)

% rev 1096

% changed ABCD_Summarize_taskBOLD_Analysis
%   to replace "-" with "_" in field and column names
%   to skip loading roi data if fname is empty
%   misc bug fixes
%   to change results.all.data to results.data and results.all.colnames to results.colnames
%   to use tmp_data and tmp_colnames instead of results.(roitype).data

% changed ABCD_Analyze_BOLD_Exam
%   to comment try/catch around mmil_surf_roi
%   to set parms.annot before calling mmil_surf_roi
%     to correctly set roicodes
%   to pass s to get_scan_info
%     to save info for only scan(s) in current analysis

% rev 1097

% implement dcm2nii in data conversion (XFG)
% M       matlab/mmil_convert/mmil_read_dicom_vol.m
% A       matlab/mmil_convert/mmil_dcm2nii2vol.m
% M       matlab/mmil_convert/mmil_read_dicom_4dvol.m
% M       matlab/fsurf_tools/fs_load_nifti.m
% A       matlab/mmil_utils/mmil_tempfname.m

% rev 1098

% modified mmil_dcm2nii2vol.m to use dcm2niix_noflipY instead of dcm2niix (XFG)

% rev 1099

% add dcm2niix_noflipY (XFG)

% rev 1100

% changed mmil_3dDeconv (Dani Cornejo)
%   to use SPMG as default stim_times_model
%   add new parameters: censorflag, derivflag, remlflag, censorthrs, goforit

% changed mmil_motion_stats (Dani Cornejo)
%   to return deriv

% changed mmil_create_glt_files (Dani Cornejo)
%   to allow SPGM for stim_times_model
%   to allow motion_flag to have 0, 1, or 2, to enable inclusion of motion derivatives

% changed abcd_extract_eprime_nback (Dani Cornejo)
%   to write stimulus timing files in seconds

% changed abcd_set_contrasts_sst (Dani Cornejo)
%   to change conditions and contrasts

% changed abcd_extract_eprime_sst (Dani Cornejo)
%   to write stimulus timing files in seconds

% changed ABCD_Analyze_BOLD_Exam (Dani Cornejo)
%   to use SPMG as default stim_times_model
%   to add TR to deconv_tags

% changed fs_mri_convert (Dani Cornejo)
%   to accept TR as input

% renamed ABCD_Analyze_BOLD_Exams to ABCD_Analyze_taskBOLD_Exams
% renamed ABCD_Analyze_BOLD_Exam to ABCD_Analyze_taskBOLD_Exam

% changed ABCD_Analyze_taskBOLD_Exams and ABCD_Analyze_taskBOLD_Exam
%   to use Analyze_taskBOLD instead of Analyze_BOLD

% changed mmil_3dDeconv
%   to fix header for stim_times_model and nbasis

% changed ABCD_Analyze_taskBOLD_Exams
%   to use SPMG as default stim_times_model
%   in header and parms

% changed mmil_3dDeconv
%   to change censorthrs to censor_thresh
%   to change censorflag to censor_flag, derivflag to deriv_flag, remlflag to reml_flag
%   to change goforit to be two separate parameters goforit_flag and goforit_num

% change mmil_motion_stats
%   to update header to show deriv output

% changed mmil_create_glt_files
%   to set default stim_times_model to 'SPMG' in header and parms

% changed abcd_set_contrasts_sst
%   to update last mod date

% rev 1101

% added libonig2 under lib for jq on older systems (XFG)

% rev 1102

% added libonig2 under lib for jq on older systems (repush;XFG)

% rev 1103

% changed ABCD_Import_Exams
%   to set default fname_sites to use abcddaic copy

% removed ABCD_Analyze_BOLD_Exam and ABCD_Analyze_BOLD_Exams

% rev 1104

% changed ABCD_Analyze_Exams
%   to set outstem to taskBOLD instead of tskBOLD

% rev 1105

% updated change.NOTES

% rev 1106

% changed ABCD_Analyze_taskBOLD_Exams
%   to accept analysis_prefix with default = 'taskBOLD'

% renamed mmil_args_ABCD_Analyze_BOLD_Exams.m to mmil_args_ABCD_Analyze_taskBOLD_Exams.m
% changed mmil_args_ABCD_Analyze_taskBOLD_Exams
%   to update name in header

% changed mmil_3dDeconv
%   to fix missing )
%   to not pass TR to mmil_normdetrend

% rev 1107

% add lib files under lib/libonig2/ (XFG)

% rev 1108

% changed mmil_args_ABCD_Analyeze_taskBOLD_Exams
%   to update extra_tags with new parameters in taskBOLD_Exams function

% changed mmil_3dDeconv
%   to remove REML_cmd file
%   to remove spaces at end of lines

% rev 1109

% fixed one bug in abcd_pc_GE.m (XFG)

% rev 1110

% changed ABCD_Concat_taskBOLD_SurfStats
%   to use taskBOLD not tskBOLD for default instem

% changed abcd_checkjson
%   to set fname_tar if ~recon_required_flag

% rev 1111

% changed abcd_extract_eprime_sst
%   to standardize formatting (spacing, comments, etc.)
%   to remove combine_types_flag
%   to add switch_thresh
%   to replace disp statements with fprintf

% changed abcd_extract_eprime_sst
%   to standardize formatting (spacing, comments, etc.)
%   to remove combine_types_flag
%   to add switch_thresh

% changed abcd_set_contrasts_nback
%   to use condnames instead of stimnames

% changed abcd_set_contrasts_sst
%   to remove extra spaces

% copied abcd_set_contrasts_nback to abcd_set_contrasts_nback_events
% copied abcd_extract_eprime_nback to abcd_extract_eprime_nback_events

% changed abcd_set_contrasts_nback
%   to remove target, lure, and non-lure conditions
%   to change contrasts

% changed abcd_extract_eprime_nback
%   to not write fixation event (use as implicit baseline)
%   to combine cuefix, cue0back, and cue2back events into one condition
%   

% rev 1112

% changed abcd_extract_eprime_nback
%   to add error_flag parameter
%   to add extra_stimnames and extra_flag parameters

% changed abcd_set_contrasts_nback
%   to add error_flag and extra_flag parameters

% removed abcd_extract_eprime_nback_events
% removed abcd_set_contrasts_nback_events

% rev 1113

% Changed fs_load_nifti.m to test memory issue (XFG)

% rev 1114

% changed abcd_extra_eprime_nback
%   to change event_info_proc_switched to event_info_proc

% changed abcd_pc_GE
%   to check if ImagesInAcquisition <= n_files
%    instead of ImagesInAcquisition >= n_files
%   to set version = 0.0.5

% rev 1115

% changed ABCD_Analyze_taskBOLD_Exam
%   to change how numTRs and TR are checked for multiple scans
%   to use max(numTRs) and max(TR) if multiple scans

% changed abcd_extract_eprime_nback
%   to read eprime file after checking encoding
%   to initialize output for get_event_info
%   to remove call to fileparts in get_event_info (unused output)

% changed abcd_extract_eprime_mid
%   to initialize output for get_event_info
%   to remove call to fileparts in get_event_info (unused output)

% changed abcd_extract_eprime_sst
%   to remove call to fileparts in get_event_info (unused output)

% rev 1116

% changed abcd_extract_eprime_nback, abcd_extract_eprime_mid, and abcd_extract_eprime_sst
%   to remove usual first row of A unless it is missing

% changed abcd_extract_eprime_nback
%   to not require size(ind_proc,2) > 3 when setting start_time in get_event_info
%   (revert back to checking ~isempty(ind_proc))

% rev 1117

% changed abcd_pc_GE.m to use absolute numbers when checking completeness (XFG)

% rev 1118

% changed abcd_extract_eprime_nback

% created qmatjobs5_highdisk and qmatjobs5_highdisk2

% rev 1119

% changed fs_load_nifti
%   to uncomment fprintf message when scaling image

% rev 1120

% updated changed.NOTES

% rev 1121

% changed mmil_twin_analysis
%   to accept pheno_xcorr_flag (default=0) and calculate phenotypic cross-correlation
%   to accept mx_flag (default=1) to allow mx calculations to be skipped

% rev 1122

% changed abcd_extract_eprime_sst
%   to save event_info instead of event_info_switched

% changed ABCD_Analyze_taskBOLD_Exams
%   to not pass tasknames to ABCD_Check_Eprime

% changed ABCD_Analyze_taskBOLD_Exam
%   to set parms.nconds = parms.nstims + parms.ncontrasts
%   to set parms.condnames
%   to create subfunctions save_split_output and set_fstem
%   to run ROI analysis for beta and Fstat
%   to save degrees of freedom to mat file

% changed ABCD_Summarize_taskBOLD_Analysis
%   to include stim_labels in condnames (along with contrast names)
%   to loop over statnames {beta,Fstat}

% rev 1123

% changed ABCD_Analyze_taskBOLD_Exam
%   to remove fstats_type parameter (unused)

% changed ABCD_Summarize_taskBOLD_Analysis
%   to fix bugs, ordering of columns

% rev 1124

% changed ABCD_Summarize_taskBOLD_Analysis
%   to put roiname at the end of colname

% rev 1125

% changed ABCD_Analyze_taskBOLD_Exam
%   to change output file name to have correct suffix (beta or Fstat)

% changed mmil_aseg_roi and mmil_surf_roi
%   to loop over frames and set nvals_invalid independently

% changed ABCD_Summarize_taskBOLD_Analysis
%   to ensure correct ordering of output columns

% rev 1126

% changed ABCD_Summarize_taskBOLD_Analysis
%   to remove minval parameter
%   to use (again) pre-calculated avg

% rev 1127

% changed MMIL_Select_Struct_Series
%   to continue if discard_flag

% changed MMIL_autoQC_Exam
%   to set default dMRI_minTRs = 10

% rev 1128

% Modified abcd_check_incoming.m to use normalized structural images instead for SIEMENS data (XFG)

% rev 1129

% Added pqa scripts and modified abcd_check_incoming to get correct classified type for series is classified as mosaic previously (XFG)
% A       matlab/abcd/abcd_pqa_mb_fbirn.m
% A       matlab/abcd/abcd_pqa.m
% A       matlab/abcd/abcd_pqa_fbirn_qa_app_main.m
% A       matlab/abcd/abcd_pqa_summarize_bysite.m
% A       matlab/abcd/abcd_pqa_read_files.m
% A       matlab/abcd/abcd_pqa_fbirn.m
% A       matlab/abcd/abcd_pqa_summarize.m
% A       matlab/abcd/abcd_pqa_summarize_byvendor.m
% M       matlab/abcd/abcd_check_incoming.m
% A       matlab/abcd/abcd_pqa_mb_fbirn_qa_app_main.m
% A       matlab/abcd/abcd_pqa_all.m
% A       matlab/abcd/abcd_pqa_fbirn_good.m
% A       matlab/ABCD/ABCD_PQA_Summarize.m
% A       matlab/ABCD/ABCD_PQA_All.m

% rev 1130

% changed abcd_check_incoming.m
%   to classify non-normalized Siemens structural data as raw (XFG)

% rev 1131

% created fast_univariate_AE_surf.mx and fast_univariate_ACE_surf.mx
%   copied from fast_univariate_AE.mx and fast_univariate_ACE.mx
% changed fast_univariate_AE.mx and fast_univariate_ACE.mx
%   to use nvals = 20000

% rev 1132

% changed ABCD_Summarize_taskBOLD_Analysis
%   to average ROI values across runs
%   to combine scan info across runs

% rev 1133

% changed abcd_pcqc_redcap (XFG)
%   to allow other reviewers
% changed abcd_radreview
%   to check tgz before sending

% rev 1134

% changed mmil_twin_analysis
%   to allow input of data matrix

% rev 1135

% changed abcd_import
%   to look for missing dicom in tgz with fpath from parms.fname_tar
%   to rename ref_sav.dat to ref.dat and vrgf_sav.dat to vrgf.dat

% rev 1136

% changed ABCD_Cleanup
%   to accept keep_qc_flag, with default = 0

% rev 1137

% created ABCD_Summarize_rsBOLD_Analysis
%   copied from MMIL_Summarize_rsBOLD_Analysis
% created abcd_define_rsBOLD_networks
%   copied from mmil_define_rsBOLD_networks

% rev 1138

% changed mmil_motion_stats
%   to revise header

% created mmil_censor_motion

% changed ABCD_Analyze_taskBOLD_Exam
%   to use split_output, not save_split_output in render_output subfunction
%   to run split_output in render_output first, before resetting parms.outdir

% changed ABCD_Analyze_rsBOLD_Exams and ABCD_Analyze_rsBOLD_Exam
%   to accept motion_radius, motion_nodyflag
%   to accept censor_thresh, contig_thresh
%   to update header

% changed MMIL_Process_Exam
%   to pass max_bval to DTI_MMIL_AtlasTrack_Exam
% changed DTI_MMIL_AtlasTrack_Exam
%   to accept max_bval, pass to DTI_MMIL_Set_DT_fstem

% rev 1139

% Changed import scripts (XFG)
%   added value -1 to mb_recon_flag to unpack the data without checking recon
%   This will work with fast-track data
% Changed abcd_check_incoming
%   to classify T1/T2 raw series as t1_raw/t2_raw
% Changed fs_load_mgh
%   to use mmil_tempfname function to get temporary file name
% Changed mmil_tempfname
%   to skip scratch as a temp destination since some systems(like Comet) has unique ways to utilize scratch space.
% M       matlab/abcd/abcd_check_incoming.m
% M       matlab/abcd/abcd_import_all.m
% M       matlab/abcd/abcd_import.m
% M       matlab/ABCD/ABCD_Import_Exams.m
% M       matlab/fsurf_tools/fs_load_mgh.m
% M       matlab/mmil_utils/mmil_tempfname.m

% rev 1140

% changed mmil_twin_analysis
%   to use '-7.3' when saving pheno xcorr results

% changed ABCD_Analyze_rsBOLD_Exam and ABCD_Analyze_rsBOLD_Exams
%   to accept mc_notch_flag, notch_low, notch_high, notch_tb, notch_zpad_flag

% changed ABCD_Analyze_rsBOLD_Exam
%   to apply notch filter to motion_data before motion_stats or censoring
%   to calculate censor_tseries using mmil_censor_motion

% created abcd_notch_filter_motion

% changed MMIL_Analyze_DTI_Exam
%   to not pass max_bval to DTI_MMIL_Set_RSI_fstem using rsi_fstem_tags

% rev 1141

% Changed pc scripts to use fixed number of files (XFG)
% M       matlab/abcd/abcd_pc_GE.m
% M       matlab/abcd/abcd_pc_Siemens.m
% M       matlab/abcd/abcd_pc_Philips.m

% rev 1142

% Changed abcd_check_incoming to include qcroot (XFG)
% M       matlab/abcd/abcd_pc_GE.m

% rev 1143

% changed mmil_paint
%   to accept nsmooth parameter
%   to pass nsmooth to getValsOnRay

% renamed abcd_notch_filter_motion to abcd_resp_filter_motion
% changed abcd_resp_filter_motion
%   to use resp_low, resp_high

% changed ABCD_Analyze_rsBOLD_Exams and ABCD_Analyze_rsBOLD_Exam
%   to remove resp_tb, resp_zpad_flag
%   to set default resp_low = 18.6
%   to set default resp_high = 25.7

% changed ABCD_Analyze_rsBOLD_Exam
%   to exclude censored frames from variance and corr calculations
%   to weight avg var and corr using ntpoints not censored from each scan

% rev 1144

% changed ABCD_Analyze_rsBOLD_Exam
%   to update last mod date

% changed fs_annot2annot
%   to include hemi in ctab file name

% changed mmil_tempfname
%   to use RandStream instead of deprecated rand twister

% rev 1145

% changed ABCD_Analyze_rsBOLD_Exam
%   to save fparc_annot dir in ContainerPath, not analysis outdir

% rev 1146

% changed mmil_tempfname
%   to use RandStream.setGlobalStream instead of RandStream.setDefaultStream

% rev 1147

% changed ABCD_Analyze_rsBOLD_Exam
%   to check if ind_valid is empty before using corr

% rev 1148

% Changed fs_save_mgh to use mmil_tempfname (XFG)
% M       matlab/fsurf_tools/fs_save_mgh.m

% rev 1149

% changed to use ContainerInfo from proc instead of raw
%   ABCD_Concat_taskBOLD_SurfStats
%   ABCD_Summarize_taskBOLD_Analysis
%   ABCD_Analyze_taskBOLD_Exams
%   ABCD_Analyze_rsBOLD_Exams

% changed ABCD_Analyze_rsBOLD_Exam
%   to save roi corr matrix to csv file

% rev 1150

% Fixed a bug in fs_save_mgh.m (XFG)

% rev 1151

% changed ABCD_Analyze_taskBOLD_Exams and ABCD_Analyze_taskBOLD_Exam
%   to accept fparc_flag and fnames_fparc

% changed ABCD_Analyze_taskBOLD_Exam
%   to check fnames_fparc, resample fparc to subj
%   to combine aparc and resampled fparc into aparc_roi_data

% rev 1152

% changed mmil_surf_roi
%   for non-aparc annots (fparc), set roicodes using hemi specific offset

% changed ABCD_Analyze_taskBOLD_Exam
%   to save aparc and fparc analysis results separately

% created mmil_fparc_roicodes

% changed ABCD_Summarize_taskBOLD_Analysis
%   to use mmil_fparc_roicodes
%   to use get_fparc_roinames (read annot files)

% rev 1153

% Added Octavio's eprime scripts(XFG)
A       python
A       python/series_t_eprime_report.py
M       matlab/abcd/abcd_check_eprime.m
A       matlab/abcd/eprime_datetime_get.m
M       matlab/abcd/abcd_check_event_eprimemissing.m
M       matlab/abcd/abcd_check_eprime_all.m
M       matlab/ABCD/ABCD_Check_Eprime.m

% rev 1154

% Modified Octavio's python scripts (XFG)
% M       python/series_t_eprime_report.py
% A       python/eprime_sprdsht_get.py
% M       matlab/abcd/eprime_datetime_get.m

% rev 1155

% Modified abcd_check_missingseries.m (XFG)
% M       matlab/abcd/abcd_check_missingseries.m

% rev 1156

% Modified Compile scripts to allow data aggregation in different locations and filteration by QC_notes; Modified MMIL_Process_Exams to allow preproc/proc separation for dti/bold data (XFG)
% M       matlab/ABCD/ABCD_Compile_Exams.m
% M       matlab/ABCD/ABCD_Compile_Exam.m
% M       matlab/MMIL_Stream/MMIL_Process_Exams.m

% rev 1157

% created mmil_fparc_roicodes

% created MMIL_Summarize_postQC

% changed MMIL_postQC_Exams:
%   copied code and subfunctions from MMIL_rawQC_Exams
%     to check whether visits have already been QC'd and exclude them
%     to exclude visits outside date range
%   adaptations as needed

% changed MMIL_postQC_Exam:
%   to copy input_QU from MMIL_rawQC_Exam

% rev 1158

% changed MMIL_postQC_Exams and MMIL_postQC_Exam
%   to accept qc_outfix, with default = 'post'
% changed MMIL_postQC_Exam
%   to use qc_outfix instead of 'post'

% changed MMIL_Summarize_postQC
%   to accept qc_outfix

% rev 1159

% changed ABCD_Analyze_taskBOLD_Exam
%   to incorporate changes by Dani
%     related to block design and t-stats instead of F-stats

% changed ABCD_Analyze_taskBOLD_Exams and ABCD_Analyze_taskBOLD_Exam
%   to change allowed values for stim_times_flag and stim_times_model

% changed by Dani:
%   abcd_extract_eprime_mid.m
%   abcd_extract_eprime_nback.m
%   abcd_extract_eprime_sst.m
%   abcd_set_contrasts_mid.m
%   abcd_set_contrasts_nback.m
%   abcd_set_contrasts_sst.m
%   mmil_3dDeconv.m
%   mmil_create_glt_files.m
%   mmil_read_HEAD_statsinfo.m

% rev 1160

% Changed abcd_check_incoming and abcd_radreview to solve Siemens structural classification issue (XFG)
% M       matlab/abcd/abcd_radreview.m
% M       matlab/abcd/abcd_check_incoming.m

% rev 1161

% Changed mmil_tempfname to prefer /scratch (XFG)

% rev 1162

% changed mmil_read_HEAD_statsinfo
%   to get dofs for ttest or ftest

% changed mmil_aseg_roi
%   to reshape values from 4D volume 1 frame at a time
%     (to save memory)

% changed ABCD_Analyze_taskBOLD_Exam
%   to save dofs with only one element (for t-test instead of F-test)

% changed mmil_slicetiming_Philips
%   to give WARNING and return if number of files is less than number of slices

% changed ABCD_Analyze_rsBOLD_Exam
%   to renormalized filtered motion_fd
%   to use filtered motion_data as regressors instead of original motion_data

% changed ABCD_Summarize_taskBOLD_Analysis
%   to change Fstat to tstat in parms.statnames

% rev 1163

% To update Octavio's python script (XFG)
%M       python/eprime_sprdsht_get.py

% rev 1164

% Changed freesurfer exam scripts and MMIL_Choose_T*.m to allow .tar as input, also updated abcd_check_eprime.m (XFG)
%M       matlab/abcd/abcd_check_eprime.m
%M       matlab/MMIL_Stream/MMIL_Freesurfer_Recon_Exam.m
%M       matlab/MMIL_Stream/MMIL_Freesurfer_Recon_Exams.m
%M       matlab/MMIL_Utils/MMIL_Choose_T1.m
%M       matlab/MMIL_Utils/MMIL_Choose_T2.m

% rev 1165

% changed ABCD_Analyze_taskBOLD_Exam
%   to set fparc_flag = 0 if fnames_fparc is empty

% chanaged rsi_fit_MFOD and rsi_fit_iso
%   to accept and use b0_thresh and scalefacts_flag (like in dti_fit_tensor)

% changed DTI_MMIL_Calc_RSI
%   to accept and use scalefacts_flag
%   to use RSIfit.i_fit to select frames used in fit (e.g. in base of nob0_flag)

% rev 1166

% Removed lots of keyboard calls in some scripts (XFG)
% M       matlab/mxhuang/dSPM_bem_vectorview.m
% M       matlab/MMIL_Tools/MMIL_Select_DTI_Series.m
% M       matlab/jsonlab/loadjson.m
% M       matlab/dti_utils/dti_read_DTIStudio_fiber.m
% M       matlab/MMIL_Utils/MMIL_Import_PET_QC.m
% M       matlab/mmil_tools/mmil_estimate_B1RxRatio_GECal.m

% rev 1167

% Changed MMIL_Process_Exam(s) to allow tar file as input, Changed two RegInfo related scripts to use relative path when needed (XFG)
% M       matlab/DTI_Stream/DTI_MMIL_Load_RegInfo.m
% M       matlab/MMIL_Stream/MMIL_Process_Exams.m
% M       matlab/MMIL_Stream/MMIL_Process_Exam.m
% M       matlab/mmil_tools/mmil_write_regscripts.m

% rev 1168

% changed mmil_subplots
%   to accept cmap parameter

% added abcd_wmbc:
% A       MMPS/matlab/abcd_wmbc
% A       MMPS/matlab/abcd_wmbc/abcd_T1_wm_corr.m
% A       MMPS/matlab/abcd_wmbc/smoothn.m
% A       MMPS/matlab/abcd_wmbc/ABCD_wmSeg.m
% A       MMPS/matlab/abcd_wmbc/ABCD_corSeg.m
% A       MMPS/matlab/abcd_wmbc/smoothn_license.txt
% A       MMPS/matlab/abcd_wmbc/estimate_WM_biasfield_T1_ABCD.m
% A       MMPS/matlab/abcd_wmbc/ABCD_wmbc_test.m
% A       MMPS/matlab/abcd_wmbc/ABCD_wmbc.m
% A       MMPS/matlab/abcd_wmbc/mmil_corr_wm_bias_spsm_T1_ABCD.m

% changed MMIL_wmCorr_Structurals
%   to accept abcd_T1_flag (default = 1)
%   to call ABCD_wmbc if abcd_T1_flag and ~T2_flag

% rev 1169

% created abcd_erode_wm
% created abcd_dilate_bm
% changed abcd_T1_wm_corr
%   to accept image_range
% changed MMIL_wmCorr_Structurals
%   to use abcd_erode_wm and abcd_dilate_bm if abcd_T1_flag = 1
%   to pass image_range to abcd_T1_wm_corr

% rev 1170

% changed MMIL_wmCorr_Structurals
%   to fix typo

% rev 1171

% changed abcd_dilate_bm
%   to remove use of dilate_tags

% rev 1172

% changed mmil_corr_wm_bias_spsm_T1_ABCD
%   to change how circshift is used to be compatible with older matlab (2011a)

% rev 1173

% changed smoothn
%   to not use narginchk for compatibility with matlab 2011a

% rev 1174

% Changed MMIL_Process_Exams.m to allow tarball as input (XFG)

% rev 1175

% changed MMIL_Apply_MRI_Corrections
%   to add '\n' to ERROR messages
%   to use 'wm' instead of 'nu' in ERROR message for wmCorr

% rev 1176

% created mmil_tools/mmil_reg2mni.m
% created fsurf_tools/fs_save_nifti.m

% rev 1177

% created abcd/abcd_reg2mni_taskBOLD.m
% created ABCD/ABCD_reg2mni_taskBOLD_Exams.m

% rev 1178

% changed abcd_reg2mni_taskBOLD
%   to remove extra parenthesis
% changed mmil_reg2mni
%   to avoid using immv if output file is same as input
% changed ABCD_reg2mni_taskBOLD_Exams
%   to include infix and concat_flag in reg_tags

% rev 1179

% changed mmil_reg2mni
%   to give tmp file name to copy of fname_in
%   to delete temporary copy of fname_in

% changed fs_save_nifti
%   to accept options to pass to fs_mri_convert
% changed abcd_reg2mni_taskBOLD
%   to apply smoothing by passing fwhm option to fs_save_nifti

% changed abcd_set_contrasts_sst
%   to add correct_go_vs_fixation contrast

% changed MMIL_postQC_Exams and MMIL_postQC_Exam
%   to set fsurf_ftype_list = {'motion','PialOver','WMUnder',...
%                              'inhomogeneity','Artifact'}

% rev 1180

% changed mmil_regress_vol
%   to return beta
%   to accept ind_valid, calculate betas with censoring

% changed mmil_detrend_vol
%   to accept ind_valid, adjust if skipTRs>0

% changed ABCD_Analyze_rsBOLD_Exam
%   to include ind_valid in detrend_tags
%   to set ind_valid based on censor_tseries
%   to accept resid_censor_thresh and resid_contig_thresh
%   to set default resid_censor_thresh = 0.3 (based on Damien's recollection)

% rev 1181

% Minor updates to some scripts (XFG)
% M       matlab/MMIL_Stream/MMIL_Freesurfer_Recon_Exam.m
% M       matlab/abcd_wmbc/abcd_dilate_bm.m
% M       matlab/abcd_wmbc/abcd_erode_wm.m

% rev 1182

% changed ABCD_Summarize_rsBOLD
%   to remove nreps from results_tags
%   to remove 'mean_trans','max_trans','mean_rot','max_rot' from motion_tags

% rev 1183


